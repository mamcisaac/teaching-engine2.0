152e2660454dff7bf4a9f0e49053b93d
import { describe, it, expect, beforeAll, beforeEach } from '@jest/globals';
import { app } from '../../src/index';
import { authRequest } from '../test-auth-helper';
import { prisma } from '../../src/prisma';
import { setupAuthenticatedTest } from '../test-setup-helpers';
describe('calendar events', () => {
    const auth = authRequest(app);
    beforeAll(async () => {
        // prisma is imported directly
    });
    beforeEach(async () => {
        // Clean up calendar events before each test to prevent contamination
        await prisma.calendarEvent.deleteMany({});
        // Setup auth for each test to handle database resets
        await setupAuthenticatedTest(prisma, auth);
    });
    it('creates and lists events', async () => {
        const res = await auth.post('/api/calendar-events').send({
            title: 'PD Day',
            start: '2025-01-02T00:00:00.000Z',
            end: '2025-01-02T23:59:59.000Z',
            allDay: true,
            eventType: 'PD_DAY',
        });
        expect(res.status).toBe(201);
        const list = await auth.get('/api/calendar-events?start=2025-01-01&end=2025-01-03');
        expect(list.status).toBe(200);
        expect(list.body.length).toBe(1);
        expect(list.body[0].title).toBe('PD Day');
    });
    it('handles date range queries', async () => {
        // Create events in different date ranges with distinct dates
        await auth.post('/api/calendar-events').send({
            title: 'Event 1',
            start: '2025-03-05T00:00:00.000Z',
            end: '2025-03-05T23:59:59.000Z',
            allDay: true,
            eventType: 'HOLIDAY',
        });
        await auth.post('/api/calendar-events').send({
            title: 'Event 2',
            start: '2025-03-15T00:00:00.000Z',
            end: '2025-03-15T23:59:59.000Z',
            allDay: true,
            eventType: 'HOLIDAY',
        });
        // Query for specific date range that should only include Event 2
        const list = await auth.get('/api/calendar-events?start=2025-03-10&end=2025-03-20');
        expect(list.status).toBe(200);
        expect(list.body.length).toBe(1);
        expect(list.body[0].title).toBe('Event 2');
    });
    it('updates calendar events', async () => {
        // Create an event
        const createRes = await auth.post('/api/calendar-events').send({
            title: 'Original Title',
            start: '2025-02-01T00:00:00.000Z',
            end: '2025-02-01T23:59:59.000Z',
            allDay: true,
            eventType: 'HOLIDAY',
        });
        expect(createRes.status).toBe(201);
        const eventId = createRes.body.id;
        // Update the event
        const updateRes = await auth.patch(`/api/calendar-events/${eventId}`).send({
            title: 'Updated Title',
            eventType: 'PD_DAY',
        });
        expect(updateRes.status).toBe(200);
        expect(updateRes.body.title).toBe('Updated Title');
        expect(updateRes.body.eventType).toBe('PD_DAY');
    });
    it('deletes calendar events', async () => {
        // Create an event
        const createRes = await auth.post('/api/calendar-events').send({
            title: 'To Delete',
            start: '2025-03-01T00:00:00.000Z',
            end: '2025-03-01T23:59:59.000Z',
            allDay: true,
            eventType: 'HOLIDAY',
        });
        expect(createRes.status).toBe(201);
        const eventId = createRes.body.id;
        // Delete the event
        const deleteRes = await auth.delete(`/api/calendar-events/${eventId}`);
        expect(deleteRes.status).toBe(204);
        // Verify it's deleted
        const list = await auth.get('/api/calendar-events?start=2025-03-01&end=2025-03-01');
        expect(list.status).toBe(200);
        expect(list.body.length).toBe(0);
    });
    describe('Edge Cases', () => {
        it('should handle empty data scenarios gracefully', async () => {
            // Query with no events
            const list = await auth.get('/api/calendar-events?start=2030-01-01&end=2030-12-31');
            expect(list.status).toBe(200);
            expect(list.body).toEqual([]);
        });
        it('should handle invalid date formats', async () => {
            const res = await auth.post('/api/calendar-events').send({
                title: 'Invalid Date Event',
                start: 'invalid-date',
                end: '2025-01-01T00:00:00.000Z',
                eventType: 'HOLIDAY',
            });
            expect(res.status).toBe(400);
        });
        it('should handle overlapping events', async () => {
            // Create first event
            await auth.post('/api/calendar-events').send({
                title: 'Event A',
                start: '2025-04-01T10:00:00.000Z',
                end: '2025-04-01T12:00:00.000Z',
                eventType: 'CUSTOM',
            });
            // Create overlapping event - should succeed
            const res = await auth.post('/api/calendar-events').send({
                title: 'Event B',
                start: '2025-04-01T11:00:00.000Z',
                end: '2025-04-01T13:00:00.000Z',
                eventType: 'CUSTOM',
            });
            expect(res.status).toBe(201);
        });
        it('should validate required fields', async () => {
            const res = await auth.post('/api/calendar-events').send({
                // Missing required fields
                eventType: 'HOLIDAY',
            });
            expect(res.status).toBe(400);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL2ludGVncmF0aW9uL2NhbGVuZGFyRXZlbnRzLnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3RDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDMUMsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFL0QsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixNQUFNLElBQUksR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDOUIsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25CLDhCQUE4QjtJQUNoQyxDQUFDLENBQUMsQ0FBQztJQUVILFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixxRUFBcUU7UUFDckUsTUFBTSxNQUFNLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxQyxxREFBcUQ7UUFDckQsTUFBTSxzQkFBc0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsMEJBQTBCLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDeEMsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUMsSUFBSSxDQUFDO1lBQ3ZELEtBQUssRUFBRSxRQUFRO1lBQ2YsS0FBSyxFQUFFLDBCQUEwQjtZQUNqQyxHQUFHLEVBQUUsMEJBQTBCO1lBQy9CLE1BQU0sRUFBRSxJ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QyxJQUFJLENBQUM7Z0JBQ3ZELEtBQUssRUFBRSxTQUFTO2dCQUNoQixLQUFLLEVBQUUsMEJBQTBCO2dCQUNqQyxHQUFHLEVBQUUsMEJBQTBCO2dCQUMvQixTQUFTLEVBQUUsUUFBUTthQUNwQixDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvQyxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ3ZELDBCQUEwQjtnQkFDMUIsU0FBUyxFQUFFLFNBQVM7YUFDckIsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWNoYWVsbWNpc2FhYy9HaXRIdWIvdGVhY2hpbmctZW5naW5lMi4wL3NlcnZlci90ZXN0cy9pbnRlZ3JhdGlvbi9jYWxlbmRhckV2ZW50cy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVBbGwsIGJlZm9yZUVhY2ggfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB7IGFwcCB9IGZyb20gJy4uLy4uL3NyYy9pbmRleCc7XG5pbXBvcnQgeyBhdXRoUmVxdWVzdCB9IGZyb20gJy4uL3Rlc3QtYXV0aC1oZWxwZXInO1xuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vLi4vc3JjL3ByaXNtYSc7XG5pbXBvcnQgeyBzZXR1cEF1dGhlbnRpY2F0ZWRUZXN0IH0gZnJvbSAnLi4vdGVzdC1zZXR1cC1oZWxwZXJzJztcblxuZGVzY3JpYmUoJ2NhbGVuZGFyIGV2ZW50cycsICgpID0+IHtcbiAgY29uc3QgYXV0aCA9IGF1dGhSZXF1ZXN0KGFwcCk7XG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gcHJpc21hIGlzIGltcG9ydGVkIGRpcmVjdGx5XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIENsZWFuIHVwIGNhbGVuZGFyIGV2ZW50cyBiZWZvcmUgZWFjaCB0ZXN0IHRvIHByZXZlbnQgY29udGFtaW5hdGlvblxuICAgIGF3YWl0IHByaXNtYS5jYWxlbmRhckV2ZW50LmRlbGV0ZU1hbnkoe30pO1xuICAgIFxuICAgIC8vIFNldHVwIGF1dGggZm9yIGVhY2ggdGVzdCB0byBoYW5kbGUgZGF0YWJhc2UgcmVzZXRzXG4gICAgYXdhaXQgc2V0dXBBdXRoZW50aWNhdGVkVGVzdChwcmlzbWEsIGF1dGgpO1xuICB9KTtcblxuICBpdCgnY3JlYXRlcyBhbmQgbGlzdHMgZXZlbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGF1dGgucG9zdCgnL2FwaS9jYWxlbmRhci1ldmVudHMnKS5zZW5kKHtcbiAgICAgIHRpdGxlOiAnUEQgRGF5JyxcbiAgICAgIHN0YXJ0OiAnMjAyNS0wMS0wMlQwMDowMDowMC4wMDBaJyxcbiAgICAgIGVuZDogJzIwMjUtMDEtMDJUMjM6NTk6NTkuMDAwWicsXG4gICAgICBhbGxEYXk6IHRydWUsXG4gICAgICBldmVudFR5cGU6ICdQRF9EQVknLFxuICAgIH0pO1xuICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMSk7XG5cbiAgICBjb25zdCBsaXN0ID0gYXdhaXQgYXV0aC5nZXQoJy9hcGkvY2FsZW5kYXItZXZlbnRzP3N0YXJ0PTIwMjUtMDEtMDEmZW5kPTIwMjUtMDEtMDMnKTtcbiAgICBleHBlY3QobGlzdC5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICBleHBlY3QobGlzdC5ib2R5Lmxlbmd0aCkudG9CZSgxKTtcbiAgICBleHBlY3QobGlzdC5ib2R5WzBdLnRpdGxlKS50b0JlKCdQRCBEYXknKTtcbiAgfSk7XG5cbiAgaXQoJ2hhbmRsZXMgZGF0ZSByYW5nZSBxdWVyaWVzJywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIENyZWF0ZSBldmVudHMgaW4gZGlmZmVyZW50IGRhdGUgcmFuZ2VzIHdpdGggZGlzdGluY3QgZGF0ZXNcbiAgICBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvY2FsZW5kYXItZXZlbnRzJykuc2VuZCh7XG4gICAgICB0aXRsZTogJ0V2ZW50IDEnLFxuICAgICAgc3RhcnQ6ICcyMDI1LTAzLTA1VDAwOjAwOjAwLjAwMFonLFxuICAgICAgZW5kOiAnMjAyNS0wMy0wNVQyMzo1OTo1OS4wMDBaJyxcbiAgICAgIGFsbERheTogdHJ1ZSxcbiAgICAgIGV2ZW50VHlwZTogJ0hPTElEQVknLFxuICAgIH0pO1xuXG4gICAgYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cycpLnNlbmQoe1xuICAgICAgdGl0bGU6ICdFdmVudCAyJyxcbiAgICAgIHN0YXJ0OiAnMjAyNS0wMy0xNVQwMDowMDowMC4wMDBaJyxcbiAgICAgIGVuZDogJzIwMjUtMDMtMTVUMjM6NTk6NTkuMDAwWicsXG4gICAgICBhbGxEYXk6IHRydWUsXG4gICAgICBldmVudFR5cGU6ICdIT0xJREFZJyxcbiAgICB9KTtcblxuICAgIC8vIFF1ZXJ5IGZvciBzcGVjaWZpYyBkYXRlIHJhbmdlIHRoYXQgc2hvdWxkIG9ubHkgaW5jbHVkZSBFdmVudCAyXG4gICAgY29uc3QgbGlzdCA9IGF3YWl0IGF1dGguZ2V0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cz9zdGFydD0yMDI1LTAzLTEwJmVuZD0yMDI1LTAzLTIwJyk7XG4gICAgZXhwZWN0KGxpc3Quc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgZXhwZWN0KGxpc3QuYm9keS5sZW5ndGgpLnRvQmUoMSk7XG4gICAgZXhwZWN0KGxpc3QuYm9keVswXS50aXRsZSkudG9CZSgnRXZlbnQgMicpO1xuICB9KTtcblxuICBpdCgndXBkYXRlcyBjYWxlbmRhciBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIGFuIGV2ZW50XG4gICAgY29uc3QgY3JlYXRlUmVzID0gYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cycpLnNlbmQoe1xuICAgICAgdGl0bGU6ICdPcmlnaW5hbCBUaXRsZScsXG4gICAgICBzdGFydDogJzIwMjUtMDItMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICBlbmQ6ICcyMDI1LTAyLTAxVDIzOjU5OjU5LjAwMFonLFxuICAgICAgYWxsRGF5OiB0cnVlLFxuICAgICAgZXZlbnRUeXBlOiAnSE9MSURBWScsXG4gICAgfSk7XG4gICAgZXhwZWN0KGNyZWF0ZVJlcy5zdGF0dXMpLnRvQmUoMjAxKTtcbiAgICBjb25zdCBldmVudElkID0gY3JlYXRlUmVzLmJvZHkuaWQ7XG5cbiAgICAvLyBVcGRhdGUgdGhlIGV2ZW50XG4gICAgY29uc3QgdXBkYXRlUmVzID0gYXdhaXQgYXV0aC5wYXRjaChgL2FwaS9jYWxlbmRhci1ldmVudHMvJHtldmVudElkfWApLnNlbmQoe1xuICAgICAgdGl0bGU6ICdVcGRhdGVkIFRpdGxlJyxcbiAgICAgIGV2ZW50VHlwZTogJ1BEX0RBWScsXG4gICAgfSk7XG4gICAgZXhwZWN0KHVwZGF0ZVJlcy5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICBleHBlY3QodXBkYXRlUmVzLmJvZHkudGl0bGUpLnRvQmUoJ1VwZGF0ZWQgVGl0bGUnKTtcbiAgICBleHBlY3QodXBkYXRlUmVzLmJvZHkuZXZlbnRUeXBlKS50b0JlKCdQRF9EQVknKTtcbiAgfSk7XG5cbiAgaXQoJ2RlbGV0ZXMgY2FsZW5kYXIgZXZlbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIENyZWF0ZSBhbiBldmVudFxuICAgIGNvbnN0IGNyZWF0ZVJlcyA9IGF3YWl0IGF1dGgucG9zdCgnL2FwaS9jYWxlbmRhci1ldmVudHMnKS5zZW5kKHtcbiAgICAgIHRpdGxlOiAnVG8gRGVsZXRlJyxcbiAgICAgIHN0YXJ0OiAnMjAyNS0wMy0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgIGVuZDogJzIwMjUtMDMtMDFUMjM6NTk6NTkuMDAwWicsXG4gICAgICBhbGxEYXk6IHRydWUsXG4gICAgICBldmVudFR5cGU6ICdIT0xJREFZJyxcbiAgICB9KTtcbiAgICBleHBlY3QoY3JlYXRlUmVzLnN0YXR1cykudG9CZSgyMDEpO1xuICAgIGNvbnN0IGV2ZW50SWQgPSBjcmVhdGVSZXMuYm9keS5pZDtcblxuICAgIC8vIERlbGV0ZSB0aGUgZXZlbnRcbiAgICBjb25zdCBkZWxldGVSZXMgPSBhd2FpdCBhdXRoLmRlbGV0ZShgL2FwaS9jYWxlbmRhci1ldmVudHMvJHtldmVudElkfWApO1xuICAgIGV4cGVjdChkZWxldGVSZXMuc3RhdHVzKS50b0JlKDIwNCk7XG5cbiAgICAvLyBWZXJpZnkgaXQncyBkZWxldGVkXG4gICAgY29uc3QgbGlzdCA9IGF3YWl0IGF1dGguZ2V0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cz9zdGFydD0yMDI1LTAzLTAxJmVuZD0yMDI1LTAzLTAxJyk7XG4gICAgZXhwZWN0KGxpc3Quc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgZXhwZWN0KGxpc3QuYm9keS5sZW5ndGgpLnRvQmUoMCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFZGdlIENhc2VzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGRhdGEgc2NlbmFyaW9zIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBRdWVyeSB3aXRoIG5vIGV2ZW50c1xuICAgICAgY29uc3QgbGlzdCA9IGF3YWl0IGF1dGguZ2V0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cz9zdGFydD0yMDMwLTAxLTAxJmVuZD0yMDMwLTEyLTMxJyk7XG4gICAgICBleHBlY3QobGlzdC5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChsaXN0LmJvZHkpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCBkYXRlIGZvcm1hdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvY2FsZW5kYXItZXZlbnRzJykuc2VuZCh7XG4gICAgICAgIHRpdGxlOiAnSW52YWxpZCBEYXRlIEV2ZW50JyxcbiAgICAgICAgc3RhcnQ6ICdpbnZhbGlkLWRhdGUnLFxuICAgICAgICBlbmQ6ICcyMDI1LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICBldmVudFR5cGU6ICdIT0xJREFZJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG92ZXJsYXBwaW5nIGV2ZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBmaXJzdCBldmVudFxuICAgICAgYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cycpLnNlbmQoe1xuICAgICAgICB0aXRsZTogJ0V2ZW50IEEnLFxuICAgICAgICBzdGFydDogJzIwMjUtMDQtMDFUMTA6MDA6MDAuMDAwWicsXG4gICAgICAgIGVuZDogJzIwMjUtMDQtMDFUMTI6MDA6MDAuMDAwWicsXG4gICAgICAgIGV2ZW50VHlwZTogJ0NVU1RPTScsXG4gICAgICB9KTtcblxuICAgICAgLy8gQ3JlYXRlIG92ZXJsYXBwaW5nIGV2ZW50IC0gc2hvdWxkIHN1Y2NlZWRcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGF1dGgucG9zdCgnL2FwaS9jYWxlbmRhci1ldmVudHMnKS5zZW5kKHtcbiAgICAgICAgdGl0bGU6ICdFdmVudCBCJyxcbiAgICAgICAgc3RhcnQ6ICcyMDI1LTA0LTAxVDExOjAwOjAwLjAwMFonLFxuICAgICAgICBlbmQ6ICcyMDI1LTA0LTAxVDEzOjAwOjAwLjAwMFonLFxuICAgICAgICBldmVudFR5cGU6ICdDVVNUT00nLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSByZXF1aXJlZCBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvY2FsZW5kYXItZXZlbnRzJykuc2VuZCh7XG4gICAgICAgIC8vIE1pc3NpbmcgcmVxdWlyZWQgZmllbGRzXG4gICAgICAgIGV2ZW50VHlwZTogJ0hPTElEQVknLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSg0MDApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9