63751433bb6ff2e9faf3b126fc2b3d83
import { Router } from 'express';
import { prisma } from '../prisma';
import { validate } from '../validation';
import { z } from 'zod';
const router = Router();
// Analytics helper functions
function calculateTrends(entries) {
    if (entries.length < 2) {
        return { ratingTrend: 'insufficient_data', engagementTrend: 'insufficient_data' };
    }
    // Sort entries by date to analyze trends over time
    const sortedEntries = entries.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
    // Calculate rating trend
    const ratingsWithValues = sortedEntries.filter((e) => e.rating !== null);
    let ratingTrend = 'stable';
    if (ratingsWithValues.length >= 3) {
        const firstHalf = ratingsWithValues.slice(0, Math.ceil(ratingsWithValues.length / 2));
        const secondHalf = ratingsWithValues.slice(Math.floor(ratingsWithValues.length / 2));
        const firstAvg = firstHalf.reduce((sum, e) => sum + (e.rating ?? e.overallRating ?? 0), 0) / firstHalf.length;
        const secondAvg = secondHalf.reduce((sum, e) => sum + (e.rating ?? e.overallRating ?? 0), 0) /
            secondHalf.length;
        const diff = secondAvg - firstAvg;
        if (diff > 0.3)
            ratingTrend = 'improving';
        else if (diff < -0.3)
            ratingTrend = 'declining';
    }
    // Calculate engagement trend by analyzing studentEngagement text
    const engagementEntries = sortedEntries.filter((e) => e.studentEngagement);
    let engagementTrend = 'stable';
    if (engagementEntries.length >= 2) {
        const recentEntries = engagementEntries.slice(-3); // Last 3 entries
        const positiveWords = ['engaged', 'active', 'interested', 'excited', 'participated', 'focused'];
        const negativeWords = ['disengaged', 'distracted', 'bored', 'struggled', 'off-task'];
        let positiveCount = 0;
        let negativeCount = 0;
        recentEntries.forEach((entry) => {
            const text = entry.studentEngagement.toLowerCase();
            positiveWords.forEach((word) => {
                if (text.includes(word))
                    positiveCount++;
            });
            negativeWords.forEach((word) => {
                if (text.includes(word))
                    negativeCount++;
            });
        });
        if (positiveCount > negativeCount)
            engagementTrend = 'improving';
        else if (negativeCount > positiveCount)
            engagementTrend = 'declining';
    }
    return { ratingTrend, engagementTrend };
}
function extractCommonThemes(entries) {
    const successWords = new Map();
    const challengeWords = new Map();
    const improvementWords = new Map();
    entries.forEach((entry) => {
        // Extract themes from whatWorked
        if (entry.whatWorked) {
            const words = extractKeywords(entry.whatWorked);
            words.forEach((word) => {
                successWords.set(word, (successWords.get(word) || 0) + 1);
            });
        }
        // Extract themes from whatDidntWork and studentChallenges
        if (entry.whatDidntWork || entry.studentChallenges) {
            const text = `${entry.whatDidntWork || ''} ${entry.studentChallenges || ''}`;
            const words = extractKeywords(text);
            words.forEach((word) => {
                challengeWords.set(word, (challengeWords.get(word) || 0) + 1);
            });
        }
        // Extract themes from nextSteps
        if (entry.nextSteps) {
            const words = extractKeywords(entry.nextSteps);
            words.forEach((word) => {
                improvementWords.set(word, (improvementWords.get(word) || 0) + 1);
            });
        }
    });
    // Get top themes (minimum 2 occurrences)
    const getTopThemes = (wordMap) => {
        return Array.from(wordMap.entries())
            .filter(([_, count]) => count >= 2)
            .sort(([_, a], [__, b]) => b - a)
            .slice(0, 5)
            .map(([word, count]) => `${word} (${count} mentions)`);
    };
    return {
        successes: getTopThemes(successWords),
        challenges: getTopThemes(challengeWords),
        improvements: getTopThemes(improvementWords),
    };
}
function extractKeywords(text) {
    // Simple keyword extraction - remove common words and extract meaningful terms
    const commonWords = new Set([
        'the',
        'a',
        'an',
        'and',
        'or',
        'but',
        'in',
        'on',
        'at',
        'to',
        'for',
        'of',
        'with',
        'by',
        'was',
        'were',
        'is',
        'are',
        'be',
        'been',
        'have',
        'has',
        'had',
        'do',
        'does',
        'did',
        'will',
        'would',
        'could',
        'should',
        'may',
        'might',
        'can',
        'this',
        'that',
        'these',
        'those',
    ]);
    return text
        .toLowerCase()
        .replace(/[^\w\s]/g, ' ')
        .split(/\s+/)
        .filter((word) => word.length > 3 && !commonWords.has(word))
        .slice(0, 10); // Limit to prevent noise
}
function generateRecommendations(entries) {
    const recommendations = [];
    if (entries.length === 0) {
        return ['Start documenting your daily teaching experiences to build insights over time.'];
    }
    // Analyze rating patterns
    const ratedEntries = entries.filter((e) => e.rating !== null);
    if (ratedEntries.length > 0) {
        const avgRating = ratedEntries.reduce((sum, e) => sum + e.rating, 0) / ratedEntries.length;
        const lowRatedEntries = ratedEntries.filter((e) => e.rating < 3);
        if (avgRating < 3.5) {
            recommendations.push('Consider reviewing lessons with lower ratings to identify improvement patterns.');
        }
        if (lowRatedEntries.length > ratedEntries.length * 0.3) {
            recommendations.push('Focus on documenting what worked well in higher-rated lessons for replication.');
        }
    }
    // Check reflection completeness
    const reflectiveEntries = entries.filter((e) => e.whatWorked || e.whatDidntWork || e.studentEngagement || e.studentChallenges || e.nextSteps);
    if (reflectiveEntries.length < entries.length * 0.5) {
        recommendations.push('Increase reflection depth by completing more reflection fields for better insights.');
    }
    // Analyze reuse patterns
    const reusedEntries = entries.filter((e) => e.wouldReuseLesson === true);
    if (reusedEntries.length > 0) {
        recommendations.push('Document successful strategies from reusable lessons for your teaching resource bank.');
    }
    // Time-based recommendations
    const recentEntries = entries.filter((e) => {
        const entryDate = new Date(e.date);
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        return entryDate >= oneWeekAgo;
    });
    if (recentEntries.length === 0) {
        recommendations.push('Regular reflection helps identify patterns - try to document lessons weekly.');
    }
    return recommendations.length > 0
        ? recommendations
        : [
            'Continue documenting your teaching experiences to build a comprehensive reflection database.',
            'Focus on noting both successes and challenges to maximize learning opportunities.',
        ];
}
// Validation schemas
const daybookEntryCreateSchema = z.object({
    date: z.string().datetime(),
    lessonPlanId: z.string().optional(),
    whatWorked: z.string().optional(),
    whatWorkedFr: z.string().optional(),
    whatDidntWork: z.string().optional(),
    whatDidntWorkFr: z.string().optional(),
    nextSteps: z.string().optional(),
    nextStepsFr: z.string().optional(),
    studentEngagement: z.string().optional(),
    studentChallenges: z.string().optional(),
    studentSuccesses: z.string().optional(),
    notes: z.string().optional(),
    notesFr: z.string().optional(),
    privateNotes: z.string().optional(),
    overallRating: z.number().int().min(1).max(5).optional(),
    wouldReuseLesson: z.boolean().optional(),
    expectationCoverage: z
        .array(z.object({
        expectationId: z.string(),
        coverage: z.enum(['introduced', 'developing', 'consolidated']),
    }))
        .optional(),
});
const daybookEntryUpdateSchema = daybookEntryCreateSchema.partial();
// Get all daybook entries for the authenticated user
router.get('/', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { startDate, endDate, hasLessonPlan, rating } = req.query;
        const where = { userId };
        if (startDate || endDate) {
            where.date = {};
            if (startDate)
                where.date.gte = new Date(String(startDate));
            if (endDate)
                where.date.lte = new Date(String(endDate));
        }
        if (hasLessonPlan !== undefined) {
            where.lessonPlanId = hasLessonPlan === 'true' ? { not: null } : null;
        }
        if (rating) {
            where.overallRating = Number(rating);
        }
        const entries = await prisma.daybookEntry.findMany({
            where,
            orderBy: { date: 'desc' },
            include: {
                lessonPlan: {
                    select: {
                        id: true,
                        title: true,
                        unitPlan: {
                            select: {
                                id: true,
                                title: true,
                                longRangePlan: {
                                    select: {
                                        subject: true,
                                        grade: true,
                                    },
                                },
                            },
                        },
                    },
                },
                _count: {
                    select: { expectations: true },
                },
            },
        });
        res.json(entries);
    }
    catch (err) {
        _next(err);
    }
});
// Get a single daybook entry
router.get('/:id', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const entry = await prisma.daybookEntry.findFirst({
            where: {
                id: req.params.id,
                userId,
            },
            include: {
                lessonPlan: {
                    include: {
                        unitPlan: {
                            include: {
                                longRangePlan: true,
                            },
                        },
                        expectations: {
                            include: { expectation: true },
                        },
                        resources: true,
                    },
                },
                expectations: {
                    include: {
                        expectation: true,
                    },
                },
            },
        });
        if (!entry) {
            return res.status(404).json({ error: 'Daybook entry not found' });
        }
        res.json(entry);
    }
    catch (err) {
        _next(err);
    }
});
// Create a new daybook entry
router.post('/', validate(daybookEntryCreateSchema), async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { expectationCoverage, ...entryData } = req.body;
        // If linking to a lesson plan, verify ownership and no existing entry
        if (entryData.lessonPlanId) {
            const lessonPlan = await prisma.eTFOLessonPlan.findFirst({
                where: {
                    id: entryData.lessonPlanId,
                    userId,
                },
                include: {
                    daybookEntry: true,
                },
            });
            if (!lessonPlan) {
                return res.status(404).json({ error: 'Lesson plan not found' });
            }
            if (lessonPlan.daybookEntry) {
                return res.status(400).json({
                    error: 'Lesson plan already has a daybook entry',
                });
            }
        }
        const entry = await prisma.daybookEntry.create({
            data: {
                ...entryData,
                userId,
                date: new Date(entryData.date),
            },
            include: {
                lessonPlan: {
                    select: {
                        id: true,
                        title: true,
                        unitPlan: {
                            select: {
                                id: true,
                                title: true,
                                longRangePlan: {
                                    select: {
                                        subject: true,
                                        grade: true,
                                    },
                                },
                            },
                        },
                    },
                },
                _count: {
                    select: { expectations: true },
                },
            },
        });
        // Add expectation coverage if provided
        if (expectationCoverage && expectationCoverage.length > 0) {
            await prisma.daybookEntryExpectation.createMany({
                data: expectationCoverage.map((ec) => ({
                    daybookEntryId: entry.id,
                    expectationId: ec.expectationId,
                    coverage: ec.coverage,
                })),
            });
            // Refetch with expectations
            const updatedEntry = await prisma.daybookEntry.findUnique({
                where: { id: entry.id },
                include: {
                    lessonPlan: {
                        select: {
                            id: true,
                            title: true,
                            unitPlan: {
                                select: {
                                    id: true,
                                    title: true,
                                    longRangePlan: {
                                        select: {
                                            subject: true,
                                            grade: true,
                                        },
                                    },
                                },
                            },
                        },
                    },
                    expectations: {
                        include: { expectation: true },
                    },
                },
            });
            return res.status(201).json(updatedEntry);
        }
        res.status(201).json(entry);
    }
    catch (err) {
        _next(err);
    }
});
// Update a daybook entry
router.put('/:id', validate(daybookEntryUpdateSchema), async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { expectationCoverage, ...updateData } = req.body;
        // Verify ownership
        const existing = await prisma.daybookEntry.findFirst({
            where: { id: req.params.id, userId },
        });
        if (!existing) {
            return res.status(404).json({ error: 'Daybook entry not found' });
        }
        // Prepare update data
        const data = { ...updateData };
        if (updateData.date)
            data.date = new Date(updateData.date);
        // Update the entry
        const entry = await prisma.daybookEntry.update({
            where: { id: req.params.id },
            data,
        });
        // Update expectation coverage if provided
        if (expectationCoverage !== undefined) {
            // Remove existing coverage
            await prisma.daybookEntryExpectation.deleteMany({
                where: { daybookEntryId: entry.id },
            });
            // Add new coverage
            if (expectationCoverage.length > 0) {
                await prisma.daybookEntryExpectation.createMany({
                    data: expectationCoverage.map((ec) => ({
                        daybookEntryId: entry.id,
                        expectationId: ec.expectationId,
                        coverage: ec.coverage,
                    })),
                });
            }
        }
        // Refetch with updated relationships
        const updatedEntry = await prisma.daybookEntry.findUnique({
            where: { id: entry.id },
            include: {
                lessonPlan: {
                    include: {
                        unitPlan: {
                            include: {
                                longRangePlan: true,
                            },
                        },
                    },
                },
                expectations: {
                    include: { expectation: true },
                },
            },
        });
        res.json(updatedEntry);
    }
    catch (err) {
        _next(err);
    }
});
// Delete a daybook entry
router.delete('/:id', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        // Verify ownership
        const entry = await prisma.daybookEntry.findFirst({
            where: { id: req.params.id, userId },
        });
        if (!entry) {
            return res.status(404).json({ error: 'Daybook entry not found' });
        }
        await prisma.daybookEntry.delete({
            where: { id: req.params.id },
        });
        res.status(204).end();
    }
    catch (err) {
        _next(err);
    }
});
// Get daybook insights and patterns
router.get('/insights/summary', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { startDate, endDate, subject } = req.query;
        const where = { userId };
        if (startDate || endDate) {
            where.date = {};
            if (startDate)
                where.date.gte = new Date(String(startDate));
            if (endDate)
                where.date.lte = new Date(String(endDate));
        }
        if (subject) {
            where.lessonPlan = {
                unitPlan: {
                    longRangePlan: {
                        subject: String(subject),
                    },
                },
            };
        }
        // Get all entries for the period
        const entries = await prisma.daybookEntry.findMany({
            where,
            select: {
                id: true,
                date: true,
                overallRating: true,
                wouldReuseLesson: true,
                whatWorked: true,
                whatDidntWork: true,
                studentEngagement: true,
                studentChallenges: true,
                lessonPlan: {
                    select: {
                        unitPlan: {
                            select: {
                                longRangePlan: {
                                    select: { subject: true },
                                },
                            },
                        },
                    },
                },
            },
        });
        // Calculate insights
        const totalEntries = entries.length;
        const entriesWithRating = entries.filter((e) => e.overallRating !== null);
        const avgRating = entriesWithRating.length > 0
            ? entriesWithRating.reduce((sum, e) => sum + (e.overallRating ?? 0), 0) /
                entriesWithRating.length
            : null;
        const reuseStats = entries.filter((e) => e.wouldReuseLesson !== null);
        const reusePercentage = reuseStats.length > 0
            ? Math.round((reuseStats.filter((e) => e.wouldReuseLesson).length / reuseStats.length) * 100)
            : null;
        // Common themes (would need NLP for real implementation)
        const insights = {
            period: {
                start: startDate || 'all time',
                end: endDate || 'present',
            },
            summary: {
                totalEntries,
                averageRating: avgRating ? Number(avgRating.toFixed(2)) : null,
                reusePercentage,
                entriesWithReflections: entries.filter((e) => e.whatWorked || e.whatDidntWork || e.studentEngagement || e.studentChallenges).length,
            },
            trends: calculateTrends(entries),
            commonThemes: extractCommonThemes(entries),
            recommendations: generateRecommendations(entries),
        };
        res.json(insights);
    }
    catch (err) {
        _next(err);
    }
});
export default router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9yb3V0ZXMvZGF5Ym9vay1lbnRyaWVzLnRzIiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQVcsTUFBTSxTQUFTLENBQUM7QUFFMUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxLQUFLLENBQUM7QUFNeEIsTUFBTSxNQUFNLEdBQUcsTUFBTSxFQUFFLENBQUM7QUFxQnhCLDZCQUE2QjtBQUM3QixTQUFTLGVBQWUsQ0FBQyxPQUFtQztJQUkxRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDdkIsT0FBTyxFQUFFLFdBQVcsRUFBRSxtQkFBbUIsRUFBRSxlQUFlLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQztJQUNwRixDQUFDO0lBRUQsbURBQW1EO0lBQ25ELE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQ2hDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FDbEUsQ0FBQztJQUVGLHlCQUF5QjtJQUN6QixNQUFNLGlCQUFpQixHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLENBQUM7SUFDekUsSUFBSSxXQUFXLEdBQUcsUUFBUSxDQUFDO0lBRTNCLElBQUksaUJBQWlCLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ2xDLE1BQU0sU0FBUyxHQUFHLGlCQUFpQixDQUFD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SHViL3RlYWNoaW5nLWVuZ2luZTIuMC9zZXJ2ZXIvc3JjL3JvdXRlcy9kYXlib29rLWVudHJpZXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVyLCBSZXF1ZXN0IH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBQcmlzbWEgfSBmcm9tICcuLi9wcmlzbWEnO1xuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vcHJpc21hJztcbmltcG9ydCB7IHZhbGlkYXRlIH0gZnJvbSAnLi4vdmFsaWRhdGlvbic7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuaW50ZXJmYWNlIEF1dGhlbnRpY2F0ZWRSZXF1ZXN0IGV4dGVuZHMgUmVxdWVzdCB7XG4gIHVzZXI/OiB7IHVzZXJJZDogc3RyaW5nIH07XG59XG5cbmNvbnN0IHJvdXRlciA9IFJvdXRlcigpO1xuXG5pbnRlcmZhY2UgRGF5Ym9va0VudHJ5Rm9yQW5hbHl0aWNzIHtcbiAgZGF0ZTogRGF0ZSB8IHN0cmluZztcbiAgcmF0aW5nPzogbnVtYmVyIHwgbnVsbDtcbiAgb3ZlcmFsbFJhdGluZz86IG51bWJlciB8IG51bGw7XG4gIHN0dWRlbnRFbmdhZ2VtZW50Pzogc3RyaW5nIHwgbnVsbDtcbiAgd2hhdFdvcmtlZD86IHN0cmluZyB8IG51bGw7XG4gIHdoYXREaWRudFdvcms/OiBzdHJpbmcgfCBudWxsO1xuICBzdHVkZW50Q2hhbGxlbmdlcz86IHN0cmluZyB8IG51bGw7XG4gIG5leHRTdGVwcz86IHN0cmluZyB8IG51bGw7XG4gIHdvdWxkUmV1c2VMZXNzb24/OiBib29sZWFuIHwgbnVsbDtcbiAgbGVzc29uUGxhbj86IHtcbiAgICB1bml0UGxhbj86IHtcbiAgICAgIGxvbmdSYW5nZVBsYW4/OiB7XG4gICAgICAgIHN1YmplY3Q/OiBzdHJpbmc7XG4gICAgICB9IHwgbnVsbDtcbiAgICB9IHwgbnVsbDtcbiAgfSB8IG51bGw7XG59XG5cbi8vIEFuYWx5dGljcyBoZWxwZXIgZnVuY3Rpb25zXG5mdW5jdGlvbiBjYWxjdWxhdGVUcmVuZHMoZW50cmllczogRGF5Ym9va0VudHJ5Rm9yQW5hbHl0aWNzW10pOiB7XG4gIHJhdGluZ1RyZW5kOiBzdHJpbmc7XG4gIGVuZ2FnZW1lbnRUcmVuZDogc3RyaW5nO1xufSB7XG4gIGlmIChlbnRyaWVzLmxlbmd0aCA8IDIpIHtcbiAgICByZXR1cm4geyByYXRpbmdUcmVuZDogJ2luc3VmZmljaWVudF9kYXRhJywgZW5nYWdlbWVudFRyZW5kOiAnaW5zdWZmaWNpZW50X2RhdGEnIH07XG4gIH1cblxuICAvLyBTb3J0IGVudHJpZXMgYnkgZGF0ZSB0byBhbmFseXplIHRyZW5kcyBvdmVyIHRpbWVcbiAgY29uc3Qgc29ydGVkRW50cmllcyA9IGVudHJpZXMuc29ydChcbiAgICAoYSwgYikgPT4gbmV3IERhdGUoYS5kYXRlKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLmRhdGUpLmdldFRpbWUoKSxcbiAgKTtcblxuICAvLyBDYWxjdWxhdGUgcmF0aW5nIHRyZW5kXG4gIGNvbnN0IHJhdGluZ3NXaXRoVmFsdWVzID0gc29ydGVkRW50cmllcy5maWx0ZXIoKGUpID0+IGUucmF0aW5nICE9PSBudWxsKTtcbiAgbGV0IHJhdGluZ1RyZW5kID0gJ3N0YWJsZSc7XG5cbiAgaWYgKHJhdGluZ3NXaXRoVmFsdWVzLmxlbmd0aCA+PSAzKSB7XG4gICAgY29uc3QgZmlyc3RIYWxmID0gcmF0aW5nc1dpdGhWYWx1ZXMuc2xpY2UoMCwgTWF0aC5jZWlsKHJhdGluZ3NXaXRoVmFsdWVzLmxlbmd0aCAvIDIpKTtcbiAgICBjb25zdCBzZWNvbmRIYWxmID0gcmF0aW5nc1dpdGhWYWx1ZXMuc2xpY2UoTWF0aC5mbG9vcihyYXRpbmdzV2l0aFZhbHVlcy5sZW5ndGggLyAyKSk7XG5cbiAgICBjb25zdCBmaXJzdEF2ZyA9XG4gICAgICBmaXJzdEhhbGYucmVkdWNlKChzdW0sIGUpID0+IHN1bSArIChlLnJhdGluZyA/PyBlLm92ZXJhbGxSYXRpbmcgPz8gMCksIDApIC8gZmlyc3RIYWxmLmxlbmd0aDtcbiAgICBjb25zdCBzZWNvbmRBdmcgPVxuICAgICAgc2Vjb25kSGFsZi5yZWR1Y2UoKHN1bSwgZSkgPT4gc3VtICsgKGUucmF0aW5nID8/IGUub3ZlcmFsbFJhdGluZyA/PyAwKSwgMCkgL1xuICAgICAgc2Vjb25kSGFsZi5sZW5ndGg7XG5cbiAgICBjb25zdCBkaWZmID0gc2Vjb25kQXZnIC0gZmlyc3RBdmc7XG4gICAgaWYgKGRpZmYgPiAwLjMpIHJhdGluZ1RyZW5kID0gJ2ltcHJvdmluZyc7XG4gICAgZWxzZSBpZiAoZGlmZiA8IC0wLjMpIHJhdGluZ1RyZW5kID0gJ2RlY2xpbmluZyc7XG4gIH1cblxuICAvLyBDYWxjdWxhdGUgZW5nYWdlbWVudCB0cmVuZCBieSBhbmFseXppbmcgc3R1ZGVudEVuZ2FnZW1lbnQgdGV4dFxuICBjb25zdCBlbmdhZ2VtZW50RW50cmllcyA9IHNvcnRlZEVudHJpZXMuZmlsdGVyKChlKSA9PiBlLnN0dWRlbnRFbmdhZ2VtZW50KTtcbiAgbGV0IGVuZ2FnZW1lbnRUcmVuZCA9ICdzdGFibGUnO1xuXG4gIGlmIChlbmdhZ2VtZW50RW50cmllcy5sZW5ndGggPj0gMikge1xuICAgIGNvbnN0IHJlY2VudEVudHJpZXMgPSBlbmdhZ2VtZW50RW50cmllcy5zbGljZSgtMyk7IC8vIExhc3QgMyBlbnRyaWVzXG4gICAgY29uc3QgcG9zaXRpdmVXb3JkcyA9IFsnZW5nYWdlZCcsICdhY3RpdmUnLCAnaW50ZXJlc3RlZCcsICdleGNpdGVkJywgJ3BhcnRpY2lwYXRlZCcsICdmb2N1c2VkJ107XG4gICAgY29uc3QgbmVnYXRpdmVXb3JkcyA9IFsnZGlzZW5nYWdlZCcsICdkaXN0cmFjdGVkJywgJ2JvcmVkJywgJ3N0cnVnZ2xlZCcsICdvZmYtdGFzayddO1xuXG4gICAgbGV0IHBvc2l0aXZlQ291bnQgPSAwO1xuICAgIGxldCBuZWdhdGl2ZUNvdW50ID0gMDtcblxuICAgIHJlY2VudEVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgIGNvbnN0IHRleHQgPSBlbnRyeS5zdHVkZW50RW5nYWdlbWVudC50b0xvd2VyQ2FzZSgpO1xuICAgICAgcG9zaXRpdmVXb3Jkcy5mb3JFYWNoKCh3b3JkKSA9PiB7XG4gICAgICAgIGlmICh0ZXh0LmluY2x1ZGVzKHdvcmQpKSBwb3NpdGl2ZUNvdW50Kys7XG4gICAgICB9KTtcbiAgICAgIG5lZ2F0aXZlV29yZHMuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICBpZiAodGV4dC5pbmNsdWRlcyh3b3JkKSkgbmVnYXRpdmVDb3VudCsrO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpZiAocG9zaXRpdmVDb3VudCA+IG5lZ2F0aXZlQ291bnQpIGVuZ2FnZW1lbnRUcmVuZCA9ICdpbXByb3ZpbmcnO1xuICAgIGVsc2UgaWYgKG5lZ2F0aXZlQ291bnQgPiBwb3NpdGl2ZUNvdW50KSBlbmdhZ2VtZW50VHJlbmQgPSAnZGVjbGluaW5nJztcbiAgfVxuXG4gIHJldHVybiB7IHJhdGluZ1RyZW5kLCBlbmdhZ2VtZW50VHJlbmQgfTtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdENvbW1vblRoZW1lcyhlbnRyaWVzOiBEYXlib29rRW50cnlGb3JBbmFseXRpY3NbXSk6IHtcbiAgc3VjY2Vzc2VzOiBzdHJpbmdbXTtcbiAgY2hhbGxlbmdlczogc3RyaW5nW107XG4gIGltcHJvdmVtZW50czogc3RyaW5nW107XG59IHtcbiAgY29uc3Qgc3VjY2Vzc1dvcmRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgY29uc3QgY2hhbGxlbmdlV29yZHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICBjb25zdCBpbXByb3ZlbWVudFdvcmRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcblxuICBlbnRyaWVzLmZvckVhY2goKGVudHJ5KSA9PiB7XG4gICAgLy8gRXh0cmFjdCB0aGVtZXMgZnJvbSB3aGF0V29ya2VkXG4gICAgaWYgKGVudHJ5LndoYXRXb3JrZWQpIHtcbiAgICAgIGNvbnN0IHdvcmRzID0gZXh0cmFjdEtleXdvcmRzKGVudHJ5LndoYXRXb3JrZWQpO1xuICAgICAgd29yZHMuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICBzdWNjZXNzV29yZHMuc2V0KHdvcmQsIChzdWNjZXNzV29yZHMuZ2V0KHdvcmQpIHx8IDApICsgMSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBFeHRyYWN0IHRoZW1lcyBmcm9tIHdoYXREaWRudFdvcmsgYW5kIHN0dWRlbnRDaGFsbGVuZ2VzXG4gICAgaWYgKGVudHJ5LndoYXREaWRudFdvcmsgfHwgZW50cnkuc3R1ZGVudENoYWxsZW5nZXMpIHtcbiAgICAgIGNvbnN0IHRleHQgPSBgJHtlbnRyeS53aGF0RGlkbnRXb3JrIHx8ICcnfSAke2VudHJ5LnN0dWRlbnRDaGFsbGVuZ2VzIHx8ICcnfWA7XG4gICAgICBjb25zdCB3b3JkcyA9IGV4dHJhY3RLZXl3b3Jkcyh0ZXh0KTtcbiAgICAgIHdvcmRzLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgY2hhbGxlbmdlV29yZHMuc2V0KHdvcmQsIChjaGFsbGVuZ2VXb3Jkcy5nZXQod29yZCkgfHwgMCkgKyAxKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgdGhlbWVzIGZyb20gbmV4dFN0ZXBzXG4gICAgaWYgKGVudHJ5Lm5leHRTdGVwcykge1xuICAgICAgY29uc3Qgd29yZHMgPSBleHRyYWN0S2V5d29yZHMoZW50cnkubmV4dFN0ZXBzKTtcbiAgICAgIHdvcmRzLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgaW1wcm92ZW1lbnRXb3Jkcy5zZXQod29yZCwgKGltcHJvdmVtZW50V29yZHMuZ2V0KHdvcmQpIHx8IDApICsgMSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIEdldCB0b3AgdGhlbWVzIChtaW5pbXVtIDIgb2NjdXJyZW5jZXMpXG4gIGNvbnN0IGdldFRvcFRoZW1lcyA9ICh3b3JkTWFwOiBNYXA8c3RyaW5nLCBudW1iZXI+KSA9PiB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20od29yZE1hcC5lbnRyaWVzKCkpXG4gICAgICAuZmlsdGVyKChbXywgY291bnRdKSA9PiBjb3VudCA+PSAyKVxuICAgICAgLnNvcnQoKFtfLCBhXSwgW19fLCBiXSkgPT4gYiAtIGEpXG4gICAgICAuc2xpY2UoMCwgNSlcbiAgICAgIC5tYXAoKFt3b3JkLCBjb3VudF0pID0+IGAke3dvcmR9ICgke2NvdW50fSBtZW50aW9ucylgKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHN1Y2Nlc3NlczogZ2V0VG9wVGhlbWVzKHN1Y2Nlc3NXb3JkcyksXG4gICAgY2hhbGxlbmdlczogZ2V0VG9wVGhlbWVzKGNoYWxsZW5nZVdvcmRzKSxcbiAgICBpbXByb3ZlbWVudHM6IGdldFRvcFRoZW1lcyhpbXByb3ZlbWVudFdvcmRzKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdEtleXdvcmRzKHRleHQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgLy8gU2ltcGxlIGtleXdvcmQgZXh0cmFjdGlvbiAtIHJlbW92ZSBjb21tb24gd29yZHMgYW5kIGV4dHJhY3QgbWVhbmluZ2Z1bCB0ZXJtc1xuICBjb25zdCBjb21tb25Xb3JkcyA9IG5ldyBTZXQoW1xuICAgICd0aGUnLFxuICAgICdhJyxcbiAgICAnYW4nLFxuICAgICdhbmQnLFxuICAgICdvcicsXG4gICAgJ2J1dCcsXG4gICAgJ2luJyxcbiAgICAnb24nLFxuICAgICdhdCcsXG4gICAgJ3RvJyxcbiAgICAnZm9yJyxcbiAgICAnb2YnLFxuICAgICd3aXRoJyxcbiAgICAnYnknLFxuICAgICd3YXMnLFxuICAgICd3ZXJlJyxcbiAgICAnaXMnLFxuICAgICdhcmUnLFxuICAgICdiZScsXG4gICAgJ2JlZW4nLFxuICAgICdoYXZlJyxcbiAgICAnaGFzJyxcbiAgICAnaGFkJyxcbiAgICAnZG8nLFxuICAgICdkb2VzJyxcbiAgICAnZGlkJyxcbiAgICAnd2lsbCcsXG4gICAgJ3dvdWxkJyxcbiAgICAnY291bGQnLFxuICAgICdzaG91bGQnLFxuICAgICdtYXknLFxuICAgICdtaWdodCcsXG4gICAgJ2NhbicsXG4gICAgJ3RoaXMnLFxuICAgICd0aGF0JyxcbiAgICAndGhlc2UnLFxuICAgICd0aG9zZScsXG4gIF0pO1xuXG4gIHJldHVybiB0ZXh0XG4gICAgLnRvTG93ZXJDYXNlKClcbiAgICAucmVwbGFjZSgvW15cXHdcXHNdL2csICcgJylcbiAgICAuc3BsaXQoL1xccysvKVxuICAgIC5maWx0ZXIoKHdvcmQpID0+IHdvcmQubGVuZ3RoID4gMyAmJiAhY29tbW9uV29yZHMuaGFzKHdvcmQpKVxuICAgIC5zbGljZSgwLCAxMCk7IC8vIExpbWl0IHRvIHByZXZlbnQgbm9pc2Vcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoZW50cmllczogRGF5Ym9va0VudHJ5Rm9yQW5hbHl0aWNzW10pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICBpZiAoZW50cmllcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gWydTdGFydCBkb2N1bWVudGluZyB5b3VyIGRhaWx5IHRlYWNoaW5nIGV4cGVyaWVuY2VzIHRvIGJ1aWxkIGluc2lnaHRzIG92ZXIgdGltZS4nXTtcbiAgfVxuXG4gIC8vIEFuYWx5emUgcmF0aW5nIHBhdHRlcm5zXG4gIGNvbnN0IHJhdGVkRW50cmllcyA9IGVudHJpZXMuZmlsdGVyKChlKSA9PiBlLnJhdGluZyAhPT0gbnVsbCk7XG4gIGlmIChyYXRlZEVudHJpZXMubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IGF2Z1JhdGluZyA9IHJhdGVkRW50cmllcy5yZWR1Y2UoKHN1bSwgZSkgPT4gc3VtICsgZS5yYXRpbmcsIDApIC8gcmF0ZWRFbnRyaWVzLmxlbmd0aDtcbiAgICBjb25zdCBsb3dSYXRlZEVudHJpZXMgPSByYXRlZEVudHJpZXMuZmlsdGVyKChlKSA9PiBlLnJhdGluZyA8IDMpO1xuXG4gICAgaWYgKGF2Z1JhdGluZyA8IDMuNSkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXG4gICAgICAgICdDb25zaWRlciByZXZpZXdpbmcgbGVzc29ucyB3aXRoIGxvd2VyIHJhdGluZ3MgdG8gaWRlbnRpZnkgaW1wcm92ZW1lbnQgcGF0dGVybnMuJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGxvd1JhdGVkRW50cmllcy5sZW5ndGggPiByYXRlZEVudHJpZXMubGVuZ3RoICogMC4zKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICAgJ0ZvY3VzIG9uIGRvY3VtZW50aW5nIHdoYXQgd29ya2VkIHdlbGwgaW4gaGlnaGVyLXJhdGVkIGxlc3NvbnMgZm9yIHJlcGxpY2F0aW9uLicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8vIENoZWNrIHJlZmxlY3Rpb24gY29tcGxldGVuZXNzXG4gIGNvbnN0IHJlZmxlY3RpdmVFbnRyaWVzID0gZW50cmllcy5maWx0ZXIoXG4gICAgKGUpID0+XG4gICAgICBlLndoYXRXb3JrZWQgfHwgZS53aGF0RGlkbnRXb3JrIHx8IGUuc3R1ZGVudEVuZ2FnZW1lbnQgfHwgZS5zdHVkZW50Q2hhbGxlbmdlcyB8fCBlLm5leHRTdGVwcyxcbiAgKTtcblxuICBpZiAocmVmbGVjdGl2ZUVudHJpZXMubGVuZ3RoIDwgZW50cmllcy5sZW5ndGggKiAwLjUpIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICdJbmNyZWFzZSByZWZsZWN0aW9uIGRlcHRoIGJ5IGNvbXBsZXRpbmcgbW9yZSByZWZsZWN0aW9uIGZpZWxkcyBmb3IgYmV0dGVyIGluc2lnaHRzLicsXG4gICAgKTtcbiAgfVxuXG4gIC8vIEFuYWx5emUgcmV1c2UgcGF0dGVybnNcbiAgY29uc3QgcmV1c2VkRW50cmllcyA9IGVudHJpZXMuZmlsdGVyKChlKSA9PiBlLndvdWxkUmV1c2VMZXNzb24gPT09IHRydWUpO1xuICBpZiAocmV1c2VkRW50cmllcy5sZW5ndGggPiAwKSB7XG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goXG4gICAgICAnRG9jdW1lbnQgc3VjY2Vzc2Z1bCBzdHJhdGVnaWVzIGZyb20gcmV1c2FibGUgbGVzc29ucyBmb3IgeW91ciB0ZWFjaGluZyByZXNvdXJjZSBiYW5rLicsXG4gICAgKTtcbiAgfVxuXG4gIC8vIFRpbWUtYmFzZWQgcmVjb21tZW5kYXRpb25zXG4gIGNvbnN0IHJlY2VudEVudHJpZXMgPSBlbnRyaWVzLmZpbHRlcigoZSkgPT4ge1xuICAgIGNvbnN0IGVudHJ5RGF0ZSA9IG5ldyBEYXRlKGUuZGF0ZSk7XG4gICAgY29uc3Qgb25lV2Vla0FnbyA9IG5ldyBEYXRlKCk7XG4gICAgb25lV2Vla0Fnby5zZXREYXRlKG9uZVdlZWtBZ28uZ2V0RGF0ZSgpIC0gNyk7XG4gICAgcmV0dXJuIGVudHJ5RGF0ZSA+PSBvbmVXZWVrQWdvO1xuICB9KTtcblxuICBpZiAocmVjZW50RW50cmllcy5sZW5ndGggPT09IDApIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICdSZWd1bGFyIHJlZmxlY3Rpb24gaGVscHMgaWRlbnRpZnkgcGF0dGVybnMgLSB0cnkgdG8gZG9jdW1lbnQgbGVzc29ucyB3ZWVrbHkuJyxcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucy5sZW5ndGggPiAwXG4gICAgPyByZWNvbW1lbmRhdGlvbnNcbiAgICA6IFtcbiAgICAgICAgJ0NvbnRpbnVlIGRvY3VtZW50aW5nIHlvdXIgdGVhY2hpbmcgZXhwZXJpZW5jZXMgdG8gYnVpbGQgYSBjb21wcmVoZW5zaXZlIHJlZmxlY3Rpb24gZGF0YWJhc2UuJyxcbiAgICAgICAgJ0ZvY3VzIG9uIG5vdGluZyBib3RoIHN1Y2Nlc3NlcyBhbmQgY2hhbGxlbmdlcyB0byBtYXhpbWl6ZSBsZWFybmluZyBvcHBvcnR1bml0aWVzLicsXG4gICAgICBdO1xufVxuXG4vLyBWYWxpZGF0aW9uIHNjaGVtYXNcbmNvbnN0IGRheWJvb2tFbnRyeUNyZWF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgZGF0ZTogei5zdHJpbmcoKS5kYXRldGltZSgpLFxuICBsZXNzb25QbGFuSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgd2hhdFdvcmtlZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB3aGF0V29ya2VkRnI6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgd2hhdERpZG50V29yazogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB3aGF0RGlkbnRXb3JrRnI6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgbmV4dFN0ZXBzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIG5leHRTdGVwc0ZyOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHN0dWRlbnRFbmdhZ2VtZW50OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHN0dWRlbnRDaGFsbGVuZ2VzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHN0dWRlbnRTdWNjZXNzZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgbm90ZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgbm90ZXNGcjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBwcml2YXRlTm90ZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgb3ZlcmFsbFJhdGluZzogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDUpLm9wdGlvbmFsKCksXG4gIHdvdWxkUmV1c2VMZXNzb246IHouYm9vbGVhbigpLm9wdGlvbmFsKCksXG4gIGV4cGVjdGF0aW9uQ292ZXJhZ2U6IHpcbiAgICAuYXJyYXkoXG4gICAgICB6Lm9iamVjdCh7XG4gICAgICAgIGV4cGVjdGF0aW9uSWQ6IHouc3RyaW5nKCksXG4gICAgICAgIGNvdmVyYWdlOiB6LmVudW0oWydpbnRyb2R1Y2VkJywgJ2RldmVsb3BpbmcnLCAnY29uc29saWRhdGVkJ10pLFxuICAgICAgfSksXG4gICAgKVxuICAgIC5vcHRpb25hbCgpLFxufSk7XG5cbmNvbnN0IGRheWJvb2tFbnRyeVVwZGF0ZVNjaGVtYSA9IGRheWJvb2tFbnRyeUNyZWF0ZVNjaGVtYS5wYXJ0aWFsKCk7XG5cbi8vIEdldCBhbGwgZGF5Ym9vayBlbnRyaWVzIGZvciB0aGUgYXV0aGVudGljYXRlZCB1c2VyXG5yb3V0ZXIuZ2V0KCcvJywgYXN5bmMgKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlcywgX25leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSBwYXJzZUludChyZXEudXNlcj8udXNlcklkIHx8ICcwJywgMTApO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBzdGFydERhdGUsIGVuZERhdGUsIGhhc0xlc3NvblBsYW4sIHJhdGluZyB9ID0gcmVxLnF1ZXJ5O1xuXG4gICAgY29uc3Qgd2hlcmU6IFByaXNtYS5EYXlib29rRW50cnlXaGVyZUlucHV0ID0geyB1c2VySWQgfTtcblxuICAgIGlmIChzdGFydERhdGUgfHwgZW5kRGF0ZSkge1xuICAgICAgd2hlcmUuZGF0ZSA9IHt9O1xuICAgICAgaWYgKHN0YXJ0RGF0ZSkgd2hlcmUuZGF0ZS5ndGUgPSBuZXcgRGF0ZShTdHJpbmcoc3RhcnREYXRlKSk7XG4gICAgICBpZiAoZW5kRGF0ZSkgd2hlcmUuZGF0ZS5sdGUgPSBuZXcgRGF0ZShTdHJpbmcoZW5kRGF0ZSkpO1xuICAgIH1cblxuICAgIGlmIChoYXNMZXNzb25QbGFuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHdoZXJlLmxlc3NvblBsYW5JZCA9IGhhc0xlc3NvblBsYW4gPT09ICd0cnVlJyA/IHsgbm90OiBudWxsIH0gOiBudWxsO1xuICAgIH1cblxuICAgIGlmIChyYXRpbmcpIHtcbiAgICAgIHdoZXJlLm92ZXJhbGxSYXRpbmcgPSBOdW1iZXIocmF0aW5nKTtcbiAgICB9XG5cbiAgICBjb25zdCBlbnRyaWVzID0gYXdhaXQgcHJpc21hLmRheWJvb2tFbnRyeS5maW5kTWFueSh7XG4gICAgICB3aGVyZSxcbiAgICAgIG9yZGVyQnk6IHsgZGF0ZTogJ2Rlc2MnIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGxlc3NvblBsYW46IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICB1bml0UGxhbjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsb25nUmFuZ2VQbGFuOiB7XG4gICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgc3ViamVjdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZ3JhZGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIF9jb3VudDoge1xuICAgICAgICAgIHNlbGVjdDogeyBleHBlY3RhdGlvbnM6IHRydWUgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXMuanNvbihlbnRyaWVzKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgX25leHQoZXJyKTtcbiAgfVxufSk7XG5cbi8vIEdldCBhIHNpbmdsZSBkYXlib29rIGVudHJ5XG5yb3V0ZXIuZ2V0KCcvOmlkJywgYXN5bmMgKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlcywgX25leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSBwYXJzZUludChyZXEudXNlcj8udXNlcklkIHx8ICcwJywgMTApO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgZW50cnkgPSBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogcmVxLnBhcmFtcy5pZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgbGVzc29uUGxhbjoge1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHVuaXRQbGFuOiB7XG4gICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBsb25nUmFuZ2VQbGFuOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uczoge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7IGV4cGVjdGF0aW9uOiB0cnVlIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzb3VyY2VzOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGV4cGVjdGF0aW9uczoge1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFlbnRyeSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdEYXlib29rIGVudHJ5IG5vdCBmb3VuZCcgfSk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24oZW50cnkpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBfbmV4dChlcnIpO1xuICB9XG59KTtcblxuLy8gQ3JlYXRlIGEgbmV3IGRheWJvb2sgZW50cnlcbnJvdXRlci5wb3N0KFxuICAnLycsXG4gIHZhbGlkYXRlKGRheWJvb2tFbnRyeUNyZWF0ZVNjaGVtYSksXG4gIGFzeW5jIChyZXE6IEF1dGhlbnRpY2F0ZWRSZXF1ZXN0LCByZXMsIF9uZXh0KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHBhcnNlSW50KHJlcS51c2VyPy51c2VySWQgfHwgJzAnLCAxMCk7XG4gICAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgZXhwZWN0YXRpb25Db3ZlcmFnZSwgLi4uZW50cnlEYXRhIH0gPSByZXEuYm9keTtcblxuICAgICAgLy8gSWYgbGlua2luZyB0byBhIGxlc3NvbiBwbGFuLCB2ZXJpZnkgb3duZXJzaGlwIGFuZCBubyBleGlzdGluZyBlbnRyeVxuICAgICAgaWYgKGVudHJ5RGF0YS5sZXNzb25QbGFuSWQpIHtcbiAgICAgICAgY29uc3QgbGVzc29uUGxhbiA9IGF3YWl0IHByaXNtYS5lVEZPTGVzc29uUGxhbi5maW5kRmlyc3Qoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBpZDogZW50cnlEYXRhLmxlc3NvblBsYW5JZCxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIGRheWJvb2tFbnRyeTogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWxlc3NvblBsYW4pIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0xlc3NvbiBwbGFuIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGVzc29uUGxhbi5kYXlib29rRW50cnkpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgZXJyb3I6ICdMZXNzb24gcGxhbiBhbHJlYWR5IGhhcyBhIGRheWJvb2sgZW50cnknLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVudHJ5ID0gYXdhaXQgcHJpc21hLmRheWJvb2tFbnRyeS5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uZW50cnlEYXRhLFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBkYXRlOiBuZXcgRGF0ZShlbnRyeURhdGEuZGF0ZSksXG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBsZXNzb25QbGFuOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgICB1bml0UGxhbjoge1xuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICB0aXRsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGxvbmdSYW5nZVBsYW46IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgc3ViamVjdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICBncmFkZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBleHBlY3RhdGlvbnM6IHRydWUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBleHBlY3RhdGlvbiBjb3ZlcmFnZSBpZiBwcm92aWRlZFxuICAgICAgaWYgKGV4cGVjdGF0aW9uQ292ZXJhZ2UgJiYgZXhwZWN0YXRpb25Db3ZlcmFnZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5kYXlib29rRW50cnlFeHBlY3RhdGlvbi5jcmVhdGVNYW55KHtcbiAgICAgICAgICBkYXRhOiBleHBlY3RhdGlvbkNvdmVyYWdlLm1hcCgoZWM6IHsgZXhwZWN0YXRpb25JZDogc3RyaW5nOyBjb3ZlcmFnZTogc3RyaW5nIH0pID0+ICh7XG4gICAgICAgICAgICBkYXlib29rRW50cnlJZDogZW50cnkuaWQsXG4gICAgICAgICAgICBleHBlY3RhdGlvbklkOiBlYy5leHBlY3RhdGlvbklkLFxuICAgICAgICAgICAgY292ZXJhZ2U6IGVjLmNvdmVyYWdlLFxuICAgICAgICAgIH0pKSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVmZXRjaCB3aXRoIGV4cGVjdGF0aW9uc1xuICAgICAgICBjb25zdCB1cGRhdGVkRW50cnkgPSBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmZpbmRVbmlxdWUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiBlbnRyeS5pZCB9LFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIGxlc3NvblBsYW46IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgdW5pdFBsYW46IHtcbiAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGxvbmdSYW5nZVBsYW46IHtcbiAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBncmFkZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uczoge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7IGV4cGVjdGF0aW9uOiB0cnVlIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbih1cGRhdGVkRW50cnkpO1xuICAgICAgfVxuXG4gICAgICByZXMuc3RhdHVzKDIwMSkuanNvbihlbnRyeSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBfbmV4dChlcnIpO1xuICAgIH1cbiAgfSxcbik7XG5cbi8vIFVwZGF0ZSBhIGRheWJvb2sgZW50cnlcbnJvdXRlci5wdXQoXG4gICcvOmlkJyxcbiAgdmFsaWRhdGUoZGF5Ym9va0VudHJ5VXBkYXRlU2NoZW1hKSxcbiAgYXN5bmMgKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlcywgX25leHQpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlcklkID0gcGFyc2VJbnQocmVxLnVzZXI/LnVzZXJJZCB8fCAnMCcsIDEwKTtcbiAgICAgIGlmICghdXNlcklkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBleHBlY3RhdGlvbkNvdmVyYWdlLCAuLi51cGRhdGVEYXRhIH0gPSByZXEuYm9keTtcblxuICAgICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiByZXEucGFyYW1zLmlkLCB1c2VySWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWV4aXN0aW5nKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnRGF5Ym9vayBlbnRyeSBub3QgZm91bmQnIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBQcmVwYXJlIHVwZGF0ZSBkYXRhXG4gICAgICBjb25zdCBkYXRhOiBQcmlzbWEuRGF5Ym9va0VudHJ5VXBkYXRlSW5wdXQgPSB7IC4uLnVwZGF0ZURhdGEgfTtcbiAgICAgIGlmICh1cGRhdGVEYXRhLmRhdGUpIGRhdGEuZGF0ZSA9IG5ldyBEYXRlKHVwZGF0ZURhdGEuZGF0ZSk7XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgZW50cnlcbiAgICAgIGNvbnN0IGVudHJ5ID0gYXdhaXQgcHJpc21hLmRheWJvb2tFbnRyeS51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZDogcmVxLnBhcmFtcy5pZCB9LFxuICAgICAgICBkYXRhLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFVwZGF0ZSBleHBlY3RhdGlvbiBjb3ZlcmFnZSBpZiBwcm92aWRlZFxuICAgICAgaWYgKGV4cGVjdGF0aW9uQ292ZXJhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAvLyBSZW1vdmUgZXhpc3RpbmcgY292ZXJhZ2VcbiAgICAgICAgYXdhaXQgcHJpc21hLmRheWJvb2tFbnRyeUV4cGVjdGF0aW9uLmRlbGV0ZU1hbnkoe1xuICAgICAgICAgIHdoZXJlOiB7IGRheWJvb2tFbnRyeUlkOiBlbnRyeS5pZCB9LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGQgbmV3IGNvdmVyYWdlXG4gICAgICAgIGlmIChleHBlY3RhdGlvbkNvdmVyYWdlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5RXhwZWN0YXRpb24uY3JlYXRlTWFueSh7XG4gICAgICAgICAgICBkYXRhOiBleHBlY3RhdGlvbkNvdmVyYWdlLm1hcCgoZWM6IHsgZXhwZWN0YXRpb25JZDogc3RyaW5nOyBjb3ZlcmFnZTogc3RyaW5nIH0pID0+ICh7XG4gICAgICAgICAgICAgIGRheWJvb2tFbnRyeUlkOiBlbnRyeS5pZCxcbiAgICAgICAgICAgICAgZXhwZWN0YXRpb25JZDogZWMuZXhwZWN0YXRpb25JZCxcbiAgICAgICAgICAgICAgY292ZXJhZ2U6IGVjLmNvdmVyYWdlLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFJlZmV0Y2ggd2l0aCB1cGRhdGVkIHJlbGF0aW9uc2hpcHNcbiAgICAgIGNvbnN0IHVwZGF0ZWRFbnRyeSA9IGF3YWl0IHByaXNtYS5kYXlib29rRW50cnkuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBlbnRyeS5pZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgbGVzc29uUGxhbjoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB1bml0UGxhbjoge1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgIGxvbmdSYW5nZVBsYW46IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBleHBlY3RhdGlvbnM6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHsgZXhwZWN0YXRpb246IHRydWUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHJlcy5qc29uKHVwZGF0ZWRFbnRyeSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBfbmV4dChlcnIpO1xuICAgIH1cbiAgfSxcbik7XG5cbi8vIERlbGV0ZSBhIGRheWJvb2sgZW50cnlcbnJvdXRlci5kZWxldGUoJy86aWQnLCBhc3luYyAocmVxOiBBdXRoZW50aWNhdGVkUmVxdWVzdCwgcmVzLCBfbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHBhcnNlSW50KHJlcS51c2VyPy51c2VySWQgfHwgJzAnLCAxMCk7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9KTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZnkgb3duZXJzaGlwXG4gICAgY29uc3QgZW50cnkgPSBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZTogeyBpZDogcmVxLnBhcmFtcy5pZCwgdXNlcklkIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIWVudHJ5KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0RheWJvb2sgZW50cnkgbm90IGZvdW5kJyB9KTtcbiAgICB9XG5cbiAgICBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmRlbGV0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogcmVxLnBhcmFtcy5pZCB9LFxuICAgIH0pO1xuXG4gICAgcmVzLnN0YXR1cygyMDQpLmVuZCgpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBfbmV4dChlcnIpO1xuICB9XG59KTtcblxuLy8gR2V0IGRheWJvb2sgaW5zaWdodHMgYW5kIHBhdHRlcm5zXG5yb3V0ZXIuZ2V0KCcvaW5zaWdodHMvc3VtbWFyeScsIGFzeW5jIChyZXE6IEF1dGhlbnRpY2F0ZWRSZXF1ZXN0LCByZXMsIF9uZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlcklkID0gcGFyc2VJbnQocmVxLnVzZXI/LnVzZXJJZCB8fCAnMCcsIDEwKTtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHsgc3RhcnREYXRlLCBlbmREYXRlLCBzdWJqZWN0IH0gPSByZXEucXVlcnk7XG5cbiAgICBjb25zdCB3aGVyZTogUHJpc21hLkRheWJvb2tFbnRyeVdoZXJlSW5wdXQgPSB7IHVzZXJJZCB9O1xuXG4gICAgaWYgKHN0YXJ0RGF0ZSB8fCBlbmREYXRlKSB7XG4gICAgICB3aGVyZS5kYXRlID0ge307XG4gICAgICBpZiAoc3RhcnREYXRlKSB3aGVyZS5kYXRlLmd0ZSA9IG5ldyBEYXRlKFN0cmluZyhzdGFydERhdGUpKTtcbiAgICAgIGlmIChlbmREYXRlKSB3aGVyZS5kYXRlLmx0ZSA9IG5ldyBEYXRlKFN0cmluZyhlbmREYXRlKSk7XG4gICAgfVxuXG4gICAgaWYgKHN1YmplY3QpIHtcbiAgICAgIHdoZXJlLmxlc3NvblBsYW4gPSB7XG4gICAgICAgIHVuaXRQbGFuOiB7XG4gICAgICAgICAgbG9uZ1JhbmdlUGxhbjoge1xuICAgICAgICAgICAgc3ViamVjdDogU3RyaW5nKHN1YmplY3QpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEdldCBhbGwgZW50cmllcyBmb3IgdGhlIHBlcmlvZFxuICAgIGNvbnN0IGVudHJpZXMgPSBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmZpbmRNYW55KHtcbiAgICAgIHdoZXJlLFxuICAgICAgc2VsZWN0OiB7XG4gICAgICAgIGlkOiB0cnVlLFxuICAgICAgICBkYXRlOiB0cnVlLFxuICAgICAgICBvdmVyYWxsUmF0aW5nOiB0cnVlLFxuICAgICAgICB3b3VsZFJldXNlTGVzc29uOiB0cnVlLFxuICAgICAgICB3aGF0V29ya2VkOiB0cnVlLFxuICAgICAgICB3aGF0RGlkbnRXb3JrOiB0cnVlLFxuICAgICAgICBzdHVkZW50RW5nYWdlbWVudDogdHJ1ZSxcbiAgICAgICAgc3R1ZGVudENoYWxsZW5nZXM6IHRydWUsXG4gICAgICAgIGxlc3NvblBsYW46IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIHVuaXRQbGFuOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGxvbmdSYW5nZVBsYW46IHtcbiAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBzdWJqZWN0OiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBDYWxjdWxhdGUgaW5zaWdodHNcbiAgICBjb25zdCB0b3RhbEVudHJpZXMgPSBlbnRyaWVzLmxlbmd0aDtcbiAgICBjb25zdCBlbnRyaWVzV2l0aFJhdGluZyA9IGVudHJpZXMuZmlsdGVyKChlKSA9PiBlLm92ZXJhbGxSYXRpbmcgIT09IG51bGwpO1xuICAgIGNvbnN0IGF2Z1JhdGluZyA9XG4gICAgICBlbnRyaWVzV2l0aFJhdGluZy5sZW5ndGggPiAwXG4gICAgICAgID8gZW50cmllc1dpdGhSYXRpbmcucmVkdWNlKChzdW0sIGUpID0+IHN1bSArIChlLm92ZXJhbGxSYXRpbmcgPz8gMCksIDApIC9cbiAgICAgICAgICBlbnRyaWVzV2l0aFJhdGluZy5sZW5ndGhcbiAgICAgICAgOiBudWxsO1xuXG4gICAgY29uc3QgcmV1c2VTdGF0cyA9IGVudHJpZXMuZmlsdGVyKChlKSA9PiBlLndvdWxkUmV1c2VMZXNzb24gIT09IG51bGwpO1xuICAgIGNvbnN0IHJldXNlUGVyY2VudGFnZSA9XG4gICAgICByZXVzZVN0YXRzLmxlbmd0aCA+IDBcbiAgICAgICAgPyBNYXRoLnJvdW5kKFxuICAgICAgICAgICAgKHJldXNlU3RhdHMuZmlsdGVyKChlKSA9PiBlLndvdWxkUmV1c2VMZXNzb24pLmxlbmd0aCAvIHJldXNlU3RhdHMubGVuZ3RoKSAqIDEwMCxcbiAgICAgICAgICApXG4gICAgICAgIDogbnVsbDtcblxuICAgIC8vIENvbW1vbiB0aGVtZXMgKHdvdWxkIG5lZWQgTkxQIGZvciByZWFsIGltcGxlbWVudGF0aW9uKVxuICAgIGNvbnN0IGluc2lnaHRzID0ge1xuICAgICAgcGVyaW9kOiB7XG4gICAgICAgIHN0YXJ0OiBzdGFydERhdGUgfHwgJ2FsbCB0aW1lJyxcbiAgICAgICAgZW5kOiBlbmREYXRlIHx8ICdwcmVzZW50JyxcbiAgICAgIH0sXG4gICAgICBzdW1tYXJ5OiB7XG4gICAgICAgIHRvdGFsRW50cmllcyxcbiAgICAgICAgYXZlcmFnZVJhdGluZzogYXZnUmF0aW5nID8gTnVtYmVyKGF2Z1JhdGluZy50b0ZpeGVkKDIpKSA6IG51bGwsXG4gICAgICAgIHJldXNlUGVyY2VudGFnZSxcbiAgICAgICAgZW50cmllc1dpdGhSZWZsZWN0aW9uczogZW50cmllcy5maWx0ZXIoXG4gICAgICAgICAgKGUpID0+IGUud2hhdFdvcmtlZCB8fCBlLndoYXREaWRudFdvcmsgfHwgZS5zdHVkZW50RW5nYWdlbWVudCB8fCBlLnN0dWRlbnRDaGFsbGVuZ2VzLFxuICAgICAgICApLmxlbmd0aCxcbiAgICAgIH0sXG4gICAgICB0cmVuZHM6IGNhbGN1bGF0ZVRyZW5kcyhlbnRyaWVzKSxcbiAgICAgIGNvbW1vblRoZW1lczogZXh0cmFjdENvbW1vblRoZW1lcyhlbnRyaWVzKSxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoZW50cmllcyksXG4gICAgfTtcblxuICAgIHJlcy5qc29uKGluc2lnaHRzKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgX25leHQoZXJyKTtcbiAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjtcbiJdLCJ2ZXJzaW9uIjozfQ==