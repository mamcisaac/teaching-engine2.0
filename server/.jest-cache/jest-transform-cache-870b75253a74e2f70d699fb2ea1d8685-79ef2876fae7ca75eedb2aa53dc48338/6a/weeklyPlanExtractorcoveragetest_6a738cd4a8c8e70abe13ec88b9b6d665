b84db30133d78f050e3ac62b3e813138
/**
 * Additional Test Coverage for Weekly Plan Extractor Service
 *
 * Tests critical paths and edge cases that weren't covered in existing tests
 * to improve overall test coverage for the weekly planning functionality
 */
import { describe, it, expect, beforeEach, jest } from '@jest/globals';
// Mock dependencies
jest.mock('openai', () => ({
    OpenAI: jest.fn().mockImplementation(() => ({
        chat: {
            completions: {
                create: jest.fn().mockResolvedValue({
                    choices: [{
                            message: {
                                content: JSON.stringify({
                                    weeklyPlan: {
                                        week: 'Week of March 1, 2024',
                                        theme: 'Numbers and Operations',
                                        objectives: ['Understand place value', 'Practice addition'],
                                        activities: [
                                            {
                                                day: 'Monday',
                                                subject: 'Mathematics',
                                                activity: 'Place value introduction',
                                                duration: 60,
                                                materials: ['Base-10 blocks', 'Worksheets']
                                            }
                                        ]
                                    }
                                })
                            }
                        }]
                })
            }
        }
    })),
}));
import { WeeklyPlanExtractor } from '../../src/services/weeklyPlanExtractor';
import { getTestPrismaClient, createTestData } from '../jest.setup';
import { startOfWeek, addDays } from 'date-fns';
describe('WeeklyPlanExtractor Coverage Tests', () => {
    let extractor;
    let mockUser;
    let mockOutcomes;
    beforeEach(async () => {
        // Create test data
        const testData = await createTestData(async (prisma) => {
            const user = await prisma.user.create({
                data: {
                    email: 'teacher@example.com',
                    password: 'hashed_password',
                    name: 'Test Teacher',
                    role: 'teacher',
                },
            });
            // Create test outcomes
            const outcomes = await Promise.all([
                prisma.outcome.create({
                    data: {
                        code: 'A1.1',
                        description: 'Demonstrate understanding of numbers',
                        subject: 'Mathematics',
                        grade: 5,
                        domain: 'Number',
                        userId: user.id,
                    },
                }),
                prisma.outcome.create({
                    data: {
                        code: 'B2.2',
                        description: 'Solve problems involving addition',
                        subject: 'Mathematics',
                        grade: 5,
                        domain: 'Number',
                        userId: user.id,
                    },
                }),
            ]);
            return { user, outcomes };
        });
        mockUser = testData.user;
        mockOutcomes = testData.outcomes;
        extractor = new WeeklyPlanExtractor();
    });
    describe('Plan Extraction from Various Sources', () => {
        it('should extract plans from structured curriculum text', async () => {
            const curriculumText = `
        Week 1: Introduction to Numbers
        Monday: Place value lesson (60 minutes)
        - Materials: Base-10 blocks, worksheets
        - Outcome: A1.1
        
        Tuesday: Number comparison (45 minutes)
        - Materials: Number cards
        - Outcome: A1.1
        
        Wednesday: Addition practice (60 minutes)
        - Materials: Manipulatives
        - Outcome: B2.2
      `;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(curriculumText, weekStart, mockUser.id);
            expect(result).toBeDefined();
            expect(result.activities).toBeDefined();
            expect(result.activities.length).toBeGreaterThan(0);
            expect(result.theme).toBeDefined();
        });
        it('should handle unstructured text input', async () => {
            const unstructuredText = `
        This week we will focus on numbers. Students need to learn about place value.
        We should also practice addition. Maybe use some manipulatives.
        Don't forget to review homework from last week.
      `;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(unstructuredText, weekStart, mockUser.id);
            expect(result).toBeDefined();
            expect(result.activities).toBeDefined();
        });
        it('should handle multilingual content', async () => {
            const multilingualText = `
        Semaine 1: Introduction aux nombres / Week 1: Introduction to Numbers
        Lundi/Monday: Valeur de position / Place value
        Mardi/Tuesday: Comparaison / Comparison
      `;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(multilingualText, weekStart, mockUser.id);
            expect(result).toBeDefined();
            expect(result.activities).toBeDefined();
        });
        it('should extract from table-formatted content', async () => {
            const tableText = `
        | Day | Subject | Activity | Duration | Materials |
        |-----|---------|----------|----------|-----------|
        | Monday | Math | Place value | 60 min | Blocks |
        | Tuesday | Math | Addition | 45 min | Cards |
        | Wednesday | Science | Experiments | 90 min | Lab kit |
      `;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(tableText, weekStart, mockUser.id);
            expect(result).toBeDefined();
            expect(result.activities.length).toBeGreaterThanOrEqual(3);
        });
    });
    describe('AI Integration and Error Handling', () => {
        it('should handle OpenAI API failures gracefully', async () => {
            const { OpenAI } = require('openai');
            const mockOpenAI = new OpenAI();
            mockOpenAI.chat.completions.create.mockRejectedValueOnce(new Error('API rate limit exceeded'));
            const text = 'Simple lesson plan for this week';
            const weekStart = startOfWeek(new Date());
            // Should either retry or fall back to basic extraction
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
            expect(result).toBeDefined();
        });
        it('should handle malformed AI responses', async () => {
            const { OpenAI } = require('openai');
            const mockOpenAI = new OpenAI();
            mockOpenAI.chat.completions.create.mockResolvedValueOnce({
                choices: [{
                        message: {
                            content: 'Invalid JSON response from AI'
                        }
                    }]
            });
            const text = 'Test lesson plan';
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
            expect(result).toBeDefined();
            // Should fall back to basic extraction when AI fails
        });
        it('should handle empty AI responses', async () => {
            const { OpenAI } = require('openai');
            const mockOpenAI = new OpenAI();
            mockOpenAI.chat.completions.create.mockResolvedValueOnce({
                choices: []
            });
            const text = 'Test lesson plan';
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
            expect(result).toBeDefined();
        });
        it('should validate AI response structure', async () => {
            const { OpenAI } = require('openai');
            const mockOpenAI = new OpenAI();
            mockOpenAI.chat.completions.create.mockResolvedValueOnce({
                choices: [{
                        message: {
                            content: JSON.stringify({
                                // Missing required fields
                                invalidStructure: true
                            })
                        }
                    }]
            });
            const text = 'Test lesson plan';
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
            expect(result).toBeDefined();
            expect(result.activities).toBeDefined();
        });
    });
    describe('Date and Time Handling', () => {
        it('should handle various date formats in input', async () => {
            const dateFormats = [
                'March 1-5, 2024',
                '03/01/2024 - 03/05/2024',
                'Week of 2024-03-01',
                'Monday March 1 to Friday March 5',
            ];
            for (const dateFormat of dateFormats) {
                const text = `${dateFormat}: Math lessons`;
                const weekStart = startOfWeek(new Date());
                const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
                expect(result).toBeDefined();
            }
        });
        it('should handle time durations in various formats', async () => {
            const timeFormats = [
                '60 minutes',
                '1 hour',
                '45 min',
                '1.5 hours',
                '90m',
            ];
            for (const timeFormat of timeFormats) {
                const text = `Monday: Math lesson (${timeFormat})`;
                const weekStart = startOfWeek(new Date());
                const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
                expect(result).toBeDefined();
                if (result.activities.length > 0) {
                    expect(result.activities[0].duration).toBeGreaterThan(0);
                }
            }
        });
        it('should handle invalid date inputs', async () => {
            const text = 'Invalid date lesson plan';
            const invalidDate = new Date('invalid');
            await expect(extractor.extractWeeklyPlan(text, invalidDate, mockUser.id)).rejects.toThrow();
        });
        it('should handle future dates correctly', async () => {
            const text = 'Future week lesson plan';
            const futureDate = addDays(new Date(), 365); // One year in future
            const result = await extractor.extractWeeklyPlan(text, futureDate, mockUser.id);
            expect(result).toBeDefined();
            expect(result.weekStart).toEqual(startOfWeek(futureDate));
        });
    });
    describe('Activity Parsing and Validation', () => {
        it('should parse complex activity descriptions', async () => {
            const complexText = `
        Monday 9:00-10:30 AM: Advanced Mathematics
        - Topic: Quadratic equations and factoring
        - Materials: Graphing calculators, worksheets A-C
        - Assessment: Quiz on previous material
        - Homework: Complete exercises 1-15
        - Notes: Differentiate for advanced learners
      `;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(complexText, weekStart, mockUser.id);
            expect(result).toBeDefined();
            expect(result.activities.length).toBeGreaterThan(0);
            const activity = result.activities[0];
            expect(activity.materials).toBeDefined();
            expect(activity.materials.length).toBeGreaterThan(0);
        });
        it('should handle missing required activity fields', async () => {
            const incompleteText = `
        Some lesson without clear structure
        Materials mentioned but no day specified
      `;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(incompleteText, weekStart, mockUser.id);
            expect(result).toBeDefined();
            // Should create valid activities even with incomplete information
            result.activities.forEach(activity => {
                expect(activity.day).toBeDefined();
                expect(activity.activity).toBeDefined();
            });
        });
        it('should validate and sanitize activity content', async () => {
            const maliciousText = `
        Monday: <script>alert('xss')</script> Math lesson
        Materials: <img src="x" onerror="alert(1)"> and blocks
        Objective: javascript:alert('malicious') understand numbers
      `;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(maliciousText, weekStart, mockUser.id);
            expect(result).toBeDefined();
            result.activities.forEach(activity => {
                expect(activity.activity).not.toContain('<script>');
                expect(activity.activity).not.toContain('javascript:');
                expect(activity.activity).not.toContain('onerror');
                if (activity.materials) {
                    activity.materials.forEach(material => {
                        expect(material).not.toContain('<script>');
                        expect(material).not.toContain('onerror');
                    });
                }
            });
        });
        it('should handle extremely long activity descriptions', async () => {
            const longDescription = 'Very long activity description ' + 'with repeated content '.repeat(1000);
            const text = `Monday: ${longDescription}`;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
            expect(result).toBeDefined();
            if (result.activities.length > 0) {
                // Should truncate or handle long descriptions appropriately
                expect(result.activities[0].activity.length).toBeLessThan(5000);
            }
        });
    });
    describe('Curriculum Alignment', () => {
        it('should align activities with curriculum outcomes', async () => {
            const alignedText = `
        Monday: Place value lesson - covers A1.1
        Tuesday: Addition practice - addresses B2.2
        Wednesday: Problem solving - relates to both A1.1 and B2.2
      `;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(alignedText, weekStart, mockUser.id);
            expect(result).toBeDefined();
            expect(result.outcomeAlignment).toBeDefined();
            // Should identify curriculum codes mentioned in text
            const alignmentCodes = Object.keys(result.outcomeAlignment);
            expect(alignmentCodes).toContain('A1.1');
            expect(alignmentCodes).toContain('B2.2');
        });
        it('should handle curriculum codes in various formats', async () => {
            const codeFormats = [
                'A1.1',
                'A.1.1',
                'Math.A.1.1',
                'MATH-A1-1',
                'Strand A, Expectation 1.1',
            ];
            for (const codeFormat of codeFormats) {
                const text = `Monday: Lesson covering ${codeFormat}`;
                const weekStart = startOfWeek(new Date());
                const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
                expect(result).toBeDefined();
                expect(result.outcomeAlignment).toBeDefined();
            }
        });
        it('should suggest missing curriculum coverage', async () => {
            const limitedText = `
        Monday: Review homework
        Tuesday: Free reading
        Wednesday: Art project
      `;
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(limitedText, weekStart, mockUser.id);
            expect(result).toBeDefined();
            expect(result.suggestions).toBeDefined();
            expect(result.suggestions.missingCoverage).toBeDefined();
        });
    });
    describe('Performance and Scalability', () => {
        it('should handle large text inputs efficiently', async () => {
            const largeText = 'Week plan content '.repeat(10000);
            const weekStart = startOfWeek(new Date());
            const startTime = Date.now();
            const result = await extractor.extractWeeklyPlan(largeText, weekStart, mockUser.id);
            const endTime = Date.now();
            expect(result).toBeDefined();
            expect(endTime - startTime).toBeLessThan(30000); // Should complete within 30 seconds
        });
        it('should handle concurrent extractions', async () => {
            const promises = [];
            for (let i = 0; i < 5; i++) {
                const text = `Week ${i} plan content`;
                const weekStart = addDays(startOfWeek(new Date()), i * 7);
                promises.push(extractor.extractWeeklyPlan(text, weekStart, mockUser.id));
            }
            const results = await Promise.allSettled(promises);
            expect(results.length).toBe(5);
            results.forEach(result => {
                expect(result.status).toBe('fulfilled');
                if (result.status === 'fulfilled') {
                    expect(result.value).toBeDefined();
                }
            });
        });
        it('should implement proper resource cleanup', async () => {
            const text = 'Test plan';
            const weekStart = startOfWeek(new Date());
            // Run multiple extractions to test for memory leaks
            for (let i = 0; i < 10; i++) {
                const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
                expect(result).toBeDefined();
            }
            // Should not accumulate resources or memory
            expect(true).toBe(true); // Basic completion test
        });
    });
    describe('Database Integration', () => {
        it('should save extracted plans to database', async () => {
            const text = 'Monday: Math lesson';
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
            // Should save to database when requested
            const savedPlan = await extractor.savePlan(result, mockUser.id);
            expect(savedPlan).toBeDefined();
            expect(savedPlan.id).toBeDefined();
        });
        it('should handle database save failures', async () => {
            const prisma = getTestPrismaClient();
            const originalCreate = prisma.weeklyPlan.create;
            prisma.weeklyPlan.create = jest.fn().mockRejectedValue(new Error('Database save failed'));
            const text = 'Monday: Math lesson';
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
            await expect(extractor.savePlan(result, mockUser.id)).rejects.toThrow('Database save failed');
            // Restore original method
            prisma.weeklyPlan.create = originalCreate;
        });
        it('should update existing plans when requested', async () => {
            const text = 'Monday: Math lesson';
            const weekStart = startOfWeek(new Date());
            // Create initial plan
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id);
            const savedPlan = await extractor.savePlan(result, mockUser.id);
            // Update with new content
            const updatedText = 'Monday: Enhanced Math lesson with activities';
            const updatedResult = await extractor.extractWeeklyPlan(updatedText, weekStart, mockUser.id);
            const updatedPlan = await extractor.updatePlan(savedPlan.id, updatedResult, mockUser.id);
            expect(updatedPlan).toBeDefined();
            expect(updatedPlan.id).toBe(savedPlan.id);
        });
    });
    describe('Configuration and Customization', () => {
        it('should respect user preferences for extraction', async () => {
            const preferences = {
                preferredSubjects: ['Mathematics', 'Science'],
                defaultDuration: 45,
                includeAssessments: true,
                language: 'en',
            };
            const text = 'Weekly lesson plan content';
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id, preferences);
            expect(result).toBeDefined();
            // Should apply preferences to extraction
            result.activities.forEach(activity => {
                if (activity.duration === undefined) {
                    expect(activity.duration).toBe(preferences.defaultDuration);
                }
            });
        });
        it('should handle invalid preference configurations', async () => {
            const invalidPreferences = {
                defaultDuration: -1, // Invalid duration
                includeAssessments: 'maybe', // Invalid boolean
                preferredSubjects: 'not an array', // Invalid array
            };
            const text = 'Weekly lesson plan content';
            const weekStart = startOfWeek(new Date());
            // Should handle invalid preferences gracefully
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id, invalidPreferences);
            expect(result).toBeDefined();
        });
        it('should support custom extraction templates', async () => {
            const customTemplate = {
                requiredFields: ['day', 'subject', 'activity', 'duration'],
                optionalFields: ['materials', 'assessment', 'homework'],
                format: 'structured',
            };
            const text = 'Monday: Math (60min) - Place value with blocks';
            const weekStart = startOfWeek(new Date());
            const result = await extractor.extractWeeklyPlan(text, weekStart, mockUser.id, null, customTemplate);
            expect(result).toBeDefined();
            result.activities.forEach(activity => {
                customTemplate.requiredFields.forEach(field => {
                    expect(activity[field]).toBeDefined();
                });
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvd2Vla2x5UGxhbkV4dHJhY3Rvci5jb3ZlcmFnZS50ZXN0LnRzIiwibWFwcGluZ3MiOiJBQUFBOzs7OztHQUtHO0FBRUgsT0FBTyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFLdkUsb0JBQW9CO0FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDekIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQzFDLElBQUksRUFBRTtZQUNKLFdBQVcsRUFBRTtnQkFDWCxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO29CQUNsQyxPQUFPLEVBQUUsQ0FBQzs0QkFDUixPQUFPLEVBQUU7Z0NBQ1AsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7b0NBQ3RCLFVBQVUsRUFBRTt3Q0FDVixJQUFJLEVBQUUsdUJBQXVCO3dDQUM3QixLQUFLLEVBQUUsd0JBQXdCO3dDQUMvQixVQUFVLEVBQUUsQ0FBQyx3QkFBd0IsRUFBRSxtQkFBbUIsQ0FBQzt3Q0FDM0QsVUFBVSxFQUFFOzRDQUNWO2dEQUNFLEdBQUcsRUFBRSxRQUFRO2dEQUNiLE9BQU8sRUFBRSxhQUFhO2dEQUN0QixRQUFRLEVBQUUsMEJBQTBCO2dEQUNwQyxRQUFRLEVBQUUsRUFBRTtnREFDWixTQUFTLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFZLENBQUM7NkNBQzVDO3lDQUNGO3FDQUNGO2lDQUNGLENBQUM7NkJBQ0g7eUJBQ0YsQ0FBQztpQkFDSCxDQUFDO2FBQ0g7U0FDRjtLQUNGLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyxDQUFDO0FBbENKLE9BQU8sRUFB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QyxLQUFLLENBQUMsRUFBRTtvQkFDNUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUN4QyxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWNoYWVsbWNpc2FhYy9HaXRIdWIvdGVhY2hpbmctZW5naW5lMi4wL3NlcnZlci90ZXN0cy91bml0L3dlZWtseVBsYW5FeHRyYWN0b3IuY292ZXJhZ2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFkZGl0aW9uYWwgVGVzdCBDb3ZlcmFnZSBmb3IgV2Vla2x5IFBsYW4gRXh0cmFjdG9yIFNlcnZpY2VcbiAqIFxuICogVGVzdHMgY3JpdGljYWwgcGF0aHMgYW5kIGVkZ2UgY2FzZXMgdGhhdCB3ZXJlbid0IGNvdmVyZWQgaW4gZXhpc3RpbmcgdGVzdHNcbiAqIHRvIGltcHJvdmUgb3ZlcmFsbCB0ZXN0IGNvdmVyYWdlIGZvciB0aGUgd2Vla2x5IHBsYW5uaW5nIGZ1bmN0aW9uYWxpdHlcbiAqL1xuXG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlRWFjaCwgamVzdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgV2Vla2x5UGxhbkV4dHJhY3RvciB9IGZyb20gJy4uLy4uL3NyYy9zZXJ2aWNlcy93ZWVrbHlQbGFuRXh0cmFjdG9yJztcbmltcG9ydCB7IGdldFRlc3RQcmlzbWFDbGllbnQsIGNyZWF0ZVRlc3REYXRhIH0gZnJvbSAnLi4vamVzdC5zZXR1cCc7XG5pbXBvcnQgeyBzdGFydE9mV2VlaywgZW5kT2ZXZWVrLCBhZGREYXlzLCBmb3JtYXQgfSBmcm9tICdkYXRlLWZucyc7XG5cbi8vIE1vY2sgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJ29wZW5haScsICgpID0+ICh7XG4gIE9wZW5BSTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIGNoYXQ6IHtcbiAgICAgIGNvbXBsZXRpb25zOiB7XG4gICAgICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBjaG9pY2VzOiBbe1xuICAgICAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICAgICBjb250ZW50OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgd2Vla2x5UGxhbjoge1xuICAgICAgICAgICAgICAgICAgd2VlazogJ1dlZWsgb2YgTWFyY2ggMSwgMjAyNCcsXG4gICAgICAgICAgICAgICAgICB0aGVtZTogJ051bWJlcnMgYW5kIE9wZXJhdGlvbnMnLFxuICAgICAgICAgICAgICAgICAgb2JqZWN0aXZlczogWydVbmRlcnN0YW5kIHBsYWNlIHZhbHVlJywgJ1ByYWN0aWNlIGFkZGl0aW9uJ10sXG4gICAgICAgICAgICAgICAgICBhY3Rpdml0aWVzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICBkYXk6ICdNb25kYXknLFxuICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6ICdNYXRoZW1hdGljcycsXG4gICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHk6ICdQbGFjZSB2YWx1ZSBpbnRyb2R1Y3Rpb24nLFxuICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA2MCxcbiAgICAgICAgICAgICAgICAgICAgICBtYXRlcmlhbHM6IFsnQmFzZS0xMCBibG9ja3MnLCAnV29ya3NoZWV0cyddXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfV1cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH0pKSxcbn0pKTtcblxuZGVzY3JpYmUoJ1dlZWtseVBsYW5FeHRyYWN0b3IgQ292ZXJhZ2UgVGVzdHMnLCAoKSA9PiB7XG4gIGxldCBleHRyYWN0b3I6IFdlZWtseVBsYW5FeHRyYWN0b3I7XG4gIGxldCBtb2NrVXNlcjogYW55O1xuICBsZXQgbW9ja091dGNvbWVzOiBhbnlbXTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBDcmVhdGUgdGVzdCBkYXRhXG4gICAgY29uc3QgdGVzdERhdGEgPSBhd2FpdCBjcmVhdGVUZXN0RGF0YShhc3luYyAocHJpc21hKSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGVtYWlsOiAndGVhY2hlckBleGFtcGxlLmNvbScsXG4gICAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRfcGFzc3dvcmQnLFxuICAgICAgICAgIG5hbWU6ICdUZXN0IFRlYWNoZXInLFxuICAgICAgICAgIHJvbGU6ICd0ZWFjaGVyJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhdGUgdGVzdCBvdXRjb21lc1xuICAgICAgY29uc3Qgb3V0Y29tZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHByaXNtYS5vdXRjb21lLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgY29kZTogJ0ExLjEnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdEZW1vbnN0cmF0ZSB1bmRlcnN0YW5kaW5nIG9mIG51bWJlcnMnLFxuICAgICAgICAgICAgc3ViamVjdDogJ01hdGhlbWF0aWNzJyxcbiAgICAgICAgICAgIGdyYWRlOiA1LFxuICAgICAgICAgICAgZG9tYWluOiAnTnVtYmVyJyxcbiAgICAgICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgcHJpc21hLm91dGNvbWUuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBjb2RlOiAnQjIuMicsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1NvbHZlIHByb2JsZW1zIGludm9sdmluZyBhZGRpdGlvbicsXG4gICAgICAgICAgICBzdWJqZWN0OiAnTWF0aGVtYXRpY3MnLFxuICAgICAgICAgICAgZ3JhZGU6IDUsXG4gICAgICAgICAgICBkb21haW46ICdOdW1iZXInLFxuICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgXSk7XG5cbiAgICAgIHJldHVybiB7IHVzZXIsIG91dGNvbWVzIH07XG4gICAgfSk7XG5cbiAgICBtb2NrVXNlciA9IHRlc3REYXRhLnVzZXI7XG4gICAgbW9ja091dGNvbWVzID0gdGVzdERhdGEub3V0Y29tZXM7XG4gICAgZXh0cmFjdG9yID0gbmV3IFdlZWtseVBsYW5FeHRyYWN0b3IoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BsYW4gRXh0cmFjdGlvbiBmcm9tIFZhcmlvdXMgU291cmNlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4dHJhY3QgcGxhbnMgZnJvbSBzdHJ1Y3R1cmVkIGN1cnJpY3VsdW0gdGV4dCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGN1cnJpY3VsdW1UZXh0ID0gYFxuICAgICAgICBXZWVrIDE6IEludHJvZHVjdGlvbiB0byBOdW1iZXJzXG4gICAgICAgIE1vbmRheTogUGxhY2UgdmFsdWUgbGVzc29uICg2MCBtaW51dGVzKVxuICAgICAgICAtIE1hdGVyaWFsczogQmFzZS0xMCBibG9ja3MsIHdvcmtzaGVldHNcbiAgICAgICAgLSBPdXRjb21lOiBBMS4xXG4gICAgICAgIFxuICAgICAgICBUdWVzZGF5OiBOdW1iZXIgY29tcGFyaXNvbiAoNDUgbWludXRlcylcbiAgICAgICAgLSBNYXRlcmlhbHM6IE51bWJlciBjYXJkc1xuICAgICAgICAtIE91dGNvbWU6IEExLjFcbiAgICAgICAgXG4gICAgICAgIFdlZG5lc2RheTogQWRkaXRpb24gcHJhY3RpY2UgKDYwIG1pbnV0ZXMpXG4gICAgICAgIC0gTWF0ZXJpYWxzOiBNYW5pcHVsYXRpdmVzXG4gICAgICAgIC0gT3V0Y29tZTogQjIuMlxuICAgICAgYDtcblxuICAgICAgY29uc3Qgd2Vla1N0YXJ0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoKSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4oXG4gICAgICAgIGN1cnJpY3VsdW1UZXh0LFxuICAgICAgICB3ZWVrU3RhcnQsXG4gICAgICAgIG1vY2tVc2VyLmlkXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hY3Rpdml0aWVzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hY3Rpdml0aWVzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC50aGVtZSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVuc3RydWN0dXJlZCB0ZXh0IGlucHV0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdW5zdHJ1Y3R1cmVkVGV4dCA9IGBcbiAgICAgICAgVGhpcyB3ZWVrIHdlIHdpbGwgZm9jdXMgb24gbnVtYmVycy4gU3R1ZGVudHMgbmVlZCB0byBsZWFybiBhYm91dCBwbGFjZSB2YWx1ZS5cbiAgICAgICAgV2Ugc2hvdWxkIGFsc28gcHJhY3RpY2UgYWRkaXRpb24uIE1heWJlIHVzZSBzb21lIG1hbmlwdWxhdGl2ZXMuXG4gICAgICAgIERvbid0IGZvcmdldCB0byByZXZpZXcgaG9tZXdvcmsgZnJvbSBsYXN0IHdlZWsuXG4gICAgICBgO1xuXG4gICAgICBjb25zdCB3ZWVrU3RhcnQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgpKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3Rvci5leHRyYWN0V2Vla2x5UGxhbihcbiAgICAgICAgdW5zdHJ1Y3R1cmVkVGV4dCxcbiAgICAgICAgd2Vla1N0YXJ0LFxuICAgICAgICBtb2NrVXNlci5pZFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWN0aXZpdGllcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG11bHRpbGluZ3VhbCBjb250ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbXVsdGlsaW5ndWFsVGV4dCA9IGBcbiAgICAgICAgU2VtYWluZSAxOiBJbnRyb2R1Y3Rpb24gYXV4IG5vbWJyZXMgLyBXZWVrIDE6IEludHJvZHVjdGlvbiB0byBOdW1iZXJzXG4gICAgICAgIEx1bmRpL01vbmRheTogVmFsZXVyIGRlIHBvc2l0aW9uIC8gUGxhY2UgdmFsdWVcbiAgICAgICAgTWFyZGkvVHVlc2RheTogQ29tcGFyYWlzb24gLyBDb21wYXJpc29uXG4gICAgICBgO1xuXG4gICAgICBjb25zdCB3ZWVrU3RhcnQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgpKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3Rvci5leHRyYWN0V2Vla2x5UGxhbihcbiAgICAgICAgbXVsdGlsaW5ndWFsVGV4dCxcbiAgICAgICAgd2Vla1N0YXJ0LFxuICAgICAgICBtb2NrVXNlci5pZFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWN0aXZpdGllcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXh0cmFjdCBmcm9tIHRhYmxlLWZvcm1hdHRlZCBjb250ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGFibGVUZXh0ID0gYFxuICAgICAgICB8IERheSB8IFN1YmplY3QgfCBBY3Rpdml0eSB8IER1cmF0aW9uIHwgTWF0ZXJpYWxzIHxcbiAgICAgICAgfC0tLS0tfC0tLS0tLS0tLXwtLS0tLS0tLS0tfC0tLS0tLS0tLS18LS0tLS0tLS0tLS18XG4gICAgICAgIHwgTW9uZGF5IHwgTWF0aCB8IFBsYWNlIHZhbHVlIHwgNjAgbWluIHwgQmxvY2tzIHxcbiAgICAgICAgfCBUdWVzZGF5IHwgTWF0aCB8IEFkZGl0aW9uIHwgNDUgbWluIHwgQ2FyZHMgfFxuICAgICAgICB8IFdlZG5lc2RheSB8IFNjaWVuY2UgfCBFeHBlcmltZW50cyB8IDkwIG1pbiB8IExhYiBraXQgfFxuICAgICAgYDtcblxuICAgICAgY29uc3Qgd2Vla1N0YXJ0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoKSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4oXG4gICAgICAgIHRhYmxlVGV4dCxcbiAgICAgICAgd2Vla1N0YXJ0LFxuICAgICAgICBtb2NrVXNlci5pZFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWN0aXZpdGllcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBSSBJbnRlZ3JhdGlvbiBhbmQgRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgT3BlbkFJIEFQSSBmYWlsdXJlcyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBPcGVuQUkgfSA9IHJlcXVpcmUoJ29wZW5haScpO1xuICAgICAgY29uc3QgbW9ja09wZW5BSSA9IG5ldyBPcGVuQUkoKTtcbiAgICAgIG1vY2tPcGVuQUkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcignQVBJIHJhdGUgbGltaXQgZXhjZWVkZWQnKSk7XG5cbiAgICAgIGNvbnN0IHRleHQgPSAnU2ltcGxlIGxlc3NvbiBwbGFuIGZvciB0aGlzIHdlZWsnO1xuICAgICAgY29uc3Qgd2Vla1N0YXJ0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoKSk7XG5cbiAgICAgIC8vIFNob3VsZCBlaXRoZXIgcmV0cnkgb3IgZmFsbCBiYWNrIHRvIGJhc2ljIGV4dHJhY3Rpb25cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3Rvci5leHRyYWN0V2Vla2x5UGxhbih0ZXh0LCB3ZWVrU3RhcnQsIG1vY2tVc2VyLmlkKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgQUkgcmVzcG9uc2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBPcGVuQUkgfSA9IHJlcXVpcmUoJ29wZW5haScpO1xuICAgICAgY29uc3QgbW9ja09wZW5BSSA9IG5ldyBPcGVuQUkoKTtcbiAgICAgIG1vY2tPcGVuQUkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgY2hvaWNlczogW3tcbiAgICAgICAgICBtZXNzYWdlOiB7XG4gICAgICAgICAgICBjb250ZW50OiAnSW52YWxpZCBKU09OIHJlc3BvbnNlIGZyb20gQUknXG4gICAgICAgICAgfVxuICAgICAgICB9XVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRleHQgPSAnVGVzdCBsZXNzb24gcGxhbic7XG4gICAgICBjb25zdCB3ZWVrU3RhcnQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgpKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKHRleHQsIHdlZWtTdGFydCwgbW9ja1VzZXIuaWQpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIC8vIFNob3VsZCBmYWxsIGJhY2sgdG8gYmFzaWMgZXh0cmFjdGlvbiB3aGVuIEFJIGZhaWxzXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBBSSByZXNwb25zZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IE9wZW5BSSB9ID0gcmVxdWlyZSgnb3BlbmFpJyk7XG4gICAgICBjb25zdCBtb2NrT3BlbkFJID0gbmV3IE9wZW5BSSgpO1xuICAgICAgbW9ja09wZW5BSS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBjaG9pY2VzOiBbXVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRleHQgPSAnVGVzdCBsZXNzb24gcGxhbic7XG4gICAgICBjb25zdCB3ZWVrU3RhcnQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgpKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKHRleHQsIHdlZWtTdGFydCwgbW9ja1VzZXIuaWQpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgQUkgcmVzcG9uc2Ugc3RydWN0dXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBPcGVuQUkgfSA9IHJlcXVpcmUoJ29wZW5haScpO1xuICAgICAgY29uc3QgbW9ja09wZW5BSSA9IG5ldyBPcGVuQUkoKTtcbiAgICAgIG1vY2tPcGVuQUkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgY2hvaWNlczogW3tcbiAgICAgICAgICBtZXNzYWdlOiB7XG4gICAgICAgICAgICBjb250ZW50OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIC8vIE1pc3NpbmcgcmVxdWlyZWQgZmllbGRzXG4gICAgICAgICAgICAgIGludmFsaWRTdHJ1Y3R1cmU6IHRydWVcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9XVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRleHQgPSAnVGVzdCBsZXNzb24gcGxhbic7XG4gICAgICBjb25zdCB3ZWVrU3RhcnQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgpKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKHRleHQsIHdlZWtTdGFydCwgbW9ja1VzZXIuaWQpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWN0aXZpdGllcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RhdGUgYW5kIFRpbWUgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmFyaW91cyBkYXRlIGZvcm1hdHMgaW4gaW5wdXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRlRm9ybWF0cyA9IFtcbiAgICAgICAgJ01hcmNoIDEtNSwgMjAyNCcsXG4gICAgICAgICcwMy8wMS8yMDI0IC0gMDMvMDUvMjAyNCcsXG4gICAgICAgICdXZWVrIG9mIDIwMjQtMDMtMDEnLFxuICAgICAgICAnTW9uZGF5IE1hcmNoIDEgdG8gRnJpZGF5IE1hcmNoIDUnLFxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBkYXRlRm9ybWF0IG9mIGRhdGVGb3JtYXRzKSB7XG4gICAgICAgIGNvbnN0IHRleHQgPSBgJHtkYXRlRm9ybWF0fTogTWF0aCBsZXNzb25zYDtcbiAgICAgICAgY29uc3Qgd2Vla1N0YXJ0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoKSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4odGV4dCwgd2Vla1N0YXJ0LCBtb2NrVXNlci5pZCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0aW1lIGR1cmF0aW9ucyBpbiB2YXJpb3VzIGZvcm1hdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0aW1lRm9ybWF0cyA9IFtcbiAgICAgICAgJzYwIG1pbnV0ZXMnLFxuICAgICAgICAnMSBob3VyJyxcbiAgICAgICAgJzQ1IG1pbicsXG4gICAgICAgICcxLjUgaG91cnMnLFxuICAgICAgICAnOTBtJyxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgdGltZUZvcm1hdCBvZiB0aW1lRm9ybWF0cykge1xuICAgICAgICBjb25zdCB0ZXh0ID0gYE1vbmRheTogTWF0aCBsZXNzb24gKCR7dGltZUZvcm1hdH0pYDtcbiAgICAgICAgY29uc3Qgd2Vla1N0YXJ0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoKSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4odGV4dCwgd2Vla1N0YXJ0LCBtb2NrVXNlci5pZCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGlmIChyZXN1bHQuYWN0aXZpdGllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZXhwZWN0KHJlc3VsdC5hY3Rpdml0aWVzWzBdLmR1cmF0aW9uKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgZGF0ZSBpbnB1dHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXh0ID0gJ0ludmFsaWQgZGF0ZSBsZXNzb24gcGxhbic7XG4gICAgICBjb25zdCBpbnZhbGlkRGF0ZSA9IG5ldyBEYXRlKCdpbnZhbGlkJyk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKHRleHQsIGludmFsaWREYXRlLCBtb2NrVXNlci5pZClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBmdXR1cmUgZGF0ZXMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGV4dCA9ICdGdXR1cmUgd2VlayBsZXNzb24gcGxhbic7XG4gICAgICBjb25zdCBmdXR1cmVEYXRlID0gYWRkRGF5cyhuZXcgRGF0ZSgpLCAzNjUpOyAvLyBPbmUgeWVhciBpbiBmdXR1cmVcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKHRleHQsIGZ1dHVyZURhdGUsIG1vY2tVc2VyLmlkKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LndlZWtTdGFydCkudG9FcXVhbChzdGFydE9mV2VlayhmdXR1cmVEYXRlKSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBY3Rpdml0eSBQYXJzaW5nIGFuZCBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcGFyc2UgY29tcGxleCBhY3Rpdml0eSBkZXNjcmlwdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wbGV4VGV4dCA9IGBcbiAgICAgICAgTW9uZGF5IDk6MDAtMTA6MzAgQU06IEFkdmFuY2VkIE1hdGhlbWF0aWNzXG4gICAgICAgIC0gVG9waWM6IFF1YWRyYXRpYyBlcXVhdGlvbnMgYW5kIGZhY3RvcmluZ1xuICAgICAgICAtIE1hdGVyaWFsczogR3JhcGhpbmcgY2FsY3VsYXRvcnMsIHdvcmtzaGVldHMgQS1DXG4gICAgICAgIC0gQXNzZXNzbWVudDogUXVpeiBvbiBwcmV2aW91cyBtYXRlcmlhbFxuICAgICAgICAtIEhvbWV3b3JrOiBDb21wbGV0ZSBleGVyY2lzZXMgMS0xNVxuICAgICAgICAtIE5vdGVzOiBEaWZmZXJlbnRpYXRlIGZvciBhZHZhbmNlZCBsZWFybmVyc1xuICAgICAgYDtcblxuICAgICAgY29uc3Qgd2Vla1N0YXJ0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoKSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4oY29tcGxleFRleHQsIHdlZWtTdGFydCwgbW9ja1VzZXIuaWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hY3Rpdml0aWVzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgXG4gICAgICBjb25zdCBhY3Rpdml0eSA9IHJlc3VsdC5hY3Rpdml0aWVzWzBdO1xuICAgICAgZXhwZWN0KGFjdGl2aXR5Lm1hdGVyaWFscykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChhY3Rpdml0eS5tYXRlcmlhbHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIHJlcXVpcmVkIGFjdGl2aXR5IGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGluY29tcGxldGVUZXh0ID0gYFxuICAgICAgICBTb21lIGxlc3NvbiB3aXRob3V0IGNsZWFyIHN0cnVjdHVyZVxuICAgICAgICBNYXRlcmlhbHMgbWVudGlvbmVkIGJ1dCBubyBkYXkgc3BlY2lmaWVkXG4gICAgICBgO1xuXG4gICAgICBjb25zdCB3ZWVrU3RhcnQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgpKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3Rvci5leHRyYWN0V2Vla2x5UGxhbihpbmNvbXBsZXRlVGV4dCwgd2Vla1N0YXJ0LCBtb2NrVXNlci5pZCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAvLyBTaG91bGQgY3JlYXRlIHZhbGlkIGFjdGl2aXRpZXMgZXZlbiB3aXRoIGluY29tcGxldGUgaW5mb3JtYXRpb25cbiAgICAgIHJlc3VsdC5hY3Rpdml0aWVzLmZvckVhY2goYWN0aXZpdHkgPT4ge1xuICAgICAgICBleHBlY3QoYWN0aXZpdHkuZGF5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QoYWN0aXZpdHkuYWN0aXZpdHkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYW5kIHNhbml0aXplIGFjdGl2aXR5IGNvbnRlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYWxpY2lvdXNUZXh0ID0gYFxuICAgICAgICBNb25kYXk6IDxzY3JpcHQ+YWxlcnQoJ3hzcycpPC9zY3JpcHQ+IE1hdGggbGVzc29uXG4gICAgICAgIE1hdGVyaWFsczogPGltZyBzcmM9XCJ4XCIgb25lcnJvcj1cImFsZXJ0KDEpXCI+IGFuZCBibG9ja3NcbiAgICAgICAgT2JqZWN0aXZlOiBqYXZhc2NyaXB0OmFsZXJ0KCdtYWxpY2lvdXMnKSB1bmRlcnN0YW5kIG51bWJlcnNcbiAgICAgIGA7XG5cbiAgICAgIGNvbnN0IHdlZWtTdGFydCA9IHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKCkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKG1hbGljaW91c1RleHQsIHdlZWtTdGFydCwgbW9ja1VzZXIuaWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgcmVzdWx0LmFjdGl2aXRpZXMuZm9yRWFjaChhY3Rpdml0eSA9PiB7XG4gICAgICAgIGV4cGVjdChhY3Rpdml0eS5hY3Rpdml0eSkubm90LnRvQ29udGFpbignPHNjcmlwdD4nKTtcbiAgICAgICAgZXhwZWN0KGFjdGl2aXR5LmFjdGl2aXR5KS5ub3QudG9Db250YWluKCdqYXZhc2NyaXB0OicpO1xuICAgICAgICBleHBlY3QoYWN0aXZpdHkuYWN0aXZpdHkpLm5vdC50b0NvbnRhaW4oJ29uZXJyb3InKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChhY3Rpdml0eS5tYXRlcmlhbHMpIHtcbiAgICAgICAgICBhY3Rpdml0eS5tYXRlcmlhbHMuZm9yRWFjaChtYXRlcmlhbCA9PiB7XG4gICAgICAgICAgICBleHBlY3QobWF0ZXJpYWwpLm5vdC50b0NvbnRhaW4oJzxzY3JpcHQ+Jyk7XG4gICAgICAgICAgICBleHBlY3QobWF0ZXJpYWwpLm5vdC50b0NvbnRhaW4oJ29uZXJyb3InKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBleHRyZW1lbHkgbG9uZyBhY3Rpdml0eSBkZXNjcmlwdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb25nRGVzY3JpcHRpb24gPSAnVmVyeSBsb25nIGFjdGl2aXR5IGRlc2NyaXB0aW9uICcgKyAnd2l0aCByZXBlYXRlZCBjb250ZW50ICcucmVwZWF0KDEwMDApO1xuICAgICAgY29uc3QgdGV4dCA9IGBNb25kYXk6ICR7bG9uZ0Rlc2NyaXB0aW9ufWA7XG5cbiAgICAgIGNvbnN0IHdlZWtTdGFydCA9IHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKCkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKHRleHQsIHdlZWtTdGFydCwgbW9ja1VzZXIuaWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgaWYgKHJlc3VsdC5hY3Rpdml0aWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gU2hvdWxkIHRydW5jYXRlIG9yIGhhbmRsZSBsb25nIGRlc2NyaXB0aW9ucyBhcHByb3ByaWF0ZWx5XG4gICAgICAgIGV4cGVjdChyZXN1bHQuYWN0aXZpdGllc1swXS5hY3Rpdml0eS5sZW5ndGgpLnRvQmVMZXNzVGhhbig1MDAwKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0N1cnJpY3VsdW0gQWxpZ25tZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWxpZ24gYWN0aXZpdGllcyB3aXRoIGN1cnJpY3VsdW0gb3V0Y29tZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhbGlnbmVkVGV4dCA9IGBcbiAgICAgICAgTW9uZGF5OiBQbGFjZSB2YWx1ZSBsZXNzb24gLSBjb3ZlcnMgQTEuMVxuICAgICAgICBUdWVzZGF5OiBBZGRpdGlvbiBwcmFjdGljZSAtIGFkZHJlc3NlcyBCMi4yXG4gICAgICAgIFdlZG5lc2RheTogUHJvYmxlbSBzb2x2aW5nIC0gcmVsYXRlcyB0byBib3RoIEExLjEgYW5kIEIyLjJcbiAgICAgIGA7XG5cbiAgICAgIGNvbnN0IHdlZWtTdGFydCA9IHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKCkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKGFsaWduZWRUZXh0LCB3ZWVrU3RhcnQsIG1vY2tVc2VyLmlkKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub3V0Y29tZUFsaWdubWVudCkudG9CZURlZmluZWQoKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIGlkZW50aWZ5IGN1cnJpY3VsdW0gY29kZXMgbWVudGlvbmVkIGluIHRleHRcbiAgICAgIGNvbnN0IGFsaWdubWVudENvZGVzID0gT2JqZWN0LmtleXMocmVzdWx0Lm91dGNvbWVBbGlnbm1lbnQpO1xuICAgICAgZXhwZWN0KGFsaWdubWVudENvZGVzKS50b0NvbnRhaW4oJ0ExLjEnKTtcbiAgICAgIGV4cGVjdChhbGlnbm1lbnRDb2RlcykudG9Db250YWluKCdCMi4yJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjdXJyaWN1bHVtIGNvZGVzIGluIHZhcmlvdXMgZm9ybWF0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvZGVGb3JtYXRzID0gW1xuICAgICAgICAnQTEuMScsXG4gICAgICAgICdBLjEuMScsXG4gICAgICAgICdNYXRoLkEuMS4xJyxcbiAgICAgICAgJ01BVEgtQTEtMScsXG4gICAgICAgICdTdHJhbmQgQSwgRXhwZWN0YXRpb24gMS4xJyxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgY29kZUZvcm1hdCBvZiBjb2RlRm9ybWF0cykge1xuICAgICAgICBjb25zdCB0ZXh0ID0gYE1vbmRheTogTGVzc29uIGNvdmVyaW5nICR7Y29kZUZvcm1hdH1gO1xuICAgICAgICBjb25zdCB3ZWVrU3RhcnQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgpKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3Rvci5leHRyYWN0V2Vla2x5UGxhbih0ZXh0LCB3ZWVrU3RhcnQsIG1vY2tVc2VyLmlkKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5vdXRjb21lQWxpZ25tZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzdWdnZXN0IG1pc3NpbmcgY3VycmljdWx1bSBjb3ZlcmFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxpbWl0ZWRUZXh0ID0gYFxuICAgICAgICBNb25kYXk6IFJldmlldyBob21ld29ya1xuICAgICAgICBUdWVzZGF5OiBGcmVlIHJlYWRpbmdcbiAgICAgICAgV2VkbmVzZGF5OiBBcnQgcHJvamVjdFxuICAgICAgYDtcblxuICAgICAgY29uc3Qgd2Vla1N0YXJ0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoKSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4obGltaXRlZFRleHQsIHdlZWtTdGFydCwgbW9ja1VzZXIuaWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWdnZXN0aW9ucykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VnZ2VzdGlvbnMubWlzc2luZ0NvdmVyYWdlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgYW5kIFNjYWxhYmlsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGxhcmdlIHRleHQgaW5wdXRzIGVmZmljaWVudGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbGFyZ2VUZXh0ID0gJ1dlZWsgcGxhbiBjb250ZW50ICcucmVwZWF0KDEwMDAwKTtcbiAgICAgIGNvbnN0IHdlZWtTdGFydCA9IHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKCkpO1xuXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKGxhcmdlVGV4dCwgd2Vla1N0YXJ0LCBtb2NrVXNlci5pZCk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChlbmRUaW1lIC0gc3RhcnRUaW1lKS50b0JlTGVzc1RoYW4oMzAwMDApOyAvLyBTaG91bGQgY29tcGxldGUgd2l0aGluIDMwIHNlY29uZHNcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgZXh0cmFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9taXNlcyA9IFtdO1xuICAgICAgXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICBjb25zdCB0ZXh0ID0gYFdlZWsgJHtpfSBwbGFuIGNvbnRlbnRgO1xuICAgICAgICBjb25zdCB3ZWVrU3RhcnQgPSBhZGREYXlzKHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKCkpLCBpICogNyk7XG4gICAgICAgIHByb21pc2VzLnB1c2goZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKHRleHQsIHdlZWtTdGFydCwgbW9ja1VzZXIuaWQpKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChwcm9taXNlcyk7XG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLnRvQmUoNSk7XG4gICAgICBcbiAgICAgIHJlc3VsdHMuZm9yRWFjaChyZXN1bHQgPT4ge1xuICAgICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZSgnZnVsZmlsbGVkJyk7XG4gICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSAnZnVsZmlsbGVkJykge1xuICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsdWUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbXBsZW1lbnQgcHJvcGVyIHJlc291cmNlIGNsZWFudXAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXh0ID0gJ1Rlc3QgcGxhbic7XG4gICAgICBjb25zdCB3ZWVrU3RhcnQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgpKTtcblxuICAgICAgLy8gUnVuIG11bHRpcGxlIGV4dHJhY3Rpb25zIHRvIHRlc3QgZm9yIG1lbW9yeSBsZWFrc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3Rvci5leHRyYWN0V2Vla2x5UGxhbih0ZXh0LCB3ZWVrU3RhcnQsIG1vY2tVc2VyLmlkKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2hvdWxkIG5vdCBhY2N1bXVsYXRlIHJlc291cmNlcyBvciBtZW1vcnlcbiAgICAgIGV4cGVjdCh0cnVlKS50b0JlKHRydWUpOyAvLyBCYXNpYyBjb21wbGV0aW9uIHRlc3RcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RhdGFiYXNlIEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2F2ZSBleHRyYWN0ZWQgcGxhbnMgdG8gZGF0YWJhc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXh0ID0gJ01vbmRheTogTWF0aCBsZXNzb24nO1xuICAgICAgY29uc3Qgd2Vla1N0YXJ0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoKSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3Rvci5leHRyYWN0V2Vla2x5UGxhbih0ZXh0LCB3ZWVrU3RhcnQsIG1vY2tVc2VyLmlkKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIHNhdmUgdG8gZGF0YWJhc2Ugd2hlbiByZXF1ZXN0ZWRcbiAgICAgIGNvbnN0IHNhdmVkUGxhbiA9IGF3YWl0IGV4dHJhY3Rvci5zYXZlUGxhbihyZXN1bHQsIG1vY2tVc2VyLmlkKTtcbiAgICAgIGV4cGVjdChzYXZlZFBsYW4pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3Qoc2F2ZWRQbGFuLmlkKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2Ugc2F2ZSBmYWlsdXJlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByaXNtYSA9IGdldFRlc3RQcmlzbWFDbGllbnQoKTtcbiAgICAgIGNvbnN0IG9yaWdpbmFsQ3JlYXRlID0gcHJpc21hLndlZWtseVBsYW4uY3JlYXRlO1xuICAgICAgcHJpc21hLndlZWtseVBsYW4uY3JlYXRlID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2Ugc2F2ZSBmYWlsZWQnKSk7XG5cbiAgICAgIGNvbnN0IHRleHQgPSAnTW9uZGF5OiBNYXRoIGxlc3Nvbic7XG4gICAgICBjb25zdCB3ZWVrU3RhcnQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgpKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKHRleHQsIHdlZWtTdGFydCwgbW9ja1VzZXIuaWQpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGV4dHJhY3Rvci5zYXZlUGxhbihyZXN1bHQsIG1vY2tVc2VyLmlkKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlIHNhdmUgZmFpbGVkJyk7XG5cbiAgICAgIC8vIFJlc3RvcmUgb3JpZ2luYWwgbWV0aG9kXG4gICAgICBwcmlzbWEud2Vla2x5UGxhbi5jcmVhdGUgPSBvcmlnaW5hbENyZWF0ZTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIGV4aXN0aW5nIHBsYW5zIHdoZW4gcmVxdWVzdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGV4dCA9ICdNb25kYXk6IE1hdGggbGVzc29uJztcbiAgICAgIGNvbnN0IHdlZWtTdGFydCA9IHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKCkpO1xuXG4gICAgICAvLyBDcmVhdGUgaW5pdGlhbCBwbGFuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4odGV4dCwgd2Vla1N0YXJ0LCBtb2NrVXNlci5pZCk7XG4gICAgICBjb25zdCBzYXZlZFBsYW4gPSBhd2FpdCBleHRyYWN0b3Iuc2F2ZVBsYW4ocmVzdWx0LCBtb2NrVXNlci5pZCk7XG5cbiAgICAgIC8vIFVwZGF0ZSB3aXRoIG5ldyBjb250ZW50XG4gICAgICBjb25zdCB1cGRhdGVkVGV4dCA9ICdNb25kYXk6IEVuaGFuY2VkIE1hdGggbGVzc29uIHdpdGggYWN0aXZpdGllcyc7XG4gICAgICBjb25zdCB1cGRhdGVkUmVzdWx0ID0gYXdhaXQgZXh0cmFjdG9yLmV4dHJhY3RXZWVrbHlQbGFuKHVwZGF0ZWRUZXh0LCB3ZWVrU3RhcnQsIG1vY2tVc2VyLmlkKTtcbiAgICAgIFxuICAgICAgY29uc3QgdXBkYXRlZFBsYW4gPSBhd2FpdCBleHRyYWN0b3IudXBkYXRlUGxhbihzYXZlZFBsYW4uaWQsIHVwZGF0ZWRSZXN1bHQsIG1vY2tVc2VyLmlkKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkUGxhbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkUGxhbi5pZCkudG9CZShzYXZlZFBsYW4uaWQpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29uZmlndXJhdGlvbiBhbmQgQ3VzdG9taXphdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc3BlY3QgdXNlciBwcmVmZXJlbmNlcyBmb3IgZXh0cmFjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByZWZlcmVuY2VzID0ge1xuICAgICAgICBwcmVmZXJyZWRTdWJqZWN0czogWydNYXRoZW1hdGljcycsICdTY2llbmNlJ10sXG4gICAgICAgIGRlZmF1bHREdXJhdGlvbjogNDUsXG4gICAgICAgIGluY2x1ZGVBc3Nlc3NtZW50czogdHJ1ZSxcbiAgICAgICAgbGFuZ3VhZ2U6ICdlbicsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB0ZXh0ID0gJ1dlZWtseSBsZXNzb24gcGxhbiBjb250ZW50JztcbiAgICAgIGNvbnN0IHdlZWtTdGFydCA9IHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKCkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4odGV4dCwgd2Vla1N0YXJ0LCBtb2NrVXNlci5pZCwgcHJlZmVyZW5jZXMpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIGFwcGx5IHByZWZlcmVuY2VzIHRvIGV4dHJhY3Rpb25cbiAgICAgIHJlc3VsdC5hY3Rpdml0aWVzLmZvckVhY2goYWN0aXZpdHkgPT4ge1xuICAgICAgICBpZiAoYWN0aXZpdHkuZHVyYXRpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGV4cGVjdChhY3Rpdml0eS5kdXJhdGlvbikudG9CZShwcmVmZXJlbmNlcy5kZWZhdWx0RHVyYXRpb24pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgcHJlZmVyZW5jZSBjb25maWd1cmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRQcmVmZXJlbmNlcyA9IHtcbiAgICAgICAgZGVmYXVsdER1cmF0aW9uOiAtMSwgLy8gSW52YWxpZCBkdXJhdGlvblxuICAgICAgICBpbmNsdWRlQXNzZXNzbWVudHM6ICdtYXliZScsIC8vIEludmFsaWQgYm9vbGVhblxuICAgICAgICBwcmVmZXJyZWRTdWJqZWN0czogJ25vdCBhbiBhcnJheScsIC8vIEludmFsaWQgYXJyYXlcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHRleHQgPSAnV2Vla2x5IGxlc3NvbiBwbGFuIGNvbnRlbnQnO1xuICAgICAgY29uc3Qgd2Vla1N0YXJ0ID0gc3RhcnRPZldlZWsobmV3IERhdGUoKSk7XG5cbiAgICAgIC8vIFNob3VsZCBoYW5kbGUgaW52YWxpZCBwcmVmZXJlbmNlcyBncmFjZWZ1bGx5XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4odGV4dCwgd2Vla1N0YXJ0LCBtb2NrVXNlci5pZCwgaW52YWxpZFByZWZlcmVuY2VzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1cHBvcnQgY3VzdG9tIGV4dHJhY3Rpb24gdGVtcGxhdGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY3VzdG9tVGVtcGxhdGUgPSB7XG4gICAgICAgIHJlcXVpcmVkRmllbGRzOiBbJ2RheScsICdzdWJqZWN0JywgJ2FjdGl2aXR5JywgJ2R1cmF0aW9uJ10sXG4gICAgICAgIG9wdGlvbmFsRmllbGRzOiBbJ21hdGVyaWFscycsICdhc3Nlc3NtZW50JywgJ2hvbWV3b3JrJ10sXG4gICAgICAgIGZvcm1hdDogJ3N0cnVjdHVyZWQnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgdGV4dCA9ICdNb25kYXk6IE1hdGggKDYwbWluKSAtIFBsYWNlIHZhbHVlIHdpdGggYmxvY2tzJztcbiAgICAgIGNvbnN0IHdlZWtTdGFydCA9IHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKCkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0b3IuZXh0cmFjdFdlZWtseVBsYW4oXG4gICAgICAgIHRleHQsIFxuICAgICAgICB3ZWVrU3RhcnQsIFxuICAgICAgICBtb2NrVXNlci5pZCwgXG4gICAgICAgIG51bGwsIFxuICAgICAgICBjdXN0b21UZW1wbGF0ZVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIHJlc3VsdC5hY3Rpdml0aWVzLmZvckVhY2goYWN0aXZpdHkgPT4ge1xuICAgICAgICBjdXN0b21UZW1wbGF0ZS5yZXF1aXJlZEZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgICAgICBleHBlY3QoYWN0aXZpdHlbZmllbGRdKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==