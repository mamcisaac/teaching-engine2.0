b1a27cef7627a9d3b982b53ae906bc4e
import { describe, it, expect } from '@jest/globals';
import { subjectSchema, milestoneCreateSchema, milestoneUpdateSchema, activityCreateSchema, } from '../../src/validation';
describe('Validation Schemas Unit Tests', () => {
    describe('subjectSchema', () => {
        it('should validate valid subject data', () => {
            const validSubject = {
                name: 'Mathematics',
                nameEn: 'Mathematics',
                nameFr: 'Mathématiques',
            };
            const result = subjectSchema.safeParse(validSubject);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data).toEqual(validSubject);
            }
        });
        it('should require name field', () => {
            const invalidSubject = {
                nameEn: 'Mathematics',
                nameFr: 'Mathématiques',
            };
            const result = subjectSchema.safeParse(invalidSubject);
            expect(result.success).toBe(false);
        });
        it('should reject empty name', () => {
            const invalidSubject = {
                name: '',
                nameEn: 'Mathematics',
            };
            const result = subjectSchema.safeParse(invalidSubject);
            expect(result.success).toBe(false);
        });
        it('should allow optional language fields', () => {
            const minimalSubject = {
                name: 'Science',
            };
            const result = subjectSchema.safeParse(minimalSubject);
            expect(result.success).toBe(true);
        });
        it('should handle only English translation', () => {
            const subjectWithEn = {
                name: 'Science',
                nameEn: 'Science',
            };
            const result = subjectSchema.safeParse(subjectWithEn);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.nameEn).toBe('Science');
                expect(result.data.nameFr).toBeUndefined();
            }
        });
        it('should handle only French translation', () => {
            const subjectWithFr = {
                name: 'Sciences',
                nameFr: 'Sciences',
            };
            const result = subjectSchema.safeParse(subjectWithFr);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.nameFr).toBe('Sciences');
                expect(result.data.nameEn).toBeUndefined();
            }
        });
    });
    describe('milestoneCreateSchema', () => {
        const validMilestone = {
            title: 'Unit 1: Numbers',
            subjectId: 1,
            startDate: '2024-01-01T00:00:00.000Z',
            endDate: '2024-01-31T23:59:59.000Z',
            estHours: 20,
        };
        it('should validate valid milestone data', () => {
            const result = milestoneCreateSchema.safeParse(validMilestone);
            expect(result.success).toBe(true);
        });
        it('should require title and subjectId', () => {
            const invalidMilestone = {
                startDate: '2024-01-01T00:00:00.000Z',
                endDate: '2024-01-31T23:59:59.000Z',
            };
            const result = milestoneCreateSchema.safeParse(invalidMilestone);
            expect(result.success).toBe(false);
        });
        it('should validate that end date is after start date', () => {
            const invalidMilestone = {
                ...validMilestone,
                startDate: '2024-01-31T00:00:00.000Z',
                endDate: '2024-01-01T23:59:59.000Z', // Before start date
            };
            const result = milestoneCreateSchema.safeParse(invalidMilestone);
            expect(result.success).toBe(false);
            if (!result.success) {
                expect(result.error.issues.some((issue) => issue.path.includes('endDate'))).toBe(true);
            }
        });
        it('should allow equal start and end dates', () => {
            const sameDayMilestone = {
                ...validMilestone,
                startDate: '2024-01-15T09:00:00.000Z',
                endDate: '2024-01-15T17:00:00.000Z',
            };
            const result = milestoneCreateSchema.safeParse(sameDayMilestone);
            expect(result.success).toBe(true);
        });
        it('should validate datetime format', () => {
            const invalidDateMilestone = {
                ...validMilestone,
                startDate: '2024-01-01', // Invalid datetime format
            };
            const result = milestoneCreateSchema.safeParse(invalidDateMilestone);
            expect(result.success).toBe(false);
        });
        it('should handle optional fields', () => {
            const minimalMilestone = {
                title: 'Basic Milestone',
                subjectId: 1,
            };
            const result = milestoneCreateSchema.safeParse(minimalMilestone);
            expect(result.success).toBe(true);
        });
        it('should validate estHours is integer', () => {
            const invalidHoursMilestone = {
                ...validMilestone,
                estHours: 20.5, // Should be integer
            };
            const result = milestoneCreateSchema.safeParse(invalidHoursMilestone);
            expect(result.success).toBe(false);
        });
        it('should limit description length', () => {
            const longDescription = 'a'.repeat(10001); // Exceeds 10000 character limit
            const invalidMilestone = {
                ...validMilestone,
                description: longDescription,
            };
            const result = milestoneCreateSchema.safeParse(invalidMilestone);
            expect(result.success).toBe(false);
        });
        it('should allow bilingual titles and descriptions', () => {
            const bilingualMilestone = {
                title: 'Unité 1 : Les nombres',
                titleEn: 'Unit 1: Numbers',
                titleFr: 'Unité 1 : Les nombres',
                subjectId: 1,
                description: 'Description en français',
                descriptionEn: 'Description in English',
                descriptionFr: 'Description en français',
            };
            const result = milestoneCreateSchema.safeParse(bilingualMilestone);
            expect(result.success).toBe(true);
        });
        it('should handle expectations array', () => {
            const milestoneWithExpectations = {
                ...validMilestone,
                expectations: ['MAT-1-N-1', 'MAT-1-N-2', 'MAT-1-PS-1'],
            };
            const result = milestoneCreateSchema.safeParse(milestoneWithExpectations);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.expectations).toEqual(['MAT-1-N-1', 'MAT-1-N-2', 'MAT-1-PS-1']);
            }
        });
    });
    describe('milestoneUpdateSchema', () => {
        it('should not require subjectId for updates', () => {
            const updateData = {
                title: 'Updated Title',
                startDate: '2024-02-01T00:00:00.000Z',
                endDate: '2024-02-28T23:59:59.000Z',
            };
            const result = milestoneUpdateSchema.safeParse(updateData);
            expect(result.success).toBe(true);
        });
        it('should still validate date constraints', () => {
            const invalidUpdate = {
                title: 'Updated Title',
                startDate: '2024-02-28T00:00:00.000Z',
                endDate: '2024-02-01T23:59:59.000Z', // Before start date
            };
            const result = milestoneUpdateSchema.safeParse(invalidUpdate);
            expect(result.success).toBe(false);
        });
        it('should allow partial updates', () => {
            const partialUpdate = {
                estHours: 30,
            };
            const result = milestoneUpdateSchema.safeParse(partialUpdate);
            if (!result.success) {
                console.error('Validation failed:', result.error);
            }
            expect(result.success).toBe(true);
        });
    });
    describe('activityCreateSchema', () => {
        it('should validate required fields', () => {
            const validActivity = {
                title: 'Introduction to Fractions',
                milestoneId: 1,
            };
            const result = activityCreateSchema.safeParse(validActivity);
            expect(result.success).toBe(true);
        });
        it('should require title and milestoneId', () => {
            const invalidActivity = {
                title: 'Activity without milestone',
                // Missing milestoneId
            };
            const result = activityCreateSchema.safeParse(invalidActivity);
            expect(result.success).toBe(false);
        });
        it('should handle bilingual titles', () => {
            const bilingualActivity = {
                title: 'Les fractions',
                titleEn: 'Fractions',
                titleFr: 'Les fractions',
                milestoneId: 1,
            };
            const result = activityCreateSchema.safeParse(bilingualActivity);
            expect(result.success).toBe(true);
        });
        it('should reject empty title', () => {
            const invalidActivity = {
                title: '',
                milestoneId: 1,
            };
            const result = activityCreateSchema.safeParse(invalidActivity);
            expect(result.success).toBe(false);
        });
    });
    describe('Cross-field validation edge cases', () => {
        it('should handle timezone-aware date comparisons', () => {
            const milestone = {
                title: 'Timezone Test',
                subjectId: 1,
                startDate: '2024-01-01T23:59:59.000Z',
                endDate: '2024-01-02T00:00:00.000Z',
            };
            const result = milestoneCreateSchema.safeParse(milestone);
            expect(result.success).toBe(true);
        });
        it('should handle millisecond precision in dates', () => {
            const milestone = {
                title: 'Precision Test',
                subjectId: 1,
                startDate: '2024-01-01T12:00:00.123Z',
                endDate: '2024-01-01T12:00:00.124Z',
            };
            const result = milestoneCreateSchema.safeParse(milestone);
            expect(result.success).toBe(true);
        });
        it('should handle year boundaries correctly', () => {
            const milestone = {
                title: 'Year Boundary Test',
                subjectId: 1,
                startDate: '2023-12-31T23:59:59.999Z',
                endDate: '2024-01-01T00:00:00.000Z',
            };
            const result = milestoneCreateSchema.safeParse(milestone);
            expect(result.success).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvdmFsaWRhdGlvbi51bml0LnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JELE9BQU8sRUFDTCxhQUFhLEVBQ2IscUJBQXFCLEVBQ3JCLHFCQUFxQixFQUNyQixvQkFBb0IsR0FDckIsTUFBTSxzQkFBc0IsQ0FBQztBQUU5QixRQUFRLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO0lBQzdDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzdCLEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7WUFDNUMsTUFBTSxZQUFZLEdBQUc7Z0JBQ25CLElBQUksRUFBRSxhQUFhO2dCQUNuQixNQUFNLEVBQUUsYUFBYTtnQkFDckIsTUFBTSxFQUFFLGVBQWU7YUFDeEIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLGFBQWEsQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDckQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ25CLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzVDLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsTUFBTSxjQUFjLEdBQUc7Z0JBQ3JCLE1BQU0sRUFBRSxhQUFhO2dCQUNyQixNQUFNLEVBQUUsZUFBZTthQUN4QixDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsYUFBYSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUN2RCxNQUFNLENB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QVMsQ0FBQyxDQUFDO1lBQzFELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtZQUN0RCxNQUFNLFNBQVMsR0FBRztnQkFDaEIsS0FBSyxFQUFFLGdCQUFnQjtnQkFDdkIsU0FBUyxFQUFFLENBQUM7Z0JBQ1osU0FBUyxFQUFFLDBCQUEwQjtnQkFDckMsT0FBTyxFQUFFLDBCQUEwQjthQUNwQyxDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcscUJBQXFCLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzFELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtZQUNqRCxNQUFNLFNBQVMsR0FBRztnQkFDaEIsS0FBSyxFQUFFLG9CQUFvQjtnQkFDM0IsU0FBUyxFQUFFLENBQUM7Z0JBQ1osU0FBUyxFQUFFLDBCQUEwQjtnQkFDckMsT0FBTyxFQUFFLDBCQUEwQjthQUNwQyxDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcscUJBQXFCLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzFELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWljaGFlbG1jaXNhYWMvR2l0SHViL3RlYWNoaW5nLWVuZ2luZTIuMC9zZXJ2ZXIvdGVzdHMvdW5pdC92YWxpZGF0aW9uLnVuaXQudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHtcbiAgc3ViamVjdFNjaGVtYSxcbiAgbWlsZXN0b25lQ3JlYXRlU2NoZW1hLFxuICBtaWxlc3RvbmVVcGRhdGVTY2hlbWEsXG4gIGFjdGl2aXR5Q3JlYXRlU2NoZW1hLFxufSBmcm9tICcuLi8uLi9zcmMvdmFsaWRhdGlvbic7XG5cbmRlc2NyaWJlKCdWYWxpZGF0aW9uIFNjaGVtYXMgVW5pdCBUZXN0cycsICgpID0+IHtcbiAgZGVzY3JpYmUoJ3N1YmplY3RTY2hlbWEnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSB2YWxpZCBzdWJqZWN0IGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZFN1YmplY3QgPSB7XG4gICAgICAgIG5hbWU6ICdNYXRoZW1hdGljcycsXG4gICAgICAgIG5hbWVFbjogJ01hdGhlbWF0aWNzJyxcbiAgICAgICAgbmFtZUZyOiAnTWF0aMOpbWF0aXF1ZXMnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc3ViamVjdFNjaGVtYS5zYWZlUGFyc2UodmFsaWRTdWJqZWN0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvRXF1YWwodmFsaWRTdWJqZWN0KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVxdWlyZSBuYW1lIGZpZWxkJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZFN1YmplY3QgPSB7XG4gICAgICAgIG5hbWVFbjogJ01hdGhlbWF0aWNzJyxcbiAgICAgICAgbmFtZUZyOiAnTWF0aMOpbWF0aXF1ZXMnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc3ViamVjdFNjaGVtYS5zYWZlUGFyc2UoaW52YWxpZFN1YmplY3QpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGVtcHR5IG5hbWUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkU3ViamVjdCA9IHtcbiAgICAgICAgbmFtZTogJycsXG4gICAgICAgIG5hbWVFbjogJ01hdGhlbWF0aWNzJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHN1YmplY3RTY2hlbWEuc2FmZVBhcnNlKGludmFsaWRTdWJqZWN0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IG9wdGlvbmFsIGxhbmd1YWdlIGZpZWxkcycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1pbmltYWxTdWJqZWN0ID0ge1xuICAgICAgICBuYW1lOiAnU2NpZW5jZScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBzdWJqZWN0U2NoZW1hLnNhZmVQYXJzZShtaW5pbWFsU3ViamVjdCk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBvbmx5IEVuZ2xpc2ggdHJhbnNsYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdWJqZWN0V2l0aEVuID0ge1xuICAgICAgICBuYW1lOiAnU2NpZW5jZScsXG4gICAgICAgIG5hbWVFbjogJ1NjaWVuY2UnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc3ViamVjdFNjaGVtYS5zYWZlUGFyc2Uoc3ViamVjdFdpdGhFbik7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhLm5hbWVFbikudG9CZSgnU2NpZW5jZScpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEubmFtZUZyKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBvbmx5IEZyZW5jaCB0cmFuc2xhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHN1YmplY3RXaXRoRnIgPSB7XG4gICAgICAgIG5hbWU6ICdTY2llbmNlcycsXG4gICAgICAgIG5hbWVGcjogJ1NjaWVuY2VzJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHN1YmplY3RTY2hlbWEuc2FmZVBhcnNlKHN1YmplY3RXaXRoRnIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5uYW1lRnIpLnRvQmUoJ1NjaWVuY2VzJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5uYW1lRW4pLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21pbGVzdG9uZUNyZWF0ZVNjaGVtYScsICgpID0+IHtcbiAgICBjb25zdCB2YWxpZE1pbGVzdG9uZSA9IHtcbiAgICAgIHRpdGxlOiAnVW5pdCAxOiBOdW1iZXJzJyxcbiAgICAgIHN1YmplY3RJZDogMSxcbiAgICAgIHN0YXJ0RGF0ZTogJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICBlbmREYXRlOiAnMjAyNC0wMS0zMVQyMzo1OTo1OS4wMDBaJyxcbiAgICAgIGVzdEhvdXJzOiAyMCxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSB2YWxpZCBtaWxlc3RvbmUgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG1pbGVzdG9uZUNyZWF0ZVNjaGVtYS5zYWZlUGFyc2UodmFsaWRNaWxlc3RvbmUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXF1aXJlIHRpdGxlIGFuZCBzdWJqZWN0SWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkTWlsZXN0b25lID0ge1xuICAgICAgICBzdGFydERhdGU6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICBlbmREYXRlOiAnMjAyNC0wMS0zMVQyMzo1OTo1OS4wMDBaJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IG1pbGVzdG9uZUNyZWF0ZVNjaGVtYS5zYWZlUGFyc2UoaW52YWxpZE1pbGVzdG9uZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSB0aGF0IGVuZCBkYXRlIGlzIGFmdGVyIHN0YXJ0IGRhdGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkTWlsZXN0b25lID0ge1xuICAgICAgICAuLi52YWxpZE1pbGVzdG9uZSxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0zMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgZW5kRGF0ZTogJzIwMjQtMDEtMDFUMjM6NTk6NTkuMDAwWicsIC8vIEJlZm9yZSBzdGFydCBkYXRlXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBtaWxlc3RvbmVDcmVhdGVTY2hlbWEuc2FmZVBhcnNlKGludmFsaWRNaWxlc3RvbmUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvci5pc3N1ZXMuc29tZSgoaXNzdWUpID0+IGlzc3VlLnBhdGguaW5jbHVkZXMoJ2VuZERhdGUnKSkpLnRvQmUodHJ1ZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGVxdWFsIHN0YXJ0IGFuZCBlbmQgZGF0ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzYW1lRGF5TWlsZXN0b25lID0ge1xuICAgICAgICAuLi52YWxpZE1pbGVzdG9uZSxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0xNVQwOTowMDowMC4wMDBaJyxcbiAgICAgICAgZW5kRGF0ZTogJzIwMjQtMDEtMTVUMTc6MDA6MDAuMDAwWicsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBtaWxlc3RvbmVDcmVhdGVTY2hlbWEuc2FmZVBhcnNlKHNhbWVEYXlNaWxlc3RvbmUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBkYXRldGltZSBmb3JtYXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkRGF0ZU1pbGVzdG9uZSA9IHtcbiAgICAgICAgLi4udmFsaWRNaWxlc3RvbmUsXG4gICAgICAgIHN0YXJ0RGF0ZTogJzIwMjQtMDEtMDEnLCAvLyBJbnZhbGlkIGRhdGV0aW1lIGZvcm1hdFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gbWlsZXN0b25lQ3JlYXRlU2NoZW1hLnNhZmVQYXJzZShpbnZhbGlkRGF0ZU1pbGVzdG9uZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgb3B0aW9uYWwgZmllbGRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWluaW1hbE1pbGVzdG9uZSA9IHtcbiAgICAgICAgdGl0bGU6ICdCYXNpYyBNaWxlc3RvbmUnLFxuICAgICAgICBzdWJqZWN0SWQ6IDEsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBtaWxlc3RvbmVDcmVhdGVTY2hlbWEuc2FmZVBhcnNlKG1pbmltYWxNaWxlc3RvbmUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBlc3RIb3VycyBpcyBpbnRlZ2VyJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZEhvdXJzTWlsZXN0b25lID0ge1xuICAgICAgICAuLi52YWxpZE1pbGVzdG9uZSxcbiAgICAgICAgZXN0SG91cnM6IDIwLjUsIC8vIFNob3VsZCBiZSBpbnRlZ2VyXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBtaWxlc3RvbmVDcmVhdGVTY2hlbWEuc2FmZVBhcnNlKGludmFsaWRIb3Vyc01pbGVzdG9uZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsaW1pdCBkZXNjcmlwdGlvbiBsZW5ndGgnLCAoKSA9PiB7XG4gICAgICBjb25zdCBsb25nRGVzY3JpcHRpb24gPSAnYScucmVwZWF0KDEwMDAxKTsgLy8gRXhjZWVkcyAxMDAwMCBjaGFyYWN0ZXIgbGltaXRcbiAgICAgIGNvbnN0IGludmFsaWRNaWxlc3RvbmUgPSB7XG4gICAgICAgIC4uLnZhbGlkTWlsZXN0b25lLFxuICAgICAgICBkZXNjcmlwdGlvbjogbG9uZ0Rlc2NyaXB0aW9uLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gbWlsZXN0b25lQ3JlYXRlU2NoZW1hLnNhZmVQYXJzZShpbnZhbGlkTWlsZXN0b25lKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGJpbGluZ3VhbCB0aXRsZXMgYW5kIGRlc2NyaXB0aW9ucycsICgpID0+IHtcbiAgICAgIGNvbnN0IGJpbGluZ3VhbE1pbGVzdG9uZSA9IHtcbiAgICAgICAgdGl0bGU6ICdVbml0w6kgMSA6IExlcyBub21icmVzJyxcbiAgICAgICAgdGl0bGVFbjogJ1VuaXQgMTogTnVtYmVycycsXG4gICAgICAgIHRpdGxlRnI6ICdVbml0w6kgMSA6IExlcyBub21icmVzJyxcbiAgICAgICAgc3ViamVjdElkOiAxLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0Rlc2NyaXB0aW9uIGVuIGZyYW7Dp2FpcycsXG4gICAgICAgIGRlc2NyaXB0aW9uRW46ICdEZXNjcmlwdGlvbiBpbiBFbmdsaXNoJyxcbiAgICAgICAgZGVzY3JpcHRpb25GcjogJ0Rlc2NyaXB0aW9uIGVuIGZyYW7Dp2FpcycsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBtaWxlc3RvbmVDcmVhdGVTY2hlbWEuc2FmZVBhcnNlKGJpbGluZ3VhbE1pbGVzdG9uZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBleHBlY3RhdGlvbnMgYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBtaWxlc3RvbmVXaXRoRXhwZWN0YXRpb25zID0ge1xuICAgICAgICAuLi52YWxpZE1pbGVzdG9uZSxcbiAgICAgICAgZXhwZWN0YXRpb25zOiBbJ01BVC0xLU4tMScsICdNQVQtMS1OLTInLCAnTUFULTEtUFMtMSddLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gbWlsZXN0b25lQ3JlYXRlU2NoZW1hLnNhZmVQYXJzZShtaWxlc3RvbmVXaXRoRXhwZWN0YXRpb25zKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuZXhwZWN0YXRpb25zKS50b0VxdWFsKFsnTUFULTEtTi0xJywgJ01BVC0xLU4tMicsICdNQVQtMS1QUy0xJ10pO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWlsZXN0b25lVXBkYXRlU2NoZW1hJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbm90IHJlcXVpcmUgc3ViamVjdElkIGZvciB1cGRhdGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgdGl0bGU6ICdVcGRhdGVkIFRpdGxlJyxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMi0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgZW5kRGF0ZTogJzIwMjQtMDItMjhUMjM6NTk6NTkuMDAwWicsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBtaWxlc3RvbmVVcGRhdGVTY2hlbWEuc2FmZVBhcnNlKHVwZGF0ZURhdGEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzdGlsbCB2YWxpZGF0ZSBkYXRlIGNvbnN0cmFpbnRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZFVwZGF0ZSA9IHtcbiAgICAgICAgdGl0bGU6ICdVcGRhdGVkIFRpdGxlJyxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMi0yOFQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgZW5kRGF0ZTogJzIwMjQtMDItMDFUMjM6NTk6NTkuMDAwWicsIC8vIEJlZm9yZSBzdGFydCBkYXRlXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBtaWxlc3RvbmVVcGRhdGVTY2hlbWEuc2FmZVBhcnNlKGludmFsaWRVcGRhdGUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgcGFydGlhbCB1cGRhdGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGFydGlhbFVwZGF0ZSA9IHtcbiAgICAgICAgZXN0SG91cnM6IDMwLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gbWlsZXN0b25lVXBkYXRlU2NoZW1hLnNhZmVQYXJzZShwYXJ0aWFsVXBkYXRlKTtcbiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignVmFsaWRhdGlvbiBmYWlsZWQ6JywgcmVzdWx0LmVycm9yKTtcbiAgICAgIH1cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FjdGl2aXR5Q3JlYXRlU2NoZW1hJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRBY3Rpdml0eSA9IHtcbiAgICAgICAgdGl0bGU6ICdJbnRyb2R1Y3Rpb24gdG8gRnJhY3Rpb25zJyxcbiAgICAgICAgbWlsZXN0b25lSWQ6IDEsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhY3Rpdml0eUNyZWF0ZVNjaGVtYS5zYWZlUGFyc2UodmFsaWRBY3Rpdml0eSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlcXVpcmUgdGl0bGUgYW5kIG1pbGVzdG9uZUlkJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZEFjdGl2aXR5ID0ge1xuICAgICAgICB0aXRsZTogJ0FjdGl2aXR5IHdpdGhvdXQgbWlsZXN0b25lJyxcbiAgICAgICAgLy8gTWlzc2luZyBtaWxlc3RvbmVJZFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYWN0aXZpdHlDcmVhdGVTY2hlbWEuc2FmZVBhcnNlKGludmFsaWRBY3Rpdml0eSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYmlsaW5ndWFsIHRpdGxlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGJpbGluZ3VhbEFjdGl2aXR5ID0ge1xuICAgICAgICB0aXRsZTogJ0xlcyBmcmFjdGlvbnMnLFxuICAgICAgICB0aXRsZUVuOiAnRnJhY3Rpb25zJyxcbiAgICAgICAgdGl0bGVGcjogJ0xlcyBmcmFjdGlvbnMnLFxuICAgICAgICBtaWxlc3RvbmVJZDogMSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGFjdGl2aXR5Q3JlYXRlU2NoZW1hLnNhZmVQYXJzZShiaWxpbmd1YWxBY3Rpdml0eSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBlbXB0eSB0aXRsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRBY3Rpdml0eSA9IHtcbiAgICAgICAgdGl0bGU6ICcnLFxuICAgICAgICBtaWxlc3RvbmVJZDogMSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGFjdGl2aXR5Q3JlYXRlU2NoZW1hLnNhZmVQYXJzZShpbnZhbGlkQWN0aXZpdHkpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Nyb3NzLWZpZWxkIHZhbGlkYXRpb24gZWRnZSBjYXNlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0aW1lem9uZS1hd2FyZSBkYXRlIGNvbXBhcmlzb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWlsZXN0b25lID0ge1xuICAgICAgICB0aXRsZTogJ1RpbWV6b25lIFRlc3QnLFxuICAgICAgICBzdWJqZWN0SWQ6IDEsXG4gICAgICAgIHN0YXJ0RGF0ZTogJzIwMjQtMDEtMDFUMjM6NTk6NTkuMDAwWicsXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTAxLTAyVDAwOjAwOjAwLjAwMFonLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gbWlsZXN0b25lQ3JlYXRlU2NoZW1hLnNhZmVQYXJzZShtaWxlc3RvbmUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlsbGlzZWNvbmQgcHJlY2lzaW9uIGluIGRhdGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWlsZXN0b25lID0ge1xuICAgICAgICB0aXRsZTogJ1ByZWNpc2lvbiBUZXN0JyxcbiAgICAgICAgc3ViamVjdElkOiAxLFxuICAgICAgICBzdGFydERhdGU6ICcyMDI0LTAxLTAxVDEyOjAwOjAwLjEyM1onLFxuICAgICAgICBlbmREYXRlOiAnMjAyNC0wMS0wMVQxMjowMDowMC4xMjRaJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IG1pbGVzdG9uZUNyZWF0ZVNjaGVtYS5zYWZlUGFyc2UobWlsZXN0b25lKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHllYXIgYm91bmRhcmllcyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBtaWxlc3RvbmUgPSB7XG4gICAgICAgIHRpdGxlOiAnWWVhciBCb3VuZGFyeSBUZXN0JyxcbiAgICAgICAgc3ViamVjdElkOiAxLFxuICAgICAgICBzdGFydERhdGU6ICcyMDIzLTEyLTMxVDIzOjU5OjU5Ljk5OVonLFxuICAgICAgICBlbmREYXRlOiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IG1pbGVzdG9uZUNyZWF0ZVNjaGVtYS5zYWZlUGFyc2UobWlsZXN0b25lKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==