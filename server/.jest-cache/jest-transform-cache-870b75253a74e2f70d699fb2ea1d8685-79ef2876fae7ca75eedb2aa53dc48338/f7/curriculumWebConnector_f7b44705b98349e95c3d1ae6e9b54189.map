{"file":"/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/src/services/connectors/curriculumWebConnector.ts","mappings":"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","names":[],"sources":["/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/src/services/connectors/curriculumWebConnector.ts"],"sourcesContent":["import { BaseConnector } from './baseConnector';\nimport { SearchParams } from '../activityDiscoveryService';\nimport { ExternalActivity } from '@teaching-engine/database';\nimport * as cheerio from 'cheerio';\n\ninterface CurriculumSite {\n  name: string;\n  baseUrl: string;\n  searchUrl: (query: string, grade?: number) => string;\n  parseResults: (html: string, $: cheerio.CheerioAPI) => CurriculumActivity[];\n}\n\ninterface CurriculumActivity {\n  title: string;\n  url: string;\n  description?: string;\n  grade?: string;\n  subject?: string;\n  type?: string;\n}\n\nexport class CurriculumWebConnector extends BaseConnector {\n  private sites: CurriculumSite[] = [\n    {\n      name: 'PEI Curriculum',\n      baseUrl: 'https://www.princeedwardisland.ca',\n      searchUrl: (query: string, grade?: number) => {\n        const baseSearch = `https://www.princeedwardisland.ca/en/search/site/${encodeURIComponent(query)}`;\n        if (grade) {\n          return `${baseSearch}+grade+${grade}`;\n        }\n        return baseSearch;\n      },\n      parseResults: (html: string, $: cheerio.CheerioAPI): CurriculumActivity[] => {\n        const results: CurriculumActivity[] = [];\n\n        // Parse PEI government search results\n        $('.search-result').each((i, elem) => {\n          const $elem = $(elem);\n          const title = $elem.find('.search-result-title a').text().trim();\n          const url = $elem.find('.search-result-title a').attr('href');\n          const description = $elem.find('.search-result-snippet').text().trim();\n\n          if (title && url) {\n            // Extract grade and subject from title or description\n            const gradeMatch = (title + ' ' + description).match(/grade\\s+(\\d+)/i);\n            const grade = gradeMatch ? gradeMatch[1] : undefined;\n\n            results.push({\n              title,\n              url: url.startsWith('http') ? url : `https://www.princeedwardisland.ca${url}`,\n              description,\n              grade,\n              type: 'document',\n            });\n          }\n        });\n\n        return results;\n      },\n    },\n    {\n      name: 'Ontario Curriculum',\n      baseUrl: 'https://www.dcp.edu.gov.on.ca',\n      searchUrl: (query: string, grade?: number) => {\n        return `https://www.dcp.edu.gov.on.ca/en/search?q=${encodeURIComponent(query)}${grade ? `+grade+${grade}` : ''}`;\n      },\n      parseResults: (html: string, $: cheerio.CheerioAPI): CurriculumActivity[] => {\n        const results: CurriculumActivity[] = [];\n\n        // Parse Ontario curriculum search results\n        $('.search-results-item').each((i, elem) => {\n          const $elem = $(elem);\n          const title = $elem.find('h3 a').text().trim();\n          const url = $elem.find('h3 a').attr('href');\n          const description = $elem.find('.description').text().trim();\n\n          if (title && url) {\n            results.push({\n              title,\n              url: url.startsWith('http') ? url : `https://www.dcp.edu.gov.on.ca${url}`,\n              description,\n              type: 'curriculum_doc',\n            });\n          }\n        });\n\n        return results;\n      },\n    },\n  ];\n\n  constructor() {\n    super('CurriculumWeb');\n  }\n\n  async search(\n    params: SearchParams,\n  ): Promise<Omit<ExternalActivity, 'id' | 'createdAt' | 'updatedAt'>[]> {\n    // Search each curriculum site\n    const searchPromises = this.sites.map(async (site) => {\n      const siteActivities: Omit<ExternalActivity, 'id' | 'createdAt' | 'updatedAt'>[] = [];\n      \n      try {\n        const searchUrl = site.searchUrl(params.query, params.gradeLevel);\n        const html = await this.fetchWithRetryAndTimeout(searchUrl, {\n          headers: {\n            'User-Agent': 'Teaching Engine 2.0 Educational Resource Bot (+https://teaching-engine.ca/bot)',\n            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n            'Accept-Language': 'en-US,en;q=0.9,fr;q=0.8',\n          },\n        }, 3, 30000, 2000); // 3 retries, 30s timeout, 2s base delay\n        \n        if (!html) {\n          console.error(`Failed to fetch from ${site.name}`);\n          return siteActivities;\n        }\n        const $ = cheerio.load(html);\n        const siteResults = site.parseResults(html, $);\n\n        // Convert to ExternalActivity format\n        for (const result of siteResults) {\n          // Fetch additional details from the activity page\n          const activityDetails = await this.fetchActivityDetails(result.url);\n\n          siteActivities.push(\n            this.transformToExternalActivity({\n              externalId: this.generateIdFromUrl(result.url),\n              source: this.sourceName,\n              url: result.url,\n              title: result.title,\n              description: activityDetails?.description || result.description,\n              activityType: this.inferActivityTypeFromContent(result, activityDetails),\n              gradeMin: params.gradeLevel || (result.grade ? parseInt(result.grade) : 1),\n              gradeMax: params.gradeLevel || (result.grade ? parseInt(result.grade) : 8),\n              subject: params.subject || activityDetails?.subject || 'General',\n              language: params.language || 'en',\n              materials: activityDetails?.materials || [],\n              duration: activityDetails?.duration || 45,\n              groupSize: activityDetails?.groupSize || 'whole class',\n              pedagogicalApproach: activityDetails?.approach || ['inquiry-based'],\n              curriculumAlignments: activityDetails?.alignments || [],\n              createdBy: site.name,\n              license: 'Government of Canada - Open Government Licence',\n              resourceUrls: activityDetails?.resources || [],\n            }),\n          );\n        }\n      } catch (error) {\n        console.error(`Error searching ${site.name}:`, error);\n      }\n      \n      return siteActivities;\n    });\n\n    const allResults = await Promise.all(searchPromises);\n    return allResults.flat();\n  }\n\n  async getActivityDetails(\n    externalId: string,\n  ): Promise<Omit<ExternalActivity, 'id' | 'createdAt' | 'updatedAt'> | null> {\n    // Reconstruct URL from external ID\n    const url = this.getUrlFromId(externalId);\n    if (!url) return null;\n\n    const activityDetails = await this.fetchActivityDetails(url);\n    if (!activityDetails) return null;\n\n    return this.transformToExternalActivity({\n      externalId,\n      source: this.sourceName,\n      url,\n      title: activityDetails.title,\n      description: activityDetails.description,\n      activityType: activityDetails.type || 'document',\n      gradeMin: activityDetails.gradeMin || 1,\n      gradeMax: activityDetails.gradeMax || 8,\n      subject: activityDetails.subject || 'General',\n      language: activityDetails.language || 'en',\n      materials: activityDetails.materials || [],\n      duration: activityDetails.duration || 45,\n      groupSize: activityDetails.groupSize || 'whole class',\n      pedagogicalApproach: activityDetails.approach || ['direct-instruction'],\n      curriculumAlignments: activityDetails.alignments || [],\n      createdBy: activityDetails.author || 'Unknown',\n      license: 'Government of Canada - Open Government Licence',\n      resourceUrls: activityDetails.resources || [],\n    });\n  }\n\n  private async fetchActivityDetails(url: string): Promise<{\n    title?: string;\n    description?: string;\n    resources?: Array<{ url: string; title: string }>;\n    gradeMin?: number;\n    gradeMax?: number;\n    subject?: string;\n    type?: string;\n    materials?: string[];\n    alignments?: string[];\n    language?: string;\n    duration?: number;\n    groupSize?: string;\n    approach?: string[];\n    author?: string;\n  } | null> {\n    try {\n      const html = await this.fetchWithRetryAndTimeout(url, {\n        headers: {\n          'User-Agent': 'Teaching Engine 2.0 Educational Resource Bot (+https://teaching-engine.ca/bot)',\n          'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n          'Accept-Language': 'en-US,en;q=0.9,fr;q=0.8',\n        },\n      }, 3, 30000, 1000); // 3 retries, 30s timeout, 1s base delay\n      \n      if (!html) {\n        return null;\n      }\n      const $ = cheerio.load(html);\n\n      // Extract common patterns from curriculum pages\n      const details: {\n        title?: string;\n        description?: string;\n        resources: Array<{ url: string; title: string }>;\n        gradeMin?: number;\n        gradeMax?: number;\n        subject?: string;\n        type?: string;\n        materials?: string[];\n        alignments?: string[];\n        language?: string;\n        duration?: number;\n        groupSize?: string;\n        approach?: string[];\n        author?: string;\n      } = {\n        title: $('h1').first().text().trim() || $('title').text().trim(),\n        description:\n          $('meta[name=\"description\"]').attr('content') ||\n          $('.content-description').text().trim() ||\n          $('p').first().text().trim(),\n        resources: [],\n      };\n\n      // Look for grade information\n      const gradeMatch = html.match(/grade\\s+(\\d+)(?:\\s*-\\s*(\\d+))?/i);\n      if (gradeMatch) {\n        details.gradeMin = parseInt(gradeMatch[1]);\n        details.gradeMax = gradeMatch[2] ? parseInt(gradeMatch[2]) : details.gradeMin;\n      }\n\n      // Look for subject information\n      const subjectKeywords = [\n        'mathematics',\n        'math',\n        'science',\n        'english',\n        'french',\n        'social studies',\n        'physical education',\n        'arts',\n        'music',\n      ];\n      for (const keyword of subjectKeywords) {\n        if (html.toLowerCase().includes(keyword)) {\n          details.subject = keyword.charAt(0).toUpperCase() + keyword.slice(1);\n          break;\n        }\n      }\n\n      // Look for PDF links and other resources\n      $('a[href$=\".pdf\"], a[href*=\"/download/\"], a[href*=\"/resource/\"]').each((i, elem) => {\n        const href = $(elem).attr('href');\n        const text = $(elem).text().trim();\n        if (href) {\n          details.resources.push({\n            url: href.startsWith('http') ? href : new URL(href, url).toString(),\n            title: text || 'Resource',\n          });\n        }\n      });\n\n      // Look for activity type indicators\n      if (html.toLowerCase().includes('lesson plan')) {\n        details.type = 'lesson_plan';\n      } else if (html.toLowerCase().includes('worksheet')) {\n        details.type = 'worksheet';\n      } else if (html.toLowerCase().includes('activity')) {\n        details.type = 'handson';\n      } else if (html.toLowerCase().includes('assessment')) {\n        details.type = 'assessment';\n      }\n\n      // Look for materials list\n      const materialsSection = $('.materials, .required-materials, #materials').text();\n      if (materialsSection) {\n        details.materials = materialsSection\n          .split(/[,\\n]/)\n          .map((m) => m.trim())\n          .filter((m) => m.length > 0);\n      }\n\n      // Look for curriculum alignments\n      const alignments: string[] = [];\n      $('.curriculum-expectation, .learning-outcome, .standard').each((i, elem) => {\n        const text = $(elem).text().trim();\n        if (text) alignments.push(text);\n      });\n      if (alignments.length > 0) {\n        details.alignments = alignments;\n      }\n\n      return details;\n    } catch (error) {\n      console.error('Error fetching activity details:', error);\n      return null;\n    }\n  }\n\n  private inferActivityTypeFromContent(\n    result: CurriculumActivity,\n    details: {\n      description?: string;\n    } | null,\n  ): string {\n    const content = (\n      result.title +\n      ' ' +\n      result.description +\n      ' ' +\n      (details?.description || '')\n    ).toLowerCase();\n\n    if (content.includes('worksheet') || content.includes('printable')) {\n      return 'worksheet';\n    } else if (content.includes('lesson plan') || content.includes('teaching plan')) {\n      return 'lesson_plan';\n    } else if (content.includes('experiment') || content.includes('lab')) {\n      return 'experiment';\n    } else if (content.includes('game') || content.includes('play')) {\n      return 'game';\n    } else if (content.includes('project')) {\n      return 'project';\n    } else if (\n      content.includes('assessment') ||\n      content.includes('test') ||\n      content.includes('quiz')\n    ) {\n      return 'assessment';\n    } else if (content.includes('activity') || content.includes('hands-on')) {\n      return 'handson';\n    }\n\n    return 'document';\n  }\n\n  private generateIdFromUrl(url: string): string {\n    // Create a unique ID from the URL\n    return Buffer.from(url)\n      .toString('base64')\n      .replace(/[^a-zA-Z0-9]/g, '')\n      .substring(0, 20);\n  }\n\n  private getUrlFromId(_externalId: string): string | null {\n    // This is a simplified reconstruction - in production, we'd store the mapping\n    // For now, return null as we'd need to look up the original URL\n    return null;\n  }\n}\n"],"version":3}