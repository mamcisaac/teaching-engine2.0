a8ab19637b362c71c89ec3b5ca1e9a76
import { jest, describe, it, beforeEach, expect } from '@jest/globals';
// Mock the subPlanService
jest.mock('../../src/services/subPlanService', () => ({
    buildSubPlanData: jest.fn(),
}));
import { extractWeeklyPlan } from '../../src/services/weeklyPlanExtractor';
import { buildSubPlanData } from '../../src/services/subPlanService';
const mockBuildSubPlanData = jest.mocked(buildSubPlanData);
describe('WeeklyPlanExtractor', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('extractWeeklyPlan', () => {
        it('should extract weekly plan data for multiple days', async () => {
            // Mock data
            const mockSubject = {
                id: 1,
                name: 'Mathematics',
                nameEn: 'Mathematics',
                nameFr: 'Mathématiques',
            };
            const mockMilestone = {
                id: 1,
                title: 'Number Operations',
                targetDate: new Date('2024-01-31'),
                subject: mockSubject,
                activities: [],
            };
            const mockActivity = {
                id: 1,
                title: 'Addition Practice',
                milestone: { subject: mockSubject },
                outcomes: [],
            };
            const mockDailyPlan = {
                id: 1,
                date: new Date('2024-01-15'),
                items: [
                    {
                        id: 1,
                        startMin: 540, // 9:00 AM
                        activity: mockActivity,
                        slot: { subject: mockSubject },
                    },
                ],
            };
            // Setup mocks
            const mockSubPlanData = {
                date: '2024-01-15',
                schedule: [
                    { time: '09:00', activity: 'Mathematics - Addition Practice', note: 'Use manipulatives' }
                ],
                pullOuts: [],
                contacts: { 'Principal': 'Ext. 100', 'Office': 'Ext. 101' },
                outcomes: [
                    { code: 'M1.1', description: 'Add numbers to 20', subject: 'Mathematics' }
                ]
            };
            mockBuildSubPlanData.mockResolvedValue(mockSubPlanData);
            const result = await extractWeeklyPlan('2024-01-15', 3, { userId: 1 });
            expect(result).toHaveProperty('startDate', '2024-01-15');
            expect(result).toHaveProperty('days');
            expect(result.days).toHaveLength(3);
            expect(result).toHaveProperty('weeklyOverview');
            expect(result.weeklyOverview).toHaveProperty('subjects');
            expect(result.weeklyOverview).toHaveProperty('milestones');
            expect(result).toHaveProperty('continuityNotes');
            expect(result).toHaveProperty('emergencyBackupPlans');
        });
        it('should generate continuity notes between days', async () => {
            // Setup mock data for consecutive days with related activities
            const mockSubject = { id: 1, name: 'Mathematics' };
            const mockPlans = [
                {
                    id: 1,
                    date: new Date('2024-01-15'),
                    items: [
                        {
                            id: 1,
                            startMin: 540,
                            activity: {
                                id: 1,
                                title: 'Introduction to Fractions',
                                milestone: { subject: mockSubject },
                            },
                            slot: { subject: mockSubject },
                        },
                    ],
                },
                {
                    id: 2,
                    date: new Date('2024-01-16'),
                    items: [
                        {
                            id: 2,
                            startMin: 540,
                            activity: {
                                id: 2,
                                title: 'Fraction Operations',
                                milestone: { subject: mockSubject },
                            },
                            slot: { subject: mockSubject },
                        },
                    ],
                },
            ];
            // Mock different data for each day to test continuity
            mockBuildSubPlanData
                .mockResolvedValueOnce({
                date: '2024-01-15',
                schedule: [{ time: '09:00', activity: 'Addition Practice' }],
                pullOuts: [],
                contacts: {},
            })
                .mockResolvedValueOnce({
                date: '2024-01-16',
                schedule: [{ time: '09:00', activity: 'Fraction Operations' }],
                pullOuts: [],
                contacts: {},
            });
            const result = await extractWeeklyPlan('2024-01-15', 2, { userId: 1 });
            expect(result.continuityNotes).toHaveLength(2);
            const day2Notes = result.continuityNotes[1];
            expect(day2Notes.connections.length).toBeGreaterThan(0);
            expect(day2Notes.connections[0]).toContain('Mathematics');
            expect(day2Notes.connections[0]).toContain('Introduction to Fractions');
            expect(day2Notes.connections[0]).toContain('Fraction Operations');
        });
        it('should generate emergency backup plans by subject', async () => {
            const mockSubjects = [
                {
                    id: 1,
                    name: 'Mathematics',
                    activities: [
                        { id: 1, title: 'Math Review Worksheets', isFallback: true },
                        { id: 2, title: 'Number Games', isFallback: true },
                    ],
                },
                {
                    id: 2,
                    name: 'Language Arts',
                    activities: [{ id: 3, title: 'Silent Reading', isFallback: true }],
                },
            ];
            // Mock empty day data
            mockBuildSubPlanData.mockResolvedValue({
                date: '2024-01-15',
                schedule: [],
                pullOuts: [],
                contacts: {},
            });
            const result = await extractWeeklyPlan('2024-01-15', 1, { userId: 1 });
            expect(result.emergencyBackupPlans).toHaveLength(2);
            const mathPlan = result.emergencyBackupPlans.find((p) => p.subject === 'Mathematics');
            expect(mathPlan).toBeDefined();
            expect(mathPlan?.activities).toContain('Math Review Worksheets');
            expect(mathPlan?.activities).toContain('Number Games');
            expect(mathPlan?.materials).toContain('Math manipulatives');
            const langPlan = result.emergencyBackupPlans.find((p) => p.subject === 'Language Arts');
            expect(langPlan).toBeDefined();
            expect(langPlan?.activities).toContain('Silent Reading');
            expect(langPlan?.materials).toContain('Reading books');
        });
        it('should calculate subject hours and topics correctly', async () => {
            const mockSubject = { id: 1, name: 'Mathematics' };
            const mockDailyPlan = {
                id: 1,
                date: new Date('2024-01-15'),
                items: [
                    {
                        id: 1,
                        startMin: 540, // 9:00 AM - assuming 15-minute slots
                        activity: {
                            id: 1,
                            title: 'Addition',
                            milestone: { subject: mockSubject },
                            outcomes: [],
                        },
                        slot: { subject: mockSubject },
                    },
                    {
                        id: 2,
                        startMin: 555, // 9:15 AM
                        activity: {
                            id: 2,
                            title: 'Subtraction',
                            milestone: { subject: mockSubject },
                            outcomes: [],
                        },
                        slot: { subject: mockSubject },
                    },
                    {
                        id: 3,
                        startMin: 570, // 9:30 AM
                        activity: {
                            id: 3,
                            title: 'Word Problems',
                            milestone: { subject: mockSubject },
                            outcomes: [],
                        },
                        slot: { subject: mockSubject },
                    },
                ],
            };
            // Mock calculation data for testing subject hours
            mockBuildSubPlanData.mockResolvedValue({
                date: '2024-01-15',
                schedule: [
                    { time: '09:00', activity: 'Mathematics - Addition' },
                    { time: '09:15', activity: 'Mathematics - Subtraction' },
                    { time: '09:30', activity: 'Mathematics - Word Problems' }
                ],
                pullOuts: [],
                contacts: {},
                outcomes: [
                    { code: 'M1.1', description: 'Add and subtract', subject: 'Mathematics' }
                ]
            });
            const result = await extractWeeklyPlan('2024-01-15', 1, { userId: 1 });
            const mathSubject = result.weeklyOverview.subjects.find((s) => s.name === 'Mathematics');
            expect(mathSubject).toBeDefined();
            expect(mathSubject?.totalHours).toBe(0.75); // 3 slots × 0.25 hours each
            expect(mathSubject?.keyTopics).toContain('Addition');
            expect(mathSubject?.keyTopics).toContain('Subtraction');
            expect(mathSubject?.keyTopics).toContain('Word Problems');
        });
        it('should handle empty days gracefully', async () => {
            // Mock empty day
            mockBuildSubPlanData.mockResolvedValue({
                date: '2024-01-15',
                schedule: [],
                pullOuts: [],
                contacts: {},
            });
            const result = await extractWeeklyPlan('2024-01-15', 3, { userId: 1 });
            expect(result.startDate).toBe('2024-01-15');
            expect(result.days).toHaveLength(3);
            expect(result.weeklyOverview.subjects).toHaveLength(0);
            expect(result.weeklyOverview.milestones).toHaveLength(0);
            expect(result.continuityNotes).toHaveLength(3);
            expect(result.emergencyBackupPlans).toHaveLength(0);
        });
        it('should respect user options for data inclusion', async () => {
            const mockDailyPlan = {
                id: 1,
                date: new Date('2024-01-15'),
                items: [],
            };
            // Mock for user options test
            mockBuildSubPlanData.mockResolvedValue({
                date: '2024-01-15',
                schedule: [{ time: '09:00', activity: 'Test Activity' }],
                pullOuts: [],
                contacts: {},
                goals: [{ id: 1, text: 'Test goal', status: 'active' }],
                routines: [{ id: 1, title: 'Morning routine', description: 'Test', category: 'morning' }]
            });
            // Test with includeGoals: false
            const result = await extractWeeklyPlan('2024-01-15', 1, {
                userId: 1,
                includeGoals: false,
                includeRoutines: false,
                includePlans: false,
            });
            expect(result.days[0].goals).toBeUndefined();
            expect(result.days[0].routines).toBeUndefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvd2Vla2x5UGxhbkV4dHJhY3Rvci51bml0LnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHdkUsMEJBQTBCO0FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNwRCxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQzVCLENBQUMsQ0FBQyxDQUFDO0FBTEosT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFPM0UsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDckUsTUFBTSxvQkFBb0IsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFFM0QsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsbURBQW1ELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDakUsWUFBWTtZQUNaLE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFFLEVBQUUsQ0FBQztnQkFDTCxJQUFJLEVBQUUsYUFBYTtnQkFDbkIsTUFBTSxFQUFFLGFBQWE7Z0JBQ3JCLE1BQU0sRUFBRSxlQUFlO2FBQ3hCLENBQUM7WUFFRixNQUFNLGFBQWEsR0FBRztnQkFDcEIsRUFBRSxFQUFFLENBQUM7Z0JBQ0wsS0FBSyxFQUFFLG1CQUFtQjtnQkFDMUIsVUFBVSxFQUFFLElBQUksSUFBSSxDQUFD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Q0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvd2Vla2x5UGxhbkV4dHJhY3Rvci51bml0LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgamVzdCwgZGVzY3JpYmUsIGl0LCBiZWZvcmVFYWNoLCBleHBlY3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB7IGV4dHJhY3RXZWVrbHlQbGFuIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL3dlZWtseVBsYW5FeHRyYWN0b3InO1xuXG4vLyBNb2NrIHRoZSBzdWJQbGFuU2VydmljZVxuamVzdC5tb2NrKCcuLi8uLi9zcmMvc2VydmljZXMvc3ViUGxhblNlcnZpY2UnLCAoKSA9PiAoe1xuICBidWlsZFN1YlBsYW5EYXRhOiBqZXN0LmZuKCksXG59KSk7XG5cbmltcG9ydCB7IGJ1aWxkU3ViUGxhbkRhdGEgfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvc3ViUGxhblNlcnZpY2UnO1xuY29uc3QgbW9ja0J1aWxkU3ViUGxhbkRhdGEgPSBqZXN0Lm1vY2tlZChidWlsZFN1YlBsYW5EYXRhKTtcblxuZGVzY3JpYmUoJ1dlZWtseVBsYW5FeHRyYWN0b3InLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXh0cmFjdFdlZWtseVBsYW4nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBleHRyYWN0IHdlZWtseSBwbGFuIGRhdGEgZm9yIG11bHRpcGxlIGRheXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIGRhdGFcbiAgICAgIGNvbnN0IG1vY2tTdWJqZWN0ID0ge1xuICAgICAgICBpZDogMSxcbiAgICAgICAgbmFtZTogJ01hdGhlbWF0aWNzJyxcbiAgICAgICAgbmFtZUVuOiAnTWF0aGVtYXRpY3MnLFxuICAgICAgICBuYW1lRnI6ICdNYXRow6ltYXRpcXVlcycsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrTWlsZXN0b25lID0ge1xuICAgICAgICBpZDogMSxcbiAgICAgICAgdGl0bGU6ICdOdW1iZXIgT3BlcmF0aW9ucycsXG4gICAgICAgIHRhcmdldERhdGU6IG5ldyBEYXRlKCcyMDI0LTAxLTMxJyksXG4gICAgICAgIHN1YmplY3Q6IG1vY2tTdWJqZWN0LFxuICAgICAgICBhY3Rpdml0aWVzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tBY3Rpdml0eSA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIHRpdGxlOiAnQWRkaXRpb24gUHJhY3RpY2UnLFxuICAgICAgICBtaWxlc3RvbmU6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgb3V0Y29tZXM6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja0RhaWx5UGxhbiA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKCcyMDI0LTAxLTE1JyksXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICBzdGFydE1pbjogNTQwLCAvLyA5OjAwIEFNXG4gICAgICAgICAgICBhY3Rpdml0eTogbW9ja0FjdGl2aXR5LFxuICAgICAgICAgICAgc2xvdDogeyBzdWJqZWN0OiBtb2NrU3ViamVjdCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICAvLyBTZXR1cCBtb2Nrc1xuICAgICAgY29uc3QgbW9ja1N1YlBsYW5EYXRhID0ge1xuICAgICAgICBkYXRlOiAnMjAyNC0wMS0xNScsXG4gICAgICAgIHNjaGVkdWxlOiBbXG4gICAgICAgICAgeyB0aW1lOiAnMDk6MDAnLCBhY3Rpdml0eTogJ01hdGhlbWF0aWNzIC0gQWRkaXRpb24gUHJhY3RpY2UnLCBub3RlOiAnVXNlIG1hbmlwdWxhdGl2ZXMnIH1cbiAgICAgICAgXSxcbiAgICAgICAgcHVsbE91dHM6IFtdLFxuICAgICAgICBjb250YWN0czogeyAnUHJpbmNpcGFsJzogJ0V4dC4gMTAwJywgJ09mZmljZSc6ICdFeHQuIDEwMScgfSxcbiAgICAgICAgb3V0Y29tZXM6IFtcbiAgICAgICAgICB7IGNvZGU6ICdNMS4xJywgZGVzY3JpcHRpb246ICdBZGQgbnVtYmVycyB0byAyMCcsIHN1YmplY3Q6ICdNYXRoZW1hdGljcycgfVxuICAgICAgICBdXG4gICAgICB9O1xuICAgICAgXG4gICAgICBtb2NrQnVpbGRTdWJQbGFuRGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3ViUGxhbkRhdGEpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0V2Vla2x5UGxhbignMjAyNC0wMS0xNScsIDMsIHsgdXNlcklkOiAxIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnc3RhcnREYXRlJywgJzIwMjQtMDEtMTUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdkYXlzJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRheXMpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd3ZWVrbHlPdmVydmlldycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC53ZWVrbHlPdmVydmlldykudG9IYXZlUHJvcGVydHkoJ3N1YmplY3RzJyk7XG4gICAgICBleHBlY3QocmVzdWx0LndlZWtseU92ZXJ2aWV3KS50b0hhdmVQcm9wZXJ0eSgnbWlsZXN0b25lcycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2NvbnRpbnVpdHlOb3RlcycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2VtZXJnZW5jeUJhY2t1cFBsYW5zJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGNvbnRpbnVpdHkgbm90ZXMgYmV0d2VlbiBkYXlzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2V0dXAgbW9jayBkYXRhIGZvciBjb25zZWN1dGl2ZSBkYXlzIHdpdGggcmVsYXRlZCBhY3Rpdml0aWVzXG4gICAgICBjb25zdCBtb2NrU3ViamVjdCA9IHsgaWQ6IDEsIG5hbWU6ICdNYXRoZW1hdGljcycgfTtcblxuICAgICAgY29uc3QgbW9ja1BsYW5zID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgZGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMTUnKSxcbiAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogMSxcbiAgICAgICAgICAgICAgc3RhcnRNaW46IDU0MCxcbiAgICAgICAgICAgICAgYWN0aXZpdHk6IHtcbiAgICAgICAgICAgICAgICBpZDogMSxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0ludHJvZHVjdGlvbiB0byBGcmFjdGlvbnMnLFxuICAgICAgICAgICAgICAgIG1pbGVzdG9uZTogeyBzdWJqZWN0OiBtb2NrU3ViamVjdCB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzbG90OiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogMixcbiAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0xNicpLFxuICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiAyLFxuICAgICAgICAgICAgICBzdGFydE1pbjogNTQwLFxuICAgICAgICAgICAgICBhY3Rpdml0eToge1xuICAgICAgICAgICAgICAgIGlkOiAyLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnRnJhY3Rpb24gT3BlcmF0aW9ucycsXG4gICAgICAgICAgICAgICAgbWlsZXN0b25lOiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHNsb3Q6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIC8vIE1vY2sgZGlmZmVyZW50IGRhdGEgZm9yIGVhY2ggZGF5IHRvIHRlc3QgY29udGludWl0eVxuICAgICAgbW9ja0J1aWxkU3ViUGxhbkRhdGFcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgICAgZGF0ZTogJzIwMjQtMDEtMTUnLFxuICAgICAgICAgIHNjaGVkdWxlOiBbeyB0aW1lOiAnMDk6MDAnLCBhY3Rpdml0eTogJ0FkZGl0aW9uIFByYWN0aWNlJyB9XSxcbiAgICAgICAgICBwdWxsT3V0czogW10sXG4gICAgICAgICAgY29udGFjdHM6IHt9LFxuICAgICAgICB9KVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgICBkYXRlOiAnMjAyNC0wMS0xNicsIFxuICAgICAgICAgIHNjaGVkdWxlOiBbeyB0aW1lOiAnMDk6MDAnLCBhY3Rpdml0eTogJ0ZyYWN0aW9uIE9wZXJhdGlvbnMnIH1dLFxuICAgICAgICAgIHB1bGxPdXRzOiBbXSxcbiAgICAgICAgICBjb250YWN0czoge30sXG4gICAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0V2Vla2x5UGxhbignMjAyNC0wMS0xNScsIDIsIHsgdXNlcklkOiAxIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmNvbnRpbnVpdHlOb3RlcykudG9IYXZlTGVuZ3RoKDIpO1xuXG4gICAgICBjb25zdCBkYXkyTm90ZXMgPSByZXN1bHQuY29udGludWl0eU5vdGVzWzFdO1xuICAgICAgZXhwZWN0KGRheTJOb3Rlcy5jb25uZWN0aW9ucy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChkYXkyTm90ZXMuY29ubmVjdGlvbnNbMF0pLnRvQ29udGFpbignTWF0aGVtYXRpY3MnKTtcbiAgICAgIGV4cGVjdChkYXkyTm90ZXMuY29ubmVjdGlvbnNbMF0pLnRvQ29udGFpbignSW50cm9kdWN0aW9uIHRvIEZyYWN0aW9ucycpO1xuICAgICAgZXhwZWN0KGRheTJOb3Rlcy5jb25uZWN0aW9uc1swXSkudG9Db250YWluKCdGcmFjdGlvbiBPcGVyYXRpb25zJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGVtZXJnZW5jeSBiYWNrdXAgcGxhbnMgYnkgc3ViamVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdWJqZWN0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgIG5hbWU6ICdNYXRoZW1hdGljcycsXG4gICAgICAgICAgYWN0aXZpdGllczogW1xuICAgICAgICAgICAgeyBpZDogMSwgdGl0bGU6ICdNYXRoIFJldmlldyBXb3Jrc2hlZXRzJywgaXNGYWxsYmFjazogdHJ1ZSB9LFxuICAgICAgICAgICAgeyBpZDogMiwgdGl0bGU6ICdOdW1iZXIgR2FtZXMnLCBpc0ZhbGxiYWNrOiB0cnVlIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAyLFxuICAgICAgICAgIG5hbWU6ICdMYW5ndWFnZSBBcnRzJyxcbiAgICAgICAgICBhY3Rpdml0aWVzOiBbeyBpZDogMywgdGl0bGU6ICdTaWxlbnQgUmVhZGluZycsIGlzRmFsbGJhY2s6IHRydWUgfV0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICAvLyBNb2NrIGVtcHR5IGRheSBkYXRhXG4gICAgICBtb2NrQnVpbGRTdWJQbGFuRGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGU6ICcyMDI0LTAxLTE1JyxcbiAgICAgICAgc2NoZWR1bGU6IFtdLFxuICAgICAgICBwdWxsT3V0czogW10sXG4gICAgICAgIGNvbnRhY3RzOiB7fSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0V2Vla2x5UGxhbignMjAyNC0wMS0xNScsIDEsIHsgdXNlcklkOiAxIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmVtZXJnZW5jeUJhY2t1cFBsYW5zKS50b0hhdmVMZW5ndGgoMik7XG5cbiAgICAgIGNvbnN0IG1hdGhQbGFuID0gcmVzdWx0LmVtZXJnZW5jeUJhY2t1cFBsYW5zLmZpbmQoKHApID0+IHAuc3ViamVjdCA9PT0gJ01hdGhlbWF0aWNzJyk7XG4gICAgICBleHBlY3QobWF0aFBsYW4pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobWF0aFBsYW4/LmFjdGl2aXRpZXMpLnRvQ29udGFpbignTWF0aCBSZXZpZXcgV29ya3NoZWV0cycpO1xuICAgICAgZXhwZWN0KG1hdGhQbGFuPy5hY3Rpdml0aWVzKS50b0NvbnRhaW4oJ051bWJlciBHYW1lcycpO1xuICAgICAgZXhwZWN0KG1hdGhQbGFuPy5tYXRlcmlhbHMpLnRvQ29udGFpbignTWF0aCBtYW5pcHVsYXRpdmVzJyk7XG5cbiAgICAgIGNvbnN0IGxhbmdQbGFuID0gcmVzdWx0LmVtZXJnZW5jeUJhY2t1cFBsYW5zLmZpbmQoKHApID0+IHAuc3ViamVjdCA9PT0gJ0xhbmd1YWdlIEFydHMnKTtcbiAgICAgIGV4cGVjdChsYW5nUGxhbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChsYW5nUGxhbj8uYWN0aXZpdGllcykudG9Db250YWluKCdTaWxlbnQgUmVhZGluZycpO1xuICAgICAgZXhwZWN0KGxhbmdQbGFuPy5tYXRlcmlhbHMpLnRvQ29udGFpbignUmVhZGluZyBib29rcycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgc3ViamVjdCBob3VycyBhbmQgdG9waWNzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdWJqZWN0ID0geyBpZDogMSwgbmFtZTogJ01hdGhlbWF0aWNzJyB9O1xuXG4gICAgICBjb25zdCBtb2NrRGFpbHlQbGFuID0ge1xuICAgICAgICBpZDogMSxcbiAgICAgICAgZGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMTUnKSxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogMSxcbiAgICAgICAgICAgIHN0YXJ0TWluOiA1NDAsIC8vIDk6MDAgQU0gLSBhc3N1bWluZyAxNS1taW51dGUgc2xvdHNcbiAgICAgICAgICAgIGFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgICAgICB0aXRsZTogJ0FkZGl0aW9uJyxcbiAgICAgICAgICAgICAgbWlsZXN0b25lOiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgICAgIG91dGNvbWVzOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzbG90OiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogMixcbiAgICAgICAgICAgIHN0YXJ0TWluOiA1NTUsIC8vIDk6MTUgQU1cbiAgICAgICAgICAgIGFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgIGlkOiAyLFxuICAgICAgICAgICAgICB0aXRsZTogJ1N1YnRyYWN0aW9uJyxcbiAgICAgICAgICAgICAgbWlsZXN0b25lOiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgICAgIG91dGNvbWVzOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzbG90OiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogMyxcbiAgICAgICAgICAgIHN0YXJ0TWluOiA1NzAsIC8vIDk6MzAgQU1cbiAgICAgICAgICAgIGFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgIGlkOiAzLFxuICAgICAgICAgICAgICB0aXRsZTogJ1dvcmQgUHJvYmxlbXMnLFxuICAgICAgICAgICAgICBtaWxlc3RvbmU6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICAgICAgb3V0Y29tZXM6IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNsb3Q6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgLy8gTW9jayBjYWxjdWxhdGlvbiBkYXRhIGZvciB0ZXN0aW5nIHN1YmplY3QgaG91cnNcbiAgICAgIG1vY2tCdWlsZFN1YlBsYW5EYXRhLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0ZTogJzIwMjQtMDEtMTUnLFxuICAgICAgICBzY2hlZHVsZTogW1xuICAgICAgICAgIHsgdGltZTogJzA5OjAwJywgYWN0aXZpdHk6ICdNYXRoZW1hdGljcyAtIEFkZGl0aW9uJyB9LFxuICAgICAgICAgIHsgdGltZTogJzA5OjE1JywgYWN0aXZpdHk6ICdNYXRoZW1hdGljcyAtIFN1YnRyYWN0aW9uJyB9LFxuICAgICAgICAgIHsgdGltZTogJzA5OjMwJywgYWN0aXZpdHk6ICdNYXRoZW1hdGljcyAtIFdvcmQgUHJvYmxlbXMnIH1cbiAgICAgICAgXSxcbiAgICAgICAgcHVsbE91dHM6IFtdLFxuICAgICAgICBjb250YWN0czoge30sXG4gICAgICAgIG91dGNvbWVzOiBbXG4gICAgICAgICAgeyBjb2RlOiAnTTEuMScsIGRlc2NyaXB0aW9uOiAnQWRkIGFuZCBzdWJ0cmFjdCcsIHN1YmplY3Q6ICdNYXRoZW1hdGljcycgfVxuICAgICAgICBdXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdFdlZWtseVBsYW4oJzIwMjQtMDEtMTUnLCAxLCB7IHVzZXJJZDogMSB9KTtcblxuICAgICAgY29uc3QgbWF0aFN1YmplY3QgPSByZXN1bHQud2Vla2x5T3ZlcnZpZXcuc3ViamVjdHMuZmluZCgocykgPT4gcy5uYW1lID09PSAnTWF0aGVtYXRpY3MnKTtcbiAgICAgIGV4cGVjdChtYXRoU3ViamVjdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChtYXRoU3ViamVjdD8udG90YWxIb3VycykudG9CZSgwLjc1KTsgLy8gMyBzbG90cyDDlyAwLjI1IGhvdXJzIGVhY2hcbiAgICAgIGV4cGVjdChtYXRoU3ViamVjdD8ua2V5VG9waWNzKS50b0NvbnRhaW4oJ0FkZGl0aW9uJyk7XG4gICAgICBleHBlY3QobWF0aFN1YmplY3Q/LmtleVRvcGljcykudG9Db250YWluKCdTdWJ0cmFjdGlvbicpO1xuICAgICAgZXhwZWN0KG1hdGhTdWJqZWN0Py5rZXlUb3BpY3MpLnRvQ29udGFpbignV29yZCBQcm9ibGVtcycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgZGF5cyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBlbXB0eSBkYXlcbiAgICAgIG1vY2tCdWlsZFN1YlBsYW5EYXRhLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0ZTogJzIwMjQtMDEtMTUnLFxuICAgICAgICBzY2hlZHVsZTogW10sXG4gICAgICAgIHB1bGxPdXRzOiBbXSxcbiAgICAgICAgY29udGFjdHM6IHt9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3RXZWVrbHlQbGFuKCcyMDI0LTAxLTE1JywgMywgeyB1c2VySWQ6IDEgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhcnREYXRlKS50b0JlKCcyMDI0LTAxLTE1Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRheXMpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2Vla2x5T3ZlcnZpZXcuc3ViamVjdHMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2Vla2x5T3ZlcnZpZXcubWlsZXN0b25lcykudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb250aW51aXR5Tm90ZXMpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZW1lcmdlbmN5QmFja3VwUGxhbnMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzcGVjdCB1c2VyIG9wdGlvbnMgZm9yIGRhdGEgaW5jbHVzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0RhaWx5UGxhbiA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKCcyMDI0LTAxLTE1JyksXG4gICAgICAgIGl0ZW1zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIC8vIE1vY2sgZm9yIHVzZXIgb3B0aW9ucyB0ZXN0XG4gICAgICBtb2NrQnVpbGRTdWJQbGFuRGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGU6ICcyMDI0LTAxLTE1JyxcbiAgICAgICAgc2NoZWR1bGU6IFt7IHRpbWU6ICcwOTowMCcsIGFjdGl2aXR5OiAnVGVzdCBBY3Rpdml0eScgfV0sXG4gICAgICAgIHB1bGxPdXRzOiBbXSxcbiAgICAgICAgY29udGFjdHM6IHt9LFxuICAgICAgICBnb2FsczogW3sgaWQ6IDEsIHRleHQ6ICdUZXN0IGdvYWwnLCBzdGF0dXM6ICdhY3RpdmUnIH1dLFxuICAgICAgICByb3V0aW5lczogW3sgaWQ6IDEsIHRpdGxlOiAnTW9ybmluZyByb3V0aW5lJywgZGVzY3JpcHRpb246ICdUZXN0JywgY2F0ZWdvcnk6ICdtb3JuaW5nJyB9XVxuICAgICAgfSk7XG5cbiAgICAgIC8vIFRlc3Qgd2l0aCBpbmNsdWRlR29hbHM6IGZhbHNlXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0V2Vla2x5UGxhbignMjAyNC0wMS0xNScsIDEsIHtcbiAgICAgICAgdXNlcklkOiAxLFxuICAgICAgICBpbmNsdWRlR29hbHM6IGZhbHNlLFxuICAgICAgICBpbmNsdWRlUm91dGluZXM6IGZhbHNlLFxuICAgICAgICBpbmNsdWRlUGxhbnM6IGZhbHNlLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZGF5c1swXS5nb2FscykudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kYXlzWzBdLnJvdXRpbmVzKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=