0d9d95403e588bbe2cef9fd7005d4028
import { describe, it, expect } from '@jest/globals';
import { filterAvailableBlocksByCalendar } from '../../src/services/planningEngine';
describe('PlanningEngine Unit Tests', () => {
    describe('filterAvailableBlocksByCalendar', () => {
        const createTimetableSlot = (id, day, startMin, endMin, subjectId = 1) => ({
            id,
            day,
            startMin,
            endMin,
            subjectId,
        });
        const createCalendarEvent = (start, end, allDay = false) => ({
            id: 1,
            title: 'Test Event',
            description: null,
            start: new Date(start),
            end: new Date(end),
            allDay,
            eventType: 'ASSEMBLY',
            source: 'MANUAL',
            teacherId: 1,
            schoolId: null,
            createdAt: new Date(),
            updatedAt: new Date(),
        });
        const createHoliday = (date) => ({
            id: 1,
            date: new Date(date),
            name: 'Test Holiday',
        });
        it('should filter out slots without subjectId', () => {
            const slots = [
                createTimetableSlot(1, 1, 480, 540, 1), // Monday 8:00-9:00 AM with subject
                createTimetableSlot(2, 2, 540, 600, null), // Tuesday 9:00-10:00 AM without subject
                createTimetableSlot(3, 3, 600, 660, 2), // Wednesday 10:00-11:00 AM with subject
            ];
            const result = filterAvailableBlocksByCalendar(slots, [], [], []);
            expect(result).toHaveLength(2);
            expect(result[0].day).toBe(1);
            expect(result[1].day).toBe(3);
        });
        it('should filter out slots that conflict with holidays', () => {
            const slots = [
                createTimetableSlot(1, 1, 480, 540), // Monday
                createTimetableSlot(2, 2, 540, 600), // Tuesday
                createTimetableSlot(3, 3, 600, 660), // Wednesday
            ];
            // Holiday on Wednesday (day 2 in converted system)
            const holidays = [
                createHoliday('2024-01-03'), // Wednesday, converts to day 2
            ];
            const result = filterAvailableBlocksByCalendar(slots, [], [], holidays);
            // Should filter out Wednesday slot due to holiday
            expect(result.length).toBeLessThan(3);
            expect(result.every((block) => block.day !== 2)).toBe(true);
        });
        it('should filter out slots that conflict with all-day events', () => {
            const slots = [
                createTimetableSlot(1, 1, 480, 540), // Day 1 8:00-9:00 AM
                createTimetableSlot(2, 1, 600, 660), // Day 1 10:00-11:00 AM
            ];
            const events = [
                createCalendarEvent('2024-01-02T00:00:00', '2024-01-02T23:59:59', true), // Tuesday converts to day 1
            ];
            const result = filterAvailableBlocksByCalendar(slots, events, [], []);
            // All day 1 slots should be filtered out due to all-day event
            expect(result).toHaveLength(0);
        });
        it('should filter out slots that conflict with timed events', () => {
            const slots = [
                createTimetableSlot(1, 1, 480, 540), // Day 1 8:00-9:00 AM
                createTimetableSlot(2, 1, 540, 600), // Day 1 9:00-10:00 AM
                createTimetableSlot(3, 1, 600, 660), // Day 1 10:00-11:00 AM
            ];
            const events = [
                createCalendarEvent('2024-01-02T09:00:00.000Z', '2024-01-02T10:00:00.000Z', false), // 9:00-10:00 AM UTC event on day 1
            ];
            const result = filterAvailableBlocksByCalendar(slots, events, [], []);
            // Should keep 8:00-9:00 and 10:00-11:00 slots, filter out 9:00-10:00
            expect(result).toHaveLength(2);
            expect(result.some((block) => block.startMin === 540 && block.endMin === 600)).toBe(false);
        });
        it('should handle partial overlaps correctly', () => {
            const slots = [
                createTimetableSlot(1, 1, 480, 540), // Day 1 8:00-9:00 AM
                createTimetableSlot(2, 1, 520, 580), // Day 1 8:40-9:40 AM (overlaps)
            ];
            const events = [
                createCalendarEvent('2024-01-02T08:30:00.000Z', '2024-01-02T09:15:00.000Z', false), // 8:30-9:15 AM UTC event on day 1
            ];
            const result = filterAvailableBlocksByCalendar(slots, events, [], []);
            // Both slots should be filtered out due to overlap
            expect(result).toHaveLength(0);
        });
        it('should preserve slots that do not conflict', () => {
            const slots = [
                createTimetableSlot(1, 1, 480, 540), // Monday 8:00-9:00 AM
                createTimetableSlot(2, 2, 540, 600), // Tuesday 9:00-10:00 AM
                createTimetableSlot(3, 3, 600, 660), // Wednesday 10:00-11:00 AM
            ];
            const events = [
                createCalendarEvent('2024-01-02T14:00:00', '2024-01-02T15:00:00', false), // Tuesday 2:00-3:00 PM
            ];
            const result = filterAvailableBlocksByCalendar(slots, events, [], []);
            // All slots should be preserved as none conflict with the afternoon event
            expect(result).toHaveLength(3);
        });
        it('should handle multiple constraints simultaneously', () => {
            const slots = [
                createTimetableSlot(1, 1, 480, 540, null), // Monday 8:00-9:00 AM (no subject)
                createTimetableSlot(2, 2, 540, 600, 1), // Tuesday 9:00-10:00 AM (has subject, holiday)
                createTimetableSlot(3, 3, 600, 660, 1), // Wednesday 10:00-11:00 AM (has subject, event conflict)
                createTimetableSlot(4, 4, 480, 540, 1), // Thursday 8:00-9:00 AM (has subject, no conflicts)
            ];
            const events = [
                createCalendarEvent('2024-01-04T10:00:00.000Z', '2024-01-04T11:00:00.000Z', false), // Thursday event conflicts with day 3 slot
            ];
            const holidays = [
                createHoliday('2024-01-03'), // Wednesday holiday conflicts with day 2 slot
            ];
            const result = filterAvailableBlocksByCalendar(slots, events, [], holidays);
            // Only Thursday slot should remain
            expect(result).toHaveLength(1);
            expect(result[0].day).toBe(4);
        });
        it('should return correct DailyBlock format', () => {
            const slots = [createTimetableSlot(1, 1, 480, 540, 5)];
            const result = filterAvailableBlocksByCalendar(slots, [], [], []);
            expect(result).toHaveLength(1);
            expect(result[0]).toEqual({
                day: 1,
                slotId: 1,
                startMin: 480,
                endMin: 540,
                subjectId: 5,
            });
        });
        it('should handle edge case of event exactly matching slot time', () => {
            const slots = [
                createTimetableSlot(1, 1, 540, 600), // Day 1 9:00-10:00 AM
            ];
            const events = [
                createCalendarEvent('2024-01-02T09:00:00.000Z', '2024-01-02T10:00:00.000Z', false), // Exact match on day 1
            ];
            const result = filterAvailableBlocksByCalendar(slots, events, [], []);
            // Should filter out the exactly matching slot
            expect(result).toHaveLength(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvcGxhbm5pbmdFbmdpbmUudW5pdC50ZXN0LnRzIiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUdwRixRQUFRLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO0lBQ3pDLFFBQVEsQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7UUFDL0MsTUFBTSxtQkFBbUIsR0FBRyxDQUMxQixFQUFVLEVBQ1YsR0FBVyxFQUNYLFFBQWdCLEVBQ2hCLE1BQWMsRUFDZCxZQUEyQixDQUFDLEVBQ2IsRUFBRSxDQUFDLENBQUM7WUFDbkIsRUFBRTtZQUNGLEdBQUc7WUFDSCxRQUFRO1lBQ1IsTUFBTTtZQUNOLFNBQVM7U0FDVixDQUFDLENBQUM7UUFFSCxNQUFNLG1CQUFtQixHQUFHLENBQUMsS0FBYSxFQUFFLEdBQVcsRUFBRSxNQUFNLEdBQUcsS0FBSyxFQUFpQixFQUFFLENBQUMsQ0FBQztZQUMxRixFQUFFLEVBQUUsQ0FBQztZQUNMLEtBQUssRUFBRSxZQUFZO1lBQ25CLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLEtBQUssRUFBRSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDdEIsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQztZQUNsQixNQUFNO1lBQ04sU0FBUyxFQUFFLFVBQVU7WUFDckIsTUFBTSxFQUFFLFFBQVE7WUFDaEIsU0FBUyxFQUFFLENBQUM7WUFDWixRQUFRLEVBQUUsSUFBSTtZQUNkLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTtZQUNyQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7U0FDdEIsQ0FBQyxDQUFDO1FBRUgsTUFBTSxhQUFhLEdBQUcsQ0FBQyxJQUFZLEVBQVcsRUFB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QUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXhFLE1BQU0sTUFBTSxHQUFHLCtCQUErQixDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRWxFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDeEIsR0FBRyxFQUFFLENBQUM7Z0JBQ04sTUFBTSxFQUFFLENBQUM7Z0JBQ1QsUUFBUSxFQUFFLEdBQUc7Z0JBQ2IsTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsU0FBUyxFQUFFLENBQUM7YUFDYixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw2REFBNkQsRUFBRSxHQUFHLEVBQUU7WUFDckUsTUFBTSxLQUFLLEdBQW9CO2dCQUM3QixtQkFBbUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxzQkFBc0I7YUFDNUQsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFvQjtnQkFDOUIsbUJBQW1CLENBQUMsMEJBQTBCLEVBQUUsMEJBQTBCLEVBQUUsS0FBSyxDQUFDLEVBQUUsdUJBQXVCO2FBQzVHLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRywrQkFBK0IsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUV0RSw4Q0FBOEM7WUFDOUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvcGxhbm5pbmdFbmdpbmUudW5pdC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBmaWx0ZXJBdmFpbGFibGVCbG9ja3NCeUNhbGVuZGFyIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL3BsYW5uaW5nRW5naW5lJztcbmltcG9ydCB0eXBlIHsgVGltZXRhYmxlU2xvdCwgQ2FsZW5kYXJFdmVudCwgSG9saWRheSB9IGZyb20gJ0B0ZWFjaGluZy1lbmdpbmUvZGF0YWJhc2UnO1xuXG5kZXNjcmliZSgnUGxhbm5pbmdFbmdpbmUgVW5pdCBUZXN0cycsICgpID0+IHtcbiAgZGVzY3JpYmUoJ2ZpbHRlckF2YWlsYWJsZUJsb2Nrc0J5Q2FsZW5kYXInLCAoKSA9PiB7XG4gICAgY29uc3QgY3JlYXRlVGltZXRhYmxlU2xvdCA9IChcbiAgICAgIGlkOiBudW1iZXIsXG4gICAgICBkYXk6IG51bWJlcixcbiAgICAgIHN0YXJ0TWluOiBudW1iZXIsXG4gICAgICBlbmRNaW46IG51bWJlcixcbiAgICAgIHN1YmplY3RJZDogbnVtYmVyIHwgbnVsbCA9IDEsXG4gICAgKTogVGltZXRhYmxlU2xvdCA9PiAoe1xuICAgICAgaWQsXG4gICAgICBkYXksXG4gICAgICBzdGFydE1pbixcbiAgICAgIGVuZE1pbixcbiAgICAgIHN1YmplY3RJZCxcbiAgICB9KTtcblxuICAgIGNvbnN0IGNyZWF0ZUNhbGVuZGFyRXZlbnQgPSAoc3RhcnQ6IHN0cmluZywgZW5kOiBzdHJpbmcsIGFsbERheSA9IGZhbHNlKTogQ2FsZW5kYXJFdmVudCA9PiAoe1xuICAgICAgaWQ6IDEsXG4gICAgICB0aXRsZTogJ1Rlc3QgRXZlbnQnLFxuICAgICAgZGVzY3JpcHRpb246IG51bGwsXG4gICAgICBzdGFydDogbmV3IERhdGUoc3RhcnQpLFxuICAgICAgZW5kOiBuZXcgRGF0ZShlbmQpLFxuICAgICAgYWxsRGF5LFxuICAgICAgZXZlbnRUeXBlOiAnQVNTRU1CTFknLFxuICAgICAgc291cmNlOiAnTUFOVUFMJyxcbiAgICAgIHRlYWNoZXJJZDogMSxcbiAgICAgIHNjaG9vbElkOiBudWxsLFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY3JlYXRlSG9saWRheSA9IChkYXRlOiBzdHJpbmcpOiBIb2xpZGF5ID0+ICh7XG4gICAgICBpZDogMSxcbiAgICAgIGRhdGU6IG5ldyBEYXRlKGRhdGUpLFxuICAgICAgbmFtZTogJ1Rlc3QgSG9saWRheScsXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBvdXQgc2xvdHMgd2l0aG91dCBzdWJqZWN0SWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzbG90czogVGltZXRhYmxlU2xvdFtdID0gW1xuICAgICAgICBjcmVhdGVUaW1ldGFibGVTbG90KDEsIDEsIDQ4MCwgNTQwLCAxKSwgLy8gTW9uZGF5IDg6MDAtOTowMCBBTSB3aXRoIHN1YmplY3RcbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgyLCAyLCA1NDAsIDYwMCwgbnVsbCksIC8vIFR1ZXNkYXkgOTowMC0xMDowMCBBTSB3aXRob3V0IHN1YmplY3RcbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgzLCAzLCA2MDAsIDY2MCwgMiksIC8vIFdlZG5lc2RheSAxMDowMC0xMTowMCBBTSB3aXRoIHN1YmplY3RcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlckF2YWlsYWJsZUJsb2Nrc0J5Q2FsZW5kYXIoc2xvdHMsIFtdLCBbXSwgW10pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLmRheSkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMV0uZGF5KS50b0JlKDMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgb3V0IHNsb3RzIHRoYXQgY29uZmxpY3Qgd2l0aCBob2xpZGF5cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNsb3RzOiBUaW1ldGFibGVTbG90W10gPSBbXG4gICAgICAgIGNyZWF0ZVRpbWV0YWJsZVNsb3QoMSwgMSwgNDgwLCA1NDApLCAvLyBNb25kYXlcbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgyLCAyLCA1NDAsIDYwMCksIC8vIFR1ZXNkYXlcbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgzLCAzLCA2MDAsIDY2MCksIC8vIFdlZG5lc2RheVxuICAgICAgXTtcblxuICAgICAgLy8gSG9saWRheSBvbiBXZWRuZXNkYXkgKGRheSAyIGluIGNvbnZlcnRlZCBzeXN0ZW0pXG4gICAgICBjb25zdCBob2xpZGF5czogSG9saWRheVtdID0gW1xuICAgICAgICBjcmVhdGVIb2xpZGF5KCcyMDI0LTAxLTAzJyksIC8vIFdlZG5lc2RheSwgY29udmVydHMgdG8gZGF5IDJcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlckF2YWlsYWJsZUJsb2Nrc0J5Q2FsZW5kYXIoc2xvdHMsIFtdLCBbXSwgaG9saWRheXMpO1xuXG4gICAgICAvLyBTaG91bGQgZmlsdGVyIG91dCBXZWRuZXNkYXkgc2xvdCBkdWUgdG8gaG9saWRheVxuICAgICAgZXhwZWN0KHJlc3VsdC5sZW5ndGgpLnRvQmVMZXNzVGhhbigzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXZlcnkoKGJsb2NrKSA9PiBibG9jay5kYXkgIT09IDIpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgb3V0IHNsb3RzIHRoYXQgY29uZmxpY3Qgd2l0aCBhbGwtZGF5IGV2ZW50cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNsb3RzOiBUaW1ldGFibGVTbG90W10gPSBbXG4gICAgICAgIGNyZWF0ZVRpbWV0YWJsZVNsb3QoMSwgMSwgNDgwLCA1NDApLCAvLyBEYXkgMSA4OjAwLTk6MDAgQU1cbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgyLCAxLCA2MDAsIDY2MCksIC8vIERheSAxIDEwOjAwLTExOjAwIEFNXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBldmVudHM6IENhbGVuZGFyRXZlbnRbXSA9IFtcbiAgICAgICAgY3JlYXRlQ2FsZW5kYXJFdmVudCgnMjAyNC0wMS0wMlQwMDowMDowMCcsICcyMDI0LTAxLTAyVDIzOjU5OjU5JywgdHJ1ZSksIC8vIFR1ZXNkYXkgY29udmVydHMgdG8gZGF5IDFcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlckF2YWlsYWJsZUJsb2Nrc0J5Q2FsZW5kYXIoc2xvdHMsIGV2ZW50cywgW10sIFtdKTtcblxuICAgICAgLy8gQWxsIGRheSAxIHNsb3RzIHNob3VsZCBiZSBmaWx0ZXJlZCBvdXQgZHVlIHRvIGFsbC1kYXkgZXZlbnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmlsdGVyIG91dCBzbG90cyB0aGF0IGNvbmZsaWN0IHdpdGggdGltZWQgZXZlbnRzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2xvdHM6IFRpbWV0YWJsZVNsb3RbXSA9IFtcbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgxLCAxLCA0ODAsIDU0MCksIC8vIERheSAxIDg6MDAtOTowMCBBTVxuICAgICAgICBjcmVhdGVUaW1ldGFibGVTbG90KDIsIDEsIDU0MCwgNjAwKSwgLy8gRGF5IDEgOTowMC0xMDowMCBBTVxuICAgICAgICBjcmVhdGVUaW1ldGFibGVTbG90KDMsIDEsIDYwMCwgNjYwKSwgLy8gRGF5IDEgMTA6MDAtMTE6MDAgQU1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IGV2ZW50czogQ2FsZW5kYXJFdmVudFtdID0gW1xuICAgICAgICBjcmVhdGVDYWxlbmRhckV2ZW50KCcyMDI0LTAxLTAyVDA5OjAwOjAwLjAwMFonLCAnMjAyNC0wMS0wMlQxMDowMDowMC4wMDBaJywgZmFsc2UpLCAvLyA5OjAwLTEwOjAwIEFNIFVUQyBldmVudCBvbiBkYXkgMVxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZmlsdGVyQXZhaWxhYmxlQmxvY2tzQnlDYWxlbmRhcihzbG90cywgZXZlbnRzLCBbXSwgW10pO1xuXG4gICAgICAvLyBTaG91bGQga2VlcCA4OjAwLTk6MDAgYW5kIDEwOjAwLTExOjAwIHNsb3RzLCBmaWx0ZXIgb3V0IDk6MDAtMTA6MDBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc29tZSgoYmxvY2spID0+IGJsb2NrLnN0YXJ0TWluID09PSA1NDAgJiYgYmxvY2suZW5kTWluID09PSA2MDApKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBhcnRpYWwgb3ZlcmxhcHMgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2xvdHM6IFRpbWV0YWJsZVNsb3RbXSA9IFtcbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgxLCAxLCA0ODAsIDU0MCksIC8vIERheSAxIDg6MDAtOTowMCBBTVxuICAgICAgICBjcmVhdGVUaW1ldGFibGVTbG90KDIsIDEsIDUyMCwgNTgwKSwgLy8gRGF5IDEgODo0MC05OjQwIEFNIChvdmVybGFwcylcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IGV2ZW50czogQ2FsZW5kYXJFdmVudFtdID0gW1xuICAgICAgICBjcmVhdGVDYWxlbmRhckV2ZW50KCcyMDI0LTAxLTAyVDA4OjMwOjAwLjAwMFonLCAnMjAyNC0wMS0wMlQwOToxNTowMC4wMDBaJywgZmFsc2UpLCAvLyA4OjMwLTk6MTUgQU0gVVRDIGV2ZW50IG9uIGRheSAxXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaWx0ZXJBdmFpbGFibGVCbG9ja3NCeUNhbGVuZGFyKHNsb3RzLCBldmVudHMsIFtdLCBbXSk7XG5cbiAgICAgIC8vIEJvdGggc2xvdHMgc2hvdWxkIGJlIGZpbHRlcmVkIG91dCBkdWUgdG8gb3ZlcmxhcFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmVzZXJ2ZSBzbG90cyB0aGF0IGRvIG5vdCBjb25mbGljdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHNsb3RzOiBUaW1ldGFibGVTbG90W10gPSBbXG4gICAgICAgIGNyZWF0ZVRpbWV0YWJsZVNsb3QoMSwgMSwgNDgwLCA1NDApLCAvLyBNb25kYXkgODowMC05OjAwIEFNXG4gICAgICAgIGNyZWF0ZVRpbWV0YWJsZVNsb3QoMiwgMiwgNTQwLCA2MDApLCAvLyBUdWVzZGF5IDk6MDAtMTA6MDAgQU1cbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgzLCAzLCA2MDAsIDY2MCksIC8vIFdlZG5lc2RheSAxMDowMC0xMTowMCBBTVxuICAgICAgXTtcblxuICAgICAgY29uc3QgZXZlbnRzOiBDYWxlbmRhckV2ZW50W10gPSBbXG4gICAgICAgIGNyZWF0ZUNhbGVuZGFyRXZlbnQoJzIwMjQtMDEtMDJUMTQ6MDA6MDAnLCAnMjAyNC0wMS0wMlQxNTowMDowMCcsIGZhbHNlKSwgLy8gVHVlc2RheSAyOjAwLTM6MDAgUE1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlckF2YWlsYWJsZUJsb2Nrc0J5Q2FsZW5kYXIoc2xvdHMsIGV2ZW50cywgW10sIFtdKTtcblxuICAgICAgLy8gQWxsIHNsb3RzIHNob3VsZCBiZSBwcmVzZXJ2ZWQgYXMgbm9uZSBjb25mbGljdCB3aXRoIHRoZSBhZnRlcm5vb24gZXZlbnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG11bHRpcGxlIGNvbnN0cmFpbnRzIHNpbXVsdGFuZW91c2x5JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2xvdHM6IFRpbWV0YWJsZVNsb3RbXSA9IFtcbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgxLCAxLCA0ODAsIDU0MCwgbnVsbCksIC8vIE1vbmRheSA4OjAwLTk6MDAgQU0gKG5vIHN1YmplY3QpXG4gICAgICAgIGNyZWF0ZVRpbWV0YWJsZVNsb3QoMiwgMiwgNTQwLCA2MDAsIDEpLCAvLyBUdWVzZGF5IDk6MDAtMTA6MDAgQU0gKGhhcyBzdWJqZWN0LCBob2xpZGF5KVxuICAgICAgICBjcmVhdGVUaW1ldGFibGVTbG90KDMsIDMsIDYwMCwgNjYwLCAxKSwgLy8gV2VkbmVzZGF5IDEwOjAwLTExOjAwIEFNIChoYXMgc3ViamVjdCwgZXZlbnQgY29uZmxpY3QpXG4gICAgICAgIGNyZWF0ZVRpbWV0YWJsZVNsb3QoNCwgNCwgNDgwLCA1NDAsIDEpLCAvLyBUaHVyc2RheSA4OjAwLTk6MDAgQU0gKGhhcyBzdWJqZWN0LCBubyBjb25mbGljdHMpXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBldmVudHM6IENhbGVuZGFyRXZlbnRbXSA9IFtcbiAgICAgICAgY3JlYXRlQ2FsZW5kYXJFdmVudCgnMjAyNC0wMS0wNFQxMDowMDowMC4wMDBaJywgJzIwMjQtMDEtMDRUMTE6MDA6MDAuMDAwWicsIGZhbHNlKSwgLy8gVGh1cnNkYXkgZXZlbnQgY29uZmxpY3RzIHdpdGggZGF5IDMgc2xvdFxuICAgICAgXTtcblxuICAgICAgY29uc3QgaG9saWRheXM6IEhvbGlkYXlbXSA9IFtcbiAgICAgICAgY3JlYXRlSG9saWRheSgnMjAyNC0wMS0wMycpLCAvLyBXZWRuZXNkYXkgaG9saWRheSBjb25mbGljdHMgd2l0aCBkYXkgMiBzbG90XG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaWx0ZXJBdmFpbGFibGVCbG9ja3NCeUNhbGVuZGFyKHNsb3RzLCBldmVudHMsIFtdLCBob2xpZGF5cyk7XG5cbiAgICAgIC8vIE9ubHkgVGh1cnNkYXkgc2xvdCBzaG91bGQgcmVtYWluXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLmRheSkudG9CZSg0KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgRGFpbHlCbG9jayBmb3JtYXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzbG90czogVGltZXRhYmxlU2xvdFtdID0gW2NyZWF0ZVRpbWV0YWJsZVNsb3QoMSwgMSwgNDgwLCA1NDAsIDUpXTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZmlsdGVyQXZhaWxhYmxlQmxvY2tzQnlDYWxlbmRhcihzbG90cywgW10sIFtdLCBbXSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0pLnRvRXF1YWwoe1xuICAgICAgICBkYXk6IDEsXG4gICAgICAgIHNsb3RJZDogMSxcbiAgICAgICAgc3RhcnRNaW46IDQ4MCxcbiAgICAgICAgZW5kTWluOiA1NDAsXG4gICAgICAgIHN1YmplY3RJZDogNSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZWRnZSBjYXNlIG9mIGV2ZW50IGV4YWN0bHkgbWF0Y2hpbmcgc2xvdCB0aW1lJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2xvdHM6IFRpbWV0YWJsZVNsb3RbXSA9IFtcbiAgICAgICAgY3JlYXRlVGltZXRhYmxlU2xvdCgxLCAxLCA1NDAsIDYwMCksIC8vIERheSAxIDk6MDAtMTA6MDAgQU1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IGV2ZW50czogQ2FsZW5kYXJFdmVudFtdID0gW1xuICAgICAgICBjcmVhdGVDYWxlbmRhckV2ZW50KCcyMDI0LTAxLTAyVDA5OjAwOjAwLjAwMFonLCAnMjAyNC0wMS0wMlQxMDowMDowMC4wMDBaJywgZmFsc2UpLCAvLyBFeGFjdCBtYXRjaCBvbiBkYXkgMVxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZmlsdGVyQXZhaWxhYmxlQmxvY2tzQnlDYWxlbmRhcihzbG90cywgZXZlbnRzLCBbXSwgW10pO1xuXG4gICAgICAvLyBTaG91bGQgZmlsdGVyIG91dCB0aGUgZXhhY3RseSBtYXRjaGluZyBzbG90XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=