{"version":3,"names":["cov_2l37gnjjxd","actualCoverage","prisma","getUnitPlanProgress","f","unitPlans","s","unitPlan","findMany","include","lessonPlans","map","plan","total","length","today","Date","completed","reduce","sum","lesson","date","b","id","title","completionRate","endDate","getUnitPlanUrgency","progress","p","daysLeft","Math","max","ceil","getTime","urgency","sort","a"],"sources":["/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/src/services/progressAnalytics.ts"],"sourcesContent":["import { prisma } from '../prisma';\n\nexport interface UnitPlanProgress {\n  id: string;\n  title: string;\n  completionRate: number;\n  endDate?: Date | null;\n}\n\nexport async function getUnitPlanProgress(): Promise<UnitPlanProgress[]> {\n  const unitPlans = await prisma.unitPlan.findMany({ include: { lessonPlans: true } });\n  return unitPlans.map((plan) => {\n    const total = plan.lessonPlans.length;\n    const today = new Date();\n    const completed = plan.lessonPlans.reduce(\n      (sum, lesson) => sum + (lesson.date <= today ? 1 : 0),\n      0,\n    );\n    return {\n      id: plan.id,\n      title: plan.title,\n      completionRate: total === 0 ? 0 : completed / total,\n      endDate: plan.endDate,\n    };\n  });\n}\n\nexport interface UnitPlanUrgency extends UnitPlanProgress {\n  urgency: number;\n}\n\n/**\n * Calculate unit plan urgency based on remaining time and completion rate.\n * Higher values indicate unit plans that need attention sooner.\n */\nexport async function getUnitPlanUrgency(): Promise<UnitPlanUrgency[]> {\n  const progress = await getUnitPlanProgress();\n  const today = new Date();\n  return progress\n    .map((p) => {\n      const daysLeft = p.endDate\n        ? Math.max(1, Math.ceil((p.endDate.getTime() - today.getTime()) / 86400000))\n        : 30;\n      const urgency = (1 - p.completionRate) / daysLeft;\n      return { ...p, urgency };\n    })\n    .sort((a, b) => b.urgency - a.urgency);\n}\n"],"mappings":"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","ignoreList":[]}