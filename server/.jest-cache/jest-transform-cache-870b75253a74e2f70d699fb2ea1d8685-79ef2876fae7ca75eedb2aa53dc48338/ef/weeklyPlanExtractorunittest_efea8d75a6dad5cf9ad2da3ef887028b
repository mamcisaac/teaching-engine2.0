428dd799dbb3c5e58c2cdac065703256
import { jest, describe, it, beforeEach, expect } from '@jest/globals';
jest.mock('../../src/services/subPlanService', () => ({
    buildSubPlanData: mockBuildSubPlanData,
}));
import { extractWeeklyPlan } from '../../src/services/weeklyPlanExtractor';
// Mock the subPlanService
const mockBuildSubPlanData = jest.fn();
describe('WeeklyPlanExtractor', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('extractWeeklyPlan', () => {
        it('should extract weekly plan data for multiple days', async () => {
            // Mock data
            const mockSubject = {
                id: 1,
                name: 'Mathematics',
                nameEn: 'Mathematics',
                nameFr: 'Mathématiques',
            };
            const mockMilestone = {
                id: 1,
                title: 'Number Operations',
                targetDate: new Date('2024-01-31'),
                subject: mockSubject,
                activities: [],
            };
            const mockActivity = {
                id: 1,
                title: 'Addition Practice',
                milestone: { subject: mockSubject },
                outcomes: [],
            };
            const mockDailyPlan = {
                id: 1,
                date: new Date('2024-01-15'),
                items: [
                    {
                        id: 1,
                        startMin: 540, // 9:00 AM
                        activity: mockActivity,
                        slot: { subject: mockSubject },
                    },
                ],
            };
            // Setup mocks
            const mockSubPlanData = {
                date: '2024-01-15',
                schedule: [
                    { time: '09:00', activity: 'Mathematics - Addition Practice', note: 'Use manipulatives' }
                ],
                pullOuts: [],
                contacts: { 'Principal': 'Ext. 100', 'Office': 'Ext. 101' },
                outcomes: [
                    { code: 'M1.1', description: 'Add numbers to 20', subject: 'Mathematics' }
                ]
            };
            mockBuildSubPlanData.mockResolvedValue(mockSubPlanData);
            const result = await extractWeeklyPlan('2024-01-15', 3, { userId: 1 });
            expect(result).toHaveProperty('startDate', '2024-01-15');
            expect(result).toHaveProperty('days');
            expect(result.days).toHaveLength(3);
            expect(result).toHaveProperty('weeklyOverview');
            expect(result.weeklyOverview).toHaveProperty('subjects');
            expect(result.weeklyOverview).toHaveProperty('milestones');
            expect(result).toHaveProperty('continuityNotes');
            expect(result).toHaveProperty('emergencyBackupPlans');
        });
        it('should generate continuity notes between days', async () => {
            // Setup mock data for consecutive days with related activities
            const mockSubject = { id: 1, name: 'Mathematics' };
            const mockPlans = [
                {
                    id: 1,
                    date: new Date('2024-01-15'),
                    items: [
                        {
                            id: 1,
                            startMin: 540,
                            activity: {
                                id: 1,
                                title: 'Introduction to Fractions',
                                milestone: { subject: mockSubject },
                            },
                            slot: { subject: mockSubject },
                        },
                    ],
                },
                {
                    id: 2,
                    date: new Date('2024-01-16'),
                    items: [
                        {
                            id: 2,
                            startMin: 540,
                            activity: {
                                id: 2,
                                title: 'Fraction Operations',
                                milestone: { subject: mockSubject },
                            },
                            slot: { subject: mockSubject },
                        },
                    ],
                },
            ];
            // Mock different data for each day to test continuity
            mockBuildSubPlanData
                .mockResolvedValueOnce({
                date: '2024-01-15',
                schedule: [{ time: '09:00', activity: 'Addition Practice' }],
                pullOuts: [],
                contacts: {},
            })
                .mockResolvedValueOnce({
                date: '2024-01-16',
                schedule: [{ time: '09:00', activity: 'Fraction Operations' }],
                pullOuts: [],
                contacts: {},
            });
            const result = await extractWeeklyPlan('2024-01-15', 2, { userId: 1 });
            expect(result.continuityNotes).toHaveLength(2);
            const day2Notes = result.continuityNotes[1];
            expect(day2Notes.connections.length).toBeGreaterThan(0);
            expect(day2Notes.connections[0]).toContain('Mathematics');
            expect(day2Notes.connections[0]).toContain('Introduction to Fractions');
            expect(day2Notes.connections[0]).toContain('Fraction Operations');
        });
        it('should generate emergency backup plans by subject', async () => {
            const mockSubjects = [
                {
                    id: 1,
                    name: 'Mathematics',
                    activities: [
                        { id: 1, title: 'Math Review Worksheets', isFallback: true },
                        { id: 2, title: 'Number Games', isFallback: true },
                    ],
                },
                {
                    id: 2,
                    name: 'Language Arts',
                    activities: [{ id: 3, title: 'Silent Reading', isFallback: true }],
                },
            ];
            // Mock empty day data
            mockBuildSubPlanData.mockResolvedValue({
                date: '2024-01-15',
                schedule: [],
                pullOuts: [],
                contacts: {},
            });
            const result = await extractWeeklyPlan('2024-01-15', 1, { userId: 1 });
            expect(result.emergencyBackupPlans).toHaveLength(2);
            const mathPlan = result.emergencyBackupPlans.find((p) => p.subject === 'Mathematics');
            expect(mathPlan).toBeDefined();
            expect(mathPlan?.activities).toContain('Math Review Worksheets');
            expect(mathPlan?.activities).toContain('Number Games');
            expect(mathPlan?.materials).toContain('Math manipulatives');
            const langPlan = result.emergencyBackupPlans.find((p) => p.subject === 'Language Arts');
            expect(langPlan).toBeDefined();
            expect(langPlan?.activities).toContain('Silent Reading');
            expect(langPlan?.materials).toContain('Reading books');
        });
        it('should calculate subject hours and topics correctly', async () => {
            const mockSubject = { id: 1, name: 'Mathematics' };
            const mockDailyPlan = {
                id: 1,
                date: new Date('2024-01-15'),
                items: [
                    {
                        id: 1,
                        startMin: 540, // 9:00 AM - assuming 15-minute slots
                        activity: {
                            id: 1,
                            title: 'Addition',
                            milestone: { subject: mockSubject },
                            outcomes: [],
                        },
                        slot: { subject: mockSubject },
                    },
                    {
                        id: 2,
                        startMin: 555, // 9:15 AM
                        activity: {
                            id: 2,
                            title: 'Subtraction',
                            milestone: { subject: mockSubject },
                            outcomes: [],
                        },
                        slot: { subject: mockSubject },
                    },
                    {
                        id: 3,
                        startMin: 570, // 9:30 AM
                        activity: {
                            id: 3,
                            title: 'Word Problems',
                            milestone: { subject: mockSubject },
                            outcomes: [],
                        },
                        slot: { subject: mockSubject },
                    },
                ],
            };
            // Mock calculation data for testing subject hours
            mockBuildSubPlanData.mockResolvedValue({
                date: '2024-01-15',
                schedule: [
                    { time: '09:00', activity: 'Mathematics - Addition' },
                    { time: '09:15', activity: 'Mathematics - Subtraction' },
                    { time: '09:30', activity: 'Mathematics - Word Problems' }
                ],
                pullOuts: [],
                contacts: {},
                outcomes: [
                    { code: 'M1.1', description: 'Add and subtract', subject: 'Mathematics' }
                ]
            });
            const result = await extractWeeklyPlan('2024-01-15', 1, { userId: 1 });
            const mathSubject = result.weeklyOverview.subjects.find((s) => s.name === 'Mathematics');
            expect(mathSubject).toBeDefined();
            expect(mathSubject?.totalHours).toBe(0.75); // 3 slots × 0.25 hours each
            expect(mathSubject?.keyTopics).toContain('Addition');
            expect(mathSubject?.keyTopics).toContain('Subtraction');
            expect(mathSubject?.keyTopics).toContain('Word Problems');
        });
        it('should handle empty days gracefully', async () => {
            // Mock empty day
            mockBuildSubPlanData.mockResolvedValue({
                date: '2024-01-15',
                schedule: [],
                pullOuts: [],
                contacts: {},
            });
            const result = await extractWeeklyPlan('2024-01-15', 3, { userId: 1 });
            expect(result.startDate).toBe('2024-01-15');
            expect(result.days).toHaveLength(3);
            expect(result.weeklyOverview.subjects).toHaveLength(0);
            expect(result.weeklyOverview.milestones).toHaveLength(0);
            expect(result.continuityNotes).toHaveLength(3);
            expect(result.emergencyBackupPlans).toHaveLength(0);
        });
        it('should respect user options for data inclusion', async () => {
            const mockDailyPlan = {
                id: 1,
                date: new Date('2024-01-15'),
                items: [],
            };
            // Mock for user options test
            mockBuildSubPlanData.mockResolvedValue({
                date: '2024-01-15',
                schedule: [{ time: '09:00', activity: 'Test Activity' }],
                pullOuts: [],
                contacts: {},
                goals: [{ id: 1, text: 'Test goal', status: 'active' }],
                routines: [{ id: 1, title: 'Morning routine', description: 'Test', category: 'morning' }]
            });
            // Test with includeGoals: false
            const result = await extractWeeklyPlan('2024-01-15', 1, {
                userId: 1,
                includeGoals: false,
                includeRoutines: false,
                includePlans: false,
            });
            expect(result.days[0].goals).toBeUndefined();
            expect(result.days[0].routines).toBeUndefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvd2Vla2x5UGxhbkV4dHJhY3Rvci51bml0LnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFLdkUsSUFBSSxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3BELGdCQUFnQixFQUFFLG9CQUFvQjtDQUN2QyxDQUFDLENBQUMsQ0FBQztBQU5KLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBRTNFLDBCQUEwQjtBQUMxQixNQUFNLG9CQUFvQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUt2QyxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1FBQ2pDLEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRSxZQUFZO1lBQ1osTUFBTSxXQUFXLEdBQUc7Z0JBQ2xCLEVBQUUsRUFBRSxDQUFDO2dCQUNMLElBQUksRUFBRSxhQUFhO2dCQUNuQixNQUFNLEVBQUUsYUFBYTtnQkFDckIsTUFBTSxFQUFFLGVBQWU7YUFDeEIsQ0FBQztZQUVGLE1BQU0sYUFBYSxHQUFHO2dCQUNwQixFQUFFLEVBQUUsQ0FBQztnQkFDTCxLQUFLLEVBQUUsbUJBQW1CO2dCQUMxQixVQUFVLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO2dCQUNsQyxPQUFPLEVBQUUsV0FBVztnQkFDcEIsVUFBVSxFQUFFLEVBQUU7YUFDZixDQUFDO1lBRUYs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YWNoaW5nLWVuZ2luZTIuMC9zZXJ2ZXIvdGVzdHMvdW5pdC93ZWVrbHlQbGFuRXh0cmFjdG9yLnVuaXQudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBqZXN0LCBkZXNjcmliZSwgaXQsIGJlZm9yZUVhY2gsIGV4cGVjdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgZXh0cmFjdFdlZWtseVBsYW4gfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvd2Vla2x5UGxhbkV4dHJhY3Rvcic7XG5cbi8vIE1vY2sgdGhlIHN1YlBsYW5TZXJ2aWNlXG5jb25zdCBtb2NrQnVpbGRTdWJQbGFuRGF0YSA9IGplc3QuZm4oKTtcbmplc3QubW9jaygnLi4vLi4vc3JjL3NlcnZpY2VzL3N1YlBsYW5TZXJ2aWNlJywgKCkgPT4gKHtcbiAgYnVpbGRTdWJQbGFuRGF0YTogbW9ja0J1aWxkU3ViUGxhbkRhdGEsXG59KSk7XG5cbmRlc2NyaWJlKCdXZWVrbHlQbGFuRXh0cmFjdG9yJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V4dHJhY3RXZWVrbHlQbGFuJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXh0cmFjdCB3ZWVrbHkgcGxhbiBkYXRhIGZvciBtdWx0aXBsZSBkYXlzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBkYXRhXG4gICAgICBjb25zdCBtb2NrU3ViamVjdCA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIG5hbWU6ICdNYXRoZW1hdGljcycsXG4gICAgICAgIG5hbWVFbjogJ01hdGhlbWF0aWNzJyxcbiAgICAgICAgbmFtZUZyOiAnTWF0aMOpbWF0aXF1ZXMnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja01pbGVzdG9uZSA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIHRpdGxlOiAnTnVtYmVyIE9wZXJhdGlvbnMnLFxuICAgICAgICB0YXJnZXREYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0zMScpLFxuICAgICAgICBzdWJqZWN0OiBtb2NrU3ViamVjdCxcbiAgICAgICAgYWN0aXZpdGllczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrQWN0aXZpdHkgPSB7XG4gICAgICAgIGlkOiAxLFxuICAgICAgICB0aXRsZTogJ0FkZGl0aW9uIFByYWN0aWNlJyxcbiAgICAgICAgbWlsZXN0b25lOiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgIG91dGNvbWVzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tEYWlseVBsYW4gPSB7XG4gICAgICAgIGlkOiAxLFxuICAgICAgICBkYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0xNScpLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgICAgc3RhcnRNaW46IDU0MCwgLy8gOTowMCBBTVxuICAgICAgICAgICAgYWN0aXZpdHk6IG1vY2tBY3Rpdml0eSxcbiAgICAgICAgICAgIHNsb3Q6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgLy8gU2V0dXAgbW9ja3NcbiAgICAgIGNvbnN0IG1vY2tTdWJQbGFuRGF0YSA9IHtcbiAgICAgICAgZGF0ZTogJzIwMjQtMDEtMTUnLFxuICAgICAgICBzY2hlZHVsZTogW1xuICAgICAgICAgIHsgdGltZTogJzA5OjAwJywgYWN0aXZpdHk6ICdNYXRoZW1hdGljcyAtIEFkZGl0aW9uIFByYWN0aWNlJywgbm90ZTogJ1VzZSBtYW5pcHVsYXRpdmVzJyB9XG4gICAgICAgIF0sXG4gICAgICAgIHB1bGxPdXRzOiBbXSxcbiAgICAgICAgY29udGFjdHM6IHsgJ1ByaW5jaXBhbCc6ICdFeHQuIDEwMCcsICdPZmZpY2UnOiAnRXh0LiAxMDEnIH0sXG4gICAgICAgIG91dGNvbWVzOiBbXG4gICAgICAgICAgeyBjb2RlOiAnTTEuMScsIGRlc2NyaXB0aW9uOiAnQWRkIG51bWJlcnMgdG8gMjAnLCBzdWJqZWN0OiAnTWF0aGVtYXRpY3MnIH1cbiAgICAgICAgXVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgbW9ja0J1aWxkU3ViUGxhbkRhdGEubW9ja1Jlc29sdmVkVmFsdWUobW9ja1N1YlBsYW5EYXRhKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdFdlZWtseVBsYW4oJzIwMjQtMDEtMTUnLCAzLCB7IHVzZXJJZDogMSB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3N0YXJ0RGF0ZScsICcyMDI0LTAxLTE1Jyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnZGF5cycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kYXlzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnd2Vla2x5T3ZlcnZpZXcnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2Vla2x5T3ZlcnZpZXcpLnRvSGF2ZVByb3BlcnR5KCdzdWJqZWN0cycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC53ZWVrbHlPdmVydmlldykudG9IYXZlUHJvcGVydHkoJ21pbGVzdG9uZXMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdjb250aW51aXR5Tm90ZXMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdlbWVyZ2VuY3lCYWNrdXBQbGFucycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBjb250aW51aXR5IG5vdGVzIGJldHdlZW4gZGF5cycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNldHVwIG1vY2sgZGF0YSBmb3IgY29uc2VjdXRpdmUgZGF5cyB3aXRoIHJlbGF0ZWQgYWN0aXZpdGllc1xuICAgICAgY29uc3QgbW9ja1N1YmplY3QgPSB7IGlkOiAxLCBuYW1lOiAnTWF0aGVtYXRpY3MnIH07XG5cbiAgICAgIGNvbnN0IG1vY2tQbGFucyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCcyMDI0LTAxLTE1JyksXG4gICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICAgIHN0YXJ0TWluOiA1NDAsXG4gICAgICAgICAgICAgIGFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdJbnRyb2R1Y3Rpb24gdG8gRnJhY3Rpb25zJyxcbiAgICAgICAgICAgICAgICBtaWxlc3RvbmU6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc2xvdDogeyBzdWJqZWN0OiBtb2NrU3ViamVjdCB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6IDIsXG4gICAgICAgICAgZGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMTYnKSxcbiAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogMixcbiAgICAgICAgICAgICAgc3RhcnRNaW46IDU0MCxcbiAgICAgICAgICAgICAgYWN0aXZpdHk6IHtcbiAgICAgICAgICAgICAgICBpZDogMixcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0ZyYWN0aW9uIE9wZXJhdGlvbnMnLFxuICAgICAgICAgICAgICAgIG1pbGVzdG9uZTogeyBzdWJqZWN0OiBtb2NrU3ViamVjdCB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzbG90OiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICAvLyBNb2NrIGRpZmZlcmVudCBkYXRhIGZvciBlYWNoIGRheSB0byB0ZXN0IGNvbnRpbnVpdHlcbiAgICAgIG1vY2tCdWlsZFN1YlBsYW5EYXRhXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICAgIGRhdGU6ICcyMDI0LTAxLTE1JyxcbiAgICAgICAgICBzY2hlZHVsZTogW3sgdGltZTogJzA5OjAwJywgYWN0aXZpdHk6ICdBZGRpdGlvbiBQcmFjdGljZScgfV0sXG4gICAgICAgICAgcHVsbE91dHM6IFtdLFxuICAgICAgICAgIGNvbnRhY3RzOiB7fSxcbiAgICAgICAgfSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgICAgZGF0ZTogJzIwMjQtMDEtMTYnLCBcbiAgICAgICAgICBzY2hlZHVsZTogW3sgdGltZTogJzA5OjAwJywgYWN0aXZpdHk6ICdGcmFjdGlvbiBPcGVyYXRpb25zJyB9XSxcbiAgICAgICAgICBwdWxsT3V0czogW10sXG4gICAgICAgICAgY29udGFjdHM6IHt9LFxuICAgICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdFdlZWtseVBsYW4oJzIwMjQtMDEtMTUnLCAyLCB7IHVzZXJJZDogMSB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5jb250aW51aXR5Tm90ZXMpLnRvSGF2ZUxlbmd0aCgyKTtcblxuICAgICAgY29uc3QgZGF5Mk5vdGVzID0gcmVzdWx0LmNvbnRpbnVpdHlOb3Rlc1sxXTtcbiAgICAgIGV4cGVjdChkYXkyTm90ZXMuY29ubmVjdGlvbnMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QoZGF5Mk5vdGVzLmNvbm5lY3Rpb25zWzBdKS50b0NvbnRhaW4oJ01hdGhlbWF0aWNzJyk7XG4gICAgICBleHBlY3QoZGF5Mk5vdGVzLmNvbm5lY3Rpb25zWzBdKS50b0NvbnRhaW4oJ0ludHJvZHVjdGlvbiB0byBGcmFjdGlvbnMnKTtcbiAgICAgIGV4cGVjdChkYXkyTm90ZXMuY29ubmVjdGlvbnNbMF0pLnRvQ29udGFpbignRnJhY3Rpb24gT3BlcmF0aW9ucycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBlbWVyZ2VuY3kgYmFja3VwIHBsYW5zIGJ5IHN1YmplY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrU3ViamVjdHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogMSxcbiAgICAgICAgICBuYW1lOiAnTWF0aGVtYXRpY3MnLFxuICAgICAgICAgIGFjdGl2aXRpZXM6IFtcbiAgICAgICAgICAgIHsgaWQ6IDEsIHRpdGxlOiAnTWF0aCBSZXZpZXcgV29ya3NoZWV0cycsIGlzRmFsbGJhY2s6IHRydWUgfSxcbiAgICAgICAgICAgIHsgaWQ6IDIsIHRpdGxlOiAnTnVtYmVyIEdhbWVzJywgaXNGYWxsYmFjazogdHJ1ZSB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogMixcbiAgICAgICAgICBuYW1lOiAnTGFuZ3VhZ2UgQXJ0cycsXG4gICAgICAgICAgYWN0aXZpdGllczogW3sgaWQ6IDMsIHRpdGxlOiAnU2lsZW50IFJlYWRpbmcnLCBpc0ZhbGxiYWNrOiB0cnVlIH1dLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgLy8gTW9jayBlbXB0eSBkYXkgZGF0YVxuICAgICAgbW9ja0J1aWxkU3ViUGxhbkRhdGEubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRlOiAnMjAyNC0wMS0xNScsXG4gICAgICAgIHNjaGVkdWxlOiBbXSxcbiAgICAgICAgcHVsbE91dHM6IFtdLFxuICAgICAgICBjb250YWN0czoge30sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdFdlZWtseVBsYW4oJzIwMjQtMDEtMTUnLCAxLCB7IHVzZXJJZDogMSB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5lbWVyZ2VuY3lCYWNrdXBQbGFucykudG9IYXZlTGVuZ3RoKDIpO1xuXG4gICAgICBjb25zdCBtYXRoUGxhbiA9IHJlc3VsdC5lbWVyZ2VuY3lCYWNrdXBQbGFucy5maW5kKChwKSA9PiBwLnN1YmplY3QgPT09ICdNYXRoZW1hdGljcycpO1xuICAgICAgZXhwZWN0KG1hdGhQbGFuKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1hdGhQbGFuPy5hY3Rpdml0aWVzKS50b0NvbnRhaW4oJ01hdGggUmV2aWV3IFdvcmtzaGVldHMnKTtcbiAgICAgIGV4cGVjdChtYXRoUGxhbj8uYWN0aXZpdGllcykudG9Db250YWluKCdOdW1iZXIgR2FtZXMnKTtcbiAgICAgIGV4cGVjdChtYXRoUGxhbj8ubWF0ZXJpYWxzKS50b0NvbnRhaW4oJ01hdGggbWFuaXB1bGF0aXZlcycpO1xuXG4gICAgICBjb25zdCBsYW5nUGxhbiA9IHJlc3VsdC5lbWVyZ2VuY3lCYWNrdXBQbGFucy5maW5kKChwKSA9PiBwLnN1YmplY3QgPT09ICdMYW5ndWFnZSBBcnRzJyk7XG4gICAgICBleHBlY3QobGFuZ1BsYW4pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobGFuZ1BsYW4/LmFjdGl2aXRpZXMpLnRvQ29udGFpbignU2lsZW50IFJlYWRpbmcnKTtcbiAgICAgIGV4cGVjdChsYW5nUGxhbj8ubWF0ZXJpYWxzKS50b0NvbnRhaW4oJ1JlYWRpbmcgYm9va3MnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIHN1YmplY3QgaG91cnMgYW5kIHRvcGljcyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrU3ViamVjdCA9IHsgaWQ6IDEsIG5hbWU6ICdNYXRoZW1hdGljcycgfTtcblxuICAgICAgY29uc3QgbW9ja0RhaWx5UGxhbiA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKCcyMDI0LTAxLTE1JyksXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICBzdGFydE1pbjogNTQwLCAvLyA5OjAwIEFNIC0gYXNzdW1pbmcgMTUtbWludXRlIHNsb3RzXG4gICAgICAgICAgICBhY3Rpdml0eToge1xuICAgICAgICAgICAgICBpZDogMSxcbiAgICAgICAgICAgICAgdGl0bGU6ICdBZGRpdGlvbicsXG4gICAgICAgICAgICAgIG1pbGVzdG9uZTogeyBzdWJqZWN0OiBtb2NrU3ViamVjdCB9LFxuICAgICAgICAgICAgICBvdXRjb21lczogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2xvdDogeyBzdWJqZWN0OiBtb2NrU3ViamVjdCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6IDIsXG4gICAgICAgICAgICBzdGFydE1pbjogNTU1LCAvLyA5OjE1IEFNXG4gICAgICAgICAgICBhY3Rpdml0eToge1xuICAgICAgICAgICAgICBpZDogMixcbiAgICAgICAgICAgICAgdGl0bGU6ICdTdWJ0cmFjdGlvbicsXG4gICAgICAgICAgICAgIG1pbGVzdG9uZTogeyBzdWJqZWN0OiBtb2NrU3ViamVjdCB9LFxuICAgICAgICAgICAgICBvdXRjb21lczogW10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2xvdDogeyBzdWJqZWN0OiBtb2NrU3ViamVjdCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6IDMsXG4gICAgICAgICAgICBzdGFydE1pbjogNTcwLCAvLyA5OjMwIEFNXG4gICAgICAgICAgICBhY3Rpdml0eToge1xuICAgICAgICAgICAgICBpZDogMyxcbiAgICAgICAgICAgICAgdGl0bGU6ICdXb3JkIFByb2JsZW1zJyxcbiAgICAgICAgICAgICAgbWlsZXN0b25lOiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgICAgIG91dGNvbWVzOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzbG90OiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIC8vIE1vY2sgY2FsY3VsYXRpb24gZGF0YSBmb3IgdGVzdGluZyBzdWJqZWN0IGhvdXJzXG4gICAgICBtb2NrQnVpbGRTdWJQbGFuRGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGU6ICcyMDI0LTAxLTE1JyxcbiAgICAgICAgc2NoZWR1bGU6IFtcbiAgICAgICAgICB7IHRpbWU6ICcwOTowMCcsIGFjdGl2aXR5OiAnTWF0aGVtYXRpY3MgLSBBZGRpdGlvbicgfSxcbiAgICAgICAgICB7IHRpbWU6ICcwOToxNScsIGFjdGl2aXR5OiAnTWF0aGVtYXRpY3MgLSBTdWJ0cmFjdGlvbicgfSxcbiAgICAgICAgICB7IHRpbWU6ICcwOTozMCcsIGFjdGl2aXR5OiAnTWF0aGVtYXRpY3MgLSBXb3JkIFByb2JsZW1zJyB9XG4gICAgICAgIF0sXG4gICAgICAgIHB1bGxPdXRzOiBbXSxcbiAgICAgICAgY29udGFjdHM6IHt9LFxuICAgICAgICBvdXRjb21lczogW1xuICAgICAgICAgIHsgY29kZTogJ00xLjEnLCBkZXNjcmlwdGlvbjogJ0FkZCBhbmQgc3VidHJhY3QnLCBzdWJqZWN0OiAnTWF0aGVtYXRpY3MnIH1cbiAgICAgICAgXVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3RXZWVrbHlQbGFuKCcyMDI0LTAxLTE1JywgMSwgeyB1c2VySWQ6IDEgfSk7XG5cbiAgICAgIGNvbnN0IG1hdGhTdWJqZWN0ID0gcmVzdWx0LndlZWtseU92ZXJ2aWV3LnN1YmplY3RzLmZpbmQoKHMpID0+IHMubmFtZSA9PT0gJ01hdGhlbWF0aWNzJyk7XG4gICAgICBleHBlY3QobWF0aFN1YmplY3QpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobWF0aFN1YmplY3Q/LnRvdGFsSG91cnMpLnRvQmUoMC43NSk7IC8vIDMgc2xvdHMgw5cgMC4yNSBob3VycyBlYWNoXG4gICAgICBleHBlY3QobWF0aFN1YmplY3Q/LmtleVRvcGljcykudG9Db250YWluKCdBZGRpdGlvbicpO1xuICAgICAgZXhwZWN0KG1hdGhTdWJqZWN0Py5rZXlUb3BpY3MpLnRvQ29udGFpbignU3VidHJhY3Rpb24nKTtcbiAgICAgIGV4cGVjdChtYXRoU3ViamVjdD8ua2V5VG9waWNzKS50b0NvbnRhaW4oJ1dvcmQgUHJvYmxlbXMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGRheXMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZW1wdHkgZGF5XG4gICAgICBtb2NrQnVpbGRTdWJQbGFuRGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGU6ICcyMDI0LTAxLTE1JyxcbiAgICAgICAgc2NoZWR1bGU6IFtdLFxuICAgICAgICBwdWxsT3V0czogW10sXG4gICAgICAgIGNvbnRhY3RzOiB7fSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0V2Vla2x5UGxhbignMjAyNC0wMS0xNScsIDMsIHsgdXNlcklkOiAxIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXJ0RGF0ZSkudG9CZSgnMjAyNC0wMS0xNScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kYXlzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QocmVzdWx0LndlZWtseU92ZXJ2aWV3LnN1YmplY3RzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3QocmVzdWx0LndlZWtseU92ZXJ2aWV3Lm1pbGVzdG9uZXMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29udGludWl0eU5vdGVzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QocmVzdWx0LmVtZXJnZW5jeUJhY2t1cFBsYW5zKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3BlY3QgdXNlciBvcHRpb25zIGZvciBkYXRhIGluY2x1c2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tEYWlseVBsYW4gPSB7XG4gICAgICAgIGlkOiAxLFxuICAgICAgICBkYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0xNScpLFxuICAgICAgICBpdGVtczogW10sXG4gICAgICB9O1xuXG4gICAgICAvLyBNb2NrIGZvciB1c2VyIG9wdGlvbnMgdGVzdFxuICAgICAgbW9ja0J1aWxkU3ViUGxhbkRhdGEubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRlOiAnMjAyNC0wMS0xNScsXG4gICAgICAgIHNjaGVkdWxlOiBbeyB0aW1lOiAnMDk6MDAnLCBhY3Rpdml0eTogJ1Rlc3QgQWN0aXZpdHknIH1dLFxuICAgICAgICBwdWxsT3V0czogW10sXG4gICAgICAgIGNvbnRhY3RzOiB7fSxcbiAgICAgICAgZ29hbHM6IFt7IGlkOiAxLCB0ZXh0OiAnVGVzdCBnb2FsJywgc3RhdHVzOiAnYWN0aXZlJyB9XSxcbiAgICAgICAgcm91dGluZXM6IFt7IGlkOiAxLCB0aXRsZTogJ01vcm5pbmcgcm91dGluZScsIGRlc2NyaXB0aW9uOiAnVGVzdCcsIGNhdGVnb3J5OiAnbW9ybmluZycgfV1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBUZXN0IHdpdGggaW5jbHVkZUdvYWxzOiBmYWxzZVxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXh0cmFjdFdlZWtseVBsYW4oJzIwMjQtMDEtMTUnLCAxLCB7XG4gICAgICAgIHVzZXJJZDogMSxcbiAgICAgICAgaW5jbHVkZUdvYWxzOiBmYWxzZSxcbiAgICAgICAgaW5jbHVkZVJvdXRpbmVzOiBmYWxzZSxcbiAgICAgICAgaW5jbHVkZVBsYW5zOiBmYWxzZSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmRheXNbMF0uZ29hbHMpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF5c1swXS5yb3V0aW5lcykudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9