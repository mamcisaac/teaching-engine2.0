8c35c8984e1c30a7761d584d7252e9f5
import { describe, it, expect, jest, beforeEach, afterEach } from '@jest/globals';
// Mock the prisma module before importing the service
jest.mock('../../src/prisma', () => ({
    prisma: {
        curriculumImport: {
            create: jest.fn(),
            findUnique: jest.fn(),
            findMany: jest.fn(),
            update: jest.fn(),
            delete: jest.fn(),
            deleteMany: jest.fn(),
            count: jest.fn(),
        },
        outcomeCluster: {
            findMany: jest.fn(),
            create: jest.fn(),
            update: jest.fn(),
            delete: jest.fn(),
        },
        curriculumExpectation: {
            findMany: jest.fn(),
            create: jest.fn(),
            createMany: jest.fn(),
            update: jest.fn(),
            delete: jest.fn(),
        },
    },
}));
// Mock the embedding service
jest.mock('../../src/services/embeddingService', () => ({
    embeddingService: {
        generateEmbedding: jest.fn(),
        findSimilarOutcomes: jest.fn(),
    },
}));
import { ImportStatus } from '@teaching-engine/database';
// Import services after mocking
import { CurriculumImportService } from '../../src/services/curriculumImportService';
import { embeddingService } from '../../src/services/embeddingService';
import { prisma } from '../../src/prisma';
describe('CurriculumImportService', () => {
    let curriculumImportService;
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    let mockPrisma;
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    let mockEmbeddingService;
    // Helper to ensure a mock function exists - removed as not needed
    beforeEach(async () => {
        jest.clearAllMocks();
        // Get mocked instances
        mockPrisma = prisma;
        mockEmbeddingService = embeddingService;
        // Create service instance
        curriculumImportService = new CurriculumImportService();
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
    describe('startImport', () => {
        it('should create a new import session', async () => {
            // Mock the create method to return a valid import object
            const mockImportRecord = {
                id: 'cm56gp6kzjoq', // CUID-like ID
                userId: 1,
                grade: 5,
                subject: 'MATH',
                sourceFormat: 'csv',
                sourceFile: 'file.csv',
                status: ImportStatus.UPLOADING,
                metadata: {},
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            mockPrisma.curriculumImport.create.mockResolvedValue(mockImportRecord);
            const importId = await curriculumImportService.startImport(1, 5, 'MATH', 'csv', 'file.csv');
            // The mock generates CUID-like IDs, so just verify it's a valid CUID format
            expect(importId).toMatch(/^c[a-z0-9]{8,}$/);
            expect(mockPrisma.curriculumImport.create).toHaveBeenCalledWith({
                data: {
                    userId: 1,
                    grade: 5,
                    subject: 'MATH',
                    sourceFormat: 'csv',
                    sourceFile: 'file.csv',
                    status: ImportStatus.UPLOADING,
                    metadata: {},
                },
            });
        });
        it('should handle errors during import creation', async () => {
            // Clear any previous mock implementations
            mockPrisma.curriculumImport.create.mockReset();
            // Configure the mock to reject the promise
            mockPrisma.curriculumImport.create.mockRejectedValueOnce(new Error('Database error'));
            await expect(curriculumImportService.startImport(1, 5, 'MATH', 'csv')).rejects.toThrow('Failed to start import session');
        });
    });
    describe('parseCSV', () => {
        it('should parse valid CSV content', () => {
            const csvContent = `code,description,subject,grade,domain
M1.1,Count to 100,MATH,1,Number
M1.2,Add single digits,MATH,1,Number
G1.1,Identify shapes,MATH,1,Geometry`;
            const outcomes = curriculumImportService.parseCSV(csvContent);
            expect(outcomes).toHaveLength(3);
            expect(outcomes[0]).toEqual({
                code: 'M1.1',
                description: 'Count to 100',
                subject: 'MATH',
                grade: 1,
                strand: 'Number',
            });
        });
        it('should handle CSV with missing optional fields', () => {
            const csvContent = `code,description
M1.1,Count to 100
M1.2,Add single digits`;
            const outcomes = curriculumImportService.parseCSV(csvContent);
            expect(outcomes).toHaveLength(2);
            expect(outcomes[0]).toEqual({
                code: 'M1.1',
                description: 'Count to 100',
                subject: 'Unknown',
                grade: 0,
                strand: 'General',
            });
        });
        it('should handle CSV with quoted values', () => {
            const csvContent = `code,description,subject,grade,domain
"M1.1","Count to 100, including skip counting",MATH,1,Number`;
            const outcomes = curriculumImportService.parseCSV(csvContent);
            expect(outcomes).toHaveLength(1);
            expect(outcomes[0].description).toBe('Count to 100, including skip counting');
        });
        it('should skip invalid lines', () => {
            const csvContent = `code,description,subject,grade,domain
M1.1,Count to 100,MATH,1,Number
invalid line without enough columns
M1.2,Add single digits,MATH,1,Number`;
            const outcomes = curriculumImportService.parseCSV(csvContent);
            expect(outcomes).toHaveLength(2);
        });
        it('should throw error for CSV without required columns', () => {
            const csvContent = `name,value
Test,123`;
            expect(() => curriculumImportService.parseCSV(csvContent)).toThrow('CSV must contain "code" and "description" columns');
        });
    });
    describe.skip('processImport', () => {
        const importId = 'c' + Math.random().toString(36).substr(2, 24); // Generate CUID-like ID
        const testOutcomes = [
            { code: 'M1.1', description: 'Count to 100', subject: 'MATH', grade: 1, domain: 'Number' },
            {
                code: 'M1.2',
                description: 'Add single digits',
                subject: 'MATH',
                grade: 1,
                domain: 'Number',
            },
        ];
        beforeEach(() => {
            // Mock update status calls
            mockPrisma.curriculumImport.update.mockResolvedValue({});
            // Mock embedding service
            mockEmbeddingService.generateBatchEmbeddings = jest.fn().mockResolvedValue([]);
            // Mock cluster creation
            mockPrisma.outcomeCluster.create.mockResolvedValue({
                id: 'cluster-1',
                clusterName: 'MATH-Number-Grade1',
                outcomeIds: ['outcome-1', 'outcome-2'],
            });
        });
        it('should process outcomes successfully', async () => {
            // Mock no existing outcomes
            mockPrisma.outcome.findUnique.mockResolvedValue(null);
            // Mock outcome creation
            mockPrisma.outcome.create
                .mockResolvedValueOnce({ id: 'outcome-1', code: 'M1.1' })
                .mockResolvedValueOnce({ id: 'outcome-2', code: 'M1.2' });
            // Mock outcomes for clustering
            mockPrisma.outcome.findMany.mockResolvedValue([
                { id: 'outcome-1', code: 'M1.1', subject: 'MATH', domain: 'Number', grade: 1 },
                { id: 'outcome-2', code: 'M1.2', subject: 'MATH', domain: 'Number', grade: 1 },
            ]);
            const result = await curriculumImportService.processImport(importId, testOutcomes);
            expect(result.importId).toBe(importId);
            expect(result.outcomes).toHaveLength(2);
            expect(result.clusters).toHaveLength(1);
            expect(result.errors).toHaveLength(0);
            // Verify status updates
            expect(mockPrisma.curriculumImport.update).toHaveBeenCalledWith({
                where: { id: importId },
                data: { status: ImportStatus.PROCESSING, totalOutcomes: 2 },
            });
            expect(mockPrisma.curriculumImport.update).toHaveBeenCalledWith({
                where: { id: importId },
                data: { status: ImportStatus.COMPLETED },
            });
            // Verify embeddings were generated
            expect(mockEmbeddingService.generateBatchEmbeddings).toHaveBeenCalled();
        });
        it('should skip existing outcomes', async () => {
            // Mock first outcome exists, second doesn't
            mockPrisma.outcome.findUnique
                .mockResolvedValueOnce({ id: 'existing-1', code: 'M1.1' })
                .mockResolvedValueOnce(null);
            mockPrisma.outcome.create.mockResolvedValue({
                id: 'outcome-2',
                code: 'M1.2',
            });
            const result = await curriculumImportService.processImport(importId, testOutcomes);
            expect(result.outcomes).toHaveLength(2);
            expect(mockPrisma.outcome.create).toHaveBeenCalledTimes(1); // Only called for new outcome
        });
        it('should handle errors during processing', async () => {
            mockPrisma.outcome.findUnique.mockRejectedValue(new Error('Database error'));
            const result = await curriculumImportService.processImport(importId, testOutcomes);
            expect(result.errors).toHaveLength(2); // One error per outcome
            expect(result.outcomes).toHaveLength(0); // No successful outcomes
            // The import should complete but with errors recorded
            expect(mockPrisma.curriculumImport.update).toHaveBeenCalledWith({
                where: { id: importId },
                data: { status: ImportStatus.COMPLETED },
            });
        });
        it('should process outcomes in batches', async () => {
            // Create 60 test outcomes (more than batch size of 50)
            const manyOutcomes = Array(60)
                .fill(null)
                .map((_, i) => ({
                code: `M1.${i}`,
                description: `Outcome ${i}`,
                subject: 'MATH',
                grade: 1,
                domain: 'Number',
            }));
            mockPrisma.outcome.findUnique.mockResolvedValue(null);
            mockPrisma.outcome.create.mockImplementation(
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            (args) => Promise.resolve({ id: `outcome-${args.data.code}`, code: args.data.code }));
            const result = await curriculumImportService.processImport(importId, manyOutcomes);
            expect(result.outcomes).toHaveLength(60);
            // Verify progress was updated during processing
            expect(mockPrisma.curriculumImport.update).toHaveBeenCalledWith({
                where: { id: importId },
                data: { processedOutcomes: 50 },
            });
        });
    });
    describe('getImportProgress', () => {
        it('should return import progress', async () => {
            const importId = 'c' + Math.random().toString(36).substr(2, 24);
            const mockImport = {
                id: importId,
                userId: 1,
                grade: 5,
                subject: 'MATH',
                sourceFormat: 'csv',
                status: ImportStatus.PROCESSING,
                totalOutcomes: 100,
                processedOutcomes: 50,
                errorLog: ['Error 1', 'Error 2'],
                createdAt: new Date(),
                updatedAt: new Date(),
                metadata: {},
                completedAt: null,
                sourceFile: null,
            };
            mockPrisma.curriculumImport.findUnique.mockResolvedValueOnce(mockImport);
            const progress = await curriculumImportService.getImportProgress(importId);
            expect(progress).toEqual({
                importId: importId,
                status: ImportStatus.PROCESSING,
                totalOutcomes: 100,
                processedOutcomes: 50,
                errors: ['Error 1', 'Error 2'],
            });
        });
        it('should return null for non-existent import', async () => {
            mockPrisma.curriculumImport.findUnique.mockResolvedValue(null);
            const progress = await curriculumImportService.getImportProgress('non-existent');
            expect(progress).toBeNull();
        });
    });
    describe('cancelImport', () => {
        it('should cancel import successfully', async () => {
            const importId = 'c' + Math.random().toString(36).substr(2, 24);
            mockPrisma.curriculumImport.update.mockResolvedValueOnce({});
            const success = await curriculumImportService.cancelImport(importId);
            expect(success).toBe(true);
            expect(mockPrisma.curriculumImport.update).toHaveBeenCalledWith({
                where: { id: importId },
                data: { status: ImportStatus.CANCELLED },
            });
        });
        it('should handle cancellation errors', async () => {
            mockPrisma.curriculumImport.update.mockRejectedValue(new Error('Not found'));
            const success = await curriculumImportService.cancelImport('non-existent');
            expect(success).toBe(false);
        });
    });
    describe('getImportHistory', () => {
        it('should return import history for user', async () => {
            const mockImports = [
                {
                    id: 'c' + Math.random().toString(36).substr(2, 24),
                    userId: 1,
                    createdAt: new Date('2024-01-01'),
                    updatedAt: new Date('2024-01-01'),
                    status: ImportStatus.COMPLETED,
                    grade: 5,
                    subject: 'MATH',
                    sourceFormat: 'csv',
                    sourceFile: null,
                    metadata: {},
                    totalOutcomes: 10,
                    processedOutcomes: 10,
                    errorLog: [],
                    completedAt: new Date('2024-01-01'),
                    clusters: [{ id: 'cluster-1', clusterName: 'Test', clusterType: 'theme' }],
                    _count: { curriculumExpectations: 10 },
                },
                {
                    id: 'c' + Math.random().toString(36).substr(2, 24),
                    userId: 1,
                    createdAt: new Date('2024-01-02'),
                    updatedAt: new Date('2024-01-02'),
                    status: ImportStatus.FAILED,
                    grade: 5,
                    subject: 'MATH',
                    sourceFormat: 'csv',
                    sourceFile: null,
                    metadata: {},
                    totalOutcomes: 0,
                    processedOutcomes: 0,
                    errorLog: ['Error occurred'],
                    completedAt: null,
                    clusters: [],
                    _count: { curriculumExpectations: 0 },
                },
            ];
            mockPrisma.curriculumImport.findMany.mockResolvedValueOnce(mockImports);
            const history = await curriculumImportService.getImportHistory(1, 10);
            expect(history).toHaveLength(2);
            expect(history[0]).toHaveProperty('id');
            expect(history[0]).toHaveProperty('clusters');
            expect(history[0]).toHaveProperty('_count');
            expect(mockPrisma.curriculumImport.findMany).toHaveBeenCalledWith({
                where: { userId: 1 },
                orderBy: { createdAt: 'desc' },
                take: 10,
                include: {
                    clusters: {
                        select: {
                            id: true,
                            clusterName: true,
                            clusterType: true,
                        },
                    },
                    _count: {
                        select: {
                            curriculumExpectations: true,
                        },
                    },
                },
            });
        });
        it('should handle empty history', async () => {
            mockPrisma.curriculumImport.findMany.mockResolvedValue([]);
            const history = await curriculumImportService.getImportHistory(1);
            expect(history).toEqual([]);
        });
    });
    describe('Edge Cases', () => {
        it.skip('should handle empty outcome array', async () => {
            const importId = 'c' + Math.random().toString(36).substr(2, 24);
            const result = await curriculumImportService.processImport(importId, []);
            expect(result.outcomes).toHaveLength(0);
            expect(result.clusters).toHaveLength(0);
            expect(result.errors).toHaveLength(0);
        });
        it('should handle CSV with special characters', () => {
            const csvContent = `code,description,subject,grade,domain
M1.1,"Count to 100, with émphasis on français",MATH,1,Nombre
M1.2,"Add & subtract (with symbols)",MATH,1,Number`;
            const outcomes = curriculumImportService.parseCSV(csvContent);
            expect(outcomes).toHaveLength(2);
            expect(outcomes[0].description).toContain('émphasis on français');
            expect(outcomes[1].description).toContain('& subtract (with symbols)');
        });
        it('should handle very large CSV files', () => {
            // Generate CSV with 1000 rows
            const headers = 'code,description,subject,grade,domain\n';
            const rows = Array(1000)
                .fill(null)
                .map((_, i) => `M${i}.1,Description ${i},MATH,${(i % 12) + 1},Domain`)
                .join('\n');
            const csvContent = headers + rows;
            const outcomes = curriculumImportService.parseCSV(csvContent);
            expect(outcomes).toHaveLength(1000);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvY3VycmljdWx1bUltcG9ydFNlcnZpY2UudGVzdC50cyIsIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHbEYsc0RBQXNEO0FBQ3RELElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNuQyxNQUFNLEVBQUU7UUFDTixnQkFBZ0IsRUFBRTtZQUNoQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNqQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNqQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNqQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNqQjtRQUNELGNBQWMsRUFBRTtZQUNkLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2xCO1FBQ0QscUJBQXFCLEVBQUU7WUFDckIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDbkIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDakIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDckIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFD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LElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNkLE1BQU0sVUFBVSxHQUFHLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFFbEMsTUFBTSxRQUFRLEdBQUcsdUJBQXVCLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRTlELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWNoYWVsbWNpc2FhYy9HaXRIdWIvdGVhY2hpbmctZW5naW5lMi4wL3NlcnZlci90ZXN0cy91bml0L2N1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGplc3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgSW1wb3J0U3RhdHVzIH0gZnJvbSAnQHRlYWNoaW5nLWVuZ2luZS9kYXRhYmFzZSc7XG5cbi8vIE1vY2sgdGhlIHByaXNtYSBtb2R1bGUgYmVmb3JlIGltcG9ydGluZyB0aGUgc2VydmljZVxuamVzdC5tb2NrKCcuLi8uLi9zcmMvcHJpc21hJywgKCkgPT4gKHtcbiAgcHJpc21hOiB7XG4gICAgY3VycmljdWx1bUltcG9ydDoge1xuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kTWFueTogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICAgIGRlbGV0ZU1hbnk6IGplc3QuZm4oKSxcbiAgICAgIGNvdW50OiBqZXN0LmZuKCksXG4gICAgfSxcbiAgICBvdXRjb21lQ2x1c3Rlcjoge1xuICAgICAgZmluZE1hbnk6IGplc3QuZm4oKSxcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICB9LFxuICAgIGN1cnJpY3VsdW1FeHBlY3RhdGlvbjoge1xuICAgICAgZmluZE1hbnk6IGplc3QuZm4oKSxcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgY3JlYXRlTWFueTogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICB9LFxuICB9LFxufSkpO1xuXG4vLyBNb2NrIHRoZSBlbWJlZGRpbmcgc2VydmljZVxuamVzdC5tb2NrKCcuLi8uLi9zcmMvc2VydmljZXMvZW1iZWRkaW5nU2VydmljZScsICgpID0+ICh7XG4gIGVtYmVkZGluZ1NlcnZpY2U6IHtcbiAgICBnZW5lcmF0ZUVtYmVkZGluZzogamVzdC5mbigpLFxuICAgIGZpbmRTaW1pbGFyT3V0Y29tZXM6IGplc3QuZm4oKSxcbiAgfSxcbn0pKTtcblxuLy8gSW1wb3J0IHNlcnZpY2VzIGFmdGVyIG1vY2tpbmdcbmltcG9ydCB7IEN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL2N1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlJztcbmltcG9ydCB7IGVtYmVkZGluZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvZW1iZWRkaW5nU2VydmljZSc7XG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi8uLi9zcmMvcHJpc21hJztcblxuZGVzY3JpYmUoJ0N1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgY3VycmljdWx1bUltcG9ydFNlcnZpY2U6IEN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBsZXQgbW9ja1ByaXNtYTogYW55O1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBsZXQgbW9ja0VtYmVkZGluZ1NlcnZpY2U6IGFueTtcblxuICAvLyBIZWxwZXIgdG8gZW5zdXJlIGEgbW9jayBmdW5jdGlvbiBleGlzdHMgLSByZW1vdmVkIGFzIG5vdCBuZWVkZWRcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcblxuICAgIC8vIEdldCBtb2NrZWQgaW5zdGFuY2VzXG4gICAgbW9ja1ByaXNtYSA9IHByaXNtYTtcbiAgICBtb2NrRW1iZWRkaW5nU2VydmljZSA9IGVtYmVkZGluZ1NlcnZpY2U7XG5cbiAgICAvLyBDcmVhdGUgc2VydmljZSBpbnN0YW5jZVxuICAgIGN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlID0gbmV3IEN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3N0YXJ0SW1wb3J0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgbmV3IGltcG9ydCBzZXNzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayB0aGUgY3JlYXRlIG1ldGhvZCB0byByZXR1cm4gYSB2YWxpZCBpbXBvcnQgb2JqZWN0XG4gICAgICBjb25zdCBtb2NrSW1wb3J0UmVjb3JkID0ge1xuICAgICAgICBpZDogJ2NtNTZncDZrempvcScsIC8vIENVSUQtbGlrZSBJRFxuICAgICAgICB1c2VySWQ6IDEsXG4gICAgICAgIGdyYWRlOiA1LFxuICAgICAgICBzdWJqZWN0OiAnTUFUSCcsXG4gICAgICAgIHNvdXJjZUZvcm1hdDogJ2NzdicsXG4gICAgICAgIHNvdXJjZUZpbGU6ICdmaWxlLmNzdicsXG4gICAgICAgIHN0YXR1czogSW1wb3J0U3RhdHVzLlVQTE9BRElORyxcbiAgICAgICAgbWV0YWRhdGE6IHt9LFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG4gICAgICBtb2NrUHJpc21hLmN1cnJpY3VsdW1JbXBvcnQuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbXBvcnRSZWNvcmQpO1xuXG4gICAgICBjb25zdCBpbXBvcnRJZCA9IGF3YWl0IGN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLnN0YXJ0SW1wb3J0KDEsIDUsICdNQVRIJywgJ2NzdicsICdmaWxlLmNzdicpO1xuXG4gICAgICAvLyBUaGUgbW9jayBnZW5lcmF0ZXMgQ1VJRC1saWtlIElEcywgc28ganVzdCB2ZXJpZnkgaXQncyBhIHZhbGlkIENVSUQgZm9ybWF0XG4gICAgICBleHBlY3QoaW1wb3J0SWQpLnRvTWF0Y2goL15jW2EtejAtOV17OCx9JC8pO1xuICAgICAgZXhwZWN0KG1vY2tQcmlzbWEuY3VycmljdWx1bUltcG9ydC5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVzZXJJZDogMSxcbiAgICAgICAgICBncmFkZTogNSxcbiAgICAgICAgICBzdWJqZWN0OiAnTUFUSCcsXG4gICAgICAgICAgc291cmNlRm9ybWF0OiAnY3N2JyxcbiAgICAgICAgICBzb3VyY2VGaWxlOiAnZmlsZS5jc3YnLFxuICAgICAgICAgIHN0YXR1czogSW1wb3J0U3RhdHVzLlVQTE9BRElORyxcbiAgICAgICAgICBtZXRhZGF0YToge30sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVycm9ycyBkdXJpbmcgaW1wb3J0IGNyZWF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ2xlYXIgYW55IHByZXZpb3VzIG1vY2sgaW1wbGVtZW50YXRpb25zXG4gICAgICBtb2NrUHJpc21hLmN1cnJpY3VsdW1JbXBvcnQuY3JlYXRlLm1vY2tSZXNldCgpO1xuICAgICAgLy8gQ29uZmlndXJlIHRoZSBtb2NrIHRvIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgbW9ja1ByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LmNyZWF0ZS5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLnN0YXJ0SW1wb3J0KDEsIDUsICdNQVRIJywgJ2NzdicpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdGYWlsZWQgdG8gc3RhcnQgaW1wb3J0IHNlc3Npb24nLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3BhcnNlQ1NWJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcGFyc2UgdmFsaWQgQ1NWIGNvbnRlbnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjc3ZDb250ZW50ID0gYGNvZGUsZGVzY3JpcHRpb24sc3ViamVjdCxncmFkZSxkb21haW5cbk0xLjEsQ291bnQgdG8gMTAwLE1BVEgsMSxOdW1iZXJcbk0xLjIsQWRkIHNpbmdsZSBkaWdpdHMsTUFUSCwxLE51bWJlclxuRzEuMSxJZGVudGlmeSBzaGFwZXMsTUFUSCwxLEdlb21ldHJ5YDtcblxuICAgICAgY29uc3Qgb3V0Y29tZXMgPSBjdXJyaWN1bHVtSW1wb3J0U2VydmljZS5wYXJzZUNTVihjc3ZDb250ZW50KTtcblxuICAgICAgZXhwZWN0KG91dGNvbWVzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3Qob3V0Y29tZXNbMF0pLnRvRXF1YWwoe1xuICAgICAgICBjb2RlOiAnTTEuMScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQ291bnQgdG8gMTAwJyxcbiAgICAgICAgc3ViamVjdDogJ01BVEgnLFxuICAgICAgICBncmFkZTogMSxcbiAgICAgICAgc3RyYW5kOiAnTnVtYmVyJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgQ1NWIHdpdGggbWlzc2luZyBvcHRpb25hbCBmaWVsZHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjc3ZDb250ZW50ID0gYGNvZGUsZGVzY3JpcHRpb25cbk0xLjEsQ291bnQgdG8gMTAwXG5NMS4yLEFkZCBzaW5nbGUgZGlnaXRzYDtcblxuICAgICAgY29uc3Qgb3V0Y29tZXMgPSBjdXJyaWN1bHVtSW1wb3J0U2VydmljZS5wYXJzZUNTVihjc3ZDb250ZW50KTtcblxuICAgICAgZXhwZWN0KG91dGNvbWVzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3Qob3V0Y29tZXNbMF0pLnRvRXF1YWwoe1xuICAgICAgICBjb2RlOiAnTTEuMScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQ291bnQgdG8gMTAwJyxcbiAgICAgICAgc3ViamVjdDogJ1Vua25vd24nLFxuICAgICAgICBncmFkZTogMCxcbiAgICAgICAgc3RyYW5kOiAnR2VuZXJhbCcsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIENTViB3aXRoIHF1b3RlZCB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjc3ZDb250ZW50ID0gYGNvZGUsZGVzY3JpcHRpb24sc3ViamVjdCxncmFkZSxkb21haW5cblwiTTEuMVwiLFwiQ291bnQgdG8gMTAwLCBpbmNsdWRpbmcgc2tpcCBjb3VudGluZ1wiLE1BVEgsMSxOdW1iZXJgO1xuXG4gICAgICBjb25zdCBvdXRjb21lcyA9IGN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLnBhcnNlQ1NWKGNzdkNvbnRlbnQpO1xuXG4gICAgICBleHBlY3Qob3V0Y29tZXMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChvdXRjb21lc1swXS5kZXNjcmlwdGlvbikudG9CZSgnQ291bnQgdG8gMTAwLCBpbmNsdWRpbmcgc2tpcCBjb3VudGluZycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBza2lwIGludmFsaWQgbGluZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjc3ZDb250ZW50ID0gYGNvZGUsZGVzY3JpcHRpb24sc3ViamVjdCxncmFkZSxkb21haW5cbk0xLjEsQ291bnQgdG8gMTAwLE1BVEgsMSxOdW1iZXJcbmludmFsaWQgbGluZSB3aXRob3V0IGVub3VnaCBjb2x1bW5zXG5NMS4yLEFkZCBzaW5nbGUgZGlnaXRzLE1BVEgsMSxOdW1iZXJgO1xuXG4gICAgICBjb25zdCBvdXRjb21lcyA9IGN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLnBhcnNlQ1NWKGNzdkNvbnRlbnQpO1xuXG4gICAgICBleHBlY3Qob3V0Y29tZXMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIENTViB3aXRob3V0IHJlcXVpcmVkIGNvbHVtbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjc3ZDb250ZW50ID0gYG5hbWUsdmFsdWVcblRlc3QsMTIzYDtcblxuICAgICAgZXhwZWN0KCgpID0+IGN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLnBhcnNlQ1NWKGNzdkNvbnRlbnQpKS50b1Rocm93KFxuICAgICAgICAnQ1NWIG11c3QgY29udGFpbiBcImNvZGVcIiBhbmQgXCJkZXNjcmlwdGlvblwiIGNvbHVtbnMnLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUuc2tpcCgncHJvY2Vzc0ltcG9ydCcsICgpID0+IHtcbiAgICBjb25zdCBpbXBvcnRJZCA9ICdjJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCAyNCk7IC8vIEdlbmVyYXRlIENVSUQtbGlrZSBJRFxuICAgIGNvbnN0IHRlc3RPdXRjb21lcyA9IFtcbiAgICAgIHsgY29kZTogJ00xLjEnLCBkZXNjcmlwdGlvbjogJ0NvdW50IHRvIDEwMCcsIHN1YmplY3Q6ICdNQVRIJywgZ3JhZGU6IDEsIGRvbWFpbjogJ051bWJlcicgfSxcbiAgICAgIHtcbiAgICAgICAgY29kZTogJ00xLjInLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0FkZCBzaW5nbGUgZGlnaXRzJyxcbiAgICAgICAgc3ViamVjdDogJ01BVEgnLFxuICAgICAgICBncmFkZTogMSxcbiAgICAgICAgZG9tYWluOiAnTnVtYmVyJyxcbiAgICAgIH0sXG4gICAgXTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgLy8gTW9jayB1cGRhdGUgc3RhdHVzIGNhbGxzXG4gICAgICBtb2NrUHJpc21hLmN1cnJpY3VsdW1JbXBvcnQudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcblxuICAgICAgLy8gTW9jayBlbWJlZGRpbmcgc2VydmljZVxuICAgICAgbW9ja0VtYmVkZGluZ1NlcnZpY2UuZ2VuZXJhdGVCYXRjaEVtYmVkZGluZ3MgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuXG4gICAgICAvLyBNb2NrIGNsdXN0ZXIgY3JlYXRpb25cbiAgICAgIG1vY2tQcmlzbWEub3V0Y29tZUNsdXN0ZXIuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdjbHVzdGVyLTEnLFxuICAgICAgICBjbHVzdGVyTmFtZTogJ01BVEgtTnVtYmVyLUdyYWRlMScsXG4gICAgICAgIG91dGNvbWVJZHM6IFsnb3V0Y29tZS0xJywgJ291dGNvbWUtMiddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb2Nlc3Mgb3V0Y29tZXMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBubyBleGlzdGluZyBvdXRjb21lc1xuICAgICAgbW9ja1ByaXNtYS5vdXRjb21lLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIC8vIE1vY2sgb3V0Y29tZSBjcmVhdGlvblxuICAgICAgbW9ja1ByaXNtYS5vdXRjb21lLmNyZWF0ZVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgaWQ6ICdvdXRjb21lLTEnLCBjb2RlOiAnTTEuMScgfSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IGlkOiAnb3V0Y29tZS0yJywgY29kZTogJ00xLjInIH0pO1xuXG4gICAgICAvLyBNb2NrIG91dGNvbWVzIGZvciBjbHVzdGVyaW5nXG4gICAgICBtb2NrUHJpc21hLm91dGNvbWUuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW1xuICAgICAgICB7IGlkOiAnb3V0Y29tZS0xJywgY29kZTogJ00xLjEnLCBzdWJqZWN0OiAnTUFUSCcsIGRvbWFpbjogJ051bWJlcicsIGdyYWRlOiAxIH0sXG4gICAgICAgIHsgaWQ6ICdvdXRjb21lLTInLCBjb2RlOiAnTTEuMicsIHN1YmplY3Q6ICdNQVRIJywgZG9tYWluOiAnTnVtYmVyJywgZ3JhZGU6IDEgfSxcbiAgICAgIF0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjdXJyaWN1bHVtSW1wb3J0U2VydmljZS5wcm9jZXNzSW1wb3J0KGltcG9ydElkLCB0ZXN0T3V0Y29tZXMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmltcG9ydElkKS50b0JlKGltcG9ydElkKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub3V0Y29tZXMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY2x1c3RlcnMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0hhdmVMZW5ndGgoMCk7XG5cbiAgICAgIC8vIFZlcmlmeSBzdGF0dXMgdXBkYXRlc1xuICAgICAgZXhwZWN0KG1vY2tQcmlzbWEuY3VycmljdWx1bUltcG9ydC51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGltcG9ydElkIH0sXG4gICAgICAgIGRhdGE6IHsgc3RhdHVzOiBJbXBvcnRTdGF0dXMuUFJPQ0VTU0lORywgdG90YWxPdXRjb21lczogMiB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLmN1cnJpY3VsdW1JbXBvcnQudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBpbXBvcnRJZCB9LFxuICAgICAgICBkYXRhOiB7IHN0YXR1czogSW1wb3J0U3RhdHVzLkNPTVBMRVRFRCB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFZlcmlmeSBlbWJlZGRpbmdzIHdlcmUgZ2VuZXJhdGVkXG4gICAgICBleHBlY3QobW9ja0VtYmVkZGluZ1NlcnZpY2UuZ2VuZXJhdGVCYXRjaEVtYmVkZGluZ3MpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2tpcCBleGlzdGluZyBvdXRjb21lcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZmlyc3Qgb3V0Y29tZSBleGlzdHMsIHNlY29uZCBkb2Vzbid0XG4gICAgICBtb2NrUHJpc21hLm91dGNvbWUuZmluZFVuaXF1ZVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgaWQ6ICdleGlzdGluZy0xJywgY29kZTogJ00xLjEnIH0pXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobnVsbCk7XG5cbiAgICAgIG1vY2tQcmlzbWEub3V0Y29tZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ291dGNvbWUtMicsXG4gICAgICAgIGNvZGU6ICdNMS4yJyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjdXJyaWN1bHVtSW1wb3J0U2VydmljZS5wcm9jZXNzSW1wb3J0KGltcG9ydElkLCB0ZXN0T3V0Y29tZXMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0Lm91dGNvbWVzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QobW9ja1ByaXNtYS5vdXRjb21lLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpOyAvLyBPbmx5IGNhbGxlZCBmb3IgbmV3IG91dGNvbWVcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVycm9ycyBkdXJpbmcgcHJvY2Vzc2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQcmlzbWEub3V0Y29tZS5maW5kVW5pcXVlLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLnByb2Nlc3NJbXBvcnQoaW1wb3J0SWQsIHRlc3RPdXRjb21lcyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0hhdmVMZW5ndGgoMik7IC8vIE9uZSBlcnJvciBwZXIgb3V0Y29tZVxuICAgICAgZXhwZWN0KHJlc3VsdC5vdXRjb21lcykudG9IYXZlTGVuZ3RoKDApOyAvLyBObyBzdWNjZXNzZnVsIG91dGNvbWVzXG5cbiAgICAgIC8vIFRoZSBpbXBvcnQgc2hvdWxkIGNvbXBsZXRlIGJ1dCB3aXRoIGVycm9ycyByZWNvcmRlZFxuICAgICAgZXhwZWN0KG1vY2tQcmlzbWEuY3VycmljdWx1bUltcG9ydC51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGltcG9ydElkIH0sXG4gICAgICAgIGRhdGE6IHsgc3RhdHVzOiBJbXBvcnRTdGF0dXMuQ09NUExFVEVEIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvY2VzcyBvdXRjb21lcyBpbiBiYXRjaGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIDYwIHRlc3Qgb3V0Y29tZXMgKG1vcmUgdGhhbiBiYXRjaCBzaXplIG9mIDUwKVxuICAgICAgY29uc3QgbWFueU91dGNvbWVzID0gQXJyYXkoNjApXG4gICAgICAgIC5maWxsKG51bGwpXG4gICAgICAgIC5tYXAoKF8sIGkpID0+ICh7XG4gICAgICAgICAgY29kZTogYE0xLiR7aX1gLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBgT3V0Y29tZSAke2l9YCxcbiAgICAgICAgICBzdWJqZWN0OiAnTUFUSCcsXG4gICAgICAgICAgZ3JhZGU6IDEsXG4gICAgICAgICAgZG9tYWluOiAnTnVtYmVyJyxcbiAgICAgICAgfSkpO1xuXG4gICAgICBtb2NrUHJpc21hLm91dGNvbWUuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIG1vY2tQcmlzbWEub3V0Y29tZS5jcmVhdGUubW9ja0ltcGxlbWVudGF0aW9uKFxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAoYXJnczogeyBkYXRhOiB7IGNvZGU6IHN0cmluZyB9IH0pID0+XG4gICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKHsgaWQ6IGBvdXRjb21lLSR7YXJncy5kYXRhLmNvZGV9YCwgY29kZTogYXJncy5kYXRhLmNvZGUgfSksXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjdXJyaWN1bHVtSW1wb3J0U2VydmljZS5wcm9jZXNzSW1wb3J0KGltcG9ydElkLCBtYW55T3V0Y29tZXMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0Lm91dGNvbWVzKS50b0hhdmVMZW5ndGgoNjApO1xuICAgICAgLy8gVmVyaWZ5IHByb2dyZXNzIHdhcyB1cGRhdGVkIGR1cmluZyBwcm9jZXNzaW5nXG4gICAgICBleHBlY3QobW9ja1ByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogaW1wb3J0SWQgfSxcbiAgICAgICAgZGF0YTogeyBwcm9jZXNzZWRPdXRjb21lczogNTAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0SW1wb3J0UHJvZ3Jlc3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gaW1wb3J0IHByb2dyZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW1wb3J0SWQgPSAnYycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgMjQpO1xuICAgICAgY29uc3QgbW9ja0ltcG9ydCA9IHtcbiAgICAgICAgaWQ6IGltcG9ydElkLFxuICAgICAgICB1c2VySWQ6IDEsXG4gICAgICAgIGdyYWRlOiA1LFxuICAgICAgICBzdWJqZWN0OiAnTUFUSCcsXG4gICAgICAgIHNvdXJjZUZvcm1hdDogJ2NzdicsXG4gICAgICAgIHN0YXR1czogSW1wb3J0U3RhdHVzLlBST0NFU1NJTkcsXG4gICAgICAgIHRvdGFsT3V0Y29tZXM6IDEwMCxcbiAgICAgICAgcHJvY2Vzc2VkT3V0Y29tZXM6IDUwLFxuICAgICAgICBlcnJvckxvZzogWydFcnJvciAxJywgJ0Vycm9yIDInXSxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIG1ldGFkYXRhOiB7fSxcbiAgICAgICAgY29tcGxldGVkQXQ6IG51bGwsXG4gICAgICAgIHNvdXJjZUZpbGU6IG51bGwsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUHJpc21hLmN1cnJpY3VsdW1JbXBvcnQuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja0ltcG9ydCk7XG5cbiAgICAgIGNvbnN0IHByb2dyZXNzID0gYXdhaXQgY3VycmljdWx1bUltcG9ydFNlcnZpY2UuZ2V0SW1wb3J0UHJvZ3Jlc3MoaW1wb3J0SWQpO1xuXG4gICAgICBleHBlY3QocHJvZ3Jlc3MpLnRvRXF1YWwoe1xuICAgICAgICBpbXBvcnRJZDogaW1wb3J0SWQsXG4gICAgICAgIHN0YXR1czogSW1wb3J0U3RhdHVzLlBST0NFU1NJTkcsXG4gICAgICAgIHRvdGFsT3V0Y29tZXM6IDEwMCxcbiAgICAgICAgcHJvY2Vzc2VkT3V0Y29tZXM6IDUwLFxuICAgICAgICBlcnJvcnM6IFsnRXJyb3IgMScsICdFcnJvciAyJ10sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIG5vbi1leGlzdGVudCBpbXBvcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUHJpc21hLmN1cnJpY3VsdW1JbXBvcnQuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBhd2FpdCBjdXJyaWN1bHVtSW1wb3J0U2VydmljZS5nZXRJbXBvcnRQcm9ncmVzcygnbm9uLWV4aXN0ZW50Jyk7XG5cbiAgICAgIGV4cGVjdChwcm9ncmVzcykudG9CZU51bGwoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbmNlbEltcG9ydCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbmNlbCBpbXBvcnQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW1wb3J0SWQgPSAnYycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgMjQpO1xuICAgICAgbW9ja1ByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe30pO1xuXG4gICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgY3VycmljdWx1bUltcG9ydFNlcnZpY2UuY2FuY2VsSW1wb3J0KGltcG9ydElkKTtcblxuICAgICAgZXhwZWN0KHN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja1ByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogaW1wb3J0SWQgfSxcbiAgICAgICAgZGF0YTogeyBzdGF0dXM6IEltcG9ydFN0YXR1cy5DQU5DRUxMRUQgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2FuY2VsbGF0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQcmlzbWEuY3VycmljdWx1bUltcG9ydC51cGRhdGUubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdOb3QgZm91bmQnKSk7XG5cbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCBjdXJyaWN1bHVtSW1wb3J0U2VydmljZS5jYW5jZWxJbXBvcnQoJ25vbi1leGlzdGVudCcpO1xuXG4gICAgICBleHBlY3Qoc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRJbXBvcnRIaXN0b3J5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGltcG9ydCBoaXN0b3J5IGZvciB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ltcG9ydHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ2MnICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDI0KSxcbiAgICAgICAgICB1c2VySWQ6IDEsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgICAgICBzdGF0dXM6IEltcG9ydFN0YXR1cy5DT01QTEVURUQsXG4gICAgICAgICAgZ3JhZGU6IDUsXG4gICAgICAgICAgc3ViamVjdDogJ01BVEgnLFxuICAgICAgICAgIHNvdXJjZUZvcm1hdDogJ2NzdicsXG4gICAgICAgICAgc291cmNlRmlsZTogbnVsbCxcbiAgICAgICAgICBtZXRhZGF0YToge30sXG4gICAgICAgICAgdG90YWxPdXRjb21lczogMTAsXG4gICAgICAgICAgcHJvY2Vzc2VkT3V0Y29tZXM6IDEwLFxuICAgICAgICAgIGVycm9yTG9nOiBbXSxcbiAgICAgICAgICBjb21wbGV0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgICAgICBjbHVzdGVyczogW3sgaWQ6ICdjbHVzdGVyLTEnLCBjbHVzdGVyTmFtZTogJ1Rlc3QnLCBjbHVzdGVyVHlwZTogJ3RoZW1lJyB9XSxcbiAgICAgICAgICBfY291bnQ6IHsgY3VycmljdWx1bUV4cGVjdGF0aW9uczogMTAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnYycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgMjQpLFxuICAgICAgICAgIHVzZXJJZDogMSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAyJyksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMicpLFxuICAgICAgICAgIHN0YXR1czogSW1wb3J0U3RhdHVzLkZBSUxFRCxcbiAgICAgICAgICBncmFkZTogNSxcbiAgICAgICAgICBzdWJqZWN0OiAnTUFUSCcsXG4gICAgICAgICAgc291cmNlRm9ybWF0OiAnY3N2JyxcbiAgICAgICAgICBzb3VyY2VGaWxlOiBudWxsLFxuICAgICAgICAgIG1ldGFkYXRhOiB7fSxcbiAgICAgICAgICB0b3RhbE91dGNvbWVzOiAwLFxuICAgICAgICAgIHByb2Nlc3NlZE91dGNvbWVzOiAwLFxuICAgICAgICAgIGVycm9yTG9nOiBbJ0Vycm9yIG9jY3VycmVkJ10sXG4gICAgICAgICAgY29tcGxldGVkQXQ6IG51bGwsXG4gICAgICAgICAgY2x1c3RlcnM6IFtdLFxuICAgICAgICAgIF9jb3VudDogeyBjdXJyaWN1bHVtRXhwZWN0YXRpb25zOiAwIH0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrUHJpc21hLmN1cnJpY3VsdW1JbXBvcnQuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG1vY2tJbXBvcnRzKTtcblxuICAgICAgY29uc3QgaGlzdG9yeSA9IGF3YWl0IGN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLmdldEltcG9ydEhpc3RvcnkoMSwgMTApO1xuXG4gICAgICBleHBlY3QoaGlzdG9yeSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KGhpc3RvcnlbMF0pLnRvSGF2ZVByb3BlcnR5KCdpZCcpO1xuICAgICAgZXhwZWN0KGhpc3RvcnlbMF0pLnRvSGF2ZVByb3BlcnR5KCdjbHVzdGVycycpO1xuICAgICAgZXhwZWN0KGhpc3RvcnlbMF0pLnRvSGF2ZVByb3BlcnR5KCdfY291bnQnKTtcbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLmN1cnJpY3VsdW1JbXBvcnQuZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiAxIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgdGFrZTogMTAsXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBjbHVzdGVyczoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICBjbHVzdGVyTmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgY2x1c3RlclR5cGU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgY3VycmljdWx1bUV4cGVjdGF0aW9uczogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgaGlzdG9yeScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQcmlzbWEuY3VycmljdWx1bUltcG9ydC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG5cbiAgICAgIGNvbnN0IGhpc3RvcnkgPSBhd2FpdCBjdXJyaWN1bHVtSW1wb3J0U2VydmljZS5nZXRJbXBvcnRIaXN0b3J5KDEpO1xuXG4gICAgICBleHBlY3QoaGlzdG9yeSkudG9FcXVhbChbXSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFZGdlIENhc2VzJywgKCkgPT4ge1xuICAgIGl0LnNraXAoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgb3V0Y29tZSBhcnJheScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGltcG9ydElkID0gJ2MnICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDI0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGN1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLnByb2Nlc3NJbXBvcnQoaW1wb3J0SWQsIFtdKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5vdXRjb21lcykudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jbHVzdGVycykudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIENTViB3aXRoIHNwZWNpYWwgY2hhcmFjdGVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNzdkNvbnRlbnQgPSBgY29kZSxkZXNjcmlwdGlvbixzdWJqZWN0LGdyYWRlLGRvbWFpblxuTTEuMSxcIkNvdW50IHRvIDEwMCwgd2l0aCDDqW1waGFzaXMgb24gZnJhbsOnYWlzXCIsTUFUSCwxLE5vbWJyZVxuTTEuMixcIkFkZCAmIHN1YnRyYWN0ICh3aXRoIHN5bWJvbHMpXCIsTUFUSCwxLE51bWJlcmA7XG5cbiAgICAgIGNvbnN0IG91dGNvbWVzID0gY3VycmljdWx1bUltcG9ydFNlcnZpY2UucGFyc2VDU1YoY3N2Q29udGVudCk7XG5cbiAgICAgIGV4cGVjdChvdXRjb21lcykudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KG91dGNvbWVzWzBdLmRlc2NyaXB0aW9uKS50b0NvbnRhaW4oJ8OpbXBoYXNpcyBvbiBmcmFuw6dhaXMnKTtcbiAgICAgIGV4cGVjdChvdXRjb21lc1sxXS5kZXNjcmlwdGlvbikudG9Db250YWluKCcmIHN1YnRyYWN0ICh3aXRoIHN5bWJvbHMpJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2ZXJ5IGxhcmdlIENTViBmaWxlcycsICgpID0+IHtcbiAgICAgIC8vIEdlbmVyYXRlIENTViB3aXRoIDEwMDAgcm93c1xuICAgICAgY29uc3QgaGVhZGVycyA9ICdjb2RlLGRlc2NyaXB0aW9uLHN1YmplY3QsZ3JhZGUsZG9tYWluXFxuJztcbiAgICAgIGNvbnN0IHJvd3MgPSBBcnJheSgxMDAwKVxuICAgICAgICAuZmlsbChudWxsKVxuICAgICAgICAubWFwKChfLCBpKSA9PiBgTSR7aX0uMSxEZXNjcmlwdGlvbiAke2l9LE1BVEgsJHsoaSAlIDEyKSArIDF9LERvbWFpbmApXG4gICAgICAgIC5qb2luKCdcXG4nKTtcbiAgICAgIGNvbnN0IGNzdkNvbnRlbnQgPSBoZWFkZXJzICsgcm93cztcblxuICAgICAgY29uc3Qgb3V0Y29tZXMgPSBjdXJyaWN1bHVtSW1wb3J0U2VydmljZS5wYXJzZUNTVihjc3ZDb250ZW50KTtcblxuICAgICAgZXhwZWN0KG91dGNvbWVzKS50b0hhdmVMZW5ndGgoMTAwMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=