{"version":3,"names":["cov_vms9fjrag","actualCoverage","s","console","log","process","env","NODE_ENV","E2E_TEST","IS_TEST_SERVER","OPENAI_API_KEY","b","DATABASE_URL","app","initializeServices","shutdownServices","logger","PORT","parseInt","startServer","f","listen","info","err","error","exit","on"],"sources":["/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/src/test-server.ts"],"sourcesContent":["/**\n * Test server entry point for E2E tests\n *\n * This bypasses the import.meta.url check entirely for E2E tests\n */\n\nconsole.log('Starting E2E test server...');\n\n// Set up environment\nprocess.env.NODE_ENV = 'test';\nprocess.env.E2E_TEST = 'true';\nprocess.env.IS_TEST_SERVER = 'true'; // Prevent index.ts from starting\n\n// Ensure we have required environment variables\nif (!process.env.OPENAI_API_KEY) {\n  process.env.OPENAI_API_KEY = 'test-api-key';\n}\nif (!process.env.DATABASE_URL) {\n  process.env.DATABASE_URL = 'file:./test-assessment-e2e.db';\n}\n\nconsole.log('Environment configured:', {\n  NODE_ENV: process.env.NODE_ENV,\n  E2E_TEST: process.env.E2E_TEST,\n  IS_TEST_SERVER: process.env.IS_TEST_SERVER,\n  DATABASE_URL: process.env.DATABASE_URL,\n  OPENAI_API_KEY: process.env.OPENAI_API_KEY ? 'set' : 'not set',\n});\n\n// Import the app and services\n// This will load index.ts but not start the server because IS_TEST_SERVER is set\nimport { app } from './index.js';\nimport { initializeServices, shutdownServices } from './services/initializeServices.js';\nimport logger from './logger.js';\n\nconst PORT = process.env.PORT ? parseInt(process.env.PORT, 10) : 3000;\n\n// Start the server\nasync function startServer() {\n  try {\n    console.log('Initializing services...');\n    await initializeServices();\n\n    console.log(`Starting server on port ${PORT}...`);\n    app.listen(PORT, '0.0.0.0', () => {\n      console.log(`Server is running on port ${PORT}`);\n      logger.info('E2E test server started successfully');\n    });\n  } catch (err) {\n    console.error('Failed to start server:', err);\n    logger.error('Failed to start E2E test server:', err);\n    process.exit(1);\n  }\n}\n\n// Graceful shutdown\nprocess.on('SIGTERM', async () => {\n  console.log('SIGTERM received, shutting down...');\n  await shutdownServices();\n  process.exit(0);\n});\n\nprocess.on('SIGINT', async () => {\n  console.log('SIGINT received, shutting down...');\n  await shutdownServices();\n  process.exit(0);\n});\n\n// Start immediately\nstartServer();\n"],"mappings":"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","ignoreList":[]}