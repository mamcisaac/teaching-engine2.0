955f337bc5f415ad41611cef6fbe1df1
import { Router } from 'express';
import { prisma } from '../prisma';
import { validate, cuidSchema } from '../validation';
import { z } from 'zod';
const router = Router();
// Enhanced validation schemas with security measures
const unitPlanCreateSchema = z.object({
    title: z.string().min(1).max(255).regex(/^[^<>]*$/, 'Title cannot contain HTML tags'),
    titleFr: z.string().max(255).regex(/^[^<>]*$/, 'French title cannot contain HTML tags').optional(),
    longRangePlanId: cuidSchema(),
    description: z.string().max(2000).optional(),
    descriptionFr: z.string().max(2000).optional(),
    bigIdeas: z.string().max(2000).optional(),
    bigIdeasFr: z.string().max(2000).optional(),
    essentialQuestions: z.array(z.string().max(500)).max(20).optional(),
    startDate: z.string().datetime(),
    endDate: z.string().datetime(),
    estimatedHours: z.number().int().positive().max(1000).optional(),
    assessmentPlan: z.string().max(2000).optional(),
    successCriteria: z.array(z.string().max(500)).max(20).optional(),
    expectationIds: z.array(cuidSchema()).max(50).min(1, 'At least one curriculum expectation must be selected'),
    // ETFO-aligned planning fields with validation
    crossCurricularConnections: z.string().max(1000).optional(),
    learningSkills: z.array(z.string().max(100)).max(10).optional(),
    culminatingTask: z.string().max(1000).optional(),
    keyVocabulary: z.array(z.string().max(100)).max(30).optional(),
    priorKnowledge: z.string().max(1000).optional(),
    parentCommunicationPlan: z.string().max(1000).optional(),
    fieldTripsAndGuestSpeakers: z.string().max(1000).optional(),
    differentiationStrategies: z
        .object({
        forStruggling: z.array(z.string().max(200)).max(10).optional(),
        forAdvanced: z.array(z.string().max(200)).max(10).optional(),
        forELL: z.array(z.string().max(200)).max(10).optional(),
        forIEP: z.array(z.string().max(200)).max(10).optional(),
    })
        .optional(),
    indigenousPerspectives: z.string().max(1000).optional(),
    environmentalEducation: z.string().max(1000).optional(),
    socialJusticeConnections: z.string().max(1000).optional(),
    technologyIntegration: z.string().max(1000).optional(),
    communityConnections: z.string().max(1000).optional(),
});
const unitPlanUpdateSchema = unitPlanCreateSchema.partial().omit({ longRangePlanId: true });
// Get all unit plans for the authenticated user
router.get('/', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { longRangePlanId, startDate, endDate } = req.query;
        const where = { userId };
        if (longRangePlanId)
            where.longRangePlanId = String(longRangePlanId);
        if (startDate || endDate) {
            where.startDate = {};
            if (startDate)
                where.startDate.gte = new Date(String(startDate));
            if (endDate)
                where.startDate.lte = new Date(String(endDate));
        }
        const unitPlans = await prisma.unitPlan.findMany({
            where,
            orderBy: { startDate: 'asc' },
            include: {
                longRangePlan: {
                    select: {
                        id: true,
                        title: true,
                        subject: true,
                        grade: true,
                    },
                },
                _count: {
                    select: {
                        lessonPlans: true,
                        expectations: true,
                        resources: true,
                    },
                },
            },
        });
        res.json(unitPlans);
    }
    catch (err) {
        _next(err);
    }
});
// Get a single unit plan
router.get('/:id', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const unitPlan = await prisma.unitPlan.findFirst({
            where: {
                id: req.params.id,
                userId,
            },
            include: {
                longRangePlan: true,
                expectations: {
                    include: {
                        expectation: true,
                    },
                    orderBy: {
                        expectation: { code: 'asc' },
                    },
                },
                lessonPlans: {
                    orderBy: { date: 'asc' },
                    include: {
                        _count: {
                            select: { expectations: true },
                        },
                        daybookEntry: {
                            select: {
                                id: true,
                                overallRating: true,
                                wouldReuseLesson: true,
                            },
                        },
                    },
                },
                resources: {
                    orderBy: { createdAt: 'desc' },
                },
            },
        });
        if (!unitPlan) {
            return res.status(404).json({ error: 'Unit plan not found' });
        }
        // Calculate progress
        const totalLessons = unitPlan.lessonPlans.length;
        const completedLessons = unitPlan.lessonPlans.filter((lp) => lp.daybookEntry).length;
        const progress = totalLessons > 0 ? Math.round((completedLessons / totalLessons) * 100) : 0;
        res.json({
            ...unitPlan,
            progress: {
                total: totalLessons,
                completed: completedLessons,
                percentage: progress,
            },
        });
    }
    catch (err) {
        _next(err);
    }
});
// Create a new unit plan
router.post('/', validate(unitPlanCreateSchema), async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { expectationIds, essentialQuestions, successCriteria, learningSkills, keyVocabulary, differentiationStrategies, ...planData } = req.body;
        // Verify user owns the long-range plan
        const longRangePlan = await prisma.longRangePlan.findFirst({
            where: {
                id: planData.longRangePlanId,
                userId,
            },
        });
        if (!longRangePlan) {
            return res.status(404).json({ error: 'Long-range plan not found' });
        }
        // Use transaction to ensure data integrity
        const result = await prisma.$transaction(async (tx) => {
            // Create the unit plan
            const unitPlan = await tx.unitPlan.create({
                data: {
                    ...planData,
                    userId,
                    startDate: new Date(planData.startDate),
                    endDate: new Date(planData.endDate),
                    essentialQuestions: essentialQuestions || [],
                    successCriteria: successCriteria || [],
                    learningSkills: learningSkills || [],
                    keyVocabulary: keyVocabulary || [],
                    differentiationStrategies: differentiationStrategies || null,
                },
            });
            // Link curriculum expectations if provided
            if (expectationIds && expectationIds.length > 0) {
                // Validate expectation IDs exist
                const validExpectations = await tx.curriculumExpectation.findMany({
                    where: { id: { in: expectationIds } },
                    select: { id: true },
                });
                if (validExpectations.length !== expectationIds.length) {
                    throw new Error('One or more curriculum expectations not found');
                }
                await tx.unitPlanExpectation.createMany({
                    data: expectationIds.map((expectationId) => ({
                        unitPlanId: unitPlan.id,
                        expectationId,
                    })),
                });
            }
            // Return the created unit plan with relations
            return await tx.unitPlan.findUnique({
                where: { id: unitPlan.id },
                include: {
                    longRangePlan: {
                        select: {
                            id: true,
                            title: true,
                            subject: true,
                            grade: true,
                        },
                    },
                    _count: {
                        select: {
                            lessonPlans: true,
                            expectations: true,
                        },
                    },
                },
            });
        });
        res.status(201).json(result);
    }
    catch (err) {
        _next(err);
    }
});
// Update a unit plan
router.put('/:id', validate(unitPlanUpdateSchema), async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { expectationIds, essentialQuestions, successCriteria, learningSkills, keyVocabulary, differentiationStrategies, ...updateData } = req.body;
        // Verify ownership
        const existing = await prisma.unitPlan.findFirst({
            where: { id: req.params.id, userId },
        });
        if (!existing) {
            return res.status(404).json({ error: 'Unit plan not found' });
        }
        // Prepare update data
        const data = { ...updateData };
        if (updateData.startDate)
            data.startDate = new Date(updateData.startDate);
        if (updateData.endDate)
            data.endDate = new Date(updateData.endDate);
        if (essentialQuestions !== undefined)
            data.essentialQuestions = essentialQuestions;
        if (successCriteria !== undefined)
            data.successCriteria = successCriteria;
        if (learningSkills !== undefined)
            data.learningSkills = learningSkills;
        if (keyVocabulary !== undefined)
            data.keyVocabulary = keyVocabulary;
        if (differentiationStrategies !== undefined)
            data.differentiationStrategies = differentiationStrategies;
        // Update the plan
        const unitPlan = await prisma.unitPlan.update({
            where: { id: req.params.id },
            data,
        });
        // Update expectations if provided
        if (expectationIds !== undefined) {
            // Remove existing expectations
            await prisma.unitPlanExpectation.deleteMany({
                where: { unitPlanId: unitPlan.id },
            });
            // Add new expectations
            if (expectationIds.length > 0) {
                await prisma.unitPlanExpectation.createMany({
                    data: expectationIds.map((expectationId) => ({
                        unitPlanId: unitPlan.id,
                        expectationId,
                    })),
                });
            }
        }
        // Refetch with updated relationships
        const updatedPlan = await prisma.unitPlan.findUnique({
            where: { id: unitPlan.id },
            include: {
                longRangePlan: true,
                expectations: {
                    include: { expectation: true },
                },
                lessonPlans: {
                    orderBy: { date: 'asc' },
                    include: {
                        _count: { select: { expectations: true } },
                    },
                },
                resources: true,
            },
        });
        res.json(updatedPlan);
    }
    catch (err) {
        _next(err);
    }
});
// Delete a unit plan
router.delete('/:id', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        // Verify ownership and check for dependencies
        const unitPlan = await prisma.unitPlan.findFirst({
            where: { id: req.params.id, userId },
            include: {
                _count: { select: { lessonPlans: true } },
            },
        });
        if (!unitPlan) {
            return res.status(404).json({ error: 'Unit plan not found' });
        }
        if (unitPlan._count.lessonPlans > 0) {
            return res.status(400).json({
                error: 'Cannot delete unit plan with existing lesson plans',
            });
        }
        await prisma.unitPlan.delete({
            where: { id: req.params.id },
        });
        res.status(204).end();
    }
    catch (err) {
        _next(err);
    }
});
// Add a resource to unit plan
router.post('/:id/resources', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { title, type, url, notes } = req.body;
        if (!title || !type) {
            return res.status(400).json({ error: 'Title and type are required' });
        }
        // Verify ownership
        const unitPlan = await prisma.unitPlan.findFirst({
            where: { id: req.params.id, userId },
        });
        if (!unitPlan) {
            return res.status(404).json({ error: 'Unit plan not found' });
        }
        const resource = await prisma.unitPlanResource.create({
            data: {
                unitPlanId: req.params.id,
                title: String(title),
                type: String(type),
                url: url ? String(url) : null,
                notes: notes ? String(notes) : null,
            },
        });
        res.status(201).json(resource);
    }
    catch (err) {
        _next(err);
    }
});
// Delete a resource
router.delete('/:id/resources/:resourceId', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        // Verify ownership through unit plan
        const resource = await prisma.unitPlanResource.findFirst({
            where: {
                id: req.params.resourceId,
                unitPlan: {
                    id: req.params.id,
                    userId,
                },
            },
        });
        if (!resource) {
            return res.status(404).json({ error: 'Resource not found' });
        }
        await prisma.unitPlanResource.delete({
            where: { id: req.params.resourceId },
        });
        res.status(204).end();
    }
    catch (err) {
        _next(err);
    }
});
// Duplicate a unit plan
router.post('/duplicate', async (req, res, _next) => {
    try {
        const userId = parseInt(req.user?.userId || '0', 10);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { sourceId, title, notes: _notes, includeSubItems } = req.body;
        if (!sourceId || !title) {
            return res.status(400).json({ error: 'Source ID and title are required' });
        }
        // Fetch the source unit plan with all relations
        const sourceUnit = await prisma.unitPlan.findFirst({
            where: { id: sourceId, userId },
            include: {
                expectations: true,
                resources: true,
                lessonPlans: includeSubItems ? {
                    include: {
                        expectations: true,
                        resources: true,
                    },
                } : false,
            },
        });
        if (!sourceUnit) {
            return res.status(404).json({ error: 'Source unit plan not found' });
        }
        // Create the duplicate in a transaction
        const result = await prisma.$transaction(async (tx) => {
            // Calculate new dates (shift to current period)
            const originalDuration = sourceUnit.endDate.getTime() - sourceUnit.startDate.getTime();
            const newStartDate = new Date();
            const newEndDate = new Date(newStartDate.getTime() + originalDuration);
            // Create the duplicate unit plan
            const { id: _, userId: __, createdAt: _createdAt, updatedAt: _updatedAt, lessonPlans, expectations, resources, ...unitData } = sourceUnit;
            const newUnit = await tx.unitPlan.create({
                data: {
                    ...unitData,
                    userId,
                    title,
                    startDate: newStartDate,
                    endDate: newEndDate,
                },
            });
            // Copy expectations
            if (expectations.length > 0) {
                await tx.unitPlanExpectation.createMany({
                    data: expectations.map(exp => ({
                        unitPlanId: newUnit.id,
                        expectationId: exp.expectationId,
                    })),
                });
            }
            // Copy resources
            if (resources.length > 0) {
                await tx.unitPlanResource.createMany({
                    data: resources.map(({ id: _id, unitPlanId: _unitPlanId, createdAt: _createdAt, ...resource }) => ({
                        ...resource,
                        unitPlanId: newUnit.id,
                    })),
                });
            }
            // Copy lesson plans if requested
            if (includeSubItems && lessonPlans && lessonPlans.length > 0) {
                for (const lesson of lessonPlans) {
                    const { id: _, unitPlanId: __, userId: ___, createdAt: _createdAt, updatedAt: _updatedAt, ...lessonData } = lesson;
                    const lessonExp = lesson.expectations || [];
                    const lessonRes = lesson.resources || [];
                    // Calculate new lesson date based on relative position
                    const originalOffset = lesson.date.getTime() - sourceUnit.startDate.getTime();
                    const newLessonDate = new Date(newStartDate.getTime() + originalOffset);
                    const newLesson = await tx.eTFOLessonPlan.create({
                        data: {
                            ...lessonData,
                            userId,
                            unitPlanId: newUnit.id,
                            date: newLessonDate,
                            title: `${lesson.title} (Copy)`,
                        },
                    });
                    // Copy lesson expectations
                    if (lessonExp.length > 0) {
                        await tx.eTFOLessonPlanExpectation.createMany({
                            data: lessonExp.map(exp => ({
                                lessonPlanId: newLesson.id,
                                expectationId: exp.expectationId,
                            })),
                        });
                    }
                    // Copy lesson resources
                    if (lessonRes.length > 0) {
                        await tx.eTFOLessonPlanResource.createMany({
                            data: lessonRes.map(({ id: _id, lessonPlanId: _lessonPlanId, createdAt: _createdAt, ...resource }) => ({
                                ...resource,
                                lessonPlanId: newLesson.id,
                            })),
                        });
                    }
                }
            }
            return newUnit;
        });
        res.status(201).json(result);
    }
    catch (err) {
        _next(err);
    }
});
export default router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9yb3V0ZXMvdW5pdC1wbGFucy50cyIsIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFXLE1BQU0sU0FBUyxDQUFDO0FBRTFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDbkMsT0FBTyxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLEtBQUssQ0FBQztBQU14QixNQUFNLE1BQU0sR0FBRyxNQUFNLEVBQUUsQ0FBQztBQUV4QixxREFBcUQ7QUFDckQsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ3BDLEtBQUssRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLGdDQUFnQyxDQUFDO0lBQ3JGLE9BQU8sRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsdUNBQXVDLENBQUMsQ0FBQyxRQUFRLEVBQUU7SUFDbEcsZUFBZSxFQUFFLFVBQVUsRUFBRTtJQUM3QixXQUFXLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUU7SUFDNUMsYUFBYSxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFO0lBQzlDLFFBQVEsRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRTtJQUN6QyxVQUFVLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdB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QUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxHQUFHLFFBQVEsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dDQUNyRyxHQUFHLFFBQVE7Z0NBQ1gsWUFBWSxFQUFFLFNBQVMsQ0FBQyxFQUFFOzZCQUMzQixDQUFDLENBQW1EO3lCQUN0RCxDQUFDLENBQUM7b0JBQ0wsQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQztZQUVELE9BQU8sT0FBTyxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDO1FBRUgsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDYixLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDYixDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFSCxlQUFlLE1BQU0sQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWljaGFlbG1jaXNhYWMvR2l0SHViL3RlYWNoaW5nLWVuZ2luZTIuMC9zZXJ2ZXIvc3JjL3JvdXRlcy91bml0LXBsYW5zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciwgUmVxdWVzdCB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgUHJpc21hIH0gZnJvbSAnLi4vcHJpc21hJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL3ByaXNtYSc7XG5pbXBvcnQgeyB2YWxpZGF0ZSwgY3VpZFNjaGVtYSB9IGZyb20gJy4uL3ZhbGlkYXRpb24nO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5cbmludGVyZmFjZSBBdXRoZW50aWNhdGVkUmVxdWVzdCBleHRlbmRzIFJlcXVlc3Qge1xuICB1c2VyPzogeyB1c2VySWQ6IHN0cmluZyB9O1xufVxuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcblxuLy8gRW5oYW5jZWQgdmFsaWRhdGlvbiBzY2hlbWFzIHdpdGggc2VjdXJpdHkgbWVhc3VyZXNcbmNvbnN0IHVuaXRQbGFuQ3JlYXRlU2NoZW1hID0gei5vYmplY3Qoe1xuICB0aXRsZTogei5zdHJpbmcoKS5taW4oMSkubWF4KDI1NSkucmVnZXgoL15bXjw+XSokLywgJ1RpdGxlIGNhbm5vdCBjb250YWluIEhUTUwgdGFncycpLFxuICB0aXRsZUZyOiB6LnN0cmluZygpLm1heCgyNTUpLnJlZ2V4KC9eW148Pl0qJC8sICdGcmVuY2ggdGl0bGUgY2Fubm90IGNvbnRhaW4gSFRNTCB0YWdzJykub3B0aW9uYWwoKSxcbiAgbG9uZ1JhbmdlUGxhbklkOiBjdWlkU2NoZW1hKCksXG4gIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm1heCgyMDAwKS5vcHRpb25hbCgpLFxuICBkZXNjcmlwdGlvbkZyOiB6LnN0cmluZygpLm1heCgyMDAwKS5vcHRpb25hbCgpLFxuICBiaWdJZGVhczogei5zdHJpbmcoKS5tYXgoMjAwMCkub3B0aW9uYWwoKSxcbiAgYmlnSWRlYXNGcjogei5zdHJpbmcoKS5tYXgoMjAwMCkub3B0aW9uYWwoKSxcbiAgZXNzZW50aWFsUXVlc3Rpb25zOiB6LmFycmF5KHouc3RyaW5nKCkubWF4KDUwMCkpLm1heCgyMCkub3B0aW9uYWwoKSxcbiAgc3RhcnREYXRlOiB6LnN0cmluZygpLmRhdGV0aW1lKCksXG4gIGVuZERhdGU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbiAgZXN0aW1hdGVkSG91cnM6IHoubnVtYmVyKCkuaW50KCkucG9zaXRpdmUoKS5tYXgoMTAwMCkub3B0aW9uYWwoKSxcbiAgYXNzZXNzbWVudFBsYW46IHouc3RyaW5nKCkubWF4KDIwMDApLm9wdGlvbmFsKCksXG4gIHN1Y2Nlc3NDcml0ZXJpYTogei5hcnJheSh6LnN0cmluZygpLm1heCg1MDApKS5tYXgoMjApLm9wdGlvbmFsKCksXG4gIGV4cGVjdGF0aW9uSWRzOiB6LmFycmF5KGN1aWRTY2hlbWEoKSkubWF4KDUwKS5taW4oMSwgJ0F0IGxlYXN0IG9uZSBjdXJyaWN1bHVtIGV4cGVjdGF0aW9uIG11c3QgYmUgc2VsZWN0ZWQnKSxcblxuICAvLyBFVEZPLWFsaWduZWQgcGxhbm5pbmcgZmllbGRzIHdpdGggdmFsaWRhdGlvblxuICBjcm9zc0N1cnJpY3VsYXJDb25uZWN0aW9uczogei5zdHJpbmcoKS5tYXgoMTAwMCkub3B0aW9uYWwoKSxcbiAgbGVhcm5pbmdTa2lsbHM6IHouYXJyYXkoei5zdHJpbmcoKS5tYXgoMTAwKSkubWF4KDEwKS5vcHRpb25hbCgpLFxuICBjdWxtaW5hdGluZ1Rhc2s6IHouc3RyaW5nKCkubWF4KDEwMDApLm9wdGlvbmFsKCksXG4gIGtleVZvY2FidWxhcnk6IHouYXJyYXkoei5zdHJpbmcoKS5tYXgoMTAwKSkubWF4KDMwKS5vcHRpb25hbCgpLFxuICBwcmlvcktub3dsZWRnZTogei5zdHJpbmcoKS5tYXgoMTAwMCkub3B0aW9uYWwoKSxcbiAgcGFyZW50Q29tbXVuaWNhdGlvblBsYW46IHouc3RyaW5nKCkubWF4KDEwMDApLm9wdGlvbmFsKCksXG4gIGZpZWxkVHJpcHNBbmRHdWVzdFNwZWFrZXJzOiB6LnN0cmluZygpLm1heCgxMDAwKS5vcHRpb25hbCgpLFxuICBkaWZmZXJlbnRpYXRpb25TdHJhdGVnaWVzOiB6XG4gICAgLm9iamVjdCh7XG4gICAgICBmb3JTdHJ1Z2dsaW5nOiB6LmFycmF5KHouc3RyaW5nKCkubWF4KDIwMCkpLm1heCgxMCkub3B0aW9uYWwoKSxcbiAgICAgIGZvckFkdmFuY2VkOiB6LmFycmF5KHouc3RyaW5nKCkubWF4KDIwMCkpLm1heCgxMCkub3B0aW9uYWwoKSxcbiAgICAgIGZvckVMTDogei5hcnJheSh6LnN0cmluZygpLm1heCgyMDApKS5tYXgoMTApLm9wdGlvbmFsKCksXG4gICAgICBmb3JJRVA6IHouYXJyYXkoei5zdHJpbmcoKS5tYXgoMjAwKSkubWF4KDEwKS5vcHRpb25hbCgpLFxuICAgIH0pXG4gICAgLm9wdGlvbmFsKCksXG4gIGluZGlnZW5vdXNQZXJzcGVjdGl2ZXM6IHouc3RyaW5nKCkubWF4KDEwMDApLm9wdGlvbmFsKCksXG4gIGVudmlyb25tZW50YWxFZHVjYXRpb246IHouc3RyaW5nKCkubWF4KDEwMDApLm9wdGlvbmFsKCksXG4gIHNvY2lhbEp1c3RpY2VDb25uZWN0aW9uczogei5zdHJpbmcoKS5tYXgoMTAwMCkub3B0aW9uYWwoKSxcbiAgdGVjaG5vbG9neUludGVncmF0aW9uOiB6LnN0cmluZygpLm1heCgxMDAwKS5vcHRpb25hbCgpLFxuICBjb21tdW5pdHlDb25uZWN0aW9uczogei5zdHJpbmcoKS5tYXgoMTAwMCkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1bml0UGxhblVwZGF0ZVNjaGVtYSA9IHVuaXRQbGFuQ3JlYXRlU2NoZW1hLnBhcnRpYWwoKS5vbWl0KHsgbG9uZ1JhbmdlUGxhbklkOiB0cnVlIH0pO1xuXG4vLyBHZXQgYWxsIHVuaXQgcGxhbnMgZm9yIHRoZSBhdXRoZW50aWNhdGVkIHVzZXJcbnJvdXRlci5nZXQoJy8nLCBhc3luYyAocmVxOiBBdXRoZW50aWNhdGVkUmVxdWVzdCwgcmVzLCBfbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHBhcnNlSW50KHJlcS51c2VyPy51c2VySWQgfHwgJzAnLCAxMCk7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGxvbmdSYW5nZVBsYW5JZCwgc3RhcnREYXRlLCBlbmREYXRlIH0gPSByZXEucXVlcnk7XG5cbiAgICBjb25zdCB3aGVyZTogUHJpc21hLlVuaXRQbGFuV2hlcmVJbnB1dCA9IHsgdXNlcklkIH07XG4gICAgaWYgKGxvbmdSYW5nZVBsYW5JZCkgd2hlcmUubG9uZ1JhbmdlUGxhbklkID0gU3RyaW5nKGxvbmdSYW5nZVBsYW5JZCk7XG4gICAgaWYgKHN0YXJ0RGF0ZSB8fCBlbmREYXRlKSB7XG4gICAgICB3aGVyZS5zdGFydERhdGUgPSB7fTtcbiAgICAgIGlmIChzdGFydERhdGUpIHdoZXJlLnN0YXJ0RGF0ZS5ndGUgPSBuZXcgRGF0ZShTdHJpbmcoc3RhcnREYXRlKSk7XG4gICAgICBpZiAoZW5kRGF0ZSkgd2hlcmUuc3RhcnREYXRlLmx0ZSA9IG5ldyBEYXRlKFN0cmluZyhlbmREYXRlKSk7XG4gICAgfVxuXG4gICAgY29uc3QgdW5pdFBsYW5zID0gYXdhaXQgcHJpc21hLnVuaXRQbGFuLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlLFxuICAgICAgb3JkZXJCeTogeyBzdGFydERhdGU6ICdhc2MnIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGxvbmdSYW5nZVBsYW46IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICBzdWJqZWN0OiB0cnVlLFxuICAgICAgICAgICAgZ3JhZGU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBsZXNzb25QbGFuczogdHJ1ZSxcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uczogdHJ1ZSxcbiAgICAgICAgICAgIHJlc291cmNlczogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJlcy5qc29uKHVuaXRQbGFucyk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIF9uZXh0KGVycik7XG4gIH1cbn0pO1xuXG4vLyBHZXQgYSBzaW5nbGUgdW5pdCBwbGFuXG5yb3V0ZXIuZ2V0KCcvOmlkJywgYXN5bmMgKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlcywgX25leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSBwYXJzZUludChyZXEudXNlcj8udXNlcklkIHx8ICcwJywgMTApO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgdW5pdFBsYW4gPSBhd2FpdCBwcmlzbWEudW5pdFBsYW4uZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiByZXEucGFyYW1zLmlkLFxuICAgICAgICB1c2VySWQsXG4gICAgICB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBsb25nUmFuZ2VQbGFuOiB0cnVlLFxuICAgICAgICBleHBlY3RhdGlvbnM6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBleHBlY3RhdGlvbjogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uOiB7IGNvZGU6ICdhc2MnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgbGVzc29uUGxhbnM6IHtcbiAgICAgICAgICBvcmRlckJ5OiB7IGRhdGU6ICdhc2MnIH0sXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICAgIHNlbGVjdDogeyBleHBlY3RhdGlvbnM6IHRydWUgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkYXlib29rRW50cnk6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgb3ZlcmFsbFJhdGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB3b3VsZFJldXNlTGVzc29uOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICByZXNvdXJjZXM6IHtcbiAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCF1bml0UGxhbikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdVbml0IHBsYW4gbm90IGZvdW5kJyB9KTtcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgcHJvZ3Jlc3NcbiAgICBjb25zdCB0b3RhbExlc3NvbnMgPSB1bml0UGxhbi5sZXNzb25QbGFucy5sZW5ndGg7XG4gICAgY29uc3QgY29tcGxldGVkTGVzc29ucyA9IHVuaXRQbGFuLmxlc3NvblBsYW5zLmZpbHRlcigobHApID0+IGxwLmRheWJvb2tFbnRyeSkubGVuZ3RoO1xuICAgIGNvbnN0IHByb2dyZXNzID0gdG90YWxMZXNzb25zID4gMCA/IE1hdGgucm91bmQoKGNvbXBsZXRlZExlc3NvbnMgLyB0b3RhbExlc3NvbnMpICogMTAwKSA6IDA7XG5cbiAgICByZXMuanNvbih7XG4gICAgICAuLi51bml0UGxhbixcbiAgICAgIHByb2dyZXNzOiB7XG4gICAgICAgIHRvdGFsOiB0b3RhbExlc3NvbnMsXG4gICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkTGVzc29ucyxcbiAgICAgICAgcGVyY2VudGFnZTogcHJvZ3Jlc3MsXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBfbmV4dChlcnIpO1xuICB9XG59KTtcblxuLy8gQ3JlYXRlIGEgbmV3IHVuaXQgcGxhblxucm91dGVyLnBvc3QoJy8nLCB2YWxpZGF0ZSh1bml0UGxhbkNyZWF0ZVNjaGVtYSksIGFzeW5jIChyZXE6IEF1dGhlbnRpY2F0ZWRSZXF1ZXN0LCByZXMsIF9uZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlcklkID0gcGFyc2VJbnQocmVxLnVzZXI/LnVzZXJJZCB8fCAnMCcsIDEwKTtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHtcbiAgICAgIGV4cGVjdGF0aW9uSWRzLFxuICAgICAgZXNzZW50aWFsUXVlc3Rpb25zLFxuICAgICAgc3VjY2Vzc0NyaXRlcmlhLFxuICAgICAgbGVhcm5pbmdTa2lsbHMsXG4gICAgICBrZXlWb2NhYnVsYXJ5LFxuICAgICAgZGlmZmVyZW50aWF0aW9uU3RyYXRlZ2llcyxcbiAgICAgIC4uLnBsYW5EYXRhXG4gICAgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gVmVyaWZ5IHVzZXIgb3ducyB0aGUgbG9uZy1yYW5nZSBwbGFuXG4gICAgY29uc3QgbG9uZ1JhbmdlUGxhbiA9IGF3YWl0IHByaXNtYS5sb25nUmFuZ2VQbGFuLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogcGxhbkRhdGEubG9uZ1JhbmdlUGxhbklkLFxuICAgICAgICB1c2VySWQsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFsb25nUmFuZ2VQbGFuKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0xvbmctcmFuZ2UgcGxhbiBub3QgZm91bmQnIH0pO1xuICAgIH1cblxuICAgIC8vIFVzZSB0cmFuc2FjdGlvbiB0byBlbnN1cmUgZGF0YSBpbnRlZ3JpdHlcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIHRoZSB1bml0IHBsYW5cbiAgICAgIGNvbnN0IHVuaXRQbGFuID0gYXdhaXQgdHgudW5pdFBsYW4uY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIC4uLnBsYW5EYXRhLFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBzdGFydERhdGU6IG5ldyBEYXRlKHBsYW5EYXRhLnN0YXJ0RGF0ZSksXG4gICAgICAgICAgZW5kRGF0ZTogbmV3IERhdGUocGxhbkRhdGEuZW5kRGF0ZSksXG4gICAgICAgICAgZXNzZW50aWFsUXVlc3Rpb25zOiBlc3NlbnRpYWxRdWVzdGlvbnMgfHwgW10sXG4gICAgICAgICAgc3VjY2Vzc0NyaXRlcmlhOiBzdWNjZXNzQ3JpdGVyaWEgfHwgW10sXG4gICAgICAgICAgbGVhcm5pbmdTa2lsbHM6IGxlYXJuaW5nU2tpbGxzIHx8IFtdLFxuICAgICAgICAgIGtleVZvY2FidWxhcnk6IGtleVZvY2FidWxhcnkgfHwgW10sXG4gICAgICAgICAgZGlmZmVyZW50aWF0aW9uU3RyYXRlZ2llczogZGlmZmVyZW50aWF0aW9uU3RyYXRlZ2llcyB8fCBudWxsLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIExpbmsgY3VycmljdWx1bSBleHBlY3RhdGlvbnMgaWYgcHJvdmlkZWRcbiAgICAgIGlmIChleHBlY3RhdGlvbklkcyAmJiBleHBlY3RhdGlvbklkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIFZhbGlkYXRlIGV4cGVjdGF0aW9uIElEcyBleGlzdFxuICAgICAgICBjb25zdCB2YWxpZEV4cGVjdGF0aW9ucyA9IGF3YWl0IHR4LmN1cnJpY3VsdW1FeHBlY3RhdGlvbi5maW5kTWFueSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IHsgaW46IGV4cGVjdGF0aW9uSWRzIH0gfSxcbiAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHZhbGlkRXhwZWN0YXRpb25zLmxlbmd0aCAhPT0gZXhwZWN0YXRpb25JZHMubGVuZ3RoKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmUgb3IgbW9yZSBjdXJyaWN1bHVtIGV4cGVjdGF0aW9ucyBub3QgZm91bmQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IHR4LnVuaXRQbGFuRXhwZWN0YXRpb24uY3JlYXRlTWFueSh7XG4gICAgICAgICAgZGF0YTogZXhwZWN0YXRpb25JZHMubWFwKChleHBlY3RhdGlvbklkOiBzdHJpbmcpID0+ICh7XG4gICAgICAgICAgICB1bml0UGxhbklkOiB1bml0UGxhbi5pZCxcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uSWQsXG4gICAgICAgICAgfSkpLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUmV0dXJuIHRoZSBjcmVhdGVkIHVuaXQgcGxhbiB3aXRoIHJlbGF0aW9uc1xuICAgICAgcmV0dXJuIGF3YWl0IHR4LnVuaXRQbGFuLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogdW5pdFBsYW4uaWQgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGxvbmdSYW5nZVBsYW46IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgIHN1YmplY3Q6IHRydWUsXG4gICAgICAgICAgICAgIGdyYWRlOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGxlc3NvblBsYW5zOiB0cnVlLFxuICAgICAgICAgICAgICBleHBlY3RhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHJlc3VsdCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIF9uZXh0KGVycik7XG4gIH1cbn0pO1xuXG4vLyBVcGRhdGUgYSB1bml0IHBsYW5cbnJvdXRlci5wdXQoXG4gICcvOmlkJyxcbiAgdmFsaWRhdGUodW5pdFBsYW5VcGRhdGVTY2hlbWEpLFxuICBhc3luYyAocmVxOiBBdXRoZW50aWNhdGVkUmVxdWVzdCwgcmVzLCBfbmV4dCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VySWQgPSBwYXJzZUludChyZXEudXNlcj8udXNlcklkIHx8ICcwJywgMTApO1xuICAgICAgaWYgKCF1c2VySWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7XG4gICAgICAgIGV4cGVjdGF0aW9uSWRzLFxuICAgICAgICBlc3NlbnRpYWxRdWVzdGlvbnMsXG4gICAgICAgIHN1Y2Nlc3NDcml0ZXJpYSxcbiAgICAgICAgbGVhcm5pbmdTa2lsbHMsXG4gICAgICAgIGtleVZvY2FidWxhcnksXG4gICAgICAgIGRpZmZlcmVudGlhdGlvblN0cmF0ZWdpZXMsXG4gICAgICAgIC4uLnVwZGF0ZURhdGFcbiAgICAgIH0gPSByZXEuYm9keTtcblxuICAgICAgLy8gVmVyaWZ5IG93bmVyc2hpcFxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEudW5pdFBsYW4uZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHJlcS5wYXJhbXMuaWQsIHVzZXJJZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdVbml0IHBsYW4gbm90IGZvdW5kJyB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJlcGFyZSB1cGRhdGUgZGF0YVxuICAgICAgY29uc3QgZGF0YTogUHJpc21hLlVuaXRQbGFuVXBkYXRlSW5wdXQgPSB7IC4uLnVwZGF0ZURhdGEgfTtcbiAgICAgIGlmICh1cGRhdGVEYXRhLnN0YXJ0RGF0ZSkgZGF0YS5zdGFydERhdGUgPSBuZXcgRGF0ZSh1cGRhdGVEYXRhLnN0YXJ0RGF0ZSk7XG4gICAgICBpZiAodXBkYXRlRGF0YS5lbmREYXRlKSBkYXRhLmVuZERhdGUgPSBuZXcgRGF0ZSh1cGRhdGVEYXRhLmVuZERhdGUpO1xuICAgICAgaWYgKGVzc2VudGlhbFF1ZXN0aW9ucyAhPT0gdW5kZWZpbmVkKSBkYXRhLmVzc2VudGlhbFF1ZXN0aW9ucyA9IGVzc2VudGlhbFF1ZXN0aW9ucztcbiAgICAgIGlmIChzdWNjZXNzQ3JpdGVyaWEgIT09IHVuZGVmaW5lZCkgZGF0YS5zdWNjZXNzQ3JpdGVyaWEgPSBzdWNjZXNzQ3JpdGVyaWE7XG4gICAgICBpZiAobGVhcm5pbmdTa2lsbHMgIT09IHVuZGVmaW5lZCkgZGF0YS5sZWFybmluZ1NraWxscyA9IGxlYXJuaW5nU2tpbGxzO1xuICAgICAgaWYgKGtleVZvY2FidWxhcnkgIT09IHVuZGVmaW5lZCkgZGF0YS5rZXlWb2NhYnVsYXJ5ID0ga2V5Vm9jYWJ1bGFyeTtcbiAgICAgIGlmIChkaWZmZXJlbnRpYXRpb25TdHJhdGVnaWVzICE9PSB1bmRlZmluZWQpXG4gICAgICAgIGRhdGEuZGlmZmVyZW50aWF0aW9uU3RyYXRlZ2llcyA9IGRpZmZlcmVudGlhdGlvblN0cmF0ZWdpZXM7XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgcGxhblxuICAgICAgY29uc3QgdW5pdFBsYW4gPSBhd2FpdCBwcmlzbWEudW5pdFBsYW4udXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHJlcS5wYXJhbXMuaWQgfSxcbiAgICAgICAgZGF0YSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBVcGRhdGUgZXhwZWN0YXRpb25zIGlmIHByb3ZpZGVkXG4gICAgICBpZiAoZXhwZWN0YXRpb25JZHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAvLyBSZW1vdmUgZXhpc3RpbmcgZXhwZWN0YXRpb25zXG4gICAgICAgIGF3YWl0IHByaXNtYS51bml0UGxhbkV4cGVjdGF0aW9uLmRlbGV0ZU1hbnkoe1xuICAgICAgICAgIHdoZXJlOiB7IHVuaXRQbGFuSWQ6IHVuaXRQbGFuLmlkIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFkZCBuZXcgZXhwZWN0YXRpb25zXG4gICAgICAgIGlmIChleHBlY3RhdGlvbklkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgYXdhaXQgcHJpc21hLnVuaXRQbGFuRXhwZWN0YXRpb24uY3JlYXRlTWFueSh7XG4gICAgICAgICAgICBkYXRhOiBleHBlY3RhdGlvbklkcy5tYXAoKGV4cGVjdGF0aW9uSWQ6IHN0cmluZykgPT4gKHtcbiAgICAgICAgICAgICAgdW5pdFBsYW5JZDogdW5pdFBsYW4uaWQsXG4gICAgICAgICAgICAgIGV4cGVjdGF0aW9uSWQsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUmVmZXRjaCB3aXRoIHVwZGF0ZWQgcmVsYXRpb25zaGlwc1xuICAgICAgY29uc3QgdXBkYXRlZFBsYW4gPSBhd2FpdCBwcmlzbWEudW5pdFBsYW4uZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB1bml0UGxhbi5pZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgbG9uZ1JhbmdlUGxhbjogdHJ1ZSxcbiAgICAgICAgICBleHBlY3RhdGlvbnM6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHsgZXhwZWN0YXRpb246IHRydWUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGxlc3NvblBsYW5zOiB7XG4gICAgICAgICAgICBvcmRlckJ5OiB7IGRhdGU6ICdhc2MnIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIF9jb3VudDogeyBzZWxlY3Q6IHsgZXhwZWN0YXRpb25zOiB0cnVlIH0gfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXNvdXJjZXM6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcmVzLmpzb24odXBkYXRlZFBsYW4pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgX25leHQoZXJyKTtcbiAgICB9XG4gIH0sXG4pO1xuXG4vLyBEZWxldGUgYSB1bml0IHBsYW5cbnJvdXRlci5kZWxldGUoJy86aWQnLCBhc3luYyAocmVxOiBBdXRoZW50aWNhdGVkUmVxdWVzdCwgcmVzLCBfbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHBhcnNlSW50KHJlcS51c2VyPy51c2VySWQgfHwgJzAnLCAxMCk7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9KTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZnkgb3duZXJzaGlwIGFuZCBjaGVjayBmb3IgZGVwZW5kZW5jaWVzXG4gICAgY29uc3QgdW5pdFBsYW4gPSBhd2FpdCBwcmlzbWEudW5pdFBsYW4uZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7IGlkOiByZXEucGFyYW1zLmlkLCB1c2VySWQgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBsZXNzb25QbGFuczogdHJ1ZSB9IH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCF1bml0UGxhbikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdVbml0IHBsYW4gbm90IGZvdW5kJyB9KTtcbiAgICB9XG5cbiAgICBpZiAodW5pdFBsYW4uX2NvdW50Lmxlc3NvblBsYW5zID4gMCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdDYW5ub3QgZGVsZXRlIHVuaXQgcGxhbiB3aXRoIGV4aXN0aW5nIGxlc3NvbiBwbGFucycsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBhd2FpdCBwcmlzbWEudW5pdFBsYW4uZGVsZXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiByZXEucGFyYW1zLmlkIH0sXG4gICAgfSk7XG5cbiAgICByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIF9uZXh0KGVycik7XG4gIH1cbn0pO1xuXG4vLyBBZGQgYSByZXNvdXJjZSB0byB1bml0IHBsYW5cbnJvdXRlci5wb3N0KCcvOmlkL3Jlc291cmNlcycsIGFzeW5jIChyZXE6IEF1dGhlbnRpY2F0ZWRSZXF1ZXN0LCByZXMsIF9uZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlcklkID0gcGFyc2VJbnQocmVxLnVzZXI/LnVzZXJJZCB8fCAnMCcsIDEwKTtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHsgdGl0bGUsIHR5cGUsIHVybCwgbm90ZXMgfSA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCF0aXRsZSB8fCAhdHlwZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdUaXRsZSBhbmQgdHlwZSBhcmUgcmVxdWlyZWQnIH0pO1xuICAgIH1cblxuICAgIC8vIFZlcmlmeSBvd25lcnNoaXBcbiAgICBjb25zdCB1bml0UGxhbiA9IGF3YWl0IHByaXNtYS51bml0UGxhbi5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHJlcS5wYXJhbXMuaWQsIHVzZXJJZCB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCF1bml0UGxhbikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdVbml0IHBsYW4gbm90IGZvdW5kJyB9KTtcbiAgICB9XG5cbiAgICBjb25zdCByZXNvdXJjZSA9IGF3YWl0IHByaXNtYS51bml0UGxhblJlc291cmNlLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHVuaXRQbGFuSWQ6IHJlcS5wYXJhbXMuaWQsXG4gICAgICAgIHRpdGxlOiBTdHJpbmcodGl0bGUpLFxuICAgICAgICB0eXBlOiBTdHJpbmcodHlwZSksXG4gICAgICAgIHVybDogdXJsID8gU3RyaW5nKHVybCkgOiBudWxsLFxuICAgICAgICBub3Rlczogbm90ZXMgPyBTdHJpbmcobm90ZXMpIDogbnVsbCxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbihyZXNvdXJjZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIF9uZXh0KGVycik7XG4gIH1cbn0pO1xuXG4vLyBEZWxldGUgYSByZXNvdXJjZVxucm91dGVyLmRlbGV0ZSgnLzppZC9yZXNvdXJjZXMvOnJlc291cmNlSWQnLCBhc3luYyAocmVxOiBBdXRoZW50aWNhdGVkUmVxdWVzdCwgcmVzLCBfbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHBhcnNlSW50KHJlcS51c2VyPy51c2VySWQgfHwgJzAnLCAxMCk7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9KTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZnkgb3duZXJzaGlwIHRocm91Z2ggdW5pdCBwbGFuXG4gICAgY29uc3QgcmVzb3VyY2UgPSBhd2FpdCBwcmlzbWEudW5pdFBsYW5SZXNvdXJjZS5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IHJlcS5wYXJhbXMucmVzb3VyY2VJZCxcbiAgICAgICAgdW5pdFBsYW46IHtcbiAgICAgICAgICBpZDogcmVxLnBhcmFtcy5pZCxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFyZXNvdXJjZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdSZXNvdXJjZSBub3QgZm91bmQnIH0pO1xuICAgIH1cblxuICAgIGF3YWl0IHByaXNtYS51bml0UGxhblJlc291cmNlLmRlbGV0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogcmVxLnBhcmFtcy5yZXNvdXJjZUlkIH0sXG4gICAgfSk7XG5cbiAgICByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIF9uZXh0KGVycik7XG4gIH1cbn0pO1xuXG4vLyBEdXBsaWNhdGUgYSB1bml0IHBsYW5cbnJvdXRlci5wb3N0KCcvZHVwbGljYXRlJywgYXN5bmMgKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlcywgX25leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSBwYXJzZUludChyZXEudXNlcj8udXNlcklkIHx8ICcwJywgMTApO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBzb3VyY2VJZCwgdGl0bGUsIG5vdGVzOiBfbm90ZXMsIGluY2x1ZGVTdWJJdGVtcyB9ID0gcmVxLmJvZHk7XG5cbiAgICBpZiAoIXNvdXJjZUlkIHx8ICF0aXRsZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdTb3VyY2UgSUQgYW5kIHRpdGxlIGFyZSByZXF1aXJlZCcgfSk7XG4gICAgfVxuXG4gICAgLy8gRmV0Y2ggdGhlIHNvdXJjZSB1bml0IHBsYW4gd2l0aCBhbGwgcmVsYXRpb25zXG4gICAgY29uc3Qgc291cmNlVW5pdCA9IGF3YWl0IHByaXNtYS51bml0UGxhbi5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHNvdXJjZUlkLCB1c2VySWQgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgZXhwZWN0YXRpb25zOiB0cnVlLFxuICAgICAgICByZXNvdXJjZXM6IHRydWUsXG4gICAgICAgIGxlc3NvblBsYW5zOiBpbmNsdWRlU3ViSXRlbXMgPyB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgZXhwZWN0YXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgcmVzb3VyY2VzOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0gOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXNvdXJjZVVuaXQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnU291cmNlIHVuaXQgcGxhbiBub3QgZm91bmQnIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSB0aGUgZHVwbGljYXRlIGluIGEgdHJhbnNhY3Rpb25cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgLy8gQ2FsY3VsYXRlIG5ldyBkYXRlcyAoc2hpZnQgdG8gY3VycmVudCBwZXJpb2QpXG4gICAgICBjb25zdCBvcmlnaW5hbER1cmF0aW9uID0gc291cmNlVW5pdC5lbmREYXRlLmdldFRpbWUoKSAtIHNvdXJjZVVuaXQuc3RhcnREYXRlLmdldFRpbWUoKTtcbiAgICAgIGNvbnN0IG5ld1N0YXJ0RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBuZXdFbmREYXRlID0gbmV3IERhdGUobmV3U3RhcnREYXRlLmdldFRpbWUoKSArIG9yaWdpbmFsRHVyYXRpb24pO1xuXG4gICAgICAvLyBDcmVhdGUgdGhlIGR1cGxpY2F0ZSB1bml0IHBsYW5cbiAgICAgIGNvbnN0IHsgaWQ6IF8sIHVzZXJJZDogX18sIGNyZWF0ZWRBdDogX2NyZWF0ZWRBdCwgdXBkYXRlZEF0OiBfdXBkYXRlZEF0LCBsZXNzb25QbGFucywgZXhwZWN0YXRpb25zLCByZXNvdXJjZXMsIC4uLnVuaXREYXRhIH0gPSBzb3VyY2VVbml0O1xuICAgICAgXG4gICAgICBjb25zdCBuZXdVbml0ID0gYXdhaXQgdHgudW5pdFBsYW4uY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIC4uLnVuaXREYXRhLFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICBzdGFydERhdGU6IG5ld1N0YXJ0RGF0ZSxcbiAgICAgICAgICBlbmREYXRlOiBuZXdFbmREYXRlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENvcHkgZXhwZWN0YXRpb25zXG4gICAgICBpZiAoZXhwZWN0YXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgYXdhaXQgdHgudW5pdFBsYW5FeHBlY3RhdGlvbi5jcmVhdGVNYW55KHtcbiAgICAgICAgICBkYXRhOiBleHBlY3RhdGlvbnMubWFwKGV4cCA9PiAoe1xuICAgICAgICAgICAgdW5pdFBsYW5JZDogbmV3VW5pdC5pZCxcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uSWQ6IGV4cC5leHBlY3RhdGlvbklkLFxuICAgICAgICAgIH0pKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENvcHkgcmVzb3VyY2VzXG4gICAgICBpZiAocmVzb3VyY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgYXdhaXQgdHgudW5pdFBsYW5SZXNvdXJjZS5jcmVhdGVNYW55KHtcbiAgICAgICAgICBkYXRhOiByZXNvdXJjZXMubWFwKCh7IGlkOiBfaWQsIHVuaXRQbGFuSWQ6IF91bml0UGxhbklkLCBjcmVhdGVkQXQ6IF9jcmVhdGVkQXQsIC4uLnJlc291cmNlIH0pID0+ICh7XG4gICAgICAgICAgICAuLi5yZXNvdXJjZSxcbiAgICAgICAgICAgIHVuaXRQbGFuSWQ6IG5ld1VuaXQuaWQsXG4gICAgICAgICAgfSkpLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29weSBsZXNzb24gcGxhbnMgaWYgcmVxdWVzdGVkXG4gICAgICBpZiAoaW5jbHVkZVN1Ykl0ZW1zICYmIGxlc3NvblBsYW5zICYmIGxlc3NvblBsYW5zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZm9yIChjb25zdCBsZXNzb24gb2YgbGVzc29uUGxhbnMpIHtcbiAgICAgICAgICBjb25zdCB7IGlkOiBfLCB1bml0UGxhbklkOiBfXywgdXNlcklkOiBfX18sIGNyZWF0ZWRBdDogX2NyZWF0ZWRBdCwgdXBkYXRlZEF0OiBfdXBkYXRlZEF0LCAuLi5sZXNzb25EYXRhIH0gPSBsZXNzb247XG4gICAgICAgICAgY29uc3QgbGVzc29uRXhwID0gKGxlc3NvbiBhcyB7IGV4cGVjdGF0aW9ucz86IEFycmF5PHsgZXhwZWN0YXRpb25JZDogc3RyaW5nIH0+IH0pLmV4cGVjdGF0aW9ucyB8fCBbXTtcbiAgICAgICAgICBjb25zdCBsZXNzb25SZXMgPSAobGVzc29uIGFzIHsgcmVzb3VyY2VzPzogQXJyYXk8eyBpZDogc3RyaW5nOyBsZXNzb25QbGFuSWQ6IHN0cmluZzsgY3JlYXRlZEF0OiBEYXRlOyBba2V5OiBzdHJpbmddOiB1bmtub3duIH0+IH0pLnJlc291cmNlcyB8fCBbXTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IGxlc3NvbiBkYXRlIGJhc2VkIG9uIHJlbGF0aXZlIHBvc2l0aW9uXG4gICAgICAgICAgY29uc3Qgb3JpZ2luYWxPZmZzZXQgPSBsZXNzb24uZGF0ZS5nZXRUaW1lKCkgLSBzb3VyY2VVbml0LnN0YXJ0RGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgICAgY29uc3QgbmV3TGVzc29uRGF0ZSA9IG5ldyBEYXRlKG5ld1N0YXJ0RGF0ZS5nZXRUaW1lKCkgKyBvcmlnaW5hbE9mZnNldCk7XG5cbiAgICAgICAgICBjb25zdCBuZXdMZXNzb24gPSBhd2FpdCB0eC5lVEZPTGVzc29uUGxhbi5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAuLi5sZXNzb25EYXRhLFxuICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgIHVuaXRQbGFuSWQ6IG5ld1VuaXQuaWQsXG4gICAgICAgICAgICAgIGRhdGU6IG5ld0xlc3NvbkRhdGUsXG4gICAgICAgICAgICAgIHRpdGxlOiBgJHtsZXNzb24udGl0bGV9IChDb3B5KWAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gQ29weSBsZXNzb24gZXhwZWN0YXRpb25zXG4gICAgICAgICAgaWYgKGxlc3NvbkV4cC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBhd2FpdCB0eC5lVEZPTGVzc29uUGxhbkV4cGVjdGF0aW9uLmNyZWF0ZU1hbnkoe1xuICAgICAgICAgICAgICBkYXRhOiBsZXNzb25FeHAubWFwKGV4cCA9PiAoe1xuICAgICAgICAgICAgICAgIGxlc3NvblBsYW5JZDogbmV3TGVzc29uLmlkLFxuICAgICAgICAgICAgICAgIGV4cGVjdGF0aW9uSWQ6IGV4cC5leHBlY3RhdGlvbklkLFxuICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBDb3B5IGxlc3NvbiByZXNvdXJjZXNcbiAgICAgICAgICBpZiAobGVzc29uUmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGF3YWl0IHR4LmVURk9MZXNzb25QbGFuUmVzb3VyY2UuY3JlYXRlTWFueSh7XG4gICAgICAgICAgICAgIGRhdGE6IGxlc3NvblJlcy5tYXAoKHsgaWQ6IF9pZCwgbGVzc29uUGxhbklkOiBfbGVzc29uUGxhbklkLCBjcmVhdGVkQXQ6IF9jcmVhdGVkQXQsIC4uLnJlc291cmNlIH0pID0+ICh7XG4gICAgICAgICAgICAgICAgLi4ucmVzb3VyY2UsXG4gICAgICAgICAgICAgICAgbGVzc29uUGxhbklkOiBuZXdMZXNzb24uaWQsXG4gICAgICAgICAgICAgIH0pKSBhcyBQcmlzbWEuRVRGT0xlc3NvblBsYW5SZXNvdXJjZUNyZWF0ZU1hbnlJbnB1dFtdLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXdVbml0O1xuICAgIH0pO1xuXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24ocmVzdWx0KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgX25leHQoZXJyKTtcbiAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjtcbiJdLCJ2ZXJzaW9uIjozfQ==