37d73c52e2ad7e4cefa87b270330abb4
import { app } from '../../src/index';
import { authRequest } from '../test-auth-helper';
import { getTestPrismaClient } from '../jest.setup';
import { setupAuthenticatedTest } from './test-setup-helpers';
describe('calendar events', () => {
    const auth = authRequest(app);
    let prisma;
    beforeAll(async () => {
        prisma = getTestPrismaClient();
    });
    beforeEach(async () => {
        // Setup auth for each test to handle database resets
        await setupAuthenticatedTest(prisma, auth);
    });
    it('creates and lists events', async () => {
        const res = await auth.post('/api/calendar-events').send({
            title: 'PD Day',
            start: '2025-01-02T00:00:00.000Z',
            end: '2025-01-02T23:59:59.000Z',
            allDay: true,
            eventType: 'PD_DAY',
        });
        expect(res.status).toBe(201);
        const list = await auth.get('/api/calendar-events?from=2025-01-01&to=2025-01-03');
        expect(list.status).toBe(200);
        expect(list.body.length).toBe(1);
        expect(list.body[0].title).toBe('PD Day');
    });
    it('handles date range queries', async () => {
        // Create events in different date ranges
        await auth.post('/api/calendar-events').send({
            title: 'Event 1',
            start: '2025-01-05T00:00:00.000Z',
            end: '2025-01-05T23:59:59.000Z',
            allDay: true,
            eventType: 'HOLIDAY',
        });
        await auth.post('/api/calendar-events').send({
            title: 'Event 2',
            start: '2025-01-15T00:00:00.000Z',
            end: '2025-01-15T23:59:59.000Z',
            allDay: true,
            eventType: 'HOLIDAY',
        });
        // Query for specific date range
        const list = await auth.get('/api/calendar-events?from=2025-01-10&to=2025-01-20');
        expect(list.status).toBe(200);
        expect(list.body.length).toBe(1);
        expect(list.body[0].title).toBe('Event 2');
    });
    it('updates calendar events', async () => {
        // Create an event
        const createRes = await auth.post('/api/calendar-events').send({
            title: 'Original Title',
            start: '2025-02-01T00:00:00.000Z',
            end: '2025-02-01T23:59:59.000Z',
            allDay: true,
            eventType: 'HOLIDAY',
        });
        expect(createRes.status).toBe(201);
        const eventId = createRes.body.id;
        // Update the event
        const updateRes = await auth.put(`/api/calendar-events/${eventId}`).send({
            title: 'Updated Title',
            eventType: 'PD_DAY',
        });
        expect(updateRes.status).toBe(200);
        expect(updateRes.body.title).toBe('Updated Title');
        expect(updateRes.body.eventType).toBe('PD_DAY');
    });
    it('deletes calendar events', async () => {
        // Create an event
        const createRes = await auth.post('/api/calendar-events').send({
            title: 'To Delete',
            start: '2025-03-01T00:00:00.000Z',
            end: '2025-03-01T23:59:59.000Z',
            allDay: true,
            eventType: 'HOLIDAY',
        });
        expect(createRes.status).toBe(201);
        const eventId = createRes.body.id;
        // Delete the event
        const deleteRes = await auth.delete(`/api/calendar-events/${eventId}`);
        expect(deleteRes.status).toBe(204);
        // Verify it's deleted
        const list = await auth.get('/api/calendar-events?from=2025-03-01&to=2025-03-01');
        expect(list.status).toBe(200);
        expect(list.body.length).toBe(0);
    });
    describe('Edge Cases', () => {
        it('should handle empty data scenarios gracefully', async () => {
            // Query with no events
            const list = await auth.get('/api/calendar-events?from=2030-01-01&to=2030-12-31');
            expect(list.status).toBe(200);
            expect(list.body).toEqual([]);
        });
        it('should handle invalid date formats', async () => {
            const res = await auth.post('/api/calendar-events').send({
                title: 'Invalid Date Event',
                start: 'invalid-date',
                end: '2025-01-01T00:00:00.000Z',
                eventType: 'HOLIDAY',
            });
            expect(res.status).toBe(400);
        });
        it('should handle overlapping events', async () => {
            // Create first event
            await auth.post('/api/calendar-events').send({
                title: 'Event A',
                start: '2025-04-01T10:00:00.000Z',
                end: '2025-04-01T12:00:00.000Z',
                eventType: 'CUSTOM',
            });
            // Create overlapping event - should succeed
            const res = await auth.post('/api/calendar-events').send({
                title: 'Event B',
                start: '2025-04-01T11:00:00.000Z',
                end: '2025-04-01T13:00:00.000Z',
                eventType: 'CUSTOM',
            });
            expect(res.status).toBe(201);
        });
        it('should validate required fields', async () => {
            const res = await auth.post('/api/calendar-events').send({
                // Missing required fields
                eventType: 'HOLIDAY',
            });
            expect(res.status).toBe(400);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL2ludGVncmF0aW9uL2NhbGVuZGFyRXZlbnRzLnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3RDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFOUQsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixNQUFNLElBQUksR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDOUIsSUFBSSxNQUE4QyxDQUFDO0lBRW5ELFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixNQUFNLEdBQUcsbUJBQW1CLEVBQUUsQ0FBQztJQUNqQyxDQUFDLENBQUMsQ0FBQztJQUVILFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixxREFBcUQ7UUFDckQsTUFBTSxzQkFBc0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsMEJBQTBCLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDeEMsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUMsSUFBSSxDQUFDO1lBQ3ZELEtBQUssRUFBRSxRQUFRO1lBQ2YsS0FBSyxFQUFFLDBCQUEwQjtZQUNqQyxHQUFHLEVBQUUsMEJBQTBCO1lBQy9CLE1BQU0sRUFBRSxJQUFJO1lBQ1osU0FBUyxFQUFFLFFBQVE7U0FDcEIsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFF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QixDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvQyxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ3ZELDBCQUEwQjtnQkFDMUIsU0FBUyxFQUFFLFNBQVM7YUFDckIsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWNoYWVsbWNpc2FhYy9HaXRIdWIvdGVhY2hpbmctZW5naW5lMi4wL3NlcnZlci90ZXN0cy9pbnRlZ3JhdGlvbi9jYWxlbmRhckV2ZW50cy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFwcCB9IGZyb20gJy4uLy4uL3NyYy9pbmRleCc7XG5pbXBvcnQgeyBhdXRoUmVxdWVzdCB9IGZyb20gJy4uL3Rlc3QtYXV0aC1oZWxwZXInO1xuaW1wb3J0IHsgZ2V0VGVzdFByaXNtYUNsaWVudCB9IGZyb20gJy4uL2plc3Quc2V0dXAnO1xuaW1wb3J0IHsgc2V0dXBBdXRoZW50aWNhdGVkVGVzdCB9IGZyb20gJy4vdGVzdC1zZXR1cC1oZWxwZXJzJztcblxuZGVzY3JpYmUoJ2NhbGVuZGFyIGV2ZW50cycsICgpID0+IHtcbiAgY29uc3QgYXV0aCA9IGF1dGhSZXF1ZXN0KGFwcCk7XG4gIGxldCBwcmlzbWE6IFJldHVyblR5cGU8dHlwZW9mIGdldFRlc3RQcmlzbWFDbGllbnQ+O1xuXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgcHJpc21hID0gZ2V0VGVzdFByaXNtYUNsaWVudCgpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBTZXR1cCBhdXRoIGZvciBlYWNoIHRlc3QgdG8gaGFuZGxlIGRhdGFiYXNlIHJlc2V0c1xuICAgIGF3YWl0IHNldHVwQXV0aGVudGljYXRlZFRlc3QocHJpc21hLCBhdXRoKTtcbiAgfSk7XG5cbiAgaXQoJ2NyZWF0ZXMgYW5kIGxpc3RzIGV2ZW50cycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvY2FsZW5kYXItZXZlbnRzJykuc2VuZCh7XG4gICAgICB0aXRsZTogJ1BEIERheScsXG4gICAgICBzdGFydDogJzIwMjUtMDEtMDJUMDA6MDA6MDAuMDAwWicsXG4gICAgICBlbmQ6ICcyMDI1LTAxLTAyVDIzOjU5OjU5LjAwMFonLFxuICAgICAgYWxsRGF5OiB0cnVlLFxuICAgICAgZXZlbnRUeXBlOiAnUERfREFZJyxcbiAgICB9KTtcbiAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDEpO1xuXG4gICAgY29uc3QgbGlzdCA9IGF3YWl0IGF1dGguZ2V0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cz9mcm9tPTIwMjUtMDEtMDEmdG89MjAyNS0wMS0wMycpO1xuICAgIGV4cGVjdChsaXN0LnN0YXR1cykudG9CZSgyMDApO1xuICAgIGV4cGVjdChsaXN0LmJvZHkubGVuZ3RoKS50b0JlKDEpO1xuICAgIGV4cGVjdChsaXN0LmJvZHlbMF0udGl0bGUpLnRvQmUoJ1BEIERheScpO1xuICB9KTtcblxuICBpdCgnaGFuZGxlcyBkYXRlIHJhbmdlIHF1ZXJpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIGV2ZW50cyBpbiBkaWZmZXJlbnQgZGF0ZSByYW5nZXNcbiAgICBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvY2FsZW5kYXItZXZlbnRzJykuc2VuZCh7XG4gICAgICB0aXRsZTogJ0V2ZW50IDEnLFxuICAgICAgc3RhcnQ6ICcyMDI1LTAxLTA1VDAwOjAwOjAwLjAwMFonLFxuICAgICAgZW5kOiAnMjAyNS0wMS0wNVQyMzo1OTo1OS4wMDBaJyxcbiAgICAgIGFsbERheTogdHJ1ZSxcbiAgICAgIGV2ZW50VHlwZTogJ0hPTElEQVknLFxuICAgIH0pO1xuXG4gICAgYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cycpLnNlbmQoe1xuICAgICAgdGl0bGU6ICdFdmVudCAyJyxcbiAgICAgIHN0YXJ0OiAnMjAyNS0wMS0xNVQwMDowMDowMC4wMDBaJyxcbiAgICAgIGVuZDogJzIwMjUtMDEtMTVUMjM6NTk6NTkuMDAwWicsXG4gICAgICBhbGxEYXk6IHRydWUsXG4gICAgICBldmVudFR5cGU6ICdIT0xJREFZJyxcbiAgICB9KTtcblxuICAgIC8vIFF1ZXJ5IGZvciBzcGVjaWZpYyBkYXRlIHJhbmdlXG4gICAgY29uc3QgbGlzdCA9IGF3YWl0IGF1dGguZ2V0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cz9mcm9tPTIwMjUtMDEtMTAmdG89MjAyNS0wMS0yMCcpO1xuICAgIGV4cGVjdChsaXN0LnN0YXR1cykudG9CZSgyMDApO1xuICAgIGV4cGVjdChsaXN0LmJvZHkubGVuZ3RoKS50b0JlKDEpO1xuICAgIGV4cGVjdChsaXN0LmJvZHlbMF0udGl0bGUpLnRvQmUoJ0V2ZW50IDInKTtcbiAgfSk7XG5cbiAgaXQoJ3VwZGF0ZXMgY2FsZW5kYXIgZXZlbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIENyZWF0ZSBhbiBldmVudFxuICAgIGNvbnN0IGNyZWF0ZVJlcyA9IGF3YWl0IGF1dGgucG9zdCgnL2FwaS9jYWxlbmRhci1ldmVudHMnKS5zZW5kKHtcbiAgICAgIHRpdGxlOiAnT3JpZ2luYWwgVGl0bGUnLFxuICAgICAgc3RhcnQ6ICcyMDI1LTAyLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgZW5kOiAnMjAyNS0wMi0wMVQyMzo1OTo1OS4wMDBaJyxcbiAgICAgIGFsbERheTogdHJ1ZSxcbiAgICAgIGV2ZW50VHlwZTogJ0hPTElEQVknLFxuICAgIH0pO1xuICAgIGV4cGVjdChjcmVhdGVSZXMuc3RhdHVzKS50b0JlKDIwMSk7XG4gICAgY29uc3QgZXZlbnRJZCA9IGNyZWF0ZVJlcy5ib2R5LmlkO1xuXG4gICAgLy8gVXBkYXRlIHRoZSBldmVudFxuICAgIGNvbnN0IHVwZGF0ZVJlcyA9IGF3YWl0IGF1dGgucHV0KGAvYXBpL2NhbGVuZGFyLWV2ZW50cy8ke2V2ZW50SWR9YCkuc2VuZCh7XG4gICAgICB0aXRsZTogJ1VwZGF0ZWQgVGl0bGUnLFxuICAgICAgZXZlbnRUeXBlOiAnUERfREFZJyxcbiAgICB9KTtcbiAgICBleHBlY3QodXBkYXRlUmVzLnN0YXR1cykudG9CZSgyMDApO1xuICAgIGV4cGVjdCh1cGRhdGVSZXMuYm9keS50aXRsZSkudG9CZSgnVXBkYXRlZCBUaXRsZScpO1xuICAgIGV4cGVjdCh1cGRhdGVSZXMuYm9keS5ldmVudFR5cGUpLnRvQmUoJ1BEX0RBWScpO1xuICB9KTtcblxuICBpdCgnZGVsZXRlcyBjYWxlbmRhciBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIGFuIGV2ZW50XG4gICAgY29uc3QgY3JlYXRlUmVzID0gYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cycpLnNlbmQoe1xuICAgICAgdGl0bGU6ICdUbyBEZWxldGUnLFxuICAgICAgc3RhcnQ6ICcyMDI1LTAzLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgZW5kOiAnMjAyNS0wMy0wMVQyMzo1OTo1OS4wMDBaJyxcbiAgICAgIGFsbERheTogdHJ1ZSxcbiAgICAgIGV2ZW50VHlwZTogJ0hPTElEQVknLFxuICAgIH0pO1xuICAgIGV4cGVjdChjcmVhdGVSZXMuc3RhdHVzKS50b0JlKDIwMSk7XG4gICAgY29uc3QgZXZlbnRJZCA9IGNyZWF0ZVJlcy5ib2R5LmlkO1xuXG4gICAgLy8gRGVsZXRlIHRoZSBldmVudFxuICAgIGNvbnN0IGRlbGV0ZVJlcyA9IGF3YWl0IGF1dGguZGVsZXRlKGAvYXBpL2NhbGVuZGFyLWV2ZW50cy8ke2V2ZW50SWR9YCk7XG4gICAgZXhwZWN0KGRlbGV0ZVJlcy5zdGF0dXMpLnRvQmUoMjA0KTtcblxuICAgIC8vIFZlcmlmeSBpdCdzIGRlbGV0ZWRcbiAgICBjb25zdCBsaXN0ID0gYXdhaXQgYXV0aC5nZXQoJy9hcGkvY2FsZW5kYXItZXZlbnRzP2Zyb209MjAyNS0wMy0wMSZ0bz0yMDI1LTAzLTAxJyk7XG4gICAgZXhwZWN0KGxpc3Quc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgZXhwZWN0KGxpc3QuYm9keS5sZW5ndGgpLnRvQmUoMCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFZGdlIENhc2VzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGRhdGEgc2NlbmFyaW9zIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBRdWVyeSB3aXRoIG5vIGV2ZW50c1xuICAgICAgY29uc3QgbGlzdCA9IGF3YWl0IGF1dGguZ2V0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cz9mcm9tPTIwMzAtMDEtMDEmdG89MjAzMC0xMi0zMScpO1xuICAgICAgZXhwZWN0KGxpc3Quc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QobGlzdC5ib2R5KS50b0VxdWFsKFtdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgZGF0ZSBmb3JtYXRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cycpLnNlbmQoe1xuICAgICAgICB0aXRsZTogJ0ludmFsaWQgRGF0ZSBFdmVudCcsXG4gICAgICAgIHN0YXJ0OiAnaW52YWxpZC1kYXRlJyxcbiAgICAgICAgZW5kOiAnMjAyNS0wMS0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgZXZlbnRUeXBlOiAnSE9MSURBWScsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDQwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBvdmVybGFwcGluZyBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgZmlyc3QgZXZlbnRcbiAgICAgIGF3YWl0IGF1dGgucG9zdCgnL2FwaS9jYWxlbmRhci1ldmVudHMnKS5zZW5kKHtcbiAgICAgICAgdGl0bGU6ICdFdmVudCBBJyxcbiAgICAgICAgc3RhcnQ6ICcyMDI1LTA0LTAxVDEwOjAwOjAwLjAwMFonLFxuICAgICAgICBlbmQ6ICcyMDI1LTA0LTAxVDEyOjAwOjAwLjAwMFonLFxuICAgICAgICBldmVudFR5cGU6ICdDVVNUT00nLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENyZWF0ZSBvdmVybGFwcGluZyBldmVudCAtIHNob3VsZCBzdWNjZWVkXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvY2FsZW5kYXItZXZlbnRzJykuc2VuZCh7XG4gICAgICAgIHRpdGxlOiAnRXZlbnQgQicsXG4gICAgICAgIHN0YXJ0OiAnMjAyNS0wNC0wMVQxMTowMDowMC4wMDBaJyxcbiAgICAgICAgZW5kOiAnMjAyNS0wNC0wMVQxMzowMDowMC4wMDBaJyxcbiAgICAgICAgZXZlbnRUeXBlOiAnQ1VTVE9NJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoMjAxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2NhbGVuZGFyLWV2ZW50cycpLnNlbmQoe1xuICAgICAgICAvLyBNaXNzaW5nIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgICBldmVudFR5cGU6ICdIT0xJREFZJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==