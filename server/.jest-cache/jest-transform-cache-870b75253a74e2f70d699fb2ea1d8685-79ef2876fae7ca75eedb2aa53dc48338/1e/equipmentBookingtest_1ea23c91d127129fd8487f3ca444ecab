3cd8fb3dbc8642578767bb5f429050e4
import { app } from '../../src/index';
import { authRequest } from '../test-auth-helper';
import { getTestPrismaClient } from '../jest.setup';
import { setupAuthenticatedTest } from './test-setup-helpers';
describe('Equipment Booking API', () => {
    let teacherId;
    let prisma;
    const auth = authRequest(app);
    beforeAll(async () => {
        prisma = getTestPrismaClient();
    });
    beforeEach(async () => {
        // Setup auth for each test to handle database resets
        await setupAuthenticatedTest(prisma, auth);
        // Create a teacher for the equipment bookings
        const teacher = await prisma.user.create({
            data: { email: `eb${Date.now()}@e.com`, password: 'x', name: 'EB' },
        });
        teacherId = teacher.id;
    });
    // No need for afterAll cleanup - database is reset after each test
    it('creates and lists bookings', async () => {
        const create = await auth.post('/api/equipment-bookings').send({
            teacherId,
            resourceName: 'iPad Cart',
            neededBy: '2025-03-01T00:00:00.000Z',
            leadTimeDays: 10,
        });
        expect(create.status).toBe(201);
        const list = await auth.get(`/api/equipment-bookings?teacherId=${teacherId}`);
        expect(list.status).toBe(200);
        expect(list.body.length).toBeGreaterThan(0);
    });
    describe('Edge Cases', () => {
        it('should handle empty data scenarios', async () => {
            // Test with missing required fields
            const missingTeacher = await auth.post('/api/equipment-bookings').send({
                resourceName: 'iPad Cart',
                neededBy: '2025-03-01T00:00:00.000Z',
                leadTimeDays: 10,
            });
            expect(missingTeacher.status).toBe(400);
            const missingResource = await auth.post('/api/equipment-bookings').send({
                teacherId,
                neededBy: '2025-03-01T00:00:00.000Z',
                leadTimeDays: 10,
            });
            expect(missingResource.status).toBe(400);
            // Test empty string values
            const emptyResource = await auth.post('/api/equipment-bookings').send({
                teacherId,
                resourceName: '',
                neededBy: '2025-03-01T00:00:00.000Z',
                leadTimeDays: 10,
            });
            expect(emptyResource.status).toBe(400);
        });
        it('should handle maximum data limits', async () => {
            // Test extremely long resource names
            const longResourceName = 'a'.repeat(1000);
            const longName = await auth.post('/api/equipment-bookings').send({
                teacherId,
                resourceName: longResourceName,
                neededBy: '2025-03-01T00:00:00.000Z',
                leadTimeDays: 10,
            });
            expect(longName.status).toBe(400);
            // Test maximum lead time
            const maxLeadTime = await auth.post('/api/equipment-bookings').send({
                teacherId,
                resourceName: 'iPad Cart',
                neededBy: '2025-03-01T00:00:00.000Z',
                leadTimeDays: 999999,
            });
            expect(maxLeadTime.status).toBe(400);
        });
        it('should handle special characters and Unicode', async () => {
            const specialChars = [
                'iPad Cart (franÃ§ais)',
                'Ã‰quipement spÃ©cial',
                'iPad ðŸ“± Cart',
                'Equipment "Quote" Test',
                "Equipment 'Apostrophe' Test",
                'Equipment\\BackslashTest',
                'Equipment%PercentTest',
            ];
            for (const resourceName of specialChars) {
                const response = await auth.post('/api/equipment-bookings').send({
                    teacherId,
                    resourceName,
                    neededBy: '2025-03-01T00:00:00.000Z',
                    leadTimeDays: 5,
                });
                // Should handle special characters gracefully
                expect([200, 201, 400]).toContain(response.status);
            }
        });
        it('should handle invalid date formats', async () => {
            const invalidDates = [
                'invalid-date',
                '2025-13-01T00:00:00.000Z', // Invalid month
                '2025-02-30T00:00:00.000Z', // Invalid day
                '2025-01-01T25:00:00.000Z', // Invalid hour
                '2025-01-01', // Missing time
                '', // Empty string
                null, // Null value
                undefined, // Undefined value
            ];
            for (const date of invalidDates) {
                const response = await auth.post('/api/equipment-bookings').send({
                    teacherId,
                    resourceName: 'iPad Cart',
                    neededBy: date,
                    leadTimeDays: 10,
                });
                expect(response.status).toBe(400);
            }
        });
        it('should handle past dates', async () => {
            const pastDate = new Date('2020-01-01T00:00:00.000Z');
            const response = await auth.post('/api/equipment-bookings').send({
                teacherId,
                resourceName: 'iPad Cart',
                neededBy: pastDate.toISOString(),
                leadTimeDays: 10,
            });
            expect(response.status).toBe(400);
        });
        it('should handle negative and zero values', async () => {
            // Test negative lead time
            const negativeLeadTime = await auth.post('/api/equipment-bookings').send({
                teacherId,
                resourceName: 'iPad Cart',
                neededBy: '2025-03-01T00:00:00.000Z',
                leadTimeDays: -5,
            });
            expect(negativeLeadTime.status).toBe(400);
            // Test zero lead time
            const zeroLeadTime = await auth.post('/api/equipment-bookings').send({
                teacherId,
                resourceName: 'iPad Cart',
                neededBy: '2025-03-01T00:00:00.000Z',
                leadTimeDays: 0,
            });
            expect([200, 201, 400]).toContain(zeroLeadTime.status);
            // Test negative teacher ID
            const negativeTeacher = await auth.post('/api/equipment-bookings').send({
                teacherId: -1,
                resourceName: 'iPad Cart',
                neededBy: '2025-03-01T00:00:00.000Z',
                leadTimeDays: 10,
            });
            expect(negativeTeacher.status).toBe(400);
        });
        it('should handle concurrent booking requests', async () => {
            const bookingData = {
                teacherId,
                resourceName: 'Shared iPad Cart',
                neededBy: '2025-04-01T00:00:00.000Z',
                leadTimeDays: 10,
            };
            // Create multiple concurrent booking requests
            const concurrentRequests = Array.from({ length: 5 }, () => auth.post('/api/equipment-bookings').send(bookingData));
            const responses = await Promise.all(concurrentRequests);
            // At least one should succeed
            const successfulRequests = responses.filter((r) => r.status === 201);
            expect(successfulRequests.length).toBeGreaterThan(0);
        });
        it('should handle extreme numeric values', async () => {
            const extremeValues = [
                Number.MAX_SAFE_INTEGER,
                Number.MIN_SAFE_INTEGER,
                Infinity,
                -Infinity,
                NaN,
            ];
            for (const value of extremeValues) {
                const response = await auth.post('/api/equipment-bookings').send({
                    teacherId: value,
                    resourceName: 'iPad Cart',
                    neededBy: '2025-03-01T00:00:00.000Z',
                    leadTimeDays: 10,
                });
                expect(response.status).toBe(400);
            }
        });
        it('should handle malformed JSON and request bodies', async () => {
            // Test with invalid JSON structure
            const malformedRequests = [
                { teacherId: 'not-a-number' },
                { leadTimeDays: 'not-a-number' },
                { neededBy: 12345 }, // Number instead of string
                { additionalField: 'should-be-ignored' },
            ];
            for (const data of malformedRequests) {
                const response = await auth.post('/api/equipment-bookings').send({
                    ...data,
                    teacherId: data.teacherId || teacherId,
                    resourceName: 'iPad Cart',
                    neededBy: data.neededBy || '2025-03-01T00:00:00.000Z',
                    leadTimeDays: data.leadTimeDays || 10,
                });
                // Should handle malformed data gracefully
                expect([200, 201, 400]).toContain(response.status);
            }
        });
        it('should handle timezone edge cases', async () => {
            const timezoneTestCases = [
                '2025-03-01T00:00:00.000Z', // UTC
                '2025-03-01T05:00:00.000-05:00', // EST
                '2025-03-01T23:59:59.999Z', // End of day UTC
                '2025-03-01T00:00:00.001Z', // Start of day UTC
            ];
            for (const dateString of timezoneTestCases) {
                const response = await auth.post('/api/equipment-bookings').send({
                    teacherId,
                    resourceName: 'Timezone Test Cart',
                    neededBy: dateString,
                    leadTimeDays: 5,
                });
                // Should handle all valid ISO date formats
                expect([200, 201]).toContain(response.status);
            }
        });
        it('should handle leap year and DST transitions', async () => {
            const specialDates = [
                '2024-02-29T00:00:00.000Z', // Leap year
                '2025-03-09T07:00:00.000Z', // DST begins (US)
                '2025-11-02T06:00:00.000Z', // DST ends (US)
                '2025-12-31T23:59:59.999Z', // Year end
                '2026-01-01T00:00:00.000Z', // Year start
            ];
            for (const dateString of specialDates) {
                const response = await auth.post('/api/equipment-bookings').send({
                    teacherId,
                    resourceName: 'Calendar Edge Case Cart',
                    neededBy: dateString,
                    leadTimeDays: 7,
                });
                expect([200, 201]).toContain(response.status);
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL2ludGVncmF0aW9uL2VxdWlwbWVudEJvb2tpbmcudGVzdC50cyIsIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDdEMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwRCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUU5RCxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ3JDLElBQUksU0FBaUIsQ0FBQztJQUN0QixJQUFJLE1BQThDLENBQUM7SUFDbkQsTUFBTSxJQUFJLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRTlCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixNQUFNLEdBQUcsbUJBQW1CLEVBQUUsQ0FBQztJQUNqQyxDQUFDLENBQUMsQ0FBQztJQUVILFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixxREFBcUQ7UUFDckQsTUFBTSxzQkFBc0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFM0MsOENBQThDO1FBQzlDLE1BQU0sT0FBTyxHQUFHLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDdkMsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLEtBQUssSUFBSSxDQUFDLEdBQUcsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFO1NBQ3BFLENBQUMsQ0FBQztRQUNILFNBQVMsR0FBRyxPQUFPLENBQUMsRUFBRSxDQUFDO0lBQ3pCLENBQUMsQ0FBQyxDQUFDO0lBRUgsbUVBQW1FO0lBRW5FLEVBQUUsQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLElBQUksRUFBRTtR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TSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNoRCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkNBQTZDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0QsTUFBTSxZQUFZLEdBQUc7Z0JBQ25CLDBCQUEwQixFQUFFLFlBQVk7Z0JBQ3hDLDBCQUEwQixFQUFFLGtCQUFrQjtnQkFDOUMsMEJBQTBCLEVBQUUsZ0JBQWdCO2dCQUM1QywwQkFBMEIsRUFBRSxXQUFXO2dCQUN2QywwQkFBMEIsRUFBRSxhQUFhO2FBQzFDLENBQUM7WUFFRixLQUFLLE1BQU0sVUFBVSxJQUFJLFlBQVksRUFBRSxDQUFDO2dCQUN0QyxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQy9ELFNBQVM7b0JBQ1QsWUFBWSxFQUFFLHlCQUF5QjtvQkFDdkMsUUFBUSxFQUFFLFVBQVU7b0JBQ3BCLFlBQVksRUFBRSxDQUFDO2lCQUNoQixDQUFDLENBQUM7Z0JBRUgsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNoRCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWNoYWVsbWNpc2FhYy9HaXRIdWIvdGVhY2hpbmctZW5naW5lMi4wL3NlcnZlci90ZXN0cy9pbnRlZ3JhdGlvbi9lcXVpcG1lbnRCb29raW5nLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXBwIH0gZnJvbSAnLi4vLi4vc3JjL2luZGV4JztcbmltcG9ydCB7IGF1dGhSZXF1ZXN0IH0gZnJvbSAnLi4vdGVzdC1hdXRoLWhlbHBlcic7XG5pbXBvcnQgeyBnZXRUZXN0UHJpc21hQ2xpZW50IH0gZnJvbSAnLi4vamVzdC5zZXR1cCc7XG5pbXBvcnQgeyBzZXR1cEF1dGhlbnRpY2F0ZWRUZXN0IH0gZnJvbSAnLi90ZXN0LXNldHVwLWhlbHBlcnMnO1xuXG5kZXNjcmliZSgnRXF1aXBtZW50IEJvb2tpbmcgQVBJJywgKCkgPT4ge1xuICBsZXQgdGVhY2hlcklkOiBudW1iZXI7XG4gIGxldCBwcmlzbWE6IFJldHVyblR5cGU8dHlwZW9mIGdldFRlc3RQcmlzbWFDbGllbnQ+O1xuICBjb25zdCBhdXRoID0gYXV0aFJlcXVlc3QoYXBwKTtcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIHByaXNtYSA9IGdldFRlc3RQcmlzbWFDbGllbnQoKTtcbiAgfSk7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gU2V0dXAgYXV0aCBmb3IgZWFjaCB0ZXN0IHRvIGhhbmRsZSBkYXRhYmFzZSByZXNldHNcbiAgICBhd2FpdCBzZXR1cEF1dGhlbnRpY2F0ZWRUZXN0KHByaXNtYSwgYXV0aCk7XG5cbiAgICAvLyBDcmVhdGUgYSB0ZWFjaGVyIGZvciB0aGUgZXF1aXBtZW50IGJvb2tpbmdzXG4gICAgY29uc3QgdGVhY2hlciA9IGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7IGVtYWlsOiBgZWIke0RhdGUubm93KCl9QGUuY29tYCwgcGFzc3dvcmQ6ICd4JywgbmFtZTogJ0VCJyB9LFxuICAgIH0pO1xuICAgIHRlYWNoZXJJZCA9IHRlYWNoZXIuaWQ7XG4gIH0pO1xuXG4gIC8vIE5vIG5lZWQgZm9yIGFmdGVyQWxsIGNsZWFudXAgLSBkYXRhYmFzZSBpcyByZXNldCBhZnRlciBlYWNoIHRlc3RcblxuICBpdCgnY3JlYXRlcyBhbmQgbGlzdHMgYm9va2luZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgY3JlYXRlID0gYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2VxdWlwbWVudC1ib29raW5ncycpLnNlbmQoe1xuICAgICAgdGVhY2hlcklkLFxuICAgICAgcmVzb3VyY2VOYW1lOiAnaVBhZCBDYXJ0JyxcbiAgICAgIG5lZWRlZEJ5OiAnMjAyNS0wMy0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgIGxlYWRUaW1lRGF5czogMTAsXG4gICAgfSk7XG4gICAgZXhwZWN0KGNyZWF0ZS5zdGF0dXMpLnRvQmUoMjAxKTtcbiAgICBjb25zdCBsaXN0ID0gYXdhaXQgYXV0aC5nZXQoYC9hcGkvZXF1aXBtZW50LWJvb2tpbmdzP3RlYWNoZXJJZD0ke3RlYWNoZXJJZH1gKTtcbiAgICBleHBlY3QobGlzdC5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICBleHBlY3QobGlzdC5ib2R5Lmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICB9KTtcblxuICBkZXNjcmliZSgnRWRnZSBDYXNlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBkYXRhIHNjZW5hcmlvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3Qgd2l0aCBtaXNzaW5nIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgY29uc3QgbWlzc2luZ1RlYWNoZXIgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvZXF1aXBtZW50LWJvb2tpbmdzJykuc2VuZCh7XG4gICAgICAgIHJlc291cmNlTmFtZTogJ2lQYWQgQ2FydCcsXG4gICAgICAgIG5lZWRlZEJ5OiAnMjAyNS0wMy0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgbGVhZFRpbWVEYXlzOiAxMCxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG1pc3NpbmdUZWFjaGVyLnN0YXR1cykudG9CZSg0MDApO1xuXG4gICAgICBjb25zdCBtaXNzaW5nUmVzb3VyY2UgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvZXF1aXBtZW50LWJvb2tpbmdzJykuc2VuZCh7XG4gICAgICAgIHRlYWNoZXJJZCxcbiAgICAgICAgbmVlZGVkQnk6ICcyMDI1LTAzLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICBsZWFkVGltZURheXM6IDEwLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QobWlzc2luZ1Jlc291cmNlLnN0YXR1cykudG9CZSg0MDApO1xuXG4gICAgICAvLyBUZXN0IGVtcHR5IHN0cmluZyB2YWx1ZXNcbiAgICAgIGNvbnN0IGVtcHR5UmVzb3VyY2UgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvZXF1aXBtZW50LWJvb2tpbmdzJykuc2VuZCh7XG4gICAgICAgIHRlYWNoZXJJZCxcbiAgICAgICAgcmVzb3VyY2VOYW1lOiAnJyxcbiAgICAgICAgbmVlZGVkQnk6ICcyMDI1LTAzLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICBsZWFkVGltZURheXM6IDEwLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoZW1wdHlSZXNvdXJjZS5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1heGltdW0gZGF0YSBsaW1pdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IGV4dHJlbWVseSBsb25nIHJlc291cmNlIG5hbWVzXG4gICAgICBjb25zdCBsb25nUmVzb3VyY2VOYW1lID0gJ2EnLnJlcGVhdCgxMDAwKTtcbiAgICAgIGNvbnN0IGxvbmdOYW1lID0gYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2VxdWlwbWVudC1ib29raW5ncycpLnNlbmQoe1xuICAgICAgICB0ZWFjaGVySWQsXG4gICAgICAgIHJlc291cmNlTmFtZTogbG9uZ1Jlc291cmNlTmFtZSxcbiAgICAgICAgbmVlZGVkQnk6ICcyMDI1LTAzLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICBsZWFkVGltZURheXM6IDEwLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QobG9uZ05hbWUuc3RhdHVzKS50b0JlKDQwMCk7XG5cbiAgICAgIC8vIFRlc3QgbWF4aW11bSBsZWFkIHRpbWVcbiAgICAgIGNvbnN0IG1heExlYWRUaW1lID0gYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2VxdWlwbWVudC1ib29raW5ncycpLnNlbmQoe1xuICAgICAgICB0ZWFjaGVySWQsXG4gICAgICAgIHJlc291cmNlTmFtZTogJ2lQYWQgQ2FydCcsXG4gICAgICAgIG5lZWRlZEJ5OiAnMjAyNS0wMy0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgbGVhZFRpbWVEYXlzOiA5OTk5OTksXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtYXhMZWFkVGltZS5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNwZWNpYWwgY2hhcmFjdGVycyBhbmQgVW5pY29kZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNwZWNpYWxDaGFycyA9IFtcbiAgICAgICAgJ2lQYWQgQ2FydCAoZnJhbsOnYWlzKScsXG4gICAgICAgICfDiXF1aXBlbWVudCBzcMOpY2lhbCcsXG4gICAgICAgICdpUGFkIPCfk7EgQ2FydCcsXG4gICAgICAgICdFcXVpcG1lbnQgXCJRdW90ZVwiIFRlc3QnLFxuICAgICAgICBcIkVxdWlwbWVudCAnQXBvc3Ryb3BoZScgVGVzdFwiLFxuICAgICAgICAnRXF1aXBtZW50XFxcXEJhY2tzbGFzaFRlc3QnLFxuICAgICAgICAnRXF1aXBtZW50JVBlcmNlbnRUZXN0JyxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgcmVzb3VyY2VOYW1lIG9mIHNwZWNpYWxDaGFycykge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF1dGgucG9zdCgnL2FwaS9lcXVpcG1lbnQtYm9va2luZ3MnKS5zZW5kKHtcbiAgICAgICAgICB0ZWFjaGVySWQsXG4gICAgICAgICAgcmVzb3VyY2VOYW1lLFxuICAgICAgICAgIG5lZWRlZEJ5OiAnMjAyNS0wMy0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgICBsZWFkVGltZURheXM6IDUsXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBTaG91bGQgaGFuZGxlIHNwZWNpYWwgY2hhcmFjdGVycyBncmFjZWZ1bGx5XG4gICAgICAgIGV4cGVjdChbMjAwLCAyMDEsIDQwMF0pLnRvQ29udGFpbihyZXNwb25zZS5zdGF0dXMpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCBkYXRlIGZvcm1hdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkRGF0ZXMgPSBbXG4gICAgICAgICdpbnZhbGlkLWRhdGUnLFxuICAgICAgICAnMjAyNS0xMy0wMVQwMDowMDowMC4wMDBaJywgLy8gSW52YWxpZCBtb250aFxuICAgICAgICAnMjAyNS0wMi0zMFQwMDowMDowMC4wMDBaJywgLy8gSW52YWxpZCBkYXlcbiAgICAgICAgJzIwMjUtMDEtMDFUMjU6MDA6MDAuMDAwWicsIC8vIEludmFsaWQgaG91clxuICAgICAgICAnMjAyNS0wMS0wMScsIC8vIE1pc3NpbmcgdGltZVxuICAgICAgICAnJywgLy8gRW1wdHkgc3RyaW5nXG4gICAgICAgIG51bGwsIC8vIE51bGwgdmFsdWVcbiAgICAgICAgdW5kZWZpbmVkLCAvLyBVbmRlZmluZWQgdmFsdWVcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgZGF0ZSBvZiBpbnZhbGlkRGF0ZXMpIHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvZXF1aXBtZW50LWJvb2tpbmdzJykuc2VuZCh7XG4gICAgICAgICAgdGVhY2hlcklkLFxuICAgICAgICAgIHJlc291cmNlTmFtZTogJ2lQYWQgQ2FydCcsXG4gICAgICAgICAgbmVlZGVkQnk6IGRhdGUsXG4gICAgICAgICAgbGVhZFRpbWVEYXlzOiAxMCxcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBhc3QgZGF0ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXN0RGF0ZSA9IG5ldyBEYXRlKCcyMDIwLTAxLTAxVDAwOjAwOjAwLjAwMFonKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2VxdWlwbWVudC1ib29raW5ncycpLnNlbmQoe1xuICAgICAgICB0ZWFjaGVySWQsXG4gICAgICAgIHJlc291cmNlTmFtZTogJ2lQYWQgQ2FydCcsXG4gICAgICAgIG5lZWRlZEJ5OiBwYXN0RGF0ZS50b0lTT1N0cmluZygpLFxuICAgICAgICBsZWFkVGltZURheXM6IDEwLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDQwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBuZWdhdGl2ZSBhbmQgemVybyB2YWx1ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IG5lZ2F0aXZlIGxlYWQgdGltZVxuICAgICAgY29uc3QgbmVnYXRpdmVMZWFkVGltZSA9IGF3YWl0IGF1dGgucG9zdCgnL2FwaS9lcXVpcG1lbnQtYm9va2luZ3MnKS5zZW5kKHtcbiAgICAgICAgdGVhY2hlcklkLFxuICAgICAgICByZXNvdXJjZU5hbWU6ICdpUGFkIENhcnQnLFxuICAgICAgICBuZWVkZWRCeTogJzIwMjUtMDMtMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICAgIGxlYWRUaW1lRGF5czogLTUsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChuZWdhdGl2ZUxlYWRUaW1lLnN0YXR1cykudG9CZSg0MDApO1xuXG4gICAgICAvLyBUZXN0IHplcm8gbGVhZCB0aW1lXG4gICAgICBjb25zdCB6ZXJvTGVhZFRpbWUgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvZXF1aXBtZW50LWJvb2tpbmdzJykuc2VuZCh7XG4gICAgICAgIHRlYWNoZXJJZCxcbiAgICAgICAgcmVzb3VyY2VOYW1lOiAnaVBhZCBDYXJ0JyxcbiAgICAgICAgbmVlZGVkQnk6ICcyMDI1LTAzLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICBsZWFkVGltZURheXM6IDAsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChbMjAwLCAyMDEsIDQwMF0pLnRvQ29udGFpbih6ZXJvTGVhZFRpbWUuc3RhdHVzKTtcblxuICAgICAgLy8gVGVzdCBuZWdhdGl2ZSB0ZWFjaGVyIElEXG4gICAgICBjb25zdCBuZWdhdGl2ZVRlYWNoZXIgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvZXF1aXBtZW50LWJvb2tpbmdzJykuc2VuZCh7XG4gICAgICAgIHRlYWNoZXJJZDogLTEsXG4gICAgICAgIHJlc291cmNlTmFtZTogJ2lQYWQgQ2FydCcsXG4gICAgICAgIG5lZWRlZEJ5OiAnMjAyNS0wMy0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgbGVhZFRpbWVEYXlzOiAxMCxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG5lZ2F0aXZlVGVhY2hlci5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgYm9va2luZyByZXF1ZXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJvb2tpbmdEYXRhID0ge1xuICAgICAgICB0ZWFjaGVySWQsXG4gICAgICAgIHJlc291cmNlTmFtZTogJ1NoYXJlZCBpUGFkIENhcnQnLFxuICAgICAgICBuZWVkZWRCeTogJzIwMjUtMDQtMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICAgIGxlYWRUaW1lRGF5czogMTAsXG4gICAgICB9O1xuXG4gICAgICAvLyBDcmVhdGUgbXVsdGlwbGUgY29uY3VycmVudCBib29raW5nIHJlcXVlc3RzXG4gICAgICBjb25zdCBjb25jdXJyZW50UmVxdWVzdHMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiA1IH0sICgpID0+XG4gICAgICAgIGF1dGgucG9zdCgnL2FwaS9lcXVpcG1lbnQtYm9va2luZ3MnKS5zZW5kKGJvb2tpbmdEYXRhKSxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlcyA9IGF3YWl0IFByb21pc2UuYWxsKGNvbmN1cnJlbnRSZXF1ZXN0cyk7XG5cbiAgICAgIC8vIEF0IGxlYXN0IG9uZSBzaG91bGQgc3VjY2VlZFxuICAgICAgY29uc3Qgc3VjY2Vzc2Z1bFJlcXVlc3RzID0gcmVzcG9uc2VzLmZpbHRlcigocikgPT4gci5zdGF0dXMgPT09IDIwMSk7XG4gICAgICBleHBlY3Qoc3VjY2Vzc2Z1bFJlcXVlc3RzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZXh0cmVtZSBudW1lcmljIHZhbHVlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV4dHJlbWVWYWx1ZXMgPSBbXG4gICAgICAgIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSLFxuICAgICAgICBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUixcbiAgICAgICAgSW5maW5pdHksXG4gICAgICAgIC1JbmZpbml0eSxcbiAgICAgICAgTmFOLFxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiBleHRyZW1lVmFsdWVzKSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXV0aC5wb3N0KCcvYXBpL2VxdWlwbWVudC1ib29raW5ncycpLnNlbmQoe1xuICAgICAgICAgIHRlYWNoZXJJZDogdmFsdWUsXG4gICAgICAgICAgcmVzb3VyY2VOYW1lOiAnaVBhZCBDYXJ0JyxcbiAgICAgICAgICBuZWVkZWRCeTogJzIwMjUtMDMtMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICAgICAgbGVhZFRpbWVEYXlzOiAxMCxcbiAgICAgICAgfSk7XG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1hbGZvcm1lZCBKU09OIGFuZCByZXF1ZXN0IGJvZGllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3Qgd2l0aCBpbnZhbGlkIEpTT04gc3RydWN0dXJlXG4gICAgICBjb25zdCBtYWxmb3JtZWRSZXF1ZXN0cyA9IFtcbiAgICAgICAgeyB0ZWFjaGVySWQ6ICdub3QtYS1udW1iZXInIH0sXG4gICAgICAgIHsgbGVhZFRpbWVEYXlzOiAnbm90LWEtbnVtYmVyJyB9LFxuICAgICAgICB7IG5lZWRlZEJ5OiAxMjM0NSB9LCAvLyBOdW1iZXIgaW5zdGVhZCBvZiBzdHJpbmdcbiAgICAgICAgeyBhZGRpdGlvbmFsRmllbGQ6ICdzaG91bGQtYmUtaWdub3JlZCcgfSxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgZGF0YSBvZiBtYWxmb3JtZWRSZXF1ZXN0cykge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF1dGgucG9zdCgnL2FwaS9lcXVpcG1lbnQtYm9va2luZ3MnKS5zZW5kKHtcbiAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgIHRlYWNoZXJJZDogZGF0YS50ZWFjaGVySWQgfHwgdGVhY2hlcklkLFxuICAgICAgICAgIHJlc291cmNlTmFtZTogJ2lQYWQgQ2FydCcsXG4gICAgICAgICAgbmVlZGVkQnk6IGRhdGEubmVlZGVkQnkgfHwgJzIwMjUtMDMtMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICAgICAgbGVhZFRpbWVEYXlzOiBkYXRhLmxlYWRUaW1lRGF5cyB8fCAxMCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgZGF0YSBncmFjZWZ1bGx5XG4gICAgICAgIGV4cGVjdChbMjAwLCAyMDEsIDQwMF0pLnRvQ29udGFpbihyZXNwb25zZS5zdGF0dXMpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdGltZXpvbmUgZWRnZSBjYXNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRpbWV6b25lVGVzdENhc2VzID0gW1xuICAgICAgICAnMjAyNS0wMy0wMVQwMDowMDowMC4wMDBaJywgLy8gVVRDXG4gICAgICAgICcyMDI1LTAzLTAxVDA1OjAwOjAwLjAwMC0wNTowMCcsIC8vIEVTVFxuICAgICAgICAnMjAyNS0wMy0wMVQyMzo1OTo1OS45OTlaJywgLy8gRW5kIG9mIGRheSBVVENcbiAgICAgICAgJzIwMjUtMDMtMDFUMDA6MDA6MDAuMDAxWicsIC8vIFN0YXJ0IG9mIGRheSBVVENcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgZGF0ZVN0cmluZyBvZiB0aW1lem9uZVRlc3RDYXNlcykge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF1dGgucG9zdCgnL2FwaS9lcXVpcG1lbnQtYm9va2luZ3MnKS5zZW5kKHtcbiAgICAgICAgICB0ZWFjaGVySWQsXG4gICAgICAgICAgcmVzb3VyY2VOYW1lOiAnVGltZXpvbmUgVGVzdCBDYXJ0JyxcbiAgICAgICAgICBuZWVkZWRCeTogZGF0ZVN0cmluZyxcbiAgICAgICAgICBsZWFkVGltZURheXM6IDUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNob3VsZCBoYW5kbGUgYWxsIHZhbGlkIElTTyBkYXRlIGZvcm1hdHNcbiAgICAgICAgZXhwZWN0KFsyMDAsIDIwMV0pLnRvQ29udGFpbihyZXNwb25zZS5zdGF0dXMpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbGVhcCB5ZWFyIGFuZCBEU1QgdHJhbnNpdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzcGVjaWFsRGF0ZXMgPSBbXG4gICAgICAgICcyMDI0LTAyLTI5VDAwOjAwOjAwLjAwMFonLCAvLyBMZWFwIHllYXJcbiAgICAgICAgJzIwMjUtMDMtMDlUMDc6MDA6MDAuMDAwWicsIC8vIERTVCBiZWdpbnMgKFVTKVxuICAgICAgICAnMjAyNS0xMS0wMlQwNjowMDowMC4wMDBaJywgLy8gRFNUIGVuZHMgKFVTKVxuICAgICAgICAnMjAyNS0xMi0zMVQyMzo1OTo1OS45OTlaJywgLy8gWWVhciBlbmRcbiAgICAgICAgJzIwMjYtMDEtMDFUMDA6MDA6MDAuMDAwWicsIC8vIFllYXIgc3RhcnRcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgZGF0ZVN0cmluZyBvZiBzcGVjaWFsRGF0ZXMpIHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhdXRoLnBvc3QoJy9hcGkvZXF1aXBtZW50LWJvb2tpbmdzJykuc2VuZCh7XG4gICAgICAgICAgdGVhY2hlcklkLFxuICAgICAgICAgIHJlc291cmNlTmFtZTogJ0NhbGVuZGFyIEVkZ2UgQ2FzZSBDYXJ0JyxcbiAgICAgICAgICBuZWVkZWRCeTogZGF0ZVN0cmluZyxcbiAgICAgICAgICBsZWFkVGltZURheXM6IDcsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGV4cGVjdChbMjAwLCAyMDFdKS50b0NvbnRhaW4ocmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==