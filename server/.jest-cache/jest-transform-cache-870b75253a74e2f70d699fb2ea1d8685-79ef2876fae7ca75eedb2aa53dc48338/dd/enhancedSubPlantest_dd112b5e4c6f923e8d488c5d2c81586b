7f4467f6f9ea0130d3920c5637c28927
import { describe, it, expect, beforeAll, afterAll, beforeEach } from 'vitest';
import request from 'supertest';
import { app } from '../../src/index';
import { prisma } from '../../src/prisma';
import { TestDatabaseManager } from '../test-database-manager';
describe('Enhanced Sub Plan API', () => {
    let testDb;
    let testUser;
    beforeAll(async () => {
        testDb = new TestDatabaseManager();
        await testDb.setup();
    });
    afterAll(async () => {
        await testDb.teardown();
    });
    beforeEach(async () => {
        await testDb.reset();
        // Create test user
        testUser = await prisma.user.create({
            data: {
                email: 'teacher@school.com',
                password: 'password',
                name: 'Test Teacher',
                role: 'teacher'
            }
        });
        // Create test class routines
        await prisma.classRoutine.createMany({
            data: [
                {
                    userId: testUser.id,
                    title: 'Morning Circle',
                    description: 'Students gather in a circle for morning greeting and calendar time',
                    category: 'morning',
                    timeOfDay: '9:00 AM',
                    priority: 10,
                    isActive: true
                },
                {
                    userId: testUser.id,
                    title: 'Line Up Procedure',
                    description: 'Students line up by door 3 after recess',
                    category: 'transition',
                    priority: 5,
                    isActive: true
                },
                {
                    userId: testUser.id,
                    title: 'Emergency Evacuation',
                    description: 'Exit through west door, meet at flag pole',
                    category: 'emergency',
                    priority: 15,
                    isActive: true
                }
            ]
        });
        // Create test students with goals
        const student1 = await prisma.student.create({
            data: {
                userId: testUser.id,
                firstName: 'Emma',
                lastName: 'Johnson',
                grade: 2
            }
        });
        const student2 = await prisma.student.create({
            data: {
                userId: testUser.id,
                firstName: 'Liam',
                lastName: 'Smith',
                grade: 2
            }
        });
        // Create test goals
        await prisma.studentGoal.createMany({
            data: [
                {
                    studentId: student1.id,
                    text: 'Identify character feelings in stories',
                    status: 'active'
                },
                {
                    studentId: student2.id,
                    text: 'Use doubles strategies for addition',
                    status: 'active'
                }
            ]
        });
    });
    describe('POST /api/sub-plan/generate', () => {
        it('should generate sub plan with all features included', async () => {
            const options = {
                date: '2025-04-12',
                days: 1,
                includeGoals: true,
                includeRoutines: true,
                includePlans: true,
                anonymize: false,
                userId: testUser.id
            };
            const response = await request(app)
                .post('/api/sub-plan/generate')
                .set('Authorization', `Bearer ${global.testToken}`)
                .send(options)
                .expect(200);
            expect(response.headers['content-type']).toBe('application/pdf');
            expect(response.body).toBeDefined();
        });
        it('should generate anonymized sub plan', async () => {
            const options = {
                date: '2025-04-12',
                days: 1,
                includeGoals: true,
                includeRoutines: true,
                includePlans: true,
                anonymize: true,
                userId: testUser.id
            };
            const response = await request(app)
                .post('/api/sub-plan/generate')
                .set('Authorization', `Bearer ${global.testToken}`)
                .send(options)
                .expect(200);
            expect(response.headers['content-type']).toBe('application/pdf');
        });
        it('should save sub plan record when requested', async () => {
            const options = {
                date: '2025-04-12',
                days: 1,
                includeGoals: true,
                includeRoutines: true,
                includePlans: true,
                anonymize: false,
                saveRecord: true,
                emailTo: 'substitute@school.com',
                notes: 'Watch for peanut allergies',
                userId: testUser.id
            };
            await request(app)
                .post('/api/sub-plan/generate')
                .set('Authorization', `Bearer ${global.testToken}`)
                .send(options)
                .expect(200);
            const record = await prisma.subPlanRecord.findFirst({
                where: { userId: testUser.id }
            });
            expect(record).toBeDefined();
            expect(record?.emailedTo).toBe('substitute@school.com');
            expect(record?.notes).toBe('Watch for peanut allergies');
        });
    });
    describe('Class Routine Management', () => {
        it('should get all routines for user', async () => {
            const response = await request(app)
                .get('/api/sub-plan/routines')
                .set('Authorization', `Bearer ${global.testToken}`)
                .query({ userId: testUser.id })
                .expect(200);
            expect(response.body).toHaveLength(3);
            expect(response.body[0].title).toBe('Emergency Evacuation'); // Highest priority
        });
        it('should create new routine', async () => {
            const newRoutine = {
                userId: testUser.id,
                title: 'Quiet Signal',
                description: 'Raise hand for quiet, students copy',
                category: 'behavior',
                priority: 8
            };
            const response = await request(app)
                .post('/api/sub-plan/routines')
                .set('Authorization', `Bearer ${global.testToken}`)
                .send(newRoutine)
                .expect(200);
            expect(response.body.id).toBeDefined();
            expect(response.body.title).toBe('Quiet Signal');
        });
        it('should update existing routine', async () => {
            const routine = await prisma.classRoutine.findFirst({
                where: { title: 'Morning Circle' }
            });
            const updateData = {
                id: routine.id,
                title: 'Morning Meeting',
                description: 'Updated morning routine',
                category: 'morning',
                priority: 12
            };
            const response = await request(app)
                .post('/api/sub-plan/routines')
                .set('Authorization', `Bearer ${global.testToken}`)
                .send(updateData)
                .expect(200);
            expect(response.body.title).toBe('Morning Meeting');
            expect(response.body.priority).toBe(12);
        });
        it('should delete routine', async () => {
            const routine = await prisma.classRoutine.findFirst({
                where: { title: 'Line Up Procedure' }
            });
            await request(app)
                .delete(`/api/sub-plan/routines/${routine.id}`)
                .set('Authorization', `Bearer ${global.testToken}`)
                .expect(200);
            const deleted = await prisma.classRoutine.findUnique({
                where: { id: routine.id }
            });
            expect(deleted).toBeNull();
        });
    });
    describe('Sub Plan Records', () => {
        it('should retrieve saved sub plan records', async () => {
            // Create some test records
            await prisma.subPlanRecord.createMany({
                data: [
                    {
                        userId: testUser.id,
                        date: new Date('2025-04-10'),
                        daysCount: 1,
                        content: {},
                        includeGoals: true,
                        includeRoutines: true,
                        includePlans: true,
                        anonymized: false
                    },
                    {
                        userId: testUser.id,
                        date: new Date('2025-04-08'),
                        daysCount: 2,
                        content: {},
                        includeGoals: false,
                        includeRoutines: true,
                        includePlans: true,
                        anonymized: true
                    }
                ]
            });
            const response = await request(app)
                .get('/api/sub-plan/records')
                .set('Authorization', `Bearer ${global.testToken}`)
                .query({ userId: testUser.id })
                .expect(200);
            expect(response.body).toHaveLength(2);
            expect(response.body[0].date).toContain('2025-04-10'); // Most recent first
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL2ludGVncmF0aW9uL2VuaGFuY2VkU3ViUGxhbi50ZXN0LnRzIiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUMvRSxPQUFPLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFDaEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3RDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUMxQyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUUvRCxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ3JDLElBQUksTUFBMkIsQ0FBQztJQUNoQyxJQUFJLFFBQWEsQ0FBQztJQUVsQixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsTUFBTSxHQUFHLElBQUksbUJBQW1CLEVBQUUsQ0FBQztRQUNuQyxNQUFNLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNsQixNQUFNLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUMxQixDQUFDLENBQUMsQ0FBQztJQUVILFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUVyQixtQkFBbUI7UUFDbkIsUUFBUSxHQUFHLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDbEMsSUFBSSxFQUFFO2dCQUNKLEtBQUssRUFBRSxvQkFBb0I7Z0JBQzNCLFFBQVEsRUFBRSxVQUFVO2dCQUNwQixJQUFJLEVBQUUsY0FBYztnQkFDcEIsSUFBSSxFQUFFLFNBQVM7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QU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVmLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLG9CQUFvQjtRQUM3RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL2ludGVncmF0aW9uL2VuaGFuY2VkU3ViUGxhbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVBbGwsIGFmdGVyQWxsLCBiZWZvcmVFYWNoIH0gZnJvbSAndml0ZXN0JztcbmltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XG5pbXBvcnQgeyBhcHAgfSBmcm9tICcuLi8uLi9zcmMvaW5kZXgnO1xuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vLi4vc3JjL3ByaXNtYSc7XG5pbXBvcnQgeyBUZXN0RGF0YWJhc2VNYW5hZ2VyIH0gZnJvbSAnLi4vdGVzdC1kYXRhYmFzZS1tYW5hZ2VyJztcblxuZGVzY3JpYmUoJ0VuaGFuY2VkIFN1YiBQbGFuIEFQSScsICgpID0+IHtcbiAgbGV0IHRlc3REYjogVGVzdERhdGFiYXNlTWFuYWdlcjtcbiAgbGV0IHRlc3RVc2VyOiBhbnk7XG5cbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICB0ZXN0RGIgPSBuZXcgVGVzdERhdGFiYXNlTWFuYWdlcigpO1xuICAgIGF3YWl0IHRlc3REYi5zZXR1cCgpO1xuICB9KTtcblxuICBhZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgdGVzdERiLnRlYXJkb3duKCk7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IHRlc3REYi5yZXNldCgpO1xuICAgIFxuICAgIC8vIENyZWF0ZSB0ZXN0IHVzZXJcbiAgICB0ZXN0VXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIGVtYWlsOiAndGVhY2hlckBzY2hvb2wuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZCcsXG4gICAgICAgIG5hbWU6ICdUZXN0IFRlYWNoZXInLFxuICAgICAgICByb2xlOiAndGVhY2hlcidcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IGNsYXNzIHJvdXRpbmVzXG4gICAgYXdhaXQgcHJpc21hLmNsYXNzUm91dGluZS5jcmVhdGVNYW55KHtcbiAgICAgIGRhdGE6IFtcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZDogdGVzdFVzZXIuaWQsXG4gICAgICAgICAgdGl0bGU6ICdNb3JuaW5nIENpcmNsZScsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdTdHVkZW50cyBnYXRoZXIgaW4gYSBjaXJjbGUgZm9yIG1vcm5pbmcgZ3JlZXRpbmcgYW5kIGNhbGVuZGFyIHRpbWUnLFxuICAgICAgICAgIGNhdGVnb3J5OiAnbW9ybmluZycsXG4gICAgICAgICAgdGltZU9mRGF5OiAnOTowMCBBTScsXG4gICAgICAgICAgcHJpb3JpdHk6IDEwLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLmlkLFxuICAgICAgICAgIHRpdGxlOiAnTGluZSBVcCBQcm9jZWR1cmUnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnU3R1ZGVudHMgbGluZSB1cCBieSBkb29yIDMgYWZ0ZXIgcmVjZXNzJyxcbiAgICAgICAgICBjYXRlZ29yeTogJ3RyYW5zaXRpb24nLFxuICAgICAgICAgIHByaW9yaXR5OiA1LFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLmlkLFxuICAgICAgICAgIHRpdGxlOiAnRW1lcmdlbmN5IEV2YWN1YXRpb24nLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRXhpdCB0aHJvdWdoIHdlc3QgZG9vciwgbWVldCBhdCBmbGFnIHBvbGUnLFxuICAgICAgICAgIGNhdGVnb3J5OiAnZW1lcmdlbmN5JyxcbiAgICAgICAgICBwcmlvcml0eTogMTUsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWVcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHRlc3Qgc3R1ZGVudHMgd2l0aCBnb2Fsc1xuICAgIGNvbnN0IHN0dWRlbnQxID0gYXdhaXQgcHJpc21hLnN0dWRlbnQuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXNlcklkOiB0ZXN0VXNlci5pZCxcbiAgICAgICAgZmlyc3ROYW1lOiAnRW1tYScsXG4gICAgICAgIGxhc3ROYW1lOiAnSm9obnNvbicsXG4gICAgICAgIGdyYWRlOiAyXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBzdHVkZW50MiA9IGF3YWl0IHByaXNtYS5zdHVkZW50LmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHVzZXJJZDogdGVzdFVzZXIuaWQsXG4gICAgICAgIGZpcnN0TmFtZTogJ0xpYW0nLFxuICAgICAgICBsYXN0TmFtZTogJ1NtaXRoJyxcbiAgICAgICAgZ3JhZGU6IDJcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IGdvYWxzXG4gICAgYXdhaXQgcHJpc21hLnN0dWRlbnRHb2FsLmNyZWF0ZU1hbnkoe1xuICAgICAgZGF0YTogW1xuICAgICAgICB7XG4gICAgICAgICAgc3R1ZGVudElkOiBzdHVkZW50MS5pZCxcbiAgICAgICAgICB0ZXh0OiAnSWRlbnRpZnkgY2hhcmFjdGVyIGZlZWxpbmdzIGluIHN0b3JpZXMnLFxuICAgICAgICAgIHN0YXR1czogJ2FjdGl2ZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHN0dWRlbnRJZDogc3R1ZGVudDIuaWQsXG4gICAgICAgICAgdGV4dDogJ1VzZSBkb3VibGVzIHN0cmF0ZWdpZXMgZm9yIGFkZGl0aW9uJyxcbiAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL2FwaS9zdWItcGxhbi9nZW5lcmF0ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHN1YiBwbGFuIHdpdGggYWxsIGZlYXR1cmVzIGluY2x1ZGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgZGF0ZTogJzIwMjUtMDQtMTInLFxuICAgICAgICBkYXlzOiAxLFxuICAgICAgICBpbmNsdWRlR29hbHM6IHRydWUsXG4gICAgICAgIGluY2x1ZGVSb3V0aW5lczogdHJ1ZSxcbiAgICAgICAgaW5jbHVkZVBsYW5zOiB0cnVlLFxuICAgICAgICBhbm9ueW1pemU6IGZhbHNlLFxuICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLmlkXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9zdWItcGxhbi9nZW5lcmF0ZScpXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7Z2xvYmFsLnRlc3RUb2tlbn1gKVxuICAgICAgICAuc2VuZChvcHRpb25zKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJzWydjb250ZW50LXR5cGUnXSkudG9CZSgnYXBwbGljYXRpb24vcGRmJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgYW5vbnltaXplZCBzdWIgcGxhbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGRhdGU6ICcyMDI1LTA0LTEyJyxcbiAgICAgICAgZGF5czogMSxcbiAgICAgICAgaW5jbHVkZUdvYWxzOiB0cnVlLFxuICAgICAgICBpbmNsdWRlUm91dGluZXM6IHRydWUsXG4gICAgICAgIGluY2x1ZGVQbGFuczogdHJ1ZSxcbiAgICAgICAgYW5vbnltaXplOiB0cnVlLFxuICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLmlkXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9zdWItcGxhbi9nZW5lcmF0ZScpXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7Z2xvYmFsLnRlc3RUb2tlbn1gKVxuICAgICAgICAuc2VuZChvcHRpb25zKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJzWydjb250ZW50LXR5cGUnXSkudG9CZSgnYXBwbGljYXRpb24vcGRmJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNhdmUgc3ViIHBsYW4gcmVjb3JkIHdoZW4gcmVxdWVzdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgZGF0ZTogJzIwMjUtMDQtMTInLFxuICAgICAgICBkYXlzOiAxLFxuICAgICAgICBpbmNsdWRlR29hbHM6IHRydWUsXG4gICAgICAgIGluY2x1ZGVSb3V0aW5lczogdHJ1ZSxcbiAgICAgICAgaW5jbHVkZVBsYW5zOiB0cnVlLFxuICAgICAgICBhbm9ueW1pemU6IGZhbHNlLFxuICAgICAgICBzYXZlUmVjb3JkOiB0cnVlLFxuICAgICAgICBlbWFpbFRvOiAnc3Vic3RpdHV0ZUBzY2hvb2wuY29tJyxcbiAgICAgICAgbm90ZXM6ICdXYXRjaCBmb3IgcGVhbnV0IGFsbGVyZ2llcycsXG4gICAgICAgIHVzZXJJZDogdGVzdFVzZXIuaWRcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9zdWItcGxhbi9nZW5lcmF0ZScpXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7Z2xvYmFsLnRlc3RUb2tlbn1gKVxuICAgICAgICAuc2VuZChvcHRpb25zKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGNvbnN0IHJlY29yZCA9IGF3YWl0IHByaXNtYS5zdWJQbGFuUmVjb3JkLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogdGVzdFVzZXIuaWQgfVxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZWNvcmQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVjb3JkPy5lbWFpbGVkVG8pLnRvQmUoJ3N1YnN0aXR1dGVAc2Nob29sLmNvbScpO1xuICAgICAgZXhwZWN0KHJlY29yZD8ubm90ZXMpLnRvQmUoJ1dhdGNoIGZvciBwZWFudXQgYWxsZXJnaWVzJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDbGFzcyBSb3V0aW5lIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgYWxsIHJvdXRpbmVzIGZvciB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9zdWItcGxhbi9yb3V0aW5lcycpXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7Z2xvYmFsLnRlc3RUb2tlbn1gKVxuICAgICAgICAucXVlcnkoeyB1c2VySWQ6IHRlc3RVc2VyLmlkIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5WzBdLnRpdGxlKS50b0JlKCdFbWVyZ2VuY3kgRXZhY3VhdGlvbicpOyAvLyBIaWdoZXN0IHByaW9yaXR5XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBuZXcgcm91dGluZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5ld1JvdXRpbmUgPSB7XG4gICAgICAgIHVzZXJJZDogdGVzdFVzZXIuaWQsXG4gICAgICAgIHRpdGxlOiAnUXVpZXQgU2lnbmFsJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdSYWlzZSBoYW5kIGZvciBxdWlldCwgc3R1ZGVudHMgY29weScsXG4gICAgICAgIGNhdGVnb3J5OiAnYmVoYXZpb3InLFxuICAgICAgICBwcmlvcml0eTogOFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvc3ViLXBsYW4vcm91dGluZXMnKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2dsb2JhbC50ZXN0VG9rZW59YClcbiAgICAgICAgLnNlbmQobmV3Um91dGluZSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5pZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnRpdGxlKS50b0JlKCdRdWlldCBTaWduYWwnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIGV4aXN0aW5nIHJvdXRpbmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByb3V0aW5lID0gYXdhaXQgcHJpc21hLmNsYXNzUm91dGluZS5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogeyB0aXRsZTogJ01vcm5pbmcgQ2lyY2xlJyB9XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgaWQ6IHJvdXRpbmUhLmlkLFxuICAgICAgICB0aXRsZTogJ01vcm5pbmcgTWVldGluZycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVXBkYXRlZCBtb3JuaW5nIHJvdXRpbmUnLFxuICAgICAgICBjYXRlZ29yeTogJ21vcm5pbmcnLFxuICAgICAgICBwcmlvcml0eTogMTJcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL3N1Yi1wbGFuL3JvdXRpbmVzJylcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHtnbG9iYWwudGVzdFRva2VufWApXG4gICAgICAgIC5zZW5kKHVwZGF0ZURhdGEpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkudGl0bGUpLnRvQmUoJ01vcm5pbmcgTWVldGluZycpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkucHJpb3JpdHkpLnRvQmUoMTIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZWxldGUgcm91dGluZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJvdXRpbmUgPSBhd2FpdCBwcmlzbWEuY2xhc3NSb3V0aW5lLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7IHRpdGxlOiAnTGluZSBVcCBQcm9jZWR1cmUnIH1cbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmRlbGV0ZShgL2FwaS9zdWItcGxhbi9yb3V0aW5lcy8ke3JvdXRpbmUhLmlkfWApXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7Z2xvYmFsLnRlc3RUb2tlbn1gKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGNvbnN0IGRlbGV0ZWQgPSBhd2FpdCBwcmlzbWEuY2xhc3NSb3V0aW5lLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogcm91dGluZSEuaWQgfVxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3ViIFBsYW4gUmVjb3JkcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHJpZXZlIHNhdmVkIHN1YiBwbGFuIHJlY29yZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgc29tZSB0ZXN0IHJlY29yZHNcbiAgICAgIGF3YWl0IHByaXNtYS5zdWJQbGFuUmVjb3JkLmNyZWF0ZU1hbnkoe1xuICAgICAgICBkYXRhOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdXNlcklkOiB0ZXN0VXNlci5pZCxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCcyMDI1LTA0LTEwJyksXG4gICAgICAgICAgICBkYXlzQ291bnQ6IDEsXG4gICAgICAgICAgICBjb250ZW50OiB7fSxcbiAgICAgICAgICAgIGluY2x1ZGVHb2FsczogdHJ1ZSxcbiAgICAgICAgICAgIGluY2x1ZGVSb3V0aW5lczogdHJ1ZSxcbiAgICAgICAgICAgIGluY2x1ZGVQbGFuczogdHJ1ZSxcbiAgICAgICAgICAgIGFub255bWl6ZWQ6IGZhbHNlXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLmlkLFxuICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoJzIwMjUtMDQtMDgnKSxcbiAgICAgICAgICAgIGRheXNDb3VudDogMixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHt9LFxuICAgICAgICAgICAgaW5jbHVkZUdvYWxzOiBmYWxzZSxcbiAgICAgICAgICAgIGluY2x1ZGVSb3V0aW5lczogdHJ1ZSxcbiAgICAgICAgICAgIGluY2x1ZGVQbGFuczogdHJ1ZSxcbiAgICAgICAgICAgIGFub255bWl6ZWQ6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL3N1Yi1wbGFuL3JlY29yZHMnKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2dsb2JhbC50ZXN0VG9rZW59YClcbiAgICAgICAgLnF1ZXJ5KHsgdXNlcklkOiB0ZXN0VXNlci5pZCB9KVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keVswXS5kYXRlKS50b0NvbnRhaW4oJzIwMjUtMDQtMTAnKTsgLy8gTW9zdCByZWNlbnQgZmlyc3RcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=