80838f1f68c5b05ee6dbaad78fcc3d02
/**
 * Authentication Service - Comprehensive Test Coverage
 * Addresses Issue #264: Critical test coverage gaps
 */
import { describe, test, expect, jest, beforeEach } from '@jest/globals';
jest.mock('bcryptjs', () => mockBcrypt);
jest.mock('jsonwebtoken', () => mockJwt);
jest.mock('@teaching-engine/database');
import bcrypt from 'bcryptjs';
import jwt from 'jsonwebtoken';
import { PrismaClient } from '@teaching-engine/database';
import { generateAuthToken, hashPassword, validatePassword, verifyToken, authenticate, checkPermissions } from '@/services/authService';
// Mock dependencies
const mockBcrypt = {
    hash: jest.fn(),
    compare: jest.fn(),
};
const mockJwt = {
    sign: jest.fn(),
    verify: jest.fn(),
};
describe('Authentication Service - Critical Path Testing', () => {
    let mockPrisma;
    beforeEach(() => {
        jest.clearAllMocks();
        mockPrisma = new PrismaClient();
        process.env.JWT_SECRET = 'test-secret-key';
    });
    describe('JWT Token Generation', () => {
        test('generates valid JWT tokens with correct payload', async () => {
            const userId = '123';
            const mockToken = 'mock.jwt.token';
            mockJwt.sign.mockReturnValue(mockToken);
            const token = await generateAuthToken(userId);
            expect(mockJwt.sign).toHaveBeenCalledWith({ userId }, 'test-secret-key', { expiresIn: '7d' });
            expect(token).toBe(mockToken);
        });
        test('throws error when JWT_SECRET is missing', async () => {
            delete process.env.JWT_SECRET;
            await expect(generateAuthToken('123'))
                .rejects.toThrow('JWT_SECRET environment variable is required');
        });
        test('generates tokens with custom expiration', async () => {
            const userId = '123';
            const customExpiry = '1h';
            mockJwt.sign.mockReturnValue('mock.token');
            await generateAuthToken(userId, customExpiry);
            expect(jwt.sign).toHaveBeenCalledWith(expect.any(Object), expect.any(String), { expiresIn: customExpiry });
        });
        test('handles token generation failures gracefully', async () => {
            mockJwt.sign.mockImplementation(() => {
                throw new Error('Token generation failed');
            });
            await expect(generateAuthToken('123'))
                .rejects.toThrow('Token generation failed');
        });
    });
    describe('Password Security', () => {
        test('hashes passwords with bcrypt using correct salt rounds', async () => {
            const plaintext = 'TestPassword123!';
            const hashedPassword = '$2a$10$mockedHashValue';
            mockBcrypt.hash.mockResolvedValue(hashedPassword);
            const result = await hashPassword(plaintext);
            expect(bcrypt.hash).toHaveBeenCalledWith(plaintext, 10);
            expect(result).toBe(hashedPassword);
        });
        test('validates password strength requirements', async () => {
            const weakPasswords = [
                '123456', // Too simple
                'password', // Common password
                'qwerty', // Common pattern
                'short', // Too short
                'nouppercase1!', // No uppercase
                'NOLOWERCASE1!', // No lowercase
                'NoNumbers!', // No numbers
                'NoSpecial123', // No special characters
            ];
            for (const weakPassword of weakPasswords) {
                await expect(validatePassword(weakPassword))
                    .rejects.toThrow('Password does not meet security requirements');
            }
        });
        test('accepts strong passwords', async () => {
            const strongPasswords = [
                'StrongPass123!',
                'C0mpl3x!P@ssw0rd',
                'Secure#Pass2023',
                'V@lidP@ssw0rd123',
            ];
            for (const strongPassword of strongPasswords) {
                await expect(validatePassword(strongPassword))
                    .resolves.toBe(true);
            }
        });
        test('compares passwords correctly', async () => {
            const plaintext = 'TestPassword123!';
            const hash = '$2a$10$hashedValue';
            mockBcrypt.compare.mockResolvedValue(true);
            const isValid = await mockBcrypt.compare(plaintext, hash);
            expect(isValid).toBe(true);
            expect(mockBcrypt.compare).toHaveBeenCalledWith(plaintext, hash);
        });
    });
    describe('Token Verification', () => {
        test('verifies valid tokens successfully', async () => {
            const mockPayload = { userId: '123', iat: Date.now() / 1000 };
            const mockToken = 'valid.jwt.token';
            jwt.verify.mockReturnValue(mockPayload);
            const result = await verifyToken(mockToken);
            expect(jwt.verify).toHaveBeenCalledWith(mockToken, 'test-secret-key');
            expect(result).toEqual(mockPayload);
        });
        test('rejects expired tokens', async () => {
            const mockToken = 'expired.jwt.token';
            jwt.verify.mockImplementation(() => {
                throw new jwt.TokenExpiredError('jwt expired', new Date());
            });
            await expect(verifyToken(mockToken))
                .rejects.toThrow('jwt expired');
        });
        test('rejects malformed tokens', async () => {
            const malformedTokens = [
                '',
                'invalid',
                'not.a.token',
                'malformed..token',
            ];
            for (const token of malformedTokens) {
                jwt.verify.mockImplementation(() => {
                    throw new jwt.JsonWebTokenError('jwt malformed');
                });
                await expect(verifyToken(token))
                    .rejects.toThrow('jwt malformed');
            }
        });
        test('handles missing JWT secret during verification', async () => {
            delete process.env.JWT_SECRET;
            await expect(verifyToken('any.token'))
                .rejects.toThrow('JWT_SECRET environment variable is required');
        });
    });
    describe('Authentication Flow', () => {
        test('authenticates valid credentials successfully', async () => {
            const email = 'test@example.com';
            const password = 'ValidPass123!';
            const hashedPassword = '$2a$10$hashedPassword';
            const mockUser = {
                id: '123',
                email,
                password: hashedPassword,
                name: 'Test User',
            };
            mockPrisma.user.findUnique = jest.fn().mockResolvedValue(mockUser);
            mockBcrypt.compare.mockResolvedValue(true);
            mockJwt.sign.mockReturnValue('mock.token');
            const result = await authenticate(email, password, mockPrisma);
            expect(mockPrisma.user.findUnique).toHaveBeenCalledWith({
                where: { email },
            });
            expect(bcrypt.compare).toHaveBeenCalledWith(password, hashedPassword);
            expect(result).toEqual({
                user: expect.objectContaining({
                    id: mockUser.id,
                    email: mockUser.email,
                    name: mockUser.name,
                }),
                token: 'mock.token',
            });
            expect(result.user).not.toHaveProperty('password');
        });
        test('rejects non-existent users', async () => {
            mockPrisma.user.findUnique = jest.fn().mockResolvedValue(null);
            await expect(authenticate('nonexistent@example.com', 'password', mockPrisma))
                .rejects.toThrow('Invalid credentials');
        });
        test('rejects incorrect passwords', async () => {
            const mockUser = {
                id: '123',
                email: 'test@example.com',
                password: '$2a$10$hashedPassword',
            };
            mockPrisma.user.findUnique = jest.fn().mockResolvedValue(mockUser);
            mockBcrypt.compare.mockResolvedValue(false);
            await expect(authenticate('test@example.com', 'wrongpassword', mockPrisma))
                .rejects.toThrow('Invalid credentials');
        });
        test('handles database errors gracefully', async () => {
            mockPrisma.user.findUnique = jest.fn().mockRejectedValue(new Error('Database connection failed'));
            await expect(authenticate('test@example.com', 'password', mockPrisma))
                .rejects.toThrow('Database connection failed');
        });
    });
    describe('SQL Injection Prevention', () => {
        test('sanitizes email input against SQL injection', async () => {
            const maliciousInputs = [
                "' OR '1'='1",
                "admin'--",
                "1; DROP TABLE users;--",
                "' UNION SELECT * FROM users--",
                "admin' OR 1=1--",
            ];
            for (const maliciousInput of maliciousInputs) {
                mockPrisma.user.findUnique = jest.fn().mockResolvedValue(null);
                await expect(authenticate(maliciousInput, 'password', mockPrisma))
                    .rejects.toThrow('Invalid credentials');
                // Verify Prisma was called with sanitized input
                expect(mockPrisma.user.findUnique).toHaveBeenCalledWith({
                    where: { email: maliciousInput },
                });
            }
        });
    });
    describe('Permission Checking', () => {
        test('allows access for users with correct permissions', async () => {
            const user = {
                id: '123',
                role: 'ADMIN',
                permissions: ['read', 'write', 'delete'],
            };
            const hasPermission = await checkPermissions(user, 'write');
            expect(hasPermission).toBe(true);
        });
        test('denies access for users without required permissions', async () => {
            const user = {
                id: '123',
                role: 'USER',
                permissions: ['read'],
            };
            const hasPermission = await checkPermissions(user, 'delete');
            expect(hasPermission).toBe(false);
        });
        test('handles role-based permissions correctly', async () => {
            const adminUser = { id: '1', role: 'ADMIN' };
            const regularUser = { id: '2', role: 'USER' };
            expect(await checkPermissions(adminUser, 'admin.access')).toBe(true);
            expect(await checkPermissions(regularUser, 'admin.access')).toBe(false);
        });
    });
    describe('Session Management', () => {
        test('creates secure session tokens', async () => {
            const sessionData = {
                userId: '123',
                deviceId: 'device-123',
                ipAddress: '192.168.1.1',
            };
            mockJwt.sign.mockReturnValue('session.token');
            const token = await createSessionToken(sessionData);
            expect(jwt.sign).toHaveBeenCalledWith(expect.objectContaining(sessionData), expect.any(String), expect.objectContaining({
                expiresIn: expect.any(String),
            }));
        });
        test('validates session tokens against blacklist', async () => {
            const token = 'potentially.blacklisted.token';
            const mockBlacklist = new Set(['blacklisted.token']);
            const isValid = await validateSessionToken(token, mockBlacklist);
            expect(isValid).toBe(true);
            const isBlacklisted = await validateSessionToken('blacklisted.token', mockBlacklist);
            expect(isBlacklisted).toBe(false);
        });
    });
    describe('Multi-Factor Authentication', () => {
        test('generates valid TOTP codes', async () => {
            const secret = 'JBSWY3DPEHPK3PXP';
            const code = generateTOTPCode(secret);
            expect(code).toMatch(/^\d{6}$/);
        });
        test('verifies TOTP codes within time window', async () => {
            const secret = 'JBSWY3DPEHPK3PXP';
            const validCode = generateTOTPCode(secret);
            const isValid = await verifyTOTPCode(validCode, secret);
            expect(isValid).toBe(true);
        });
        test('rejects invalid TOTP codes', async () => {
            const secret = 'JBSWY3DPEHPK3PXP';
            const invalidCodes = ['000000', '123456', '999999'];
            for (const code of invalidCodes) {
                const isValid = await verifyTOTPCode(code, secret);
                expect(isValid).toBe(false);
            }
        });
    });
});
// Mock function implementations for testing
async function createSessionToken(data) {
    return jwt.sign(data, process.env.JWT_SECRET, { expiresIn: '24h' });
}
async function validateSessionToken(token, blacklist) {
    return !blacklist.has(token);
}
function generateTOTPCode(secret) {
    // Mock implementation
    return Math.floor(100000 + Math.random() * 900000).toString();
}
async function verifyTOTPCode(code, secret) {
    // Mock implementation
    return code === generateTOTPCode(secret);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvYXV0aC9hdXRoZW50aWNhdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRztBQUVILE9BQU8sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBdUJ6RSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUN4QyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN6QyxJQUFJLENBQUMsSUFBSSxDQUFDLDJCQUEyQixDQUFDLENBQUM7QUF4QnZDLE9BQU8sTUFBTSxNQUFNLFVBQVUsQ0FBQztBQUM5QixPQUFPLEdBQUcsTUFBTSxjQUFjLENBQUM7QUFDL0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3pELE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsWUFBWSxFQUNaLGdCQUFnQixFQUNoQixXQUFXLEVBQ1gsWUFBWSxFQUNaLGdCQUFnQixFQUNqQixNQUFNLHdCQUF3QixDQUFDO0FBRWhDLG9CQUFvQjtBQUNwQixNQUFNLFVBQVUsR0FBRztJQUNqQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ25CLENBQUM7QUFDRixNQUFNLE9BQU8sR0FBRztJQUNkLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2YsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDbEIsQ0FBQztBQU1GLFFBQVEsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7SUFDOUQsSUFBSSxVQUFxQyxDQUFDO0lBRTFDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJ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SUFBUztJQUN6QyxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVyxFQUFFLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7QUFDdkUsQ0FBQztBQUVELEtBQUssVUFBVSxvQkFBb0IsQ0FBQyxLQUFhLEVBQUUsU0FBc0I7SUFDdkUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDL0IsQ0FBQztBQUVELFNBQVMsZ0JBQWdCLENBQUMsTUFBYztJQUN0QyxzQkFBc0I7SUFDdEIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDaEUsQ0FBQztBQUVELEtBQUssVUFBVSxjQUFjLENBQUMsSUFBWSxFQUFFLE1BQWM7SUFDeEQsc0JBQXNCO0lBQ3RCLE9BQU8sSUFBSSxLQUFLLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzNDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvYXV0aC9hdXRoZW50aWNhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQXV0aGVudGljYXRpb24gU2VydmljZSAtIENvbXByZWhlbnNpdmUgVGVzdCBDb3ZlcmFnZVxuICogQWRkcmVzc2VzIElzc3VlICMyNjQ6IENyaXRpY2FsIHRlc3QgY292ZXJhZ2UgZ2Fwc1xuICovXG5cbmltcG9ydCB7IGRlc2NyaWJlLCB0ZXN0LCBleHBlY3QsIGplc3QsIGJlZm9yZUVhY2ggfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCBiY3J5cHQgZnJvbSAnYmNyeXB0anMnO1xuaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHRlYWNoaW5nLWVuZ2luZS9kYXRhYmFzZSc7XG5pbXBvcnQgeyBcbiAgZ2VuZXJhdGVBdXRoVG9rZW4sIFxuICBoYXNoUGFzc3dvcmQsIFxuICB2YWxpZGF0ZVBhc3N3b3JkLFxuICB2ZXJpZnlUb2tlbixcbiAgYXV0aGVudGljYXRlLFxuICBjaGVja1Blcm1pc3Npb25zIFxufSBmcm9tICdAL3NlcnZpY2VzL2F1dGhTZXJ2aWNlJztcblxuLy8gTW9jayBkZXBlbmRlbmNpZXNcbmNvbnN0IG1vY2tCY3J5cHQgPSB7XG4gIGhhc2g6IGplc3QuZm4oKSxcbiAgY29tcGFyZTogamVzdC5mbigpLFxufTtcbmNvbnN0IG1vY2tKd3QgPSB7XG4gIHNpZ246IGplc3QuZm4oKSxcbiAgdmVyaWZ5OiBqZXN0LmZuKCksXG59O1xuXG5qZXN0Lm1vY2soJ2JjcnlwdGpzJywgKCkgPT4gbW9ja0JjcnlwdCk7XG5qZXN0Lm1vY2soJ2pzb253ZWJ0b2tlbicsICgpID0+IG1vY2tKd3QpO1xuamVzdC5tb2NrKCdAdGVhY2hpbmctZW5naW5lL2RhdGFiYXNlJyk7XG5cbmRlc2NyaWJlKCdBdXRoZW50aWNhdGlvbiBTZXJ2aWNlIC0gQ3JpdGljYWwgUGF0aCBUZXN0aW5nJywgKCkgPT4ge1xuICBsZXQgbW9ja1ByaXNtYTogamVzdC5Nb2NrZWQ8UHJpc21hQ2xpZW50PjtcbiAgXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIG1vY2tQcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCkgYXMgamVzdC5Nb2NrZWQ8UHJpc21hQ2xpZW50PjtcbiAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Qtc2VjcmV0LWtleSc7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdKV1QgVG9rZW4gR2VuZXJhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdnZW5lcmF0ZXMgdmFsaWQgSldUIHRva2VucyB3aXRoIGNvcnJlY3QgcGF5bG9hZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICcxMjMnO1xuICAgICAgY29uc3QgbW9ja1Rva2VuID0gJ21vY2suand0LnRva2VuJztcbiAgICAgIFxuICAgICAgbW9ja0p3dC5zaWduLm1vY2tSZXR1cm5WYWx1ZShtb2NrVG9rZW4pO1xuICAgICAgXG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGdlbmVyYXRlQXV0aFRva2VuKHVzZXJJZCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrSnd0LnNpZ24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB7IHVzZXJJZCB9LFxuICAgICAgICAndGVzdC1zZWNyZXQta2V5JyxcbiAgICAgICAgeyBleHBpcmVzSW46ICc3ZCcgfVxuICAgICAgKTtcbiAgICAgIGV4cGVjdCh0b2tlbikudG9CZShtb2NrVG9rZW4pO1xuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ3Rocm93cyBlcnJvciB3aGVuIEpXVF9TRUNSRVQgaXMgbWlzc2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoZ2VuZXJhdGVBdXRoVG9rZW4oJzEyMycpKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KCdKV1RfU0VDUkVUIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIHJlcXVpcmVkJyk7XG4gICAgfSk7XG4gICAgXG4gICAgdGVzdCgnZ2VuZXJhdGVzIHRva2VucyB3aXRoIGN1c3RvbSBleHBpcmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJzEyMyc7XG4gICAgICBjb25zdCBjdXN0b21FeHBpcnkgPSAnMWgnO1xuICAgICAgXG4gICAgICBtb2NrSnd0LnNpZ24ubW9ja1JldHVyblZhbHVlKCdtb2NrLnRva2VuJyk7XG4gICAgICBcbiAgICAgIGF3YWl0IGdlbmVyYXRlQXV0aFRva2VuKHVzZXJJZCwgY3VzdG9tRXhwaXJ5KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGp3dC5zaWduKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LmFueShPYmplY3QpLFxuICAgICAgICBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICAgIHsgZXhwaXJlc0luOiBjdXN0b21FeHBpcnkgfVxuICAgICAgKTtcbiAgICB9KTtcbiAgICBcbiAgICB0ZXN0KCdoYW5kbGVzIHRva2VuIGdlbmVyYXRpb24gZmFpbHVyZXMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tKd3Quc2lnbi5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rva2VuIGdlbmVyYXRpb24gZmFpbGVkJyk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGdlbmVyYXRlQXV0aFRva2VuKCcxMjMnKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnVG9rZW4gZ2VuZXJhdGlvbiBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Bhc3N3b3JkIFNlY3VyaXR5JywgKCkgPT4ge1xuICAgIHRlc3QoJ2hhc2hlcyBwYXNzd29yZHMgd2l0aCBiY3J5cHQgdXNpbmcgY29ycmVjdCBzYWx0IHJvdW5kcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBsYWludGV4dCA9ICdUZXN0UGFzc3dvcmQxMjMhJztcbiAgICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gJyQyYSQxMCRtb2NrZWRIYXNoVmFsdWUnO1xuICAgICAgXG4gICAgICBtb2NrQmNyeXB0Lmhhc2gubW9ja1Jlc29sdmVkVmFsdWUoaGFzaGVkUGFzc3dvcmQpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGxhaW50ZXh0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGJjcnlwdC5oYXNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChwbGFpbnRleHQsIDEwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoaGFzaGVkUGFzc3dvcmQpO1xuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ3ZhbGlkYXRlcyBwYXNzd29yZCBzdHJlbmd0aCByZXF1aXJlbWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWFrUGFzc3dvcmRzID0gW1xuICAgICAgICAnMTIzNDU2JywgICAgICAgIC8vIFRvbyBzaW1wbGVcbiAgICAgICAgJ3Bhc3N3b3JkJywgICAgICAvLyBDb21tb24gcGFzc3dvcmRcbiAgICAgICAgJ3F3ZXJ0eScsICAgICAgICAvLyBDb21tb24gcGF0dGVyblxuICAgICAgICAnc2hvcnQnLCAgICAgICAgIC8vIFRvbyBzaG9ydFxuICAgICAgICAnbm91cHBlcmNhc2UxIScsIC8vIE5vIHVwcGVyY2FzZVxuICAgICAgICAnTk9MT1dFUkNBU0UxIScsIC8vIE5vIGxvd2VyY2FzZVxuICAgICAgICAnTm9OdW1iZXJzIScsICAgIC8vIE5vIG51bWJlcnNcbiAgICAgICAgJ05vU3BlY2lhbDEyMycsICAvLyBObyBzcGVjaWFsIGNoYXJhY3RlcnNcbiAgICAgIF07XG4gICAgICBcbiAgICAgIGZvciAoY29uc3Qgd2Vha1Bhc3N3b3JkIG9mIHdlYWtQYXNzd29yZHMpIHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KHZhbGlkYXRlUGFzc3dvcmQod2Vha1Bhc3N3b3JkKSlcbiAgICAgICAgICAucmVqZWN0cy50b1Rocm93KCdQYXNzd29yZCBkb2VzIG5vdCBtZWV0IHNlY3VyaXR5IHJlcXVpcmVtZW50cycpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ2FjY2VwdHMgc3Ryb25nIHBhc3N3b3JkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0cm9uZ1Bhc3N3b3JkcyA9IFtcbiAgICAgICAgJ1N0cm9uZ1Bhc3MxMjMhJyxcbiAgICAgICAgJ0MwbXBsM3ghUEBzc3cwcmQnLFxuICAgICAgICAnU2VjdXJlI1Bhc3MyMDIzJyxcbiAgICAgICAgJ1ZAbGlkUEBzc3cwcmQxMjMnLFxuICAgICAgXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBzdHJvbmdQYXNzd29yZCBvZiBzdHJvbmdQYXNzd29yZHMpIHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KHZhbGlkYXRlUGFzc3dvcmQoc3Ryb25nUGFzc3dvcmQpKVxuICAgICAgICAgIC5yZXNvbHZlcy50b0JlKHRydWUpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ2NvbXBhcmVzIHBhc3N3b3JkcyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwbGFpbnRleHQgPSAnVGVzdFBhc3N3b3JkMTIzISc7XG4gICAgICBjb25zdCBoYXNoID0gJyQyYSQxMCRoYXNoZWRWYWx1ZSc7XG4gICAgICBcbiAgICAgIG1vY2tCY3J5cHQuY29tcGFyZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIFxuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IG1vY2tCY3J5cHQuY29tcGFyZShwbGFpbnRleHQsIGhhc2gpO1xuICAgICAgXG4gICAgICBleHBlY3QoaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChtb2NrQmNyeXB0LmNvbXBhcmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHBsYWludGV4dCwgaGFzaCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdUb2tlbiBWZXJpZmljYXRpb24nLCAoKSA9PiB7XG4gICAgdGVzdCgndmVyaWZpZXMgdmFsaWQgdG9rZW5zIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQYXlsb2FkID0geyB1c2VySWQ6ICcxMjMnLCBpYXQ6IERhdGUubm93KCkgLyAxMDAwIH07XG4gICAgICBjb25zdCBtb2NrVG9rZW4gPSAndmFsaWQuand0LnRva2VuJztcbiAgICAgIFxuICAgICAgKGp3dC52ZXJpZnkgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUobW9ja1BheWxvYWQpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2ZXJpZnlUb2tlbihtb2NrVG9rZW4pO1xuICAgICAgXG4gICAgICBleHBlY3Qoand0LnZlcmlmeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja1Rva2VuLCAndGVzdC1zZWNyZXQta2V5Jyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tQYXlsb2FkKTtcbiAgICB9KTtcbiAgICBcbiAgICB0ZXN0KCdyZWplY3RzIGV4cGlyZWQgdG9rZW5zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Rva2VuID0gJ2V4cGlyZWQuand0LnRva2VuJztcbiAgICAgIFxuICAgICAgKGp3dC52ZXJpZnkgYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgand0LlRva2VuRXhwaXJlZEVycm9yKCdqd3QgZXhwaXJlZCcsIG5ldyBEYXRlKCkpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdCh2ZXJpZnlUb2tlbihtb2NrVG9rZW4pKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KCdqd3QgZXhwaXJlZCcpO1xuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ3JlamVjdHMgbWFsZm9ybWVkIHRva2VucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1hbGZvcm1lZFRva2VucyA9IFtcbiAgICAgICAgJycsXG4gICAgICAgICdpbnZhbGlkJyxcbiAgICAgICAgJ25vdC5hLnRva2VuJyxcbiAgICAgICAgJ21hbGZvcm1lZC4udG9rZW4nLFxuICAgICAgXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCB0b2tlbiBvZiBtYWxmb3JtZWRUb2tlbnMpIHtcbiAgICAgICAgKGp3dC52ZXJpZnkgYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICAgIHRocm93IG5ldyBqd3QuSnNvbldlYlRva2VuRXJyb3IoJ2p3dCBtYWxmb3JtZWQnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBleHBlY3QodmVyaWZ5VG9rZW4odG9rZW4pKVxuICAgICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ2p3dCBtYWxmb3JtZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICB0ZXN0KCdoYW5kbGVzIG1pc3NpbmcgSldUIHNlY3JldCBkdXJpbmcgdmVyaWZpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQ7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdCh2ZXJpZnlUb2tlbignYW55LnRva2VuJykpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ0pXVF9TRUNSRVQgZW52aXJvbm1lbnQgdmFyaWFibGUgaXMgcmVxdWlyZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0F1dGhlbnRpY2F0aW9uIEZsb3cnLCAoKSA9PiB7XG4gICAgdGVzdCgnYXV0aGVudGljYXRlcyB2YWxpZCBjcmVkZW50aWFscyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbWFpbCA9ICd0ZXN0QGV4YW1wbGUuY29tJztcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gJ1ZhbGlkUGFzczEyMyEnO1xuICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSAnJDJhJDEwJGhhc2hlZFBhc3N3b3JkJztcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogJzEyMycsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgIG5hbWU6ICdUZXN0IFVzZXInLFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgbW9ja1ByaXNtYS51c2VyLmZpbmRVbmlxdWUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgbW9ja0JjcnlwdC5jb21wYXJlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgbW9ja0p3dC5zaWduLm1vY2tSZXR1cm5WYWx1ZSgnbW9jay50b2tlbicpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoZW50aWNhdGUoZW1haWwsIHBhc3N3b3JkLCBtb2NrUHJpc21hKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tQcmlzbWEudXNlci5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGVtYWlsIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChiY3J5cHQuY29tcGFyZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgocGFzc3dvcmQsIGhhc2hlZFBhc3N3b3JkKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VyOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgaWQ6IG1vY2tVc2VyLmlkLFxuICAgICAgICAgIGVtYWlsOiBtb2NrVXNlci5lbWFpbCxcbiAgICAgICAgICBuYW1lOiBtb2NrVXNlci5uYW1lLFxuICAgICAgICB9KSxcbiAgICAgICAgdG9rZW46ICdtb2NrLnRva2VuJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyKS5ub3QudG9IYXZlUHJvcGVydHkoJ3Bhc3N3b3JkJyk7XG4gICAgfSk7XG4gICAgXG4gICAgdGVzdCgncmVqZWN0cyBub24tZXhpc3RlbnQgdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUHJpc21hLnVzZXIuZmluZFVuaXF1ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGF1dGhlbnRpY2F0ZSgnbm9uZXhpc3RlbnRAZXhhbXBsZS5jb20nLCAncGFzc3dvcmQnLCBtb2NrUHJpc21hKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCBjcmVkZW50aWFscycpO1xuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ3JlamVjdHMgaW5jb3JyZWN0IHBhc3N3b3JkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogJzEyMycsXG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnJDJhJDEwJGhhc2hlZFBhc3N3b3JkJyxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIG1vY2tQcmlzbWEudXNlci5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIG1vY2tCY3J5cHQuY29tcGFyZS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChhdXRoZW50aWNhdGUoJ3Rlc3RAZXhhbXBsZS5jb20nLCAnd3JvbmdwYXNzd29yZCcsIG1vY2tQcmlzbWEpKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KCdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7XG4gICAgfSk7XG4gICAgXG4gICAgdGVzdCgnaGFuZGxlcyBkYXRhYmFzZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQcmlzbWEudXNlci5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJylcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChhdXRoZW50aWNhdGUoJ3Rlc3RAZXhhbXBsZS5jb20nLCAncGFzc3dvcmQnLCBtb2NrUHJpc21hKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NRTCBJbmplY3Rpb24gUHJldmVudGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzYW5pdGl6ZXMgZW1haWwgaW5wdXQgYWdhaW5zdCBTUUwgaW5qZWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWFsaWNpb3VzSW5wdXRzID0gW1xuICAgICAgICBcIicgT1IgJzEnPScxXCIsXG4gICAgICAgIFwiYWRtaW4nLS1cIixcbiAgICAgICAgXCIxOyBEUk9QIFRBQkxFIHVzZXJzOy0tXCIsXG4gICAgICAgIFwiJyBVTklPTiBTRUxFQ1QgKiBGUk9NIHVzZXJzLS1cIixcbiAgICAgICAgXCJhZG1pbicgT1IgMT0xLS1cIixcbiAgICAgIF07XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgbWFsaWNpb3VzSW5wdXQgb2YgbWFsaWNpb3VzSW5wdXRzKSB7XG4gICAgICAgIG1vY2tQcmlzbWEudXNlci5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgICBcbiAgICAgICAgYXdhaXQgZXhwZWN0KGF1dGhlbnRpY2F0ZShtYWxpY2lvdXNJbnB1dCwgJ3Bhc3N3b3JkJywgbW9ja1ByaXNtYSkpXG4gICAgICAgICAgLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCBjcmVkZW50aWFscycpO1xuICAgICAgICBcbiAgICAgICAgLy8gVmVyaWZ5IFByaXNtYSB3YXMgY2FsbGVkIHdpdGggc2FuaXRpemVkIGlucHV0XG4gICAgICAgIGV4cGVjdChtb2NrUHJpc21hLnVzZXIuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIHdoZXJlOiB7IGVtYWlsOiBtYWxpY2lvdXNJbnB1dCB9LFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Blcm1pc3Npb24gQ2hlY2tpbmcnLCAoKSA9PiB7XG4gICAgdGVzdCgnYWxsb3dzIGFjY2VzcyBmb3IgdXNlcnMgd2l0aCBjb3JyZWN0IHBlcm1pc3Npb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IHtcbiAgICAgICAgaWQ6ICcxMjMnLFxuICAgICAgICByb2xlOiAnQURNSU4nLFxuICAgICAgICBwZXJtaXNzaW9uczogWydyZWFkJywgJ3dyaXRlJywgJ2RlbGV0ZSddLFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgaGFzUGVybWlzc2lvbiA9IGF3YWl0IGNoZWNrUGVybWlzc2lvbnModXNlciwgJ3dyaXRlJyk7XG4gICAgICBleHBlY3QoaGFzUGVybWlzc2lvbikudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgICBcbiAgICB0ZXN0KCdkZW5pZXMgYWNjZXNzIGZvciB1c2VycyB3aXRob3V0IHJlcXVpcmVkIHBlcm1pc3Npb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlciA9IHtcbiAgICAgICAgaWQ6ICcxMjMnLFxuICAgICAgICByb2xlOiAnVVNFUicsXG4gICAgICAgIHBlcm1pc3Npb25zOiBbJ3JlYWQnXSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IGhhc1Blcm1pc3Npb24gPSBhd2FpdCBjaGVja1Blcm1pc3Npb25zKHVzZXIsICdkZWxldGUnKTtcbiAgICAgIGV4cGVjdChoYXNQZXJtaXNzaW9uKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgICBcbiAgICB0ZXN0KCdoYW5kbGVzIHJvbGUtYmFzZWQgcGVybWlzc2lvbnMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWRtaW5Vc2VyID0geyBpZDogJzEnLCByb2xlOiAnQURNSU4nIH07XG4gICAgICBjb25zdCByZWd1bGFyVXNlciA9IHsgaWQ6ICcyJywgcm9sZTogJ1VTRVInIH07XG4gICAgICBcbiAgICAgIGV4cGVjdChhd2FpdCBjaGVja1Blcm1pc3Npb25zKGFkbWluVXNlciwgJ2FkbWluLmFjY2VzcycpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGF3YWl0IGNoZWNrUGVybWlzc2lvbnMocmVndWxhclVzZXIsICdhZG1pbi5hY2Nlc3MnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZXNzaW9uIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgdGVzdCgnY3JlYXRlcyBzZWN1cmUgc2Vzc2lvbiB0b2tlbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXNzaW9uRGF0YSA9IHtcbiAgICAgICAgdXNlcklkOiAnMTIzJyxcbiAgICAgICAgZGV2aWNlSWQ6ICdkZXZpY2UtMTIzJyxcbiAgICAgICAgaXBBZGRyZXNzOiAnMTkyLjE2OC4xLjEnLFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgbW9ja0p3dC5zaWduLm1vY2tSZXR1cm5WYWx1ZSgnc2Vzc2lvbi50b2tlbicpO1xuICAgICAgXG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGNyZWF0ZVNlc3Npb25Ub2tlbihzZXNzaW9uRGF0YSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChqd3Quc2lnbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHNlc3Npb25EYXRhKSxcbiAgICAgICAgZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZXhwaXJlc0luOiBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ3ZhbGlkYXRlcyBzZXNzaW9uIHRva2VucyBhZ2FpbnN0IGJsYWNrbGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ3BvdGVudGlhbGx5LmJsYWNrbGlzdGVkLnRva2VuJztcbiAgICAgIGNvbnN0IG1vY2tCbGFja2xpc3QgPSBuZXcgU2V0KFsnYmxhY2tsaXN0ZWQudG9rZW4nXSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB2YWxpZGF0ZVNlc3Npb25Ub2tlbih0b2tlbiwgbW9ja0JsYWNrbGlzdCk7XG4gICAgICBleHBlY3QoaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgY29uc3QgaXNCbGFja2xpc3RlZCA9IGF3YWl0IHZhbGlkYXRlU2Vzc2lvblRva2VuKCdibGFja2xpc3RlZC50b2tlbicsIG1vY2tCbGFja2xpc3QpO1xuICAgICAgZXhwZWN0KGlzQmxhY2tsaXN0ZWQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTXVsdGktRmFjdG9yIEF1dGhlbnRpY2F0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ2dlbmVyYXRlcyB2YWxpZCBUT1RQIGNvZGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VjcmV0ID0gJ0pCU1dZM0RQRUhQSzNQWFAnO1xuICAgICAgY29uc3QgY29kZSA9IGdlbmVyYXRlVE9UUENvZGUoc2VjcmV0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNvZGUpLnRvTWF0Y2goL15cXGR7Nn0kLyk7XG4gICAgfSk7XG4gICAgXG4gICAgdGVzdCgndmVyaWZpZXMgVE9UUCBjb2RlcyB3aXRoaW4gdGltZSB3aW5kb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZWNyZXQgPSAnSkJTV1kzRFBFSFBLM1BYUCc7XG4gICAgICBjb25zdCB2YWxpZENvZGUgPSBnZW5lcmF0ZVRPVFBDb2RlKHNlY3JldCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB2ZXJpZnlUT1RQQ29kZSh2YWxpZENvZGUsIHNlY3JldCk7XG4gICAgICBleHBlY3QoaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgICBcbiAgICB0ZXN0KCdyZWplY3RzIGludmFsaWQgVE9UUCBjb2RlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlY3JldCA9ICdKQlNXWTNEUEVIUEszUFhQJztcbiAgICAgIGNvbnN0IGludmFsaWRDb2RlcyA9IFsnMDAwMDAwJywgJzEyMzQ1NicsICc5OTk5OTknXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBjb2RlIG9mIGludmFsaWRDb2Rlcykge1xuICAgICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgdmVyaWZ5VE9UUENvZGUoY29kZSwgc2VjcmV0KTtcbiAgICAgICAgZXhwZWN0KGlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG4vLyBNb2NrIGZ1bmN0aW9uIGltcGxlbWVudGF0aW9ucyBmb3IgdGVzdGluZ1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2Vzc2lvblRva2VuKGRhdGE6IGFueSk6IFByb21pc2U8c3RyaW5nPiB7XG4gIHJldHVybiBqd3Quc2lnbihkYXRhLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUISwgeyBleHBpcmVzSW46ICcyNGgnIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiB2YWxpZGF0ZVNlc3Npb25Ub2tlbih0b2tlbjogc3RyaW5nLCBibGFja2xpc3Q6IFNldDxzdHJpbmc+KTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHJldHVybiAhYmxhY2tsaXN0Lmhhcyh0b2tlbik7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVE9UUENvZGUoc2VjcmV0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBNb2NrIGltcGxlbWVudGF0aW9uXG4gIHJldHVybiBNYXRoLmZsb29yKDEwMDAwMCArIE1hdGgucmFuZG9tKCkgKiA5MDAwMDApLnRvU3RyaW5nKCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHZlcmlmeVRPVFBDb2RlKGNvZGU6IHN0cmluZywgc2VjcmV0OiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgLy8gTW9jayBpbXBsZW1lbnRhdGlvblxuICByZXR1cm4gY29kZSA9PT0gZ2VuZXJhdGVUT1RQQ29kZShzZWNyZXQpO1xufSJdLCJ2ZXJzaW9uIjozfQ==