44fd39613acc03f11d109edf66023f23
import { Router } from 'express';
import { Prisma } from '../prisma';
import { prisma } from '../prisma';
import { validate } from '../validation';
import { z } from 'zod';
import { auditLoggers } from '../middleware/auditLog';
const router = Router();
// Validation schemas
const studentCreateSchema = z
    .object({
    firstName: z.string().min(1).max(100).optional(),
    lastName: z.string().min(1).max(100).optional(),
    grade: z.number().int().min(1).max(12).optional(),
    // Legacy field for backward compatibility
    name: z.string().min(1).max(200).optional(),
})
    .refine((data) => {
    // Either use new fields (firstName, lastName, grade) or legacy name field
    return (data.firstName && data.lastName && typeof data.grade === 'number') || data.name;
}, {
    message: 'Either provide firstName, lastName, and grade, or provide name',
});
const studentUpdateSchema = z.object({
    firstName: z.string().min(1).max(100).optional(),
    lastName: z.string().min(1).max(100).optional(),
    grade: z.number().int().min(1).max(12).optional(),
    name: z.string().min(1).max(200).optional(),
});
const studentGoalCreateSchema = z.object({
    text: z.string().min(1).max(500),
    // themeId removed - ThematicUnit model archived
    unitPlanId: z.number().int().optional(),
    status: z.enum(['active', 'completed', 'abandoned']).default('active'),
});
const studentGoalUpdateSchema = z.object({
    text: z.string().min(1).max(500).optional(),
    // themeId removed - ThematicUnit model archived
    unitPlanId: z.number().int().optional(),
    status: z.enum(['active', 'completed', 'abandoned']).optional(),
});
const studentReflectionCreateSchema = z.object({
    date: z.string().datetime().optional(),
    text: z.string().max(1000).optional(),
    content: z.string().max(1000).optional(),
    emoji: z.string().max(10).optional(),
    voicePath: z.string().max(500).optional(),
    // themeId removed - ThematicUnit model archived
    unitPlanId: z.number().int().optional(),
});
// Get all students for the authenticated teacher
router.get('/', auditLoggers.studentView, async (req, res, next) => {
    try {
        const userId = req.user?.id;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const students = await prisma.student.findMany({
            where: { userId: parseInt(userId) },
            include: {
                goals: true,
                reflections: true,
                _count: {
                    select: {
                        artifacts: true,
                        reflections: true,
                        parentSummaries: true,
                    },
                },
            },
            orderBy: [{ grade: 'asc' }, { lastName: 'asc' }, { firstName: 'asc' }],
        });
        // Add backward compatibility for name field and mask sensitive data
        const studentsWithLegacy = students.map((student) => ({
            ...student,
            name: student.firstName && student.lastName
                ? `${student.firstName} ${student.lastName}`
                : 'Unnamed Student',
            // Remove any accidentally included sensitive fields
            createdAt: undefined,
            updatedAt: undefined,
        }));
        res.json(studentsWithLegacy);
    }
    catch (err) {
        next(err);
    }
});
// Get a specific student
router.get('/:id', auditLoggers.studentView, async (req, res, next) => {
    try {
        const userId = req.user?.id;
        const studentId = parseInt(req.params.id);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const student = await prisma.student.findFirst({
            where: {
                id: studentId,
                userId: parseInt(userId),
            },
            include: {
                goals: true,
                reflections: true,
                artifacts: {
                    orderBy: { createdAt: 'desc' },
                    take: 10,
                },
                parentSummaries: {
                    orderBy: { createdAt: 'desc' },
                    take: 5,
                },
            },
        });
        if (!student) {
            return res.status(404).json({ error: 'Student not found' });
        }
        // Add backward compatibility for name field and mask sensitive data
        const studentWithLegacy = {
            ...student,
            name: student.firstName && student.lastName
                ? `${student.firstName} ${student.lastName}`
                : 'Unnamed Student',
            // Remove any accidentally included sensitive fields
            createdAt: undefined,
            updatedAt: undefined,
        };
        res.json(studentWithLegacy);
    }
    catch (err) {
        next(err);
    }
});
// Create a new student
router.post('/', validate(studentCreateSchema), auditLoggers.studentCreate, async (req, res, next) => {
    try {
        const userId = req.user?.id;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { firstName, lastName, grade, name } = req.body;
        // Handle both new and legacy formats
        let studentData;
        if (firstName && lastName && grade !== undefined) {
            // New parent communication format
            studentData = {
                firstName,
                lastName,
                grade,
                userId: parseInt(userId),
            };
        }
        else if (name) {
            // Legacy format - extract first and last name from full name
            const nameParts = name.trim().split(' ');
            const firstNamePart = nameParts[0] || 'Unknown';
            const lastNamePart = nameParts.slice(1).join(' ') || 'Student';
            studentData = {
                firstName: firstNamePart,
                lastName: lastNamePart,
                grade: 1, // Default grade for legacy students
                userId: parseInt(userId),
            };
        }
        else {
            return res.status(400).json({ error: 'Invalid student data' });
        }
        const student = await prisma.student.create({
            data: studentData,
            include: {
                goals: true,
                reflections: true,
            },
        });
        // Add backward compatibility for name field
        const studentWithLegacy = {
            ...student,
            name: `${student.firstName} ${student.lastName}`,
        };
        res.status(201).json(studentWithLegacy);
    }
    catch (err) {
        next(err);
    }
});
// Update a student
router.put('/:id', validate(studentUpdateSchema), auditLoggers.studentUpdate, async (req, res, next) => {
    try {
        const userId = req.user?.id;
        const studentId = parseInt(req.params.id);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        // Verify the student belongs to this teacher
        const existingStudent = await prisma.student.findFirst({
            where: {
                id: studentId,
                userId: parseInt(userId),
            },
        });
        if (!existingStudent) {
            return res.status(404).json({ error: 'Student not found' });
        }
        const { firstName, lastName, grade, name } = req.body;
        const updateData = {};
        if (firstName !== undefined)
            updateData.firstName = firstName;
        if (lastName !== undefined)
            updateData.lastName = lastName;
        if (grade !== undefined)
            updateData.grade = grade;
        // Handle legacy name field
        if (name !== undefined) {
            const nameParts = name.trim().split(' ');
            updateData.firstName = nameParts[0] || 'Unknown';
            updateData.lastName = nameParts.slice(1).join(' ') || 'Student';
        }
        const student = await prisma.student.update({
            where: { id: studentId },
            data: updateData,
            include: {
                goals: true,
                reflections: true,
            },
        });
        // Add backward compatibility for name field
        const studentWithLegacy = {
            ...student,
            name: `${student.firstName} ${student.lastName}`,
        };
        res.json(studentWithLegacy);
    }
    catch (err) {
        next(err);
    }
});
// Delete a student
router.delete('/:id', auditLoggers.studentDelete, async (req, res, next) => {
    try {
        const userId = req.user?.id;
        const studentId = parseInt(req.params.id);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        // Verify the student belongs to this teacher
        const existingStudent = await prisma.student.findFirst({
            where: {
                id: studentId,
                userId: parseInt(userId),
            },
        });
        if (!existingStudent) {
            return res.status(404).json({ error: 'Student not found' });
        }
        // Delete related data in a transaction for data integrity
        await prisma.$transaction(async (tx) => {
            // Delete in dependency order
            await tx.studentArtifact.deleteMany({ where: { studentId } });
            await tx.studentReflection.deleteMany({ where: { studentId } });
            await tx.studentGoal.deleteMany({ where: { studentId } });
            await tx.parentSummary.deleteMany({ where: { studentId } });
            // Finally delete the student
            await tx.student.delete({ where: { id: studentId } });
        }, {
            // Set a timeout for the transaction
            timeout: 10000, // 10 seconds
        });
        res.status(204).send();
    }
    catch (err) {
        next(err);
    }
});
// Student goals routes
router.get('/:id/goals', async (req, res, next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const student = await prisma.student.findFirst({
            where: {
                id: Number(req.params.id),
                userId,
            },
        });
        if (!student)
            return res.status(404).json({ error: 'Student not found' });
        const goals = await prisma.studentGoal.findMany({
            where: { studentId: Number(req.params.id) },
            // theme removed - ThematicUnit model archived
            orderBy: { createdAt: 'desc' },
        });
        res.json(goals);
    }
    catch (err) {
        next(err);
    }
});
router.post('/:id/goals', validate(studentGoalCreateSchema), async (req, res, next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const student = await prisma.student.findFirst({
            where: {
                id: Number(req.params.id),
                userId,
            },
        });
        if (!student)
            return res.status(404).json({ error: 'Student not found' });
        const goal = await prisma.studentGoal.create({
            data: {
                studentId: Number(req.params.id),
                text: req.body.text,
                unitPlanId: req.body.unitPlanId || null,
                status: req.body.status || 'active',
            },
            // theme removed - ThematicUnit model archived
        });
        res.status(201).json(goal);
    }
    catch (err) {
        next(err);
    }
});
router.patch('/:id/goals/:goalId', validate(studentGoalUpdateSchema), async (req, res, next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const student = await prisma.student.findFirst({
            where: {
                id: Number(req.params.id),
                userId,
            },
        });
        if (!student)
            return res.status(404).json({ error: 'Student not found' });
        const goal = await prisma.studentGoal.update({
            where: {
                id: Number(req.params.goalId),
                studentId: Number(req.params.id),
            },
            data: {
                text: req.body.text,
                status: req.body.status,
                unitPlanId: req.body.unitPlanId,
            },
            // theme removed - ThematicUnit model archived
        });
        res.json(goal);
    }
    catch (err) {
        if (err instanceof Prisma.PrismaClientKnownRequestError && err.code === 'P2025') {
            return res.status(404).json({ error: 'Goal not found' });
        }
        next(err);
    }
});
router.delete('/:id/goals/:goalId', async (req, res, next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const student = await prisma.student.findFirst({
            where: {
                id: Number(req.params.id),
                userId,
            },
        });
        if (!student)
            return res.status(404).json({ error: 'Student not found' });
        await prisma.studentGoal.delete({
            where: {
                id: Number(req.params.goalId),
                studentId: Number(req.params.id),
            },
        });
        res.status(204).end();
    }
    catch (err) {
        if (err instanceof Prisma.PrismaClientKnownRequestError && err.code === 'P2025') {
            return res.status(404).json({ error: 'Goal not found' });
        }
        next(err);
    }
});
// Student reflections routes
router.get('/:id/reflections', async (req, res, next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const student = await prisma.student.findFirst({
            where: {
                id: Number(req.params.id),
                userId,
            },
        });
        if (!student)
            return res.status(404).json({ error: 'Student not found' });
        const reflections = await prisma.studentReflection.findMany({
            where: { studentId: Number(req.params.id) },
            // theme removed - ThematicUnit model archived
            orderBy: { createdAt: 'desc' },
        });
        res.json(reflections);
    }
    catch (err) {
        next(err);
    }
});
router.post('/:id/reflections', validate(studentReflectionCreateSchema), async (req, res, next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const student = await prisma.student.findFirst({
            where: {
                id: Number(req.params.id),
                userId,
            },
        });
        if (!student)
            return res.status(404).json({ error: 'Student not found' });
        const reflection = await prisma.studentReflection.create({
            data: {
                studentId: Number(req.params.id),
                content: req.body.content || req.body.text || null,
                date: req.body.date ? new Date(req.body.date) : new Date(),
                unitPlanId: req.body.unitPlanId || null,
            },
            // theme removed - ThematicUnit model archived
        });
        res.status(201).json(reflection);
    }
    catch (err) {
        next(err);
    }
});
router.delete('/:id/reflections/:reflectionId', async (req, res, next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const student = await prisma.student.findFirst({
            where: {
                id: Number(req.params.id),
                userId,
            },
        });
        if (!student)
            return res.status(404).json({ error: 'Student not found' });
        await prisma.studentReflection.delete({
            where: {
                id: Number(req.params.reflectionId),
                studentId: Number(req.params.id),
            },
        });
        res.status(204).end();
    }
    catch (err) {
        if (err instanceof Prisma.PrismaClientKnownRequestError && err.code === 'P2025') {
            return res.status(404).json({ error: 'Reflection not found' });
        }
        next(err);
    }
});
// Get student progress summary
router.get('/:id/progress', auditLoggers.studentView, async (req, res, next) => {
    try {
        const userId = req.user?.id;
        const studentId = parseInt(req.params.id);
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const student = await prisma.student.findFirst({
            where: {
                id: studentId,
                userId: parseInt(userId),
            },
        });
        if (!student) {
            return res.status(404).json({ error: 'Student not found' });
        }
        // Assessment functionality removed
        res.json({
            student,
            progress: {
                totalAssessments: 0,
                averageScore: null,
                assessmentsByType: {},
                artifactCount: await prisma.studentArtifact.count({ where: { studentId } }),
                reflectionCount: await prisma.studentReflection.count({ where: { studentId } }),
            },
        });
    }
    catch (err) {
        next(err);
    }
});
export default router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9yb3V0ZXMvc3R1ZGVudC50cyIsIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFXLE1BQU0sU0FBUyxDQUFDO0FBQzFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDbkMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxLQUFLLENBQUM7QUFDeEIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBR3RELE1BQU0sTUFBTSxHQUFHLE1BQU0sRUFBRSxDQUFDO0FBRXhCLHFCQUFxQjtBQUNyQixNQUFNLG1CQUFtQixHQUFHLENBQUM7S0FDMUIsTUFBTSxDQUFDO0lBQ04sU0FBUyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRTtJQUNoRCxRQUFRLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFO0lBQy9DLEtBQUssRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUU7SUFDakQsMENBQTBDO0lBQzFDLElBQUksRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUU7Q0FDNUMsQ0FBQztLQUNELE1BQU0sQ0FDTCxDQUFD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RUFBRSxDQUFDO1lBQ2IsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxtQkFBbUIsRUFBRSxDQUFDLENBQUM7UUFDOUQsQ0FBQztRQUVELG1DQUFtQztRQUVuQyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBQ1AsT0FBTztZQUNQLFFBQVEsRUFBRTtnQkFDUixnQkFBZ0IsRUFBRSxDQUFDO2dCQUNuQixZQUFZLEVBQUUsSUFBSTtnQkFDbEIsaUJBQWlCLEVBQUUsRUFBRTtnQkFDckIsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRSxDQUFDO2dCQUMzRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsU0FBUyxFQUFFLEVBQUUsQ0FBQzthQUNoRjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ1osQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDO0FBRUgsZUFBZSxNQUFNLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9yb3V0ZXMvc3R1ZGVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIsIFJlcXVlc3QgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IFByaXNtYSB9IGZyb20gJy4uL3ByaXNtYSc7XG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9wcmlzbWEnO1xuaW1wb3J0IHsgdmFsaWRhdGUgfSBmcm9tICcuLi92YWxpZGF0aW9uJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgYXVkaXRMb2dnZXJzIH0gZnJvbSAnLi4vbWlkZGxld2FyZS9hdWRpdExvZyc7XG5cblxuY29uc3Qgcm91dGVyID0gUm91dGVyKCk7XG5cbi8vIFZhbGlkYXRpb24gc2NoZW1hc1xuY29uc3Qgc3R1ZGVudENyZWF0ZVNjaGVtYSA9IHpcbiAgLm9iamVjdCh7XG4gICAgZmlyc3ROYW1lOiB6LnN0cmluZygpLm1pbigxKS5tYXgoMTAwKS5vcHRpb25hbCgpLFxuICAgIGxhc3ROYW1lOiB6LnN0cmluZygpLm1pbigxKS5tYXgoMTAwKS5vcHRpb25hbCgpLFxuICAgIGdyYWRlOiB6Lm51bWJlcigpLmludCgpLm1pbigxKS5tYXgoMTIpLm9wdGlvbmFsKCksXG4gICAgLy8gTGVnYWN5IGZpZWxkIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgbmFtZTogei5zdHJpbmcoKS5taW4oMSkubWF4KDIwMCkub3B0aW9uYWwoKSxcbiAgfSlcbiAgLnJlZmluZShcbiAgICAoZGF0YSkgPT4ge1xuICAgICAgLy8gRWl0aGVyIHVzZSBuZXcgZmllbGRzIChmaXJzdE5hbWUsIGxhc3ROYW1lLCBncmFkZSkgb3IgbGVnYWN5IG5hbWUgZmllbGRcbiAgICAgIHJldHVybiAoZGF0YS5maXJzdE5hbWUgJiYgZGF0YS5sYXN0TmFtZSAmJiB0eXBlb2YgZGF0YS5ncmFkZSA9PT0gJ251bWJlcicpIHx8IGRhdGEubmFtZTtcbiAgICB9LFxuICAgIHtcbiAgICAgIG1lc3NhZ2U6ICdFaXRoZXIgcHJvdmlkZSBmaXJzdE5hbWUsIGxhc3ROYW1lLCBhbmQgZ3JhZGUsIG9yIHByb3ZpZGUgbmFtZScsXG4gICAgfSxcbiAgKTtcblxuY29uc3Qgc3R1ZGVudFVwZGF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgZmlyc3ROYW1lOiB6LnN0cmluZygpLm1pbigxKS5tYXgoMTAwKS5vcHRpb25hbCgpLFxuICBsYXN0TmFtZTogei5zdHJpbmcoKS5taW4oMSkubWF4KDEwMCkub3B0aW9uYWwoKSxcbiAgZ3JhZGU6IHoubnVtYmVyKCkuaW50KCkubWluKDEpLm1heCgxMikub3B0aW9uYWwoKSxcbiAgbmFtZTogei5zdHJpbmcoKS5taW4oMSkubWF4KDIwMCkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCBzdHVkZW50R29hbENyZWF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgdGV4dDogei5zdHJpbmcoKS5taW4oMSkubWF4KDUwMCksXG4gIC8vIHRoZW1lSWQgcmVtb3ZlZCAtIFRoZW1hdGljVW5pdCBtb2RlbCBhcmNoaXZlZFxuICB1bml0UGxhbklkOiB6Lm51bWJlcigpLmludCgpLm9wdGlvbmFsKCksXG4gIHN0YXR1czogei5lbnVtKFsnYWN0aXZlJywgJ2NvbXBsZXRlZCcsICdhYmFuZG9uZWQnXSkuZGVmYXVsdCgnYWN0aXZlJyksXG59KTtcblxuY29uc3Qgc3R1ZGVudEdvYWxVcGRhdGVTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHRleHQ6IHouc3RyaW5nKCkubWluKDEpLm1heCg1MDApLm9wdGlvbmFsKCksXG4gIC8vIHRoZW1lSWQgcmVtb3ZlZCAtIFRoZW1hdGljVW5pdCBtb2RlbCBhcmNoaXZlZFxuICB1bml0UGxhbklkOiB6Lm51bWJlcigpLmludCgpLm9wdGlvbmFsKCksXG4gIHN0YXR1czogei5lbnVtKFsnYWN0aXZlJywgJ2NvbXBsZXRlZCcsICdhYmFuZG9uZWQnXSkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCBzdHVkZW50UmVmbGVjdGlvbkNyZWF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgZGF0ZTogei5zdHJpbmcoKS5kYXRldGltZSgpLm9wdGlvbmFsKCksXG4gIHRleHQ6IHouc3RyaW5nKCkubWF4KDEwMDApLm9wdGlvbmFsKCksXG4gIGNvbnRlbnQ6IHouc3RyaW5nKCkubWF4KDEwMDApLm9wdGlvbmFsKCksXG4gIGVtb2ppOiB6LnN0cmluZygpLm1heCgxMCkub3B0aW9uYWwoKSxcbiAgdm9pY2VQYXRoOiB6LnN0cmluZygpLm1heCg1MDApLm9wdGlvbmFsKCksXG4gIC8vIHRoZW1lSWQgcmVtb3ZlZCAtIFRoZW1hdGljVW5pdCBtb2RlbCBhcmNoaXZlZFxuICB1bml0UGxhbklkOiB6Lm51bWJlcigpLmludCgpLm9wdGlvbmFsKCksXG59KTtcblxuLy8gR2V0IGFsbCBzdHVkZW50cyBmb3IgdGhlIGF1dGhlbnRpY2F0ZWQgdGVhY2hlclxucm91dGVyLmdldCgnLycsIGF1ZGl0TG9nZ2Vycy5zdHVkZW50VmlldywgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXI/LmlkO1xuXG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBzdHVkZW50cyA9IGF3YWl0IHByaXNtYS5zdHVkZW50LmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7IHVzZXJJZDogcGFyc2VJbnQodXNlcklkKSB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBnb2FsczogdHJ1ZSxcbiAgICAgICAgcmVmbGVjdGlvbnM6IHRydWUsXG4gICAgICAgIF9jb3VudDoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgYXJ0aWZhY3RzOiB0cnVlLFxuICAgICAgICAgICAgcmVmbGVjdGlvbnM6IHRydWUsXG4gICAgICAgICAgICBwYXJlbnRTdW1tYXJpZXM6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBvcmRlckJ5OiBbeyBncmFkZTogJ2FzYycgfSwgeyBsYXN0TmFtZTogJ2FzYycgfSwgeyBmaXJzdE5hbWU6ICdhc2MnIH1dLFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgZm9yIG5hbWUgZmllbGQgYW5kIG1hc2sgc2Vuc2l0aXZlIGRhdGFcbiAgICBjb25zdCBzdHVkZW50c1dpdGhMZWdhY3kgPSBzdHVkZW50cy5tYXAoKHN0dWRlbnQpID0+ICh7XG4gICAgICAuLi5zdHVkZW50LFxuICAgICAgbmFtZTpcbiAgICAgICAgc3R1ZGVudC5maXJzdE5hbWUgJiYgc3R1ZGVudC5sYXN0TmFtZVxuICAgICAgICAgID8gYCR7c3R1ZGVudC5maXJzdE5hbWV9ICR7c3R1ZGVudC5sYXN0TmFtZX1gXG4gICAgICAgICAgOiAnVW5uYW1lZCBTdHVkZW50JyxcbiAgICAgIC8vIFJlbW92ZSBhbnkgYWNjaWRlbnRhbGx5IGluY2x1ZGVkIHNlbnNpdGl2ZSBmaWVsZHNcbiAgICAgIGNyZWF0ZWRBdDogdW5kZWZpbmVkLFxuICAgICAgdXBkYXRlZEF0OiB1bmRlZmluZWQsXG4gICAgfSkpO1xuXG4gICAgcmVzLmpzb24oc3R1ZGVudHNXaXRoTGVnYWN5KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbmV4dChlcnIpO1xuICB9XG59KTtcblxuLy8gR2V0IGEgc3BlY2lmaWMgc3R1ZGVudFxucm91dGVyLmdldCgnLzppZCcsIGF1ZGl0TG9nZ2Vycy5zdHVkZW50VmlldywgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXI/LmlkO1xuICAgIGNvbnN0IHN0dWRlbnRJZCA9IHBhcnNlSW50KHJlcS5wYXJhbXMuaWQpO1xuXG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBzdHVkZW50ID0gYXdhaXQgcHJpc21hLnN0dWRlbnQuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBzdHVkZW50SWQsXG4gICAgICAgIHVzZXJJZDogcGFyc2VJbnQodXNlcklkKSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGdvYWxzOiB0cnVlLFxuICAgICAgICByZWZsZWN0aW9uczogdHJ1ZSxcbiAgICAgICAgYXJ0aWZhY3RzOiB7XG4gICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICAgIHRha2U6IDEwLFxuICAgICAgICB9LFxuICAgICAgICBwYXJlbnRTdW1tYXJpZXM6IHtcbiAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgICAgdGFrZTogNSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXN0dWRlbnQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnU3R1ZGVudCBub3QgZm91bmQnIH0pO1xuICAgIH1cblxuICAgIC8vIEFkZCBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IGZvciBuYW1lIGZpZWxkIGFuZCBtYXNrIHNlbnNpdGl2ZSBkYXRhXG4gICAgY29uc3Qgc3R1ZGVudFdpdGhMZWdhY3kgPSB7XG4gICAgICAuLi5zdHVkZW50LFxuICAgICAgbmFtZTpcbiAgICAgICAgc3R1ZGVudC5maXJzdE5hbWUgJiYgc3R1ZGVudC5sYXN0TmFtZVxuICAgICAgICAgID8gYCR7c3R1ZGVudC5maXJzdE5hbWV9ICR7c3R1ZGVudC5sYXN0TmFtZX1gXG4gICAgICAgICAgOiAnVW5uYW1lZCBTdHVkZW50JyxcbiAgICAgIC8vIFJlbW92ZSBhbnkgYWNjaWRlbnRhbGx5IGluY2x1ZGVkIHNlbnNpdGl2ZSBmaWVsZHNcbiAgICAgIGNyZWF0ZWRBdDogdW5kZWZpbmVkLFxuICAgICAgdXBkYXRlZEF0OiB1bmRlZmluZWQsXG4gICAgfTtcblxuICAgIHJlcy5qc29uKHN0dWRlbnRXaXRoTGVnYWN5KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbmV4dChlcnIpO1xuICB9XG59KTtcblxuLy8gQ3JlYXRlIGEgbmV3IHN0dWRlbnRcbnJvdXRlci5wb3N0KCcvJywgdmFsaWRhdGUoc3R1ZGVudENyZWF0ZVNjaGVtYSksIGF1ZGl0TG9nZ2Vycy5zdHVkZW50Q3JlYXRlLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlcj8uaWQ7XG5cbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZmlyc3ROYW1lLCBsYXN0TmFtZSwgZ3JhZGUsIG5hbWUgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gSGFuZGxlIGJvdGggbmV3IGFuZCBsZWdhY3kgZm9ybWF0c1xuICAgIGxldCBzdHVkZW50RGF0YTtcbiAgICBpZiAoZmlyc3ROYW1lICYmIGxhc3ROYW1lICYmIGdyYWRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIE5ldyBwYXJlbnQgY29tbXVuaWNhdGlvbiBmb3JtYXRcbiAgICAgIHN0dWRlbnREYXRhID0ge1xuICAgICAgICBmaXJzdE5hbWUsXG4gICAgICAgIGxhc3ROYW1lLFxuICAgICAgICBncmFkZSxcbiAgICAgICAgdXNlcklkOiBwYXJzZUludCh1c2VySWQpLFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKG5hbWUpIHtcbiAgICAgIC8vIExlZ2FjeSBmb3JtYXQgLSBleHRyYWN0IGZpcnN0IGFuZCBsYXN0IG5hbWUgZnJvbSBmdWxsIG5hbWVcbiAgICAgIGNvbnN0IG5hbWVQYXJ0cyA9IG5hbWUudHJpbSgpLnNwbGl0KCcgJyk7XG4gICAgICBjb25zdCBmaXJzdE5hbWVQYXJ0ID0gbmFtZVBhcnRzWzBdIHx8ICdVbmtub3duJztcbiAgICAgIGNvbnN0IGxhc3ROYW1lUGFydCA9IG5hbWVQYXJ0cy5zbGljZSgxKS5qb2luKCcgJykgfHwgJ1N0dWRlbnQnO1xuXG4gICAgICBzdHVkZW50RGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiBmaXJzdE5hbWVQYXJ0LFxuICAgICAgICBsYXN0TmFtZTogbGFzdE5hbWVQYXJ0LFxuICAgICAgICBncmFkZTogMSwgLy8gRGVmYXVsdCBncmFkZSBmb3IgbGVnYWN5IHN0dWRlbnRzXG4gICAgICAgIHVzZXJJZDogcGFyc2VJbnQodXNlcklkKSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnSW52YWxpZCBzdHVkZW50IGRhdGEnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHN0dWRlbnQgPSBhd2FpdCBwcmlzbWEuc3R1ZGVudC5jcmVhdGUoe1xuICAgICAgZGF0YTogc3R1ZGVudERhdGEsXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGdvYWxzOiB0cnVlLFxuICAgICAgICByZWZsZWN0aW9uczogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgYmFja3dhcmQgY29tcGF0aWJpbGl0eSBmb3IgbmFtZSBmaWVsZFxuICAgIGNvbnN0IHN0dWRlbnRXaXRoTGVnYWN5ID0ge1xuICAgICAgLi4uc3R1ZGVudCxcbiAgICAgIG5hbWU6IGAke3N0dWRlbnQuZmlyc3ROYW1lfSAke3N0dWRlbnQubGFzdE5hbWV9YCxcbiAgICB9O1xuXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oc3R1ZGVudFdpdGhMZWdhY3kpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBuZXh0KGVycik7XG4gIH1cbn0pO1xuXG4vLyBVcGRhdGUgYSBzdHVkZW50XG5yb3V0ZXIucHV0KCcvOmlkJywgdmFsaWRhdGUoc3R1ZGVudFVwZGF0ZVNjaGVtYSksIGF1ZGl0TG9nZ2Vycy5zdHVkZW50VXBkYXRlLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlcj8uaWQ7XG4gICAgY29uc3Qgc3R1ZGVudElkID0gcGFyc2VJbnQocmVxLnBhcmFtcy5pZCk7XG5cbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIC8vIFZlcmlmeSB0aGUgc3R1ZGVudCBiZWxvbmdzIHRvIHRoaXMgdGVhY2hlclxuICAgIGNvbnN0IGV4aXN0aW5nU3R1ZGVudCA9IGF3YWl0IHByaXNtYS5zdHVkZW50LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogc3R1ZGVudElkLFxuICAgICAgICB1c2VySWQ6IHBhcnNlSW50KHVzZXJJZCksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFleGlzdGluZ1N0dWRlbnQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnU3R1ZGVudCBub3QgZm91bmQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZmlyc3ROYW1lLCBsYXN0TmFtZSwgZ3JhZGUsIG5hbWUgfSA9IHJlcS5ib2R5O1xuXG4gICAgY29uc3QgdXBkYXRlRGF0YTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fTtcbiAgICBpZiAoZmlyc3ROYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuZmlyc3ROYW1lID0gZmlyc3ROYW1lO1xuICAgIGlmIChsYXN0TmFtZSAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmxhc3ROYW1lID0gbGFzdE5hbWU7XG4gICAgaWYgKGdyYWRlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuZ3JhZGUgPSBncmFkZTtcblxuICAgIC8vIEhhbmRsZSBsZWdhY3kgbmFtZSBmaWVsZFxuICAgIGlmIChuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnN0IG5hbWVQYXJ0cyA9IG5hbWUudHJpbSgpLnNwbGl0KCcgJyk7XG4gICAgICB1cGRhdGVEYXRhLmZpcnN0TmFtZSA9IG5hbWVQYXJ0c1swXSB8fCAnVW5rbm93bic7XG4gICAgICB1cGRhdGVEYXRhLmxhc3ROYW1lID0gbmFtZVBhcnRzLnNsaWNlKDEpLmpvaW4oJyAnKSB8fCAnU3R1ZGVudCc7XG4gICAgfVxuXG4gICAgY29uc3Qgc3R1ZGVudCA9IGF3YWl0IHByaXNtYS5zdHVkZW50LnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogc3R1ZGVudElkIH0sXG4gICAgICBkYXRhOiB1cGRhdGVEYXRhLFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBnb2FsczogdHJ1ZSxcbiAgICAgICAgcmVmbGVjdGlvbnM6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgZm9yIG5hbWUgZmllbGRcbiAgICBjb25zdCBzdHVkZW50V2l0aExlZ2FjeSA9IHtcbiAgICAgIC4uLnN0dWRlbnQsXG4gICAgICBuYW1lOiBgJHtzdHVkZW50LmZpcnN0TmFtZX0gJHtzdHVkZW50Lmxhc3ROYW1lfWAsXG4gICAgfTtcblxuICAgIHJlcy5qc29uKHN0dWRlbnRXaXRoTGVnYWN5KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbmV4dChlcnIpO1xuICB9XG59KTtcblxuLy8gRGVsZXRlIGEgc3R1ZGVudFxucm91dGVyLmRlbGV0ZSgnLzppZCcsIGF1ZGl0TG9nZ2Vycy5zdHVkZW50RGVsZXRlLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlcj8uaWQ7XG4gICAgY29uc3Qgc3R1ZGVudElkID0gcGFyc2VJbnQocmVxLnBhcmFtcy5pZCk7XG5cbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIC8vIFZlcmlmeSB0aGUgc3R1ZGVudCBiZWxvbmdzIHRvIHRoaXMgdGVhY2hlclxuICAgIGNvbnN0IGV4aXN0aW5nU3R1ZGVudCA9IGF3YWl0IHByaXNtYS5zdHVkZW50LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogc3R1ZGVudElkLFxuICAgICAgICB1c2VySWQ6IHBhcnNlSW50KHVzZXJJZCksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFleGlzdGluZ1N0dWRlbnQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnU3R1ZGVudCBub3QgZm91bmQnIH0pO1xuICAgIH1cblxuICAgIC8vIERlbGV0ZSByZWxhdGVkIGRhdGEgaW4gYSB0cmFuc2FjdGlvbiBmb3IgZGF0YSBpbnRlZ3JpdHlcbiAgICBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgLy8gRGVsZXRlIGluIGRlcGVuZGVuY3kgb3JkZXJcbiAgICAgIGF3YWl0IHR4LnN0dWRlbnRBcnRpZmFjdC5kZWxldGVNYW55KHsgd2hlcmU6IHsgc3R1ZGVudElkIH0gfSk7XG4gICAgICBhd2FpdCB0eC5zdHVkZW50UmVmbGVjdGlvbi5kZWxldGVNYW55KHsgd2hlcmU6IHsgc3R1ZGVudElkIH0gfSk7XG4gICAgICBhd2FpdCB0eC5zdHVkZW50R29hbC5kZWxldGVNYW55KHsgd2hlcmU6IHsgc3R1ZGVudElkIH0gfSk7XG4gICAgICBhd2FpdCB0eC5wYXJlbnRTdW1tYXJ5LmRlbGV0ZU1hbnkoeyB3aGVyZTogeyBzdHVkZW50SWQgfSB9KTtcbiAgICAgIFxuICAgICAgLy8gRmluYWxseSBkZWxldGUgdGhlIHN0dWRlbnRcbiAgICAgIGF3YWl0IHR4LnN0dWRlbnQuZGVsZXRlKHsgd2hlcmU6IHsgaWQ6IHN0dWRlbnRJZCB9IH0pO1xuICAgIH0sIHtcbiAgICAgIC8vIFNldCBhIHRpbWVvdXQgZm9yIHRoZSB0cmFuc2FjdGlvblxuICAgICAgdGltZW91dDogMTAwMDAsIC8vIDEwIHNlY29uZHNcbiAgICB9KTtcblxuICAgIHJlcy5zdGF0dXMoMjA0KS5zZW5kKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIG5leHQoZXJyKTtcbiAgfVxufSk7XG5cbi8vIFN0dWRlbnQgZ29hbHMgcm91dGVzXG5yb3V0ZXIuZ2V0KCcvOmlkL2dvYWxzJywgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXI/LmlkIHx8IDA7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9KTtcbiAgICB9XG4gICAgY29uc3Qgc3R1ZGVudCA9IGF3YWl0IHByaXNtYS5zdHVkZW50LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogTnVtYmVyKHJlcS5wYXJhbXMuaWQpLFxuICAgICAgICB1c2VySWQsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIGlmICghc3R1ZGVudCkgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdTdHVkZW50IG5vdCBmb3VuZCcgfSk7XG5cbiAgICBjb25zdCBnb2FscyA9IGF3YWl0IHByaXNtYS5zdHVkZW50R29hbC5maW5kTWFueSh7XG4gICAgICB3aGVyZTogeyBzdHVkZW50SWQ6IE51bWJlcihyZXEucGFyYW1zLmlkKSB9LFxuICAgICAgLy8gdGhlbWUgcmVtb3ZlZCAtIFRoZW1hdGljVW5pdCBtb2RlbCBhcmNoaXZlZFxuICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgIH0pO1xuICAgIHJlcy5qc29uKGdvYWxzKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbmV4dChlcnIpO1xuICB9XG59KTtcblxucm91dGVyLnBvc3QoXG4gICcvOmlkL2dvYWxzJyxcbiAgdmFsaWRhdGUoc3R1ZGVudEdvYWxDcmVhdGVTY2hlbWEpLFxuICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXMsIG5leHQpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXI/LmlkIHx8IDA7XG4gICAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCBzdHVkZW50ID0gYXdhaXQgcHJpc21hLnN0dWRlbnQuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBpZDogTnVtYmVyKHJlcS5wYXJhbXMuaWQpLFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgaWYgKCFzdHVkZW50KSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ1N0dWRlbnQgbm90IGZvdW5kJyB9KTtcblxuICAgICAgY29uc3QgZ29hbCA9IGF3YWl0IHByaXNtYS5zdHVkZW50R29hbC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3R1ZGVudElkOiBOdW1iZXIocmVxLnBhcmFtcy5pZCksXG4gICAgICAgICAgdGV4dDogcmVxLmJvZHkudGV4dCxcbiAgICAgICAgICB1bml0UGxhbklkOiByZXEuYm9keS51bml0UGxhbklkIHx8IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiByZXEuYm9keS5zdGF0dXMgfHwgJ2FjdGl2ZScsXG4gICAgICAgIH0sXG4gICAgICAgIC8vIHRoZW1lIHJlbW92ZWQgLSBUaGVtYXRpY1VuaXQgbW9kZWwgYXJjaGl2ZWRcbiAgICAgIH0pO1xuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oZ29hbCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBuZXh0KGVycik7XG4gICAgfVxuICB9LFxuKTtcblxucm91dGVyLnBhdGNoKFxuICAnLzppZC9nb2Fscy86Z29hbElkJyxcbiAgdmFsaWRhdGUoc3R1ZGVudEdvYWxVcGRhdGVTY2hlbWEpLFxuICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXMsIG5leHQpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXI/LmlkIHx8IDA7XG4gICAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCBzdHVkZW50ID0gYXdhaXQgcHJpc21hLnN0dWRlbnQuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBpZDogTnVtYmVyKHJlcS5wYXJhbXMuaWQpLFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgaWYgKCFzdHVkZW50KSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ1N0dWRlbnQgbm90IGZvdW5kJyB9KTtcblxuICAgICAgY29uc3QgZ29hbCA9IGF3YWl0IHByaXNtYS5zdHVkZW50R29hbC51cGRhdGUoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGlkOiBOdW1iZXIocmVxLnBhcmFtcy5nb2FsSWQpLFxuICAgICAgICAgIHN0dWRlbnRJZDogTnVtYmVyKHJlcS5wYXJhbXMuaWQpLFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdGV4dDogcmVxLmJvZHkudGV4dCxcbiAgICAgICAgICBzdGF0dXM6IHJlcS5ib2R5LnN0YXR1cyxcbiAgICAgICAgICB1bml0UGxhbklkOiByZXEuYm9keS51bml0UGxhbklkLFxuICAgICAgICB9LFxuICAgICAgICAvLyB0aGVtZSByZW1vdmVkIC0gVGhlbWF0aWNVbml0IG1vZGVsIGFyY2hpdmVkXG4gICAgICB9KTtcbiAgICAgIHJlcy5qc29uKGdvYWwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIFByaXNtYS5QcmlzbWFDbGllbnRLbm93blJlcXVlc3RFcnJvciAmJiBlcnIuY29kZSA9PT0gJ1AyMDI1Jykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0dvYWwgbm90IGZvdW5kJyB9KTtcbiAgICAgIH1cbiAgICAgIG5leHQoZXJyKTtcbiAgICB9XG4gIH0sXG4pO1xuXG5yb3V0ZXIuZGVsZXRlKCcvOmlkL2dvYWxzLzpnb2FsSWQnLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlcj8uaWQgfHwgMDtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cbiAgICBjb25zdCBzdHVkZW50ID0gYXdhaXQgcHJpc21hLnN0dWRlbnQuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBOdW1iZXIocmVxLnBhcmFtcy5pZCksXG4gICAgICAgIHVzZXJJZCxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgaWYgKCFzdHVkZW50KSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ1N0dWRlbnQgbm90IGZvdW5kJyB9KTtcblxuICAgIGF3YWl0IHByaXNtYS5zdHVkZW50R29hbC5kZWxldGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IE51bWJlcihyZXEucGFyYW1zLmdvYWxJZCksXG4gICAgICAgIHN0dWRlbnRJZDogTnVtYmVyKHJlcS5wYXJhbXMuaWQpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmIChlcnIgaW5zdGFuY2VvZiBQcmlzbWEuUHJpc21hQ2xpZW50S25vd25SZXF1ZXN0RXJyb3IgJiYgZXJyLmNvZGUgPT09ICdQMjAyNScpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnR29hbCBub3QgZm91bmQnIH0pO1xuICAgIH1cbiAgICBuZXh0KGVycik7XG4gIH1cbn0pO1xuXG4vLyBTdHVkZW50IHJlZmxlY3Rpb25zIHJvdXRlc1xucm91dGVyLmdldCgnLzppZC9yZWZsZWN0aW9ucycsIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlcywgbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZCB8fCAwO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuICAgIGNvbnN0IHN0dWRlbnQgPSBhd2FpdCBwcmlzbWEuc3R1ZGVudC5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IE51bWJlcihyZXEucGFyYW1zLmlkKSxcbiAgICAgICAgdXNlcklkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBpZiAoIXN0dWRlbnQpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnU3R1ZGVudCBub3QgZm91bmQnIH0pO1xuXG4gICAgY29uc3QgcmVmbGVjdGlvbnMgPSBhd2FpdCBwcmlzbWEuc3R1ZGVudFJlZmxlY3Rpb24uZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHsgc3R1ZGVudElkOiBOdW1iZXIocmVxLnBhcmFtcy5pZCkgfSxcbiAgICAgIC8vIHRoZW1lIHJlbW92ZWQgLSBUaGVtYXRpY1VuaXQgbW9kZWwgYXJjaGl2ZWRcbiAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICB9KTtcbiAgICByZXMuanNvbihyZWZsZWN0aW9ucyk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIG5leHQoZXJyKTtcbiAgfVxufSk7XG5cbnJvdXRlci5wb3N0KFxuICAnLzppZC9yZWZsZWN0aW9ucycsXG4gIHZhbGlkYXRlKHN0dWRlbnRSZWZsZWN0aW9uQ3JlYXRlU2NoZW1hKSxcbiAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzLCBuZXh0KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZCB8fCAwO1xuICAgICAgaWYgKCF1c2VySWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3R1ZGVudCA9IGF3YWl0IHByaXNtYS5zdHVkZW50LmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgaWQ6IE51bWJlcihyZXEucGFyYW1zLmlkKSxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGlmICghc3R1ZGVudCkgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdTdHVkZW50IG5vdCBmb3VuZCcgfSk7XG5cbiAgICAgIGNvbnN0IHJlZmxlY3Rpb24gPSBhd2FpdCBwcmlzbWEuc3R1ZGVudFJlZmxlY3Rpb24uY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHN0dWRlbnRJZDogTnVtYmVyKHJlcS5wYXJhbXMuaWQpLFxuICAgICAgICAgIGNvbnRlbnQ6IHJlcS5ib2R5LmNvbnRlbnQgfHwgcmVxLmJvZHkudGV4dCB8fCBudWxsLFxuICAgICAgICAgIGRhdGU6IHJlcS5ib2R5LmRhdGUgPyBuZXcgRGF0ZShyZXEuYm9keS5kYXRlKSA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdW5pdFBsYW5JZDogcmVxLmJvZHkudW5pdFBsYW5JZCB8fCBudWxsLFxuICAgICAgICB9LFxuICAgICAgICAvLyB0aGVtZSByZW1vdmVkIC0gVGhlbWF0aWNVbml0IG1vZGVsIGFyY2hpdmVkXG4gICAgICB9KTtcbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHJlZmxlY3Rpb24pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbmV4dChlcnIpO1xuICAgIH1cbiAgfSxcbik7XG5cbnJvdXRlci5kZWxldGUoJy86aWQvcmVmbGVjdGlvbnMvOnJlZmxlY3Rpb25JZCcsIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlcywgbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZCB8fCAwO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuICAgIGNvbnN0IHN0dWRlbnQgPSBhd2FpdCBwcmlzbWEuc3R1ZGVudC5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IE51bWJlcihyZXEucGFyYW1zLmlkKSxcbiAgICAgICAgdXNlcklkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBpZiAoIXN0dWRlbnQpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnU3R1ZGVudCBub3QgZm91bmQnIH0pO1xuXG4gICAgYXdhaXQgcHJpc21hLnN0dWRlbnRSZWZsZWN0aW9uLmRlbGV0ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogTnVtYmVyKHJlcS5wYXJhbXMucmVmbGVjdGlvbklkKSxcbiAgICAgICAgc3R1ZGVudElkOiBOdW1iZXIocmVxLnBhcmFtcy5pZCksXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHJlcy5zdGF0dXMoMjA0KS5lbmQoKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKGVyciBpbnN0YW5jZW9mIFByaXNtYS5QcmlzbWFDbGllbnRLbm93blJlcXVlc3RFcnJvciAmJiBlcnIuY29kZSA9PT0gJ1AyMDI1Jykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdSZWZsZWN0aW9uIG5vdCBmb3VuZCcgfSk7XG4gICAgfVxuICAgIG5leHQoZXJyKTtcbiAgfVxufSk7XG5cbi8vIEdldCBzdHVkZW50IHByb2dyZXNzIHN1bW1hcnlcbnJvdXRlci5nZXQoJy86aWQvcHJvZ3Jlc3MnLCBhdWRpdExvZ2dlcnMuc3R1ZGVudFZpZXcsIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlcywgbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZDtcbiAgICBjb25zdCBzdHVkZW50SWQgPSBwYXJzZUludChyZXEucGFyYW1zLmlkKTtcblxuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3R1ZGVudCA9IGF3YWl0IHByaXNtYS5zdHVkZW50LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogc3R1ZGVudElkLFxuICAgICAgICB1c2VySWQ6IHBhcnNlSW50KHVzZXJJZCksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFzdHVkZW50KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ1N0dWRlbnQgbm90IGZvdW5kJyB9KTtcbiAgICB9XG5cbiAgICAvLyBBc3Nlc3NtZW50IGZ1bmN0aW9uYWxpdHkgcmVtb3ZlZFxuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3R1ZGVudCxcbiAgICAgIHByb2dyZXNzOiB7XG4gICAgICAgIHRvdGFsQXNzZXNzbWVudHM6IDAsXG4gICAgICAgIGF2ZXJhZ2VTY29yZTogbnVsbCxcbiAgICAgICAgYXNzZXNzbWVudHNCeVR5cGU6IHt9LFxuICAgICAgICBhcnRpZmFjdENvdW50OiBhd2FpdCBwcmlzbWEuc3R1ZGVudEFydGlmYWN0LmNvdW50KHsgd2hlcmU6IHsgc3R1ZGVudElkIH0gfSksXG4gICAgICAgIHJlZmxlY3Rpb25Db3VudDogYXdhaXQgcHJpc21hLnN0dWRlbnRSZWZsZWN0aW9uLmNvdW50KHsgd2hlcmU6IHsgc3R1ZGVudElkIH0gfSksXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBuZXh0KGVycik7XG4gIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7XG4iXSwidmVyc2lvbiI6M30=