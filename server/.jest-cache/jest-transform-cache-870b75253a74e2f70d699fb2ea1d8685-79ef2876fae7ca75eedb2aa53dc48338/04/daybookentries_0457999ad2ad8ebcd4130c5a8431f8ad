437ac12c6f864d643ab09e21da0b7c9b
import { Router } from 'express';
import { prisma } from '../prisma';
import { validate } from '../validation';
import { z } from 'zod';
const router = Router();
// Analytics helper functions
function calculateTrends(entries) {
    if (entries.length < 2) {
        return { ratingTrend: 'insufficient_data', engagementTrend: 'insufficient_data' };
    }
    // Sort entries by date to analyze trends over time
    const sortedEntries = entries.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
    // Calculate rating trend
    const ratingsWithValues = sortedEntries.filter((e) => e.rating !== null);
    let ratingTrend = 'stable';
    if (ratingsWithValues.length >= 3) {
        const firstHalf = ratingsWithValues.slice(0, Math.ceil(ratingsWithValues.length / 2));
        const secondHalf = ratingsWithValues.slice(Math.floor(ratingsWithValues.length / 2));
        const firstAvg = firstHalf.reduce((sum, e) => sum + (e.rating ?? e.overallRating ?? 0), 0) / firstHalf.length;
        const secondAvg = secondHalf.reduce((sum, e) => sum + (e.rating ?? e.overallRating ?? 0), 0) /
            secondHalf.length;
        const diff = secondAvg - firstAvg;
        if (diff > 0.3)
            ratingTrend = 'improving';
        else if (diff < -0.3)
            ratingTrend = 'declining';
    }
    // Calculate engagement trend by analyzing studentEngagement text
    const engagementEntries = sortedEntries.filter((e) => e.studentEngagement);
    let engagementTrend = 'stable';
    if (engagementEntries.length >= 2) {
        const recentEntries = engagementEntries.slice(-3); // Last 3 entries
        const positiveWords = ['engaged', 'active', 'interested', 'excited', 'participated', 'focused'];
        const negativeWords = ['disengaged', 'distracted', 'bored', 'struggled', 'off-task'];
        let positiveCount = 0;
        let negativeCount = 0;
        recentEntries.forEach((entry) => {
            const text = entry.studentEngagement.toLowerCase();
            positiveWords.forEach((word) => {
                if (text.includes(word))
                    positiveCount++;
            });
            negativeWords.forEach((word) => {
                if (text.includes(word))
                    negativeCount++;
            });
        });
        if (positiveCount > negativeCount)
            engagementTrend = 'improving';
        else if (negativeCount > positiveCount)
            engagementTrend = 'declining';
    }
    return { ratingTrend, engagementTrend };
}
function extractCommonThemes(entries) {
    const successWords = new Map();
    const challengeWords = new Map();
    const improvementWords = new Map();
    entries.forEach((entry) => {
        // Extract themes from whatWorked
        if (entry.whatWorked) {
            const words = extractKeywords(entry.whatWorked);
            words.forEach((word) => {
                successWords.set(word, (successWords.get(word) || 0) + 1);
            });
        }
        // Extract themes from whatDidntWork and studentChallenges
        if (entry.whatDidntWork || entry.studentChallenges) {
            const text = `${entry.whatDidntWork || ''} ${entry.studentChallenges || ''}`;
            const words = extractKeywords(text);
            words.forEach((word) => {
                challengeWords.set(word, (challengeWords.get(word) || 0) + 1);
            });
        }
        // Extract themes from nextSteps
        if (entry.nextSteps) {
            const words = extractKeywords(entry.nextSteps);
            words.forEach((word) => {
                improvementWords.set(word, (improvementWords.get(word) || 0) + 1);
            });
        }
    });
    // Get top themes (minimum 2 occurrences)
    const getTopThemes = (wordMap) => {
        return Array.from(wordMap.entries())
            .filter(([_, count]) => count >= 2)
            .sort(([_, a], [__, b]) => b - a)
            .slice(0, 5)
            .map(([word, count]) => `${word} (${count} mentions)`);
    };
    return {
        successes: getTopThemes(successWords),
        challenges: getTopThemes(challengeWords),
        improvements: getTopThemes(improvementWords),
    };
}
function extractKeywords(text) {
    // Simple keyword extraction - remove common words and extract meaningful terms
    const commonWords = new Set([
        'the',
        'a',
        'an',
        'and',
        'or',
        'but',
        'in',
        'on',
        'at',
        'to',
        'for',
        'of',
        'with',
        'by',
        'was',
        'were',
        'is',
        'are',
        'be',
        'been',
        'have',
        'has',
        'had',
        'do',
        'does',
        'did',
        'will',
        'would',
        'could',
        'should',
        'may',
        'might',
        'can',
        'this',
        'that',
        'these',
        'those',
    ]);
    return text
        .toLowerCase()
        .replace(/[^\w\s]/g, ' ')
        .split(/\s+/)
        .filter((word) => word.length > 3 && !commonWords.has(word))
        .slice(0, 10); // Limit to prevent noise
}
function generateRecommendations(entries) {
    const recommendations = [];
    if (entries.length === 0) {
        return ['Start documenting your daily teaching experiences to build insights over time.'];
    }
    // Analyze rating patterns
    const ratedEntries = entries.filter((e) => e.rating !== null);
    if (ratedEntries.length > 0) {
        const avgRating = ratedEntries.reduce((sum, e) => sum + e.rating, 0) / ratedEntries.length;
        const lowRatedEntries = ratedEntries.filter((e) => e.rating < 3);
        if (avgRating < 3.5) {
            recommendations.push('Consider reviewing lessons with lower ratings to identify improvement patterns.');
        }
        if (lowRatedEntries.length > ratedEntries.length * 0.3) {
            recommendations.push('Focus on documenting what worked well in higher-rated lessons for replication.');
        }
    }
    // Check reflection completeness
    const reflectiveEntries = entries.filter((e) => e.whatWorked || e.whatDidntWork || e.studentEngagement || e.studentChallenges || e.nextSteps);
    if (reflectiveEntries.length < entries.length * 0.5) {
        recommendations.push('Increase reflection depth by completing more reflection fields for better insights.');
    }
    // Analyze reuse patterns
    const reusedEntries = entries.filter((e) => e.wouldReuseLesson === true);
    if (reusedEntries.length > 0) {
        recommendations.push('Document successful strategies from reusable lessons for your teaching resource bank.');
    }
    // Time-based recommendations
    const recentEntries = entries.filter((e) => {
        const entryDate = new Date(e.date);
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        return entryDate >= oneWeekAgo;
    });
    if (recentEntries.length === 0) {
        recommendations.push('Regular reflection helps identify patterns - try to document lessons weekly.');
    }
    return recommendations.length > 0
        ? recommendations
        : [
            'Continue documenting your teaching experiences to build a comprehensive reflection database.',
            'Focus on noting both successes and challenges to maximize learning opportunities.',
        ];
}
// Validation schemas
const daybookEntryCreateSchema = z.object({
    date: z.string().datetime(),
    lessonPlanId: z.string().optional(),
    whatWorked: z.string().optional(),
    whatWorkedFr: z.string().optional(),
    whatDidntWork: z.string().optional(),
    whatDidntWorkFr: z.string().optional(),
    nextSteps: z.string().optional(),
    nextStepsFr: z.string().optional(),
    studentEngagement: z.string().optional(),
    studentChallenges: z.string().optional(),
    studentSuccesses: z.string().optional(),
    notes: z.string().optional(),
    notesFr: z.string().optional(),
    privateNotes: z.string().optional(),
    overallRating: z.number().int().min(1).max(5).optional(),
    wouldReuseLesson: z.boolean().optional(),
    expectationCoverage: z
        .array(z.object({
        expectationId: z.string(),
        coverage: z.enum(['introduced', 'developing', 'consolidated']),
    }))
        .optional(),
});
const daybookEntryUpdateSchema = daybookEntryCreateSchema.partial();
// Get all daybook entries for the authenticated user
router.get('/', async (req, res, _next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { startDate, endDate, hasLessonPlan, rating } = req.query;
        const where = { userId };
        if (startDate || endDate) {
            where.date = {};
            if (startDate)
                where.date.gte = new Date(String(startDate));
            if (endDate)
                where.date.lte = new Date(String(endDate));
        }
        if (hasLessonPlan !== undefined) {
            where.lessonPlanId = hasLessonPlan === 'true' ? { not: null } : null;
        }
        if (rating) {
            where.overallRating = Number(rating);
        }
        const entries = await prisma.daybookEntry.findMany({
            where,
            orderBy: { date: 'desc' },
            include: {
                lessonPlan: {
                    select: {
                        id: true,
                        title: true,
                        unitPlan: {
                            select: {
                                id: true,
                                title: true,
                                longRangePlan: {
                                    select: {
                                        subject: true,
                                        grade: true,
                                    },
                                },
                            },
                        },
                    },
                },
                _count: {
                    select: { expectations: true },
                },
            },
        });
        res.json(entries);
    }
    catch (err) {
        _next(err);
    }
});
// Get a single daybook entry
router.get('/:id', async (req, res, _next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const entry = await prisma.daybookEntry.findFirst({
            where: {
                id: req.params.id,
                userId,
            },
            include: {
                lessonPlan: {
                    include: {
                        unitPlan: {
                            include: {
                                longRangePlan: true,
                            },
                        },
                        expectations: {
                            include: { expectation: true },
                        },
                        resources: true,
                    },
                },
                expectations: {
                    include: {
                        expectation: true,
                    },
                },
            },
        });
        if (!entry) {
            return res.status(404).json({ error: 'Daybook entry not found' });
        }
        res.json(entry);
    }
    catch (err) {
        _next(err);
    }
});
// Create a new daybook entry
router.post('/', validate(daybookEntryCreateSchema), async (req, res, _next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { expectationCoverage, ...entryData } = req.body;
        // If linking to a lesson plan, verify ownership and no existing entry
        if (entryData.lessonPlanId) {
            const lessonPlan = await prisma.eTFOLessonPlan.findFirst({
                where: {
                    id: entryData.lessonPlanId,
                    userId,
                },
                include: {
                    daybookEntry: true,
                },
            });
            if (!lessonPlan) {
                return res.status(404).json({ error: 'Lesson plan not found' });
            }
            if (lessonPlan.daybookEntry) {
                return res.status(400).json({
                    error: 'Lesson plan already has a daybook entry',
                });
            }
        }
        const entry = await prisma.daybookEntry.create({
            data: {
                ...entryData,
                userId,
                date: new Date(entryData.date),
            },
            include: {
                lessonPlan: {
                    select: {
                        id: true,
                        title: true,
                        unitPlan: {
                            select: {
                                id: true,
                                title: true,
                                longRangePlan: {
                                    select: {
                                        subject: true,
                                        grade: true,
                                    },
                                },
                            },
                        },
                    },
                },
                _count: {
                    select: { expectations: true },
                },
            },
        });
        // Add expectation coverage if provided
        if (expectationCoverage && expectationCoverage.length > 0) {
            await prisma.daybookEntryExpectation.createMany({
                data: expectationCoverage.map((ec) => ({
                    daybookEntryId: entry.id,
                    expectationId: ec.expectationId,
                    coverage: ec.coverage,
                })),
            });
            // Refetch with expectations
            const updatedEntry = await prisma.daybookEntry.findUnique({
                where: { id: entry.id },
                include: {
                    lessonPlan: {
                        select: {
                            id: true,
                            title: true,
                            unitPlan: {
                                select: {
                                    id: true,
                                    title: true,
                                    longRangePlan: {
                                        select: {
                                            subject: true,
                                            grade: true,
                                        },
                                    },
                                },
                            },
                        },
                    },
                    expectations: {
                        include: { expectation: true },
                    },
                },
            });
            return res.status(201).json(updatedEntry);
        }
        res.status(201).json(entry);
    }
    catch (err) {
        _next(err);
    }
});
// Update a daybook entry
router.put('/:id', validate(daybookEntryUpdateSchema), async (req, res, _next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { expectationCoverage, ...updateData } = req.body;
        // Verify ownership
        const existing = await prisma.daybookEntry.findFirst({
            where: { id: req.params.id, userId },
        });
        if (!existing) {
            return res.status(404).json({ error: 'Daybook entry not found' });
        }
        // Prepare update data
        const data = { ...updateData };
        if (updateData.date)
            data.date = new Date(updateData.date);
        // Update the entry
        const entry = await prisma.daybookEntry.update({
            where: { id: req.params.id },
            data,
        });
        // Update expectation coverage if provided
        if (expectationCoverage !== undefined) {
            // Remove existing coverage
            await prisma.daybookEntryExpectation.deleteMany({
                where: { daybookEntryId: entry.id },
            });
            // Add new coverage
            if (expectationCoverage.length > 0) {
                await prisma.daybookEntryExpectation.createMany({
                    data: expectationCoverage.map((ec) => ({
                        daybookEntryId: entry.id,
                        expectationId: ec.expectationId,
                        coverage: ec.coverage,
                    })),
                });
            }
        }
        // Refetch with updated relationships
        const updatedEntry = await prisma.daybookEntry.findUnique({
            where: { id: entry.id },
            include: {
                lessonPlan: {
                    include: {
                        unitPlan: {
                            include: {
                                longRangePlan: true,
                            },
                        },
                    },
                },
                expectations: {
                    include: { expectation: true },
                },
            },
        });
        res.json(updatedEntry);
    }
    catch (err) {
        _next(err);
    }
});
// Delete a daybook entry
router.delete('/:id', async (req, res, _next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        // Verify ownership
        const entry = await prisma.daybookEntry.findFirst({
            where: { id: req.params.id, userId },
        });
        if (!entry) {
            return res.status(404).json({ error: 'Daybook entry not found' });
        }
        await prisma.daybookEntry.delete({
            where: { id: req.params.id },
        });
        res.status(204).end();
    }
    catch (err) {
        _next(err);
    }
});
// Get daybook insights and patterns
router.get('/insights/summary', async (req, res, _next) => {
    try {
        const userId = req.user?.id || 0;
        if (!userId) {
            return res.status(401).json({ error: 'Unauthorized' });
        }
        const { startDate, endDate, subject } = req.query;
        const where = { userId };
        if (startDate || endDate) {
            where.date = {};
            if (startDate)
                where.date.gte = new Date(String(startDate));
            if (endDate)
                where.date.lte = new Date(String(endDate));
        }
        if (subject) {
            where.lessonPlan = {
                unitPlan: {
                    longRangePlan: {
                        subject: String(subject),
                    },
                },
            };
        }
        // Get all entries for the period
        const entries = await prisma.daybookEntry.findMany({
            where,
            select: {
                id: true,
                date: true,
                overallRating: true,
                wouldReuseLesson: true,
                whatWorked: true,
                whatDidntWork: true,
                studentEngagement: true,
                studentChallenges: true,
                lessonPlan: {
                    select: {
                        unitPlan: {
                            select: {
                                longRangePlan: {
                                    select: { subject: true },
                                },
                            },
                        },
                    },
                },
            },
        });
        // Calculate insights
        const totalEntries = entries.length;
        const entriesWithRating = entries.filter((e) => e.overallRating !== null);
        const avgRating = entriesWithRating.length > 0
            ? entriesWithRating.reduce((sum, e) => sum + (e.overallRating ?? 0), 0) /
                entriesWithRating.length
            : null;
        const reuseStats = entries.filter((e) => e.wouldReuseLesson !== null);
        const reusePercentage = reuseStats.length > 0
            ? Math.round((reuseStats.filter((e) => e.wouldReuseLesson).length / reuseStats.length) * 100)
            : null;
        // Common themes (would need NLP for real implementation)
        const insights = {
            period: {
                start: startDate || 'all time',
                end: endDate || 'present',
            },
            summary: {
                totalEntries,
                averageRating: avgRating ? Number(avgRating.toFixed(2)) : null,
                reusePercentage,
                entriesWithReflections: entries.filter((e) => e.whatWorked || e.whatDidntWork || e.studentEngagement || e.studentChallenges).length,
            },
            trends: calculateTrends(entries),
            commonThemes: extractCommonThemes(entries),
            recommendations: generateRecommendations(entries),
        };
        res.json(insights);
    }
    catch (err) {
        _next(err);
    }
});
export default router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9yb3V0ZXMvZGF5Ym9vay1lbnRyaWVzLnRzIiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQVcsTUFBTSxTQUFTLENBQUM7QUFFMUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxLQUFLLENBQUM7QUFFeEIsTUFBTSxNQUFNLEdBQUcsTUFBTSxFQUFFLENBQUM7QUFxQnhCLDZCQUE2QjtBQUM3QixTQUFTLGVBQWUsQ0FBQyxPQUFtQztJQUkxRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDdkIsT0FBTyxFQUFFLFdBQVcsRUFBRSxtQkFBbUIsRUFBRSxlQUFlLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQztJQUNwRixDQUFDO0lBRUQsbURBQW1EO0lBQ25ELE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQ2hDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FDbEUsQ0FBQztJQUVGLHlCQUF5QjtJQUN6QixNQUFNLGlCQUFpQixHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLENBQUM7SUFDekUsSUFBSSxXQUFXLEdBQUcsUUFBUSxDQUFDO0lBRTNCLElBQUksaUJBQWlCLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ2xDLE1BQU0sU0FBUyxHQUFHLGlCQUFpQixDQUFD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eURBQXlEO1FBQ3pELE1BQU0sUUFBUSxHQUFHO1lBQ2YsTUFBTSxFQUFFO2dCQUNOLEtBQUssRUFBRSxTQUFTLElBQUksVUFBVTtnQkFDOUIsR0FBRyxFQUFFLE9BQU8sSUFBSSxTQUFTO2FBQzFCO1lBQ0QsT0FBTyxFQUFFO2dCQUNQLFlBQVk7Z0JBQ1osYUFBYSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSTtnQkFDOUQsZUFBZTtnQkFDZixzQkFBc0IsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUNwQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVUsSUFBSSxDQUFDLENBQUMsYUFBYSxJQUFJLENBQUMsQ0FBQyxpQkFBaUIsSUFBSSxDQUFDLENBQUMsaUJBQWlCLENBQ3JGLENBQUMsTUFBTTthQUNUO1lBQ0QsTUFBTSxFQUFFLGVBQWUsQ0FBQyxPQUFPLENBQUM7WUFDaEMsWUFBWSxFQUFFLG1CQUFtQixDQUFDLE9BQU8sQ0FBQztZQUMxQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsT0FBTyxDQUFDO1NBQ2xELENBQUM7UUFFRixHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3JCLENBQUM7SUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2IsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDO0FBRUgsZUFBZSxNQUFNLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9yb3V0ZXMvZGF5Ym9vay1lbnRyaWVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciwgUmVxdWVzdCB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgUHJpc21hIH0gZnJvbSAnLi4vcHJpc21hJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL3ByaXNtYSc7XG5pbXBvcnQgeyB2YWxpZGF0ZSB9IGZyb20gJy4uL3ZhbGlkYXRpb24nO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5cbmNvbnN0IHJvdXRlciA9IFJvdXRlcigpO1xuXG5pbnRlcmZhY2UgRGF5Ym9va0VudHJ5Rm9yQW5hbHl0aWNzIHtcbiAgZGF0ZTogRGF0ZSB8IHN0cmluZztcbiAgcmF0aW5nPzogbnVtYmVyIHwgbnVsbDtcbiAgb3ZlcmFsbFJhdGluZz86IG51bWJlciB8IG51bGw7XG4gIHN0dWRlbnRFbmdhZ2VtZW50Pzogc3RyaW5nIHwgbnVsbDtcbiAgd2hhdFdvcmtlZD86IHN0cmluZyB8IG51bGw7XG4gIHdoYXREaWRudFdvcms/OiBzdHJpbmcgfCBudWxsO1xuICBzdHVkZW50Q2hhbGxlbmdlcz86IHN0cmluZyB8IG51bGw7XG4gIG5leHRTdGVwcz86IHN0cmluZyB8IG51bGw7XG4gIHdvdWxkUmV1c2VMZXNzb24/OiBib29sZWFuIHwgbnVsbDtcbiAgbGVzc29uUGxhbj86IHtcbiAgICB1bml0UGxhbj86IHtcbiAgICAgIGxvbmdSYW5nZVBsYW4/OiB7XG4gICAgICAgIHN1YmplY3Q/OiBzdHJpbmc7XG4gICAgICB9IHwgbnVsbDtcbiAgICB9IHwgbnVsbDtcbiAgfSB8IG51bGw7XG59XG5cbi8vIEFuYWx5dGljcyBoZWxwZXIgZnVuY3Rpb25zXG5mdW5jdGlvbiBjYWxjdWxhdGVUcmVuZHMoZW50cmllczogRGF5Ym9va0VudHJ5Rm9yQW5hbHl0aWNzW10pOiB7XG4gIHJhdGluZ1RyZW5kOiBzdHJpbmc7XG4gIGVuZ2FnZW1lbnRUcmVuZDogc3RyaW5nO1xufSB7XG4gIGlmIChlbnRyaWVzLmxlbmd0aCA8IDIpIHtcbiAgICByZXR1cm4geyByYXRpbmdUcmVuZDogJ2luc3VmZmljaWVudF9kYXRhJywgZW5nYWdlbWVudFRyZW5kOiAnaW5zdWZmaWNpZW50X2RhdGEnIH07XG4gIH1cblxuICAvLyBTb3J0IGVudHJpZXMgYnkgZGF0ZSB0byBhbmFseXplIHRyZW5kcyBvdmVyIHRpbWVcbiAgY29uc3Qgc29ydGVkRW50cmllcyA9IGVudHJpZXMuc29ydChcbiAgICAoYSwgYikgPT4gbmV3IERhdGUoYS5kYXRlKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLmRhdGUpLmdldFRpbWUoKSxcbiAgKTtcblxuICAvLyBDYWxjdWxhdGUgcmF0aW5nIHRyZW5kXG4gIGNvbnN0IHJhdGluZ3NXaXRoVmFsdWVzID0gc29ydGVkRW50cmllcy5maWx0ZXIoKGUpID0+IGUucmF0aW5nICE9PSBudWxsKTtcbiAgbGV0IHJhdGluZ1RyZW5kID0gJ3N0YWJsZSc7XG5cbiAgaWYgKHJhdGluZ3NXaXRoVmFsdWVzLmxlbmd0aCA+PSAzKSB7XG4gICAgY29uc3QgZmlyc3RIYWxmID0gcmF0aW5nc1dpdGhWYWx1ZXMuc2xpY2UoMCwgTWF0aC5jZWlsKHJhdGluZ3NXaXRoVmFsdWVzLmxlbmd0aCAvIDIpKTtcbiAgICBjb25zdCBzZWNvbmRIYWxmID0gcmF0aW5nc1dpdGhWYWx1ZXMuc2xpY2UoTWF0aC5mbG9vcihyYXRpbmdzV2l0aFZhbHVlcy5sZW5ndGggLyAyKSk7XG5cbiAgICBjb25zdCBmaXJzdEF2ZyA9XG4gICAgICBmaXJzdEhhbGYucmVkdWNlKChzdW0sIGUpID0+IHN1bSArIChlLnJhdGluZyA/PyBlLm92ZXJhbGxSYXRpbmcgPz8gMCksIDApIC8gZmlyc3RIYWxmLmxlbmd0aDtcbiAgICBjb25zdCBzZWNvbmRBdmcgPVxuICAgICAgc2Vjb25kSGFsZi5yZWR1Y2UoKHN1bSwgZSkgPT4gc3VtICsgKGUucmF0aW5nID8/IGUub3ZlcmFsbFJhdGluZyA/PyAwKSwgMCkgL1xuICAgICAgc2Vjb25kSGFsZi5sZW5ndGg7XG5cbiAgICBjb25zdCBkaWZmID0gc2Vjb25kQXZnIC0gZmlyc3RBdmc7XG4gICAgaWYgKGRpZmYgPiAwLjMpIHJhdGluZ1RyZW5kID0gJ2ltcHJvdmluZyc7XG4gICAgZWxzZSBpZiAoZGlmZiA8IC0wLjMpIHJhdGluZ1RyZW5kID0gJ2RlY2xpbmluZyc7XG4gIH1cblxuICAvLyBDYWxjdWxhdGUgZW5nYWdlbWVudCB0cmVuZCBieSBhbmFseXppbmcgc3R1ZGVudEVuZ2FnZW1lbnQgdGV4dFxuICBjb25zdCBlbmdhZ2VtZW50RW50cmllcyA9IHNvcnRlZEVudHJpZXMuZmlsdGVyKChlKSA9PiBlLnN0dWRlbnRFbmdhZ2VtZW50KTtcbiAgbGV0IGVuZ2FnZW1lbnRUcmVuZCA9ICdzdGFibGUnO1xuXG4gIGlmIChlbmdhZ2VtZW50RW50cmllcy5sZW5ndGggPj0gMikge1xuICAgIGNvbnN0IHJlY2VudEVudHJpZXMgPSBlbmdhZ2VtZW50RW50cmllcy5zbGljZSgtMyk7IC8vIExhc3QgMyBlbnRyaWVzXG4gICAgY29uc3QgcG9zaXRpdmVXb3JkcyA9IFsnZW5nYWdlZCcsICdhY3RpdmUnLCAnaW50ZXJlc3RlZCcsICdleGNpdGVkJywgJ3BhcnRpY2lwYXRlZCcsICdmb2N1c2VkJ107XG4gICAgY29uc3QgbmVnYXRpdmVXb3JkcyA9IFsnZGlzZW5nYWdlZCcsICdkaXN0cmFjdGVkJywgJ2JvcmVkJywgJ3N0cnVnZ2xlZCcsICdvZmYtdGFzayddO1xuXG4gICAgbGV0IHBvc2l0aXZlQ291bnQgPSAwO1xuICAgIGxldCBuZWdhdGl2ZUNvdW50ID0gMDtcblxuICAgIHJlY2VudEVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgIGNvbnN0IHRleHQgPSBlbnRyeS5zdHVkZW50RW5nYWdlbWVudC50b0xvd2VyQ2FzZSgpO1xuICAgICAgcG9zaXRpdmVXb3Jkcy5mb3JFYWNoKCh3b3JkKSA9PiB7XG4gICAgICAgIGlmICh0ZXh0LmluY2x1ZGVzKHdvcmQpKSBwb3NpdGl2ZUNvdW50Kys7XG4gICAgICB9KTtcbiAgICAgIG5lZ2F0aXZlV29yZHMuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICBpZiAodGV4dC5pbmNsdWRlcyh3b3JkKSkgbmVnYXRpdmVDb3VudCsrO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpZiAocG9zaXRpdmVDb3VudCA+IG5lZ2F0aXZlQ291bnQpIGVuZ2FnZW1lbnRUcmVuZCA9ICdpbXByb3ZpbmcnO1xuICAgIGVsc2UgaWYgKG5lZ2F0aXZlQ291bnQgPiBwb3NpdGl2ZUNvdW50KSBlbmdhZ2VtZW50VHJlbmQgPSAnZGVjbGluaW5nJztcbiAgfVxuXG4gIHJldHVybiB7IHJhdGluZ1RyZW5kLCBlbmdhZ2VtZW50VHJlbmQgfTtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdENvbW1vblRoZW1lcyhlbnRyaWVzOiBEYXlib29rRW50cnlGb3JBbmFseXRpY3NbXSk6IHtcbiAgc3VjY2Vzc2VzOiBzdHJpbmdbXTtcbiAgY2hhbGxlbmdlczogc3RyaW5nW107XG4gIGltcHJvdmVtZW50czogc3RyaW5nW107XG59IHtcbiAgY29uc3Qgc3VjY2Vzc1dvcmRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgY29uc3QgY2hhbGxlbmdlV29yZHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICBjb25zdCBpbXByb3ZlbWVudFdvcmRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcblxuICBlbnRyaWVzLmZvckVhY2goKGVudHJ5KSA9PiB7XG4gICAgLy8gRXh0cmFjdCB0aGVtZXMgZnJvbSB3aGF0V29ya2VkXG4gICAgaWYgKGVudHJ5LndoYXRXb3JrZWQpIHtcbiAgICAgIGNvbnN0IHdvcmRzID0gZXh0cmFjdEtleXdvcmRzKGVudHJ5LndoYXRXb3JrZWQpO1xuICAgICAgd29yZHMuZm9yRWFjaCgod29yZCkgPT4ge1xuICAgICAgICBzdWNjZXNzV29yZHMuc2V0KHdvcmQsIChzdWNjZXNzV29yZHMuZ2V0KHdvcmQpIHx8IDApICsgMSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBFeHRyYWN0IHRoZW1lcyBmcm9tIHdoYXREaWRudFdvcmsgYW5kIHN0dWRlbnRDaGFsbGVuZ2VzXG4gICAgaWYgKGVudHJ5LndoYXREaWRudFdvcmsgfHwgZW50cnkuc3R1ZGVudENoYWxsZW5nZXMpIHtcbiAgICAgIGNvbnN0IHRleHQgPSBgJHtlbnRyeS53aGF0RGlkbnRXb3JrIHx8ICcnfSAke2VudHJ5LnN0dWRlbnRDaGFsbGVuZ2VzIHx8ICcnfWA7XG4gICAgICBjb25zdCB3b3JkcyA9IGV4dHJhY3RLZXl3b3Jkcyh0ZXh0KTtcbiAgICAgIHdvcmRzLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgY2hhbGxlbmdlV29yZHMuc2V0KHdvcmQsIChjaGFsbGVuZ2VXb3Jkcy5nZXQod29yZCkgfHwgMCkgKyAxKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgdGhlbWVzIGZyb20gbmV4dFN0ZXBzXG4gICAgaWYgKGVudHJ5Lm5leHRTdGVwcykge1xuICAgICAgY29uc3Qgd29yZHMgPSBleHRyYWN0S2V5d29yZHMoZW50cnkubmV4dFN0ZXBzKTtcbiAgICAgIHdvcmRzLmZvckVhY2goKHdvcmQpID0+IHtcbiAgICAgICAgaW1wcm92ZW1lbnRXb3Jkcy5zZXQod29yZCwgKGltcHJvdmVtZW50V29yZHMuZ2V0KHdvcmQpIHx8IDApICsgMSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIEdldCB0b3AgdGhlbWVzIChtaW5pbXVtIDIgb2NjdXJyZW5jZXMpXG4gIGNvbnN0IGdldFRvcFRoZW1lcyA9ICh3b3JkTWFwOiBNYXA8c3RyaW5nLCBudW1iZXI+KSA9PiB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20od29yZE1hcC5lbnRyaWVzKCkpXG4gICAgICAuZmlsdGVyKChbXywgY291bnRdKSA9PiBjb3VudCA+PSAyKVxuICAgICAgLnNvcnQoKFtfLCBhXSwgW19fLCBiXSkgPT4gYiAtIGEpXG4gICAgICAuc2xpY2UoMCwgNSlcbiAgICAgIC5tYXAoKFt3b3JkLCBjb3VudF0pID0+IGAke3dvcmR9ICgke2NvdW50fSBtZW50aW9ucylgKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHN1Y2Nlc3NlczogZ2V0VG9wVGhlbWVzKHN1Y2Nlc3NXb3JkcyksXG4gICAgY2hhbGxlbmdlczogZ2V0VG9wVGhlbWVzKGNoYWxsZW5nZVdvcmRzKSxcbiAgICBpbXByb3ZlbWVudHM6IGdldFRvcFRoZW1lcyhpbXByb3ZlbWVudFdvcmRzKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdEtleXdvcmRzKHRleHQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgLy8gU2ltcGxlIGtleXdvcmQgZXh0cmFjdGlvbiAtIHJlbW92ZSBjb21tb24gd29yZHMgYW5kIGV4dHJhY3QgbWVhbmluZ2Z1bCB0ZXJtc1xuICBjb25zdCBjb21tb25Xb3JkcyA9IG5ldyBTZXQoW1xuICAgICd0aGUnLFxuICAgICdhJyxcbiAgICAnYW4nLFxuICAgICdhbmQnLFxuICAgICdvcicsXG4gICAgJ2J1dCcsXG4gICAgJ2luJyxcbiAgICAnb24nLFxuICAgICdhdCcsXG4gICAgJ3RvJyxcbiAgICAnZm9yJyxcbiAgICAnb2YnLFxuICAgICd3aXRoJyxcbiAgICAnYnknLFxuICAgICd3YXMnLFxuICAgICd3ZXJlJyxcbiAgICAnaXMnLFxuICAgICdhcmUnLFxuICAgICdiZScsXG4gICAgJ2JlZW4nLFxuICAgICdoYXZlJyxcbiAgICAnaGFzJyxcbiAgICAnaGFkJyxcbiAgICAnZG8nLFxuICAgICdkb2VzJyxcbiAgICAnZGlkJyxcbiAgICAnd2lsbCcsXG4gICAgJ3dvdWxkJyxcbiAgICAnY291bGQnLFxuICAgICdzaG91bGQnLFxuICAgICdtYXknLFxuICAgICdtaWdodCcsXG4gICAgJ2NhbicsXG4gICAgJ3RoaXMnLFxuICAgICd0aGF0JyxcbiAgICAndGhlc2UnLFxuICAgICd0aG9zZScsXG4gIF0pO1xuXG4gIHJldHVybiB0ZXh0XG4gICAgLnRvTG93ZXJDYXNlKClcbiAgICAucmVwbGFjZSgvW15cXHdcXHNdL2csICcgJylcbiAgICAuc3BsaXQoL1xccysvKVxuICAgIC5maWx0ZXIoKHdvcmQpID0+IHdvcmQubGVuZ3RoID4gMyAmJiAhY29tbW9uV29yZHMuaGFzKHdvcmQpKVxuICAgIC5zbGljZSgwLCAxMCk7IC8vIExpbWl0IHRvIHByZXZlbnQgbm9pc2Vcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoZW50cmllczogRGF5Ym9va0VudHJ5Rm9yQW5hbHl0aWNzW10pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICBpZiAoZW50cmllcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gWydTdGFydCBkb2N1bWVudGluZyB5b3VyIGRhaWx5IHRlYWNoaW5nIGV4cGVyaWVuY2VzIHRvIGJ1aWxkIGluc2lnaHRzIG92ZXIgdGltZS4nXTtcbiAgfVxuXG4gIC8vIEFuYWx5emUgcmF0aW5nIHBhdHRlcm5zXG4gIGNvbnN0IHJhdGVkRW50cmllcyA9IGVudHJpZXMuZmlsdGVyKChlKSA9PiBlLnJhdGluZyAhPT0gbnVsbCk7XG4gIGlmIChyYXRlZEVudHJpZXMubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IGF2Z1JhdGluZyA9IHJhdGVkRW50cmllcy5yZWR1Y2UoKHN1bSwgZSkgPT4gc3VtICsgZS5yYXRpbmcsIDApIC8gcmF0ZWRFbnRyaWVzLmxlbmd0aDtcbiAgICBjb25zdCBsb3dSYXRlZEVudHJpZXMgPSByYXRlZEVudHJpZXMuZmlsdGVyKChlKSA9PiBlLnJhdGluZyA8IDMpO1xuXG4gICAgaWYgKGF2Z1JhdGluZyA8IDMuNSkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXG4gICAgICAgICdDb25zaWRlciByZXZpZXdpbmcgbGVzc29ucyB3aXRoIGxvd2VyIHJhdGluZ3MgdG8gaWRlbnRpZnkgaW1wcm92ZW1lbnQgcGF0dGVybnMuJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGxvd1JhdGVkRW50cmllcy5sZW5ndGggPiByYXRlZEVudHJpZXMubGVuZ3RoICogMC4zKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICAgJ0ZvY3VzIG9uIGRvY3VtZW50aW5nIHdoYXQgd29ya2VkIHdlbGwgaW4gaGlnaGVyLXJhdGVkIGxlc3NvbnMgZm9yIHJlcGxpY2F0aW9uLicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8vIENoZWNrIHJlZmxlY3Rpb24gY29tcGxldGVuZXNzXG4gIGNvbnN0IHJlZmxlY3RpdmVFbnRyaWVzID0gZW50cmllcy5maWx0ZXIoXG4gICAgKGUpID0+XG4gICAgICBlLndoYXRXb3JrZWQgfHwgZS53aGF0RGlkbnRXb3JrIHx8IGUuc3R1ZGVudEVuZ2FnZW1lbnQgfHwgZS5zdHVkZW50Q2hhbGxlbmdlcyB8fCBlLm5leHRTdGVwcyxcbiAgKTtcblxuICBpZiAocmVmbGVjdGl2ZUVudHJpZXMubGVuZ3RoIDwgZW50cmllcy5sZW5ndGggKiAwLjUpIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICdJbmNyZWFzZSByZWZsZWN0aW9uIGRlcHRoIGJ5IGNvbXBsZXRpbmcgbW9yZSByZWZsZWN0aW9uIGZpZWxkcyBmb3IgYmV0dGVyIGluc2lnaHRzLicsXG4gICAgKTtcbiAgfVxuXG4gIC8vIEFuYWx5emUgcmV1c2UgcGF0dGVybnNcbiAgY29uc3QgcmV1c2VkRW50cmllcyA9IGVudHJpZXMuZmlsdGVyKChlKSA9PiBlLndvdWxkUmV1c2VMZXNzb24gPT09IHRydWUpO1xuICBpZiAocmV1c2VkRW50cmllcy5sZW5ndGggPiAwKSB7XG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goXG4gICAgICAnRG9jdW1lbnQgc3VjY2Vzc2Z1bCBzdHJhdGVnaWVzIGZyb20gcmV1c2FibGUgbGVzc29ucyBmb3IgeW91ciB0ZWFjaGluZyByZXNvdXJjZSBiYW5rLicsXG4gICAgKTtcbiAgfVxuXG4gIC8vIFRpbWUtYmFzZWQgcmVjb21tZW5kYXRpb25zXG4gIGNvbnN0IHJlY2VudEVudHJpZXMgPSBlbnRyaWVzLmZpbHRlcigoZSkgPT4ge1xuICAgIGNvbnN0IGVudHJ5RGF0ZSA9IG5ldyBEYXRlKGUuZGF0ZSk7XG4gICAgY29uc3Qgb25lV2Vla0FnbyA9IG5ldyBEYXRlKCk7XG4gICAgb25lV2Vla0Fnby5zZXREYXRlKG9uZVdlZWtBZ28uZ2V0RGF0ZSgpIC0gNyk7XG4gICAgcmV0dXJuIGVudHJ5RGF0ZSA+PSBvbmVXZWVrQWdvO1xuICB9KTtcblxuICBpZiAocmVjZW50RW50cmllcy5sZW5ndGggPT09IDApIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICdSZWd1bGFyIHJlZmxlY3Rpb24gaGVscHMgaWRlbnRpZnkgcGF0dGVybnMgLSB0cnkgdG8gZG9jdW1lbnQgbGVzc29ucyB3ZWVrbHkuJyxcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucy5sZW5ndGggPiAwXG4gICAgPyByZWNvbW1lbmRhdGlvbnNcbiAgICA6IFtcbiAgICAgICAgJ0NvbnRpbnVlIGRvY3VtZW50aW5nIHlvdXIgdGVhY2hpbmcgZXhwZXJpZW5jZXMgdG8gYnVpbGQgYSBjb21wcmVoZW5zaXZlIHJlZmxlY3Rpb24gZGF0YWJhc2UuJyxcbiAgICAgICAgJ0ZvY3VzIG9uIG5vdGluZyBib3RoIHN1Y2Nlc3NlcyBhbmQgY2hhbGxlbmdlcyB0byBtYXhpbWl6ZSBsZWFybmluZyBvcHBvcnR1bml0aWVzLicsXG4gICAgICBdO1xufVxuXG4vLyBWYWxpZGF0aW9uIHNjaGVtYXNcbmNvbnN0IGRheWJvb2tFbnRyeUNyZWF0ZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgZGF0ZTogei5zdHJpbmcoKS5kYXRldGltZSgpLFxuICBsZXNzb25QbGFuSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgd2hhdFdvcmtlZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB3aGF0V29ya2VkRnI6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgd2hhdERpZG50V29yazogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB3aGF0RGlkbnRXb3JrRnI6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgbmV4dFN0ZXBzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIG5leHRTdGVwc0ZyOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHN0dWRlbnRFbmdhZ2VtZW50OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHN0dWRlbnRDaGFsbGVuZ2VzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHN0dWRlbnRTdWNjZXNzZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgbm90ZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgbm90ZXNGcjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBwcml2YXRlTm90ZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgb3ZlcmFsbFJhdGluZzogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDUpLm9wdGlvbmFsKCksXG4gIHdvdWxkUmV1c2VMZXNzb246IHouYm9vbGVhbigpLm9wdGlvbmFsKCksXG4gIGV4cGVjdGF0aW9uQ292ZXJhZ2U6IHpcbiAgICAuYXJyYXkoXG4gICAgICB6Lm9iamVjdCh7XG4gICAgICAgIGV4cGVjdGF0aW9uSWQ6IHouc3RyaW5nKCksXG4gICAgICAgIGNvdmVyYWdlOiB6LmVudW0oWydpbnRyb2R1Y2VkJywgJ2RldmVsb3BpbmcnLCAnY29uc29saWRhdGVkJ10pLFxuICAgICAgfSksXG4gICAgKVxuICAgIC5vcHRpb25hbCgpLFxufSk7XG5cbmNvbnN0IGRheWJvb2tFbnRyeVVwZGF0ZVNjaGVtYSA9IGRheWJvb2tFbnRyeUNyZWF0ZVNjaGVtYS5wYXJ0aWFsKCk7XG5cbi8vIEdldCBhbGwgZGF5Ym9vayBlbnRyaWVzIGZvciB0aGUgYXV0aGVudGljYXRlZCB1c2VyXG5yb3V0ZXIuZ2V0KCcvJywgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzLCBfbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZCB8fCAwO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBzdGFydERhdGUsIGVuZERhdGUsIGhhc0xlc3NvblBsYW4sIHJhdGluZyB9ID0gcmVxLnF1ZXJ5O1xuXG4gICAgY29uc3Qgd2hlcmU6IFByaXNtYS5EYXlib29rRW50cnlXaGVyZUlucHV0ID0geyB1c2VySWQgfTtcblxuICAgIGlmIChzdGFydERhdGUgfHwgZW5kRGF0ZSkge1xuICAgICAgd2hlcmUuZGF0ZSA9IHt9O1xuICAgICAgaWYgKHN0YXJ0RGF0ZSkgd2hlcmUuZGF0ZS5ndGUgPSBuZXcgRGF0ZShTdHJpbmcoc3RhcnREYXRlKSk7XG4gICAgICBpZiAoZW5kRGF0ZSkgd2hlcmUuZGF0ZS5sdGUgPSBuZXcgRGF0ZShTdHJpbmcoZW5kRGF0ZSkpO1xuICAgIH1cblxuICAgIGlmIChoYXNMZXNzb25QbGFuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHdoZXJlLmxlc3NvblBsYW5JZCA9IGhhc0xlc3NvblBsYW4gPT09ICd0cnVlJyA/IHsgbm90OiBudWxsIH0gOiBudWxsO1xuICAgIH1cblxuICAgIGlmIChyYXRpbmcpIHtcbiAgICAgIHdoZXJlLm92ZXJhbGxSYXRpbmcgPSBOdW1iZXIocmF0aW5nKTtcbiAgICB9XG5cbiAgICBjb25zdCBlbnRyaWVzID0gYXdhaXQgcHJpc21hLmRheWJvb2tFbnRyeS5maW5kTWFueSh7XG4gICAgICB3aGVyZSxcbiAgICAgIG9yZGVyQnk6IHsgZGF0ZTogJ2Rlc2MnIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGxlc3NvblBsYW46IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICB1bml0UGxhbjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aXRsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsb25nUmFuZ2VQbGFuOiB7XG4gICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgc3ViamVjdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZ3JhZGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIF9jb3VudDoge1xuICAgICAgICAgIHNlbGVjdDogeyBleHBlY3RhdGlvbnM6IHRydWUgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXMuanNvbihlbnRyaWVzKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgX25leHQoZXJyKTtcbiAgfVxufSk7XG5cbi8vIEdldCBhIHNpbmdsZSBkYXlib29rIGVudHJ5XG5yb3V0ZXIuZ2V0KCcvOmlkJywgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzLCBfbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZCB8fCAwO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgZW50cnkgPSBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogcmVxLnBhcmFtcy5pZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgbGVzc29uUGxhbjoge1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHVuaXRQbGFuOiB7XG4gICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBsb25nUmFuZ2VQbGFuOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uczoge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7IGV4cGVjdGF0aW9uOiB0cnVlIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzb3VyY2VzOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGV4cGVjdGF0aW9uczoge1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFlbnRyeSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdEYXlib29rIGVudHJ5IG5vdCBmb3VuZCcgfSk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24oZW50cnkpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBfbmV4dChlcnIpO1xuICB9XG59KTtcblxuLy8gQ3JlYXRlIGEgbmV3IGRheWJvb2sgZW50cnlcbnJvdXRlci5wb3N0KCcvJywgdmFsaWRhdGUoZGF5Ym9va0VudHJ5Q3JlYXRlU2NoZW1hKSwgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzLCBfbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZCB8fCAwO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBleHBlY3RhdGlvbkNvdmVyYWdlLCAuLi5lbnRyeURhdGEgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gSWYgbGlua2luZyB0byBhIGxlc3NvbiBwbGFuLCB2ZXJpZnkgb3duZXJzaGlwIGFuZCBubyBleGlzdGluZyBlbnRyeVxuICAgIGlmIChlbnRyeURhdGEubGVzc29uUGxhbklkKSB7XG4gICAgICBjb25zdCBsZXNzb25QbGFuID0gYXdhaXQgcHJpc21hLmVURk9MZXNzb25QbGFuLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgaWQ6IGVudHJ5RGF0YS5sZXNzb25QbGFuSWQsXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgZGF5Ym9va0VudHJ5OiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghbGVzc29uUGxhbikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0xlc3NvbiBwbGFuIG5vdCBmb3VuZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChsZXNzb25QbGFuLmRheWJvb2tFbnRyeSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIGVycm9yOiAnTGVzc29uIHBsYW4gYWxyZWFkeSBoYXMgYSBkYXlib29rIGVudHJ5JyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZW50cnkgPSBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIC4uLmVudHJ5RGF0YSxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBkYXRlOiBuZXcgRGF0ZShlbnRyeURhdGEuZGF0ZSksXG4gICAgICB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBsZXNzb25QbGFuOiB7XG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgdW5pdFBsYW46IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgbG9uZ1JhbmdlUGxhbjoge1xuICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGdyYWRlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICBzZWxlY3Q6IHsgZXhwZWN0YXRpb25zOiB0cnVlIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGV4cGVjdGF0aW9uIGNvdmVyYWdlIGlmIHByb3ZpZGVkXG4gICAgaWYgKGV4cGVjdGF0aW9uQ292ZXJhZ2UgJiYgZXhwZWN0YXRpb25Db3ZlcmFnZS5sZW5ndGggPiAwKSB7XG4gICAgICBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5RXhwZWN0YXRpb24uY3JlYXRlTWFueSh7XG4gICAgICAgIGRhdGE6IGV4cGVjdGF0aW9uQ292ZXJhZ2UubWFwKChlYzogeyBleHBlY3RhdGlvbklkOiBzdHJpbmc7IGNvdmVyYWdlOiBzdHJpbmcgfSkgPT4gKHtcbiAgICAgICAgICBkYXlib29rRW50cnlJZDogZW50cnkuaWQsXG4gICAgICAgICAgZXhwZWN0YXRpb25JZDogZWMuZXhwZWN0YXRpb25JZCxcbiAgICAgICAgICBjb3ZlcmFnZTogZWMuY292ZXJhZ2UsXG4gICAgICAgIH0pKSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBSZWZldGNoIHdpdGggZXhwZWN0YXRpb25zXG4gICAgICBjb25zdCB1cGRhdGVkRW50cnkgPSBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogZW50cnkuaWQgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGxlc3NvblBsYW46IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgIHVuaXRQbGFuOiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgbG9uZ1JhbmdlUGxhbjoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgIGdyYWRlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGV4cGVjdGF0aW9uczoge1xuICAgICAgICAgICAgaW5jbHVkZTogeyBleHBlY3RhdGlvbjogdHJ1ZSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKHVwZGF0ZWRFbnRyeSk7XG4gICAgfVxuXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oZW50cnkpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBfbmV4dChlcnIpO1xuICB9XG59KTtcblxuLy8gVXBkYXRlIGEgZGF5Ym9vayBlbnRyeVxucm91dGVyLnB1dCgnLzppZCcsIHZhbGlkYXRlKGRheWJvb2tFbnRyeVVwZGF0ZVNjaGVtYSksIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlcywgX25leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlcj8uaWQgfHwgMDtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZXhwZWN0YXRpb25Db3ZlcmFnZSwgLi4udXBkYXRlRGF0YSB9ID0gcmVxLmJvZHk7XG5cbiAgICAvLyBWZXJpZnkgb3duZXJzaGlwXG4gICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZTogeyBpZDogcmVxLnBhcmFtcy5pZCwgdXNlcklkIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIWV4aXN0aW5nKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0RheWJvb2sgZW50cnkgbm90IGZvdW5kJyB9KTtcbiAgICB9XG5cbiAgICAvLyBQcmVwYXJlIHVwZGF0ZSBkYXRhXG4gICAgY29uc3QgZGF0YTogUHJpc21hLkRheWJvb2tFbnRyeVVwZGF0ZUlucHV0ID0geyAuLi51cGRhdGVEYXRhIH07XG4gICAgaWYgKHVwZGF0ZURhdGEuZGF0ZSkgZGF0YS5kYXRlID0gbmV3IERhdGUodXBkYXRlRGF0YS5kYXRlKTtcblxuICAgIC8vIFVwZGF0ZSB0aGUgZW50cnlcbiAgICBjb25zdCBlbnRyeSA9IGF3YWl0IHByaXNtYS5kYXlib29rRW50cnkudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiByZXEucGFyYW1zLmlkIH0sXG4gICAgICBkYXRhLFxuICAgIH0pO1xuXG4gICAgLy8gVXBkYXRlIGV4cGVjdGF0aW9uIGNvdmVyYWdlIGlmIHByb3ZpZGVkXG4gICAgaWYgKGV4cGVjdGF0aW9uQ292ZXJhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gUmVtb3ZlIGV4aXN0aW5nIGNvdmVyYWdlXG4gICAgICBhd2FpdCBwcmlzbWEuZGF5Ym9va0VudHJ5RXhwZWN0YXRpb24uZGVsZXRlTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGRheWJvb2tFbnRyeUlkOiBlbnRyeS5pZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBuZXcgY292ZXJhZ2VcbiAgICAgIGlmIChleHBlY3RhdGlvbkNvdmVyYWdlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmRheWJvb2tFbnRyeUV4cGVjdGF0aW9uLmNyZWF0ZU1hbnkoe1xuICAgICAgICAgIGRhdGE6IGV4cGVjdGF0aW9uQ292ZXJhZ2UubWFwKChlYzogeyBleHBlY3RhdGlvbklkOiBzdHJpbmc7IGNvdmVyYWdlOiBzdHJpbmcgfSkgPT4gKHtcbiAgICAgICAgICAgIGRheWJvb2tFbnRyeUlkOiBlbnRyeS5pZCxcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uSWQ6IGVjLmV4cGVjdGF0aW9uSWQsXG4gICAgICAgICAgICBjb3ZlcmFnZTogZWMuY292ZXJhZ2UsXG4gICAgICAgICAgfSkpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZWZldGNoIHdpdGggdXBkYXRlZCByZWxhdGlvbnNoaXBzXG4gICAgY29uc3QgdXBkYXRlZEVudHJ5ID0gYXdhaXQgcHJpc21hLmRheWJvb2tFbnRyeS5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBlbnRyeS5pZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBsZXNzb25QbGFuOiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdW5pdFBsYW46IHtcbiAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIGxvbmdSYW5nZVBsYW46IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGV4cGVjdGF0aW9uczoge1xuICAgICAgICAgIGluY2x1ZGU6IHsgZXhwZWN0YXRpb246IHRydWUgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXMuanNvbih1cGRhdGVkRW50cnkpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBfbmV4dChlcnIpO1xuICB9XG59KTtcblxuLy8gRGVsZXRlIGEgZGF5Ym9vayBlbnRyeVxucm91dGVyLmRlbGV0ZSgnLzppZCcsIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlcywgX25leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlcj8uaWQgfHwgMDtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIC8vIFZlcmlmeSBvd25lcnNoaXBcbiAgICBjb25zdCBlbnRyeSA9IGF3YWl0IHByaXNtYS5kYXlib29rRW50cnkuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7IGlkOiByZXEucGFyYW1zLmlkLCB1c2VySWQgfSxcbiAgICB9KTtcblxuICAgIGlmICghZW50cnkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnRGF5Ym9vayBlbnRyeSBub3QgZm91bmQnIH0pO1xuICAgIH1cblxuICAgIGF3YWl0IHByaXNtYS5kYXlib29rRW50cnkuZGVsZXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiByZXEucGFyYW1zLmlkIH0sXG4gICAgfSk7XG5cbiAgICByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIF9uZXh0KGVycik7XG4gIH1cbn0pO1xuXG4vLyBHZXQgZGF5Ym9vayBpbnNpZ2h0cyBhbmQgcGF0dGVybnNcbnJvdXRlci5nZXQoJy9pbnNpZ2h0cy9zdW1tYXJ5JywgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzLCBfbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZCB8fCAwO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBzdGFydERhdGUsIGVuZERhdGUsIHN1YmplY3QgfSA9IHJlcS5xdWVyeTtcblxuICAgIGNvbnN0IHdoZXJlOiBQcmlzbWEuRGF5Ym9va0VudHJ5V2hlcmVJbnB1dCA9IHsgdXNlcklkIH07XG5cbiAgICBpZiAoc3RhcnREYXRlIHx8IGVuZERhdGUpIHtcbiAgICAgIHdoZXJlLmRhdGUgPSB7fTtcbiAgICAgIGlmIChzdGFydERhdGUpIHdoZXJlLmRhdGUuZ3RlID0gbmV3IERhdGUoU3RyaW5nKHN0YXJ0RGF0ZSkpO1xuICAgICAgaWYgKGVuZERhdGUpIHdoZXJlLmRhdGUubHRlID0gbmV3IERhdGUoU3RyaW5nKGVuZERhdGUpKTtcbiAgICB9XG5cbiAgICBpZiAoc3ViamVjdCkge1xuICAgICAgd2hlcmUubGVzc29uUGxhbiA9IHtcbiAgICAgICAgdW5pdFBsYW46IHtcbiAgICAgICAgICBsb25nUmFuZ2VQbGFuOiB7XG4gICAgICAgICAgICBzdWJqZWN0OiBTdHJpbmcoc3ViamVjdCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gR2V0IGFsbCBlbnRyaWVzIGZvciB0aGUgcGVyaW9kXG4gICAgY29uc3QgZW50cmllcyA9IGF3YWl0IHByaXNtYS5kYXlib29rRW50cnkuZmluZE1hbnkoe1xuICAgICAgd2hlcmUsXG4gICAgICBzZWxlY3Q6IHtcbiAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgIGRhdGU6IHRydWUsXG4gICAgICAgIG92ZXJhbGxSYXRpbmc6IHRydWUsXG4gICAgICAgIHdvdWxkUmV1c2VMZXNzb246IHRydWUsXG4gICAgICAgIHdoYXRXb3JrZWQ6IHRydWUsXG4gICAgICAgIHdoYXREaWRudFdvcms6IHRydWUsXG4gICAgICAgIHN0dWRlbnRFbmdhZ2VtZW50OiB0cnVlLFxuICAgICAgICBzdHVkZW50Q2hhbGxlbmdlczogdHJ1ZSxcbiAgICAgICAgbGVzc29uUGxhbjoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgdW5pdFBsYW46IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgbG9uZ1JhbmdlUGxhbjoge1xuICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IHN1YmplY3Q6IHRydWUgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIENhbGN1bGF0ZSBpbnNpZ2h0c1xuICAgIGNvbnN0IHRvdGFsRW50cmllcyA9IGVudHJpZXMubGVuZ3RoO1xuICAgIGNvbnN0IGVudHJpZXNXaXRoUmF0aW5nID0gZW50cmllcy5maWx0ZXIoKGUpID0+IGUub3ZlcmFsbFJhdGluZyAhPT0gbnVsbCk7XG4gICAgY29uc3QgYXZnUmF0aW5nID1cbiAgICAgIGVudHJpZXNXaXRoUmF0aW5nLmxlbmd0aCA+IDBcbiAgICAgICAgPyBlbnRyaWVzV2l0aFJhdGluZy5yZWR1Y2UoKHN1bSwgZSkgPT4gc3VtICsgKGUub3ZlcmFsbFJhdGluZyA/PyAwKSwgMCkgL1xuICAgICAgICAgIGVudHJpZXNXaXRoUmF0aW5nLmxlbmd0aFxuICAgICAgICA6IG51bGw7XG5cbiAgICBjb25zdCByZXVzZVN0YXRzID0gZW50cmllcy5maWx0ZXIoKGUpID0+IGUud291bGRSZXVzZUxlc3NvbiAhPT0gbnVsbCk7XG4gICAgY29uc3QgcmV1c2VQZXJjZW50YWdlID1cbiAgICAgIHJldXNlU3RhdHMubGVuZ3RoID4gMFxuICAgICAgICA/IE1hdGgucm91bmQoXG4gICAgICAgICAgICAocmV1c2VTdGF0cy5maWx0ZXIoKGUpID0+IGUud291bGRSZXVzZUxlc3NvbikubGVuZ3RoIC8gcmV1c2VTdGF0cy5sZW5ndGgpICogMTAwLFxuICAgICAgICAgIClcbiAgICAgICAgOiBudWxsO1xuXG4gICAgLy8gQ29tbW9uIHRoZW1lcyAod291bGQgbmVlZCBOTFAgZm9yIHJlYWwgaW1wbGVtZW50YXRpb24pXG4gICAgY29uc3QgaW5zaWdodHMgPSB7XG4gICAgICBwZXJpb2Q6IHtcbiAgICAgICAgc3RhcnQ6IHN0YXJ0RGF0ZSB8fCAnYWxsIHRpbWUnLFxuICAgICAgICBlbmQ6IGVuZERhdGUgfHwgJ3ByZXNlbnQnLFxuICAgICAgfSxcbiAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgdG90YWxFbnRyaWVzLFxuICAgICAgICBhdmVyYWdlUmF0aW5nOiBhdmdSYXRpbmcgPyBOdW1iZXIoYXZnUmF0aW5nLnRvRml4ZWQoMikpIDogbnVsbCxcbiAgICAgICAgcmV1c2VQZXJjZW50YWdlLFxuICAgICAgICBlbnRyaWVzV2l0aFJlZmxlY3Rpb25zOiBlbnRyaWVzLmZpbHRlcihcbiAgICAgICAgICAoZSkgPT4gZS53aGF0V29ya2VkIHx8IGUud2hhdERpZG50V29yayB8fCBlLnN0dWRlbnRFbmdhZ2VtZW50IHx8IGUuc3R1ZGVudENoYWxsZW5nZXMsXG4gICAgICAgICkubGVuZ3RoLFxuICAgICAgfSxcbiAgICAgIHRyZW5kczogY2FsY3VsYXRlVHJlbmRzKGVudHJpZXMpLFxuICAgICAgY29tbW9uVGhlbWVzOiBleHRyYWN0Q29tbW9uVGhlbWVzKGVudHJpZXMpLFxuICAgICAgcmVjb21tZW5kYXRpb25zOiBnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhlbnRyaWVzKSxcbiAgICB9O1xuXG4gICAgcmVzLmpzb24oaW5zaWdodHMpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBfbmV4dChlcnIpO1xuICB9XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyO1xuIl0sInZlcnNpb24iOjN9