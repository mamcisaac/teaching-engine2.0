{"file":"/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/src/services/aiPromptTemplateService.ts","mappings":"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","names":[],"sources":["/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/src/services/aiPromptTemplateService.ts"],"sourcesContent":["/**\n * AI Prompt Template Service\n * \n * This service provides improved AI prompts that:\n * 1. Use natural teacher language and voice\n * 2. Follow ETFO Planning for Student Learning framework accurately\n * 3. Include proper differentiation and assessment strategies\n * 4. Support bilingual/French immersion contexts\n * 5. Provide version control and A/B testing capabilities\n */\n\n\nexport interface PromptContext {\n  grade: number;\n  subject: string;\n  language?: 'en' | 'fr' | 'both';\n  isImmersion?: boolean;\n  academicYear?: string;\n  term?: string;\n  timeframe?: string;\n  specialNeeds?: string[];\n}\n\nexport interface CurriculumExpectation {\n  id?: string;\n  code: string;\n  description: string;\n  type: 'overall' | 'specific';\n  strand: string;\n  substrand?: string;\n  grade?: number;\n  subject?: string;\n  keywords?: string[];\n}\n\n// Version control for prompt templates\ninterface PromptTemplate {\n  id: string;\n  version: string;\n  createdAt: Date;\n  description: string;\n  template: string;\n  systemPrompt: string;\n  temperature: number;\n  metadata: {\n    etfoAligned: boolean;\n    bilingualSupport: boolean;\n    differentiationIncluded: boolean;\n    assessmentFramework: 'FOR_AS_OF' | 'OTHER';\n  };\n}\n\nclass AIPromptTemplateService {\n  private templates: Map<string, PromptTemplate[]> = new Map();\n  \n  constructor() {\n    this.initializeDefaultTemplates();\n  }\n\n  private initializeDefaultTemplates() {\n    // Long-Range Plan Templates\n    this.addTemplate('long-range-plan', {\n      id: 'lrp-v2.0',\n      version: '2.0',\n      createdAt: new Date(),\n      description: 'ETFO-aligned Long-Range Plan generation with natural teacher voice',\n      template: this.getLongRangePlanTemplate(),\n      systemPrompt: this.getETFOSystemPrompt(),\n      temperature: 0.3,\n      metadata: {\n        etfoAligned: true,\n        bilingualSupport: true,\n        differentiationIncluded: true,\n        assessmentFramework: 'FOR_AS_OF'\n      }\n    });\n\n    // Unit Plan Templates\n    this.addTemplate('unit-plan', {\n      id: 'up-v2.0',\n      version: '2.0',\n      createdAt: new Date(),\n      description: 'Three-part ETFO unit planning with comprehensive assessment',\n      template: this.getUnitPlanTemplate(),\n      systemPrompt: this.getETFOSystemPrompt(),\n      temperature: 0.3,\n      metadata: {\n        etfoAligned: true,\n        bilingualSupport: true,\n        differentiationIncluded: true,\n        assessmentFramework: 'FOR_AS_OF'\n      }\n    });\n\n    // Lesson Plan Templates\n    this.addTemplate('lesson-plan', {\n      id: 'lp-v2.0',\n      version: '2.0',\n      createdAt: new Date(),\n      description: 'Three-part lesson structure with authentic teacher language',\n      template: this.getLessonPlanTemplate(),\n      systemPrompt: this.getETFOSystemPrompt(),\n      temperature: 0.4,\n      metadata: {\n        etfoAligned: true,\n        bilingualSupport: true,\n        differentiationIncluded: true,\n        assessmentFramework: 'FOR_AS_OF'\n      }\n    });\n\n    // Activity Generation Templates\n    this.addTemplate('activity-generation', {\n      id: 'ag-v2.0',\n      version: '2.0',\n      createdAt: new Date(),\n      description: 'Engaging, age-appropriate activity generation',\n      template: this.getActivityGenerationTemplate(),\n      systemPrompt: this.getETFOSystemPrompt(),\n      temperature: 0.6,\n      metadata: {\n        etfoAligned: true,\n        bilingualSupport: true,\n        differentiationIncluded: true,\n        assessmentFramework: 'FOR_AS_OF'\n      }\n    });\n  }\n\n  private getETFOSystemPrompt(): string {\n    return `You are an experienced elementary school teacher and ETFO member with 15+ years of classroom experience. You understand child development, Ontario curriculum, and practical classroom realities.\n\nYour planning follows the ETFO Planning for Student Learning framework with authentic teacher voice - you write like a real teacher talking to another teacher.\n\nKey principles you follow:\n- Students come first - all decisions center on what's best for kids\n- Curriculum serves learning, not the other way around\n- Assessment drives instruction (Assessment FOR, AS, and OF learning)\n- Differentiation is natural and embedded, not an add-on\n- Cross-curricular connections happen organically\n- You understand that real classrooms are messy and plans need flexibility\n- French immersion considerations when applicable\n- Indigenous ways of knowing are respectfully incorporated\n- You write in a warm, professional teacher voice - not robotic or overly formal\n\nYou avoid educational jargon overload and focus on practical, actionable content that real teachers can actually use in their busy classrooms.`;\n  }\n\n  private getLongRangePlanTemplate(): string {\n    return `I'm planning my long-range plan for Grade {{grade}} {{subject}} for the {{academicYear}} school year. I need to organize these curriculum expectations into meaningful units that make sense for how kids learn and grow throughout the year.\n\nHere's what I'm working with:\n\n**Curriculum Expectations to Cover:**\n{{expectations}}\n\n**My Context:**\n- Grade: {{grade}}\n- Subject: {{subject}}\n- {{#isImmersion}}French Immersion Program{{/isImmersion}}\n- School year structure: {{termStructure}}\n{{#specialConsiderations}}\n- Special considerations: {{specialConsiderations}}\n{{/specialConsiderations}}\n\n**What I need from you:**\nHelp me create 4-6 units that feel natural and build on each other. I want units that excite kids and make connections they can understand. Think about:\n\n1. **Unit Flow**: How do the big ideas connect and build throughout the year?\n2. **Seasonal Connections**: What makes sense when? (e.g., nature units in fall/spring)\n3. **Student Development**: How do Grade {{grade}} kids typically grow over the year?\n4. **Real Classroom Life**: Accounting for holidays, assemblies, and the reality of school life\n5. **Cross-Curricular Magic**: Where can we naturally connect subjects?\n\nFor each unit, I need:\n- A title that kids would find interesting (not just \"Unit 1\")\n- Big ideas that connect to their world\n- Which curriculum expectations fit naturally\n- Realistic timing (considering everything else happening in school)\n- Quick notes about assessment opportunities\n\nPlease organize this in a JSON format I can work with, but write like you're talking to a fellow teacher. I want to feel excited about teaching these units!\n\n{{#frenchImmersion}}\nNote: Since this is French immersion, please consider how concepts transfer between languages and suggest opportunities for language development alongside content learning.\n{{/frenchImmersion}}`;\n  }\n\n  private getUnitPlanTemplate(): string {\n    return `I'm diving deeper into planning my \"{{unitTitle}}\" unit for Grade {{grade}} {{subject}}. This unit is part of my year-long plan and needs to fit with what we've learned before and what's coming next.\n\n**Unit Context:**\n- Grade: {{grade}} {{subject}}\n- Estimated Duration: {{duration}} weeks\n- {{#longRangePlanContext}}Connected to: {{longRangePlanContext}}{{/longRangePlanContext}}\n{{#isImmersion}}\n- French Immersion context\n{{/isImmersion}}\n\n**Curriculum Expectations I'm addressing:**\n{{expectations}}\n\n**The Three-Part ETFO Framework I'm following:**\n\n**PART 1: FRAMING THE UNIT**\nHelp me identify the big ideas that will anchor this unit - the \"so what?\" that helps kids see why this matters in their world. What essential questions will drive our inquiry and keep kids curious?\n\n**PART 2: LEARNING GOALS & SUCCESS CRITERIA**\nI need learning goals that are clear but written in kid-friendly language. Success criteria should help students self-assess and understand what good work looks like in Grade {{grade}}.\n\n**PART 3: ASSESSMENT PLAN**\nThis is where the magic happens - how will I:\n- **Assess FOR learning**: Find out what kids already know/think (diagnostics)\n- **Assess AS learning**: Support their learning journey with feedback (formatives)  \n- **Assess OF learning**: Celebrate their growth and determine next steps (summatives)\n\n**What I'm hoping for:**\n- Big ideas that Grade {{grade}} kids can grasp and get excited about\n- Essential questions that spark genuine curiosity\n- Learning goals that feel achievable but challenging\n- Assessment ideas that feel natural, not forced\n- Differentiation strategies that work in real classrooms\n- Cross-curricular connections that emerge organically\n- A timeline that accounts for actual school life\n\nPlease respond in JSON format, but keep the teacher voice - like you're sharing ideas with a colleague over coffee.\n\n{{#specialNeeds}}\n**Classroom considerations**: {{specialNeeds}}\n{{/specialNeeds}}`;\n  }\n\n  private getLessonPlanTemplate(): string {\n    return `I'm planning a lesson for my Grade {{grade}} {{subject}} class as part of our \"{{unitTitle}}\" unit. This is {{#lessonNumber}}lesson {{lessonNumber}} in the unit{{/lessonNumber}}{{^lessonNumber}}one of our key lessons{{/lessonNumber}}, and I have {{duration}} minutes to work with.\n\n**What I'm covering:**\n{{expectations}}\n\n**Unit context:**\n{{#unitContext}}{{unitContext}}{{/unitContext}}\n\n**The lesson structure I'm following (Three-Part ETFO Model):**\n\n**MINDS ON** (~15% of time - getting kids hooked and ready)\nThis is where I grab their attention and connect to what they already know. What's a great way to start that will have them leaning in and curious?\n\n**ACTION** (~70% of time - the main learning)\nThis is the heart of the lesson where kids are actively engaged with the new learning. I need activities that are hands-on, minds-on, and appropriate for Grade {{grade}} attention spans and abilities.\n\n**CONSOLIDATION** (~15% of time - making sense of it all)\nHow do we wrap up in a way that helps kids reflect on their learning and make connections? This should feel like a satisfying conclusion, not just \"time's up!\"\n\n**What I need:**\n- A lesson that feels engaging and purposeful\n- Activities that match Grade {{grade}} developmental needs\n- Clear learning goals kids can understand\n- Success criteria that help them self-assess\n- Materials I can actually get/afford\n- Differentiation that's built in, not tacked on\n- Assessment opportunities that feel natural\n- Timing that's realistic (including transitions!)\n\n**Classroom reality check:**\n- I have typical Grade {{grade}} energy levels and attention spans\n- Mixed ability group with diverse learners\n- {{#accommodations}}Need to consider: {{accommodations}}{{/accommodations}}\n- Need backup plans for when technology doesn't work\n- Should work for a substitute if needed\n\nPlease give me a practical lesson plan in JSON format, written like you're sharing with a fellow teacher. I want to feel confident and excited about teaching this!\n\n{{#frenchImmersion}}\n**Language considerations**: This is French immersion, so please consider vocabulary development and language scaffolding alongside content learning.\n{{/frenchImmersion}}`;\n  }\n\n  private getActivityGenerationTemplate(): string {\n    return `I need an engaging activity for my Grade {{grade}} {{subject}} class. Here's what I'm working with:\n\n**Context:**\n- Grade: {{grade}}\n- Subject: {{subject}}\n- Duration: {{duration}} minutes\n- Part of lesson: {{section}}\n{{#learningGoals}}\n- Learning goals: {{learningGoals}}\n{{/learningGoals}}\n\n**What I'm hoping for:**\n{{#activityType}}\n- Activity type: {{activityType}}\n{{/activityType}}\n{{#materials}}\n- Materials I have available: {{materials}}\n{{/materials}}\n{{#groupSize}}\n- Group arrangement: {{groupSize}}\n{{/groupSize}}\n\n**My classroom reality:**\n- Typical Grade {{grade}} energy and attention spans\n- Mix of learning styles and abilities\n- Some kids who need extra support, others ready for challenges\n- Limited prep time (let's be honest!)\n- Need activities that actually work in practice\n\n**What makes a great activity for my kids:**\n- Clear purpose that connects to their world\n- Hands-on engagement (they learn by doing)\n- Appropriate challenge level - not too easy, not impossible\n- Built-in opportunities for different entry points\n- Materials that won't break the budget\n- Instructions kids can follow without me repeating 10 times\n- Natural assessment opportunities\n- Cleanup that doesn't take forever\n\n{{#inspiration}}\n**For inspiration, here are some activities I've seen work well:**\n{{inspiration}}\n{{/inspiration}}\n\nPlease suggest an activity that feels doable and exciting. Include step-by-step instructions I can actually follow, differentiation ideas that work in real classrooms, and assessment suggestions that feel natural.\n\nRespond in JSON format but keep that practical teacher voice - like you're sharing a great idea you just tried with your class!\n\n{{#safetyConsiderations}}\n**Safety note**: Please consider any safety aspects for Grade {{grade}} students.\n{{/safetyConsiderations}}`;\n  }\n\n  // Template management methods\n  private addTemplate(type: string, template: PromptTemplate) {\n    if (!this.templates.has(type)) {\n      this.templates.set(type, []);\n    }\n    this.templates.get(type)!.push(template);\n  }\n\n  public getTemplate(type: string, version?: string): PromptTemplate | null {\n    const templates = this.templates.get(type);\n    if (!templates || templates.length === 0) return null;\n\n    if (version) {\n      return templates.find(t => t.version === version) || null;\n    }\n    \n    // Return latest version\n    return templates.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())[0];\n  }\n\n  public getAllVersions(type: string): PromptTemplate[] {\n    return this.templates.get(type) || [];\n  }\n\n  // Template compilation with Handlebars-like syntax\n  public compileTemplate(template: string, context: Record<string, unknown>): string {\n    let compiled = template;\n    \n    // Replace simple variables {{variable}}\n    compiled = compiled.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\n      return context[key] !== undefined ? String(context[key]) : match;\n    });\n\n    // Handle conditional blocks {{#if}}{{/if}}\n    compiled = compiled.replace(/\\{\\{#(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/\\1\\}\\}/g, (match, key, content) => {\n      return context[key] ? content : '';\n    });\n\n    // Handle negative conditional blocks {{^if}}{{/if}}\n    compiled = compiled.replace(/\\{\\{\\^(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/\\1\\}\\}/g, (match, key, content) => {\n      return !context[key] ? content : '';\n    });\n\n    return compiled.trim();\n  }\n\n  // Generate prompts for specific planning types\n  public generateLongRangePlanPrompt(context: PromptContext, expectations: CurriculumExpectation[]): { prompt: string; systemPrompt: string; temperature: number } {\n    const template = this.getTemplate('long-range-plan');\n    if (!template) throw new Error('Long-range plan template not found');\n\n    const promptContext = {\n      ...context,\n      expectations: expectations.map(exp => \n        `${exp.code} (${exp.type}): ${exp.description}`\n      ).join('\\n'),\n      frenchImmersion: context.isImmersion,\n      termStructure: context.term || 'semester',\n      specialConsiderations: context.specialNeeds?.join(', ') || ''\n    };\n\n    return {\n      prompt: this.compileTemplate(template.template, promptContext),\n      systemPrompt: template.systemPrompt,\n      temperature: template.temperature\n    };\n  }\n\n  public generateUnitPlanPrompt(\n    context: PromptContext, \n    unitTitle: string, \n    expectations: CurriculumExpectation[],\n    duration: number = 3,\n    longRangePlanContext?: string\n  ): { prompt: string; systemPrompt: string; temperature: number } {\n    const template = this.getTemplate('unit-plan');\n    if (!template) throw new Error('Unit plan template not found');\n\n    const promptContext = {\n      ...context,\n      unitTitle,\n      duration,\n      longRangePlanContext,\n      expectations: expectations.map(exp => \n        `${exp.code} (${exp.type}): ${exp.description}\\n  â†’ ${exp.strand}${exp.substrand ? ` / ${exp.substrand}` : ''}`\n      ).join('\\n'),\n      specialNeeds: context.specialNeeds?.join(', ') || ''\n    };\n\n    return {\n      prompt: this.compileTemplate(template.template, promptContext),\n      systemPrompt: template.systemPrompt,\n      temperature: template.temperature\n    };\n  }\n\n  public generateLessonPlanPrompt(\n    context: PromptContext,\n    unitTitle: string,\n    expectations: CurriculumExpectation[],\n    duration: number,\n    unitContext?: string,\n    lessonNumber?: number,\n    accommodations?: string[]\n  ): { prompt: string; systemPrompt: string; temperature: number } {\n    const template = this.getTemplate('lesson-plan');\n    if (!template) throw new Error('Lesson plan template not found');\n\n    const promptContext = {\n      ...context,\n      unitTitle,\n      duration,\n      unitContext,\n      lessonNumber,\n      expectations: expectations.map(exp => \n        `${exp.code}: ${exp.description}`\n      ).join('\\n'),\n      accommodations: accommodations?.join(', ') || '',\n      frenchImmersion: context.isImmersion\n    };\n\n    return {\n      prompt: this.compileTemplate(template.template, promptContext),\n      systemPrompt: template.systemPrompt,\n      temperature: template.temperature\n    };\n  }\n\n  public generateActivityPrompt(\n    context: PromptContext,\n    activityContext: {\n      duration: number;\n      section: 'mindsOn' | 'action' | 'consolidation';\n      learningGoals?: string[];\n      activityType?: string;\n      materials?: string[];\n      groupSize?: string;\n      inspiration?: string[];\n      safetyConsiderations?: boolean;\n    }\n  ): { prompt: string; systemPrompt: string; temperature: number } {\n    const template = this.getTemplate('activity-generation');\n    if (!template) throw new Error('Activity generation template not found');\n\n    const promptContext = {\n      ...context,\n      ...activityContext,\n      learningGoals: activityContext.learningGoals?.join(', ') || '',\n      materials: activityContext.materials?.join(', ') || 'standard classroom materials',\n      inspiration: activityContext.inspiration?.map(i => `- ${i}`).join('\\n') || '',\n      safetyConsiderations: activityContext.safetyConsiderations\n    };\n\n    return {\n      prompt: this.compileTemplate(template.template, promptContext),\n      systemPrompt: template.systemPrompt,\n      temperature: template.temperature\n    };\n  }\n\n  // A/B Testing and Analytics\n  public recordPromptUsage(_templateId: string, success: boolean, feedback?: string) {\n    // In a real implementation, this would log to analytics\n    console.log(`Template ${_templateId}: ${success ? 'SUCCESS' : 'FAILURE'}`, feedback);\n  }\n\n  public getTemplateMetrics(_templateId: string) {\n    // In a real implementation, this would return usage analytics\n    return {\n      usageCount: 0,\n      successRate: 0,\n      avgRating: 0,\n      commonFeedback: []\n    };\n  }\n}\n\nexport const aiPromptTemplateService = new AIPromptTemplateService();"],"version":3}