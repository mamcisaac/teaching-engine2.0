7e265c572d01b2e2946a52f03788efc3
import { Router } from 'express';
import { z } from 'zod';
import { PrismaClient, CalendarEventType, CalendarEventSource } from '@teaching-engine/database';
import { requireAuth } from '../middleware/auth';
import { validateRequest } from '../middleware/validateRequest';
import { startOfDay, endOfDay, parseISO } from 'date-fns';
const router = Router();
const prisma = new PrismaClient();
// Validation schemas
const calendarEventSchema = z.object({
    title: z.string().min(1).max(255),
    description: z.string().optional(),
    start: z.string().datetime(),
    end: z.string().datetime(),
    allDay: z.boolean().default(false),
    eventType: z.enum(['PD_DAY', 'ASSEMBLY', 'TRIP', 'HOLIDAY', 'CUSTOM']),
    source: z.enum(['MANUAL', 'ICAL_FEED', 'SYSTEM']).default('MANUAL'),
});
const querySchema = z.object({
    start: z.string().optional(),
    end: z.string().optional(),
    eventType: z.enum(['PD_DAY', 'ASSEMBLY', 'TRIP', 'HOLIDAY', 'CUSTOM']).optional(),
});
// Get calendar events for a date range
router.get('/', requireAuth, validateRequest({ query: querySchema }), async (req, res) => {
    try {
        const { start, end, eventType } = req.query;
        const userId = req.user.userId;
        const where = {
            OR: [
                { teacherId: parseInt(userId) },
                { teacherId: null }, // School-wide events
            ],
        };
        if (start) {
            where.start = { gte: parseISO(start) };
        }
        if (end) {
            where.end = { lte: endOfDay(parseISO(end)) };
        }
        if (eventType) {
            where.eventType = eventType;
        }
        const events = await prisma.calendarEvent.findMany({
            where,
            orderBy: { start: 'asc' },
        });
        res.json(events);
    }
    catch (error) {
        console.error('Error fetching calendar events:', error);
        res.status(500).json({ error: 'Failed to fetch calendar events' });
    }
});
// Create a new calendar event
router.post('/', requireAuth, validateRequest({ body: calendarEventSchema }), async (req, res) => {
    try {
        const data = req.body;
        const userId = req.user.userId;
        const event = await prisma.calendarEvent.create({
            data: {
                title: data.title,
                description: data.description,
                start: new Date(data.start),
                end: new Date(data.end),
                allDay: data.allDay,
                eventType: data.eventType,
                source: data.source,
                teacherId: parseInt(userId),
            },
        });
        res.status(201).json(event);
    }
    catch (error) {
        console.error('Error creating calendar event:', error);
        res.status(500).json({ error: 'Failed to create calendar event' });
    }
});
// Update a calendar event
router.patch('/:id', requireAuth, async (req, res) => {
    try {
        const { id } = req.params;
        const userId = req.user.userId;
        const updates = req.body;
        // Check ownership
        const event = await prisma.calendarEvent.findFirst({
            where: {
                id: parseInt(id),
                teacherId: parseInt(userId),
            },
        });
        if (!event) {
            return res.status(404).json({ error: 'Event not found or unauthorized' });
        }
        // Convert date strings to Date objects if present
        if (updates.start)
            updates.start = new Date(updates.start);
        if (updates.end)
            updates.end = new Date(updates.end);
        const updatedEvent = await prisma.calendarEvent.update({
            where: { id: parseInt(id) },
            data: updates,
        });
        res.json(updatedEvent);
    }
    catch (error) {
        console.error('Error updating calendar event:', error);
        res.status(500).json({ error: 'Failed to update calendar event' });
    }
});
// Delete a calendar event
router.delete('/:id', requireAuth, async (req, res) => {
    try {
        const { id } = req.params;
        const userId = req.user.userId;
        // Check ownership
        const event = await prisma.calendarEvent.findFirst({
            where: {
                id: parseInt(id),
                teacherId: parseInt(userId),
            },
        });
        if (!event) {
            return res.status(404).json({ error: 'Event not found or unauthorized' });
        }
        await prisma.calendarEvent.delete({
            where: { id: parseInt(id) },
        });
        res.status(204).send();
    }
    catch (error) {
        console.error('Error deleting calendar event:', error);
        res.status(500).json({ error: 'Failed to delete calendar event' });
    }
});
// Import holidays from a standard calendar
router.post('/import-holidays', requireAuth, async (req, res) => {
    try {
        const { year = new Date().getFullYear() } = req.body;
        // Common Ontario school holidays
        const holidays = [
            { title: 'Labour Day', month: 9, day: 1 },
            { title: 'Thanksgiving', month: 10, day: 2 }, // 2nd Monday
            { title: 'Winter Break Start', month: 12, day: 23 },
            { title: 'Winter Break End', month: 1, day: 2 },
            { title: 'Family Day', month: 2, day: 3 }, // 3rd Monday
            { title: 'March Break Start', month: 3, day: 2 }, // 2nd week
            { title: 'March Break End', month: 3, day: 3 },
            { title: 'Good Friday', month: 4, day: 1 }, // Varies
            { title: 'Easter Monday', month: 4, day: 2 }, // Varies
            { title: 'Victoria Day', month: 5, day: 3 }, // Monday before May 25
        ];
        const createdEvents = [];
        for (const holiday of holidays) {
            const date = new Date(year, holiday.month - 1, holiday.day);
            const existing = await prisma.calendarEvent.findFirst({
                where: {
                    title: holiday.title,
                    start: {
                        gte: startOfDay(date),
                        lte: endOfDay(date),
                    },
                },
            });
            if (!existing) {
                const event = await prisma.calendarEvent.create({
                    data: {
                        title: holiday.title,
                        start: startOfDay(date),
                        end: endOfDay(date),
                        allDay: true,
                        eventType: CalendarEventType.HOLIDAY,
                        source: CalendarEventSource.SYSTEM,
                    },
                });
                createdEvents.push(event);
            }
        }
        res.json({
            message: `Imported ${createdEvents.length} holidays`,
            events: createdEvents,
        });
    }
    catch (error) {
        console.error('Error importing holidays:', error);
        res.status(500).json({ error: 'Failed to import holidays' });
    }
});
export default router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9yb3V0ZXMvY2FsZW5kYXItZXZlbnRzLnRzIiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDakMsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLEtBQUssQ0FBQztBQUN4QixPQUFPLEVBQUUsWUFBWSxFQUFFLGlCQUFpQixFQUFFLG1CQUFtQixFQUFVLE1BQU0sMkJBQTJCLENBQUM7QUFDekcsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFMUQsTUFBTSxNQUFNLEdBQUcsTUFBTSxFQUFFLENBQUM7QUFDeEIsTUFBTSxNQUFNLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUVsQyxxQkFBcUI7QUFDckIsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ25DLEtBQUssRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUM7SUFDakMsV0FBVyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDbEMsS0FBSyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDNUIsR0FBRyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDMUIsTUFBTSxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO0lBQ2xDLFNBQVMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFN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LFlBQVksYUFBYSxDQUFDLE1BQU0sV0FBVztZQUNwRCxNQUFNLEVBQUUsYUFBYTtTQUN0QixDQUFDLENBQUM7SUFDTCxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQyxDQUFDO0lBQy9ELENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILGVBQWUsTUFBTSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWNoYWVsbWNpc2FhYy9HaXRIdWIvdGVhY2hpbmctZW5naW5lMi4wL3NlcnZlci9zcmMvcm91dGVzL2NhbGVuZGFyLWV2ZW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50LCBDYWxlbmRhckV2ZW50VHlwZSwgQ2FsZW5kYXJFdmVudFNvdXJjZSwgUHJpc21hIH0gZnJvbSAnQHRlYWNoaW5nLWVuZ2luZS9kYXRhYmFzZSc7XG5pbXBvcnQgeyByZXF1aXJlQXV0aCB9IGZyb20gJy4uL21pZGRsZXdhcmUvYXV0aCc7XG5pbXBvcnQgeyB2YWxpZGF0ZVJlcXVlc3QgfSBmcm9tICcuLi9taWRkbGV3YXJlL3ZhbGlkYXRlUmVxdWVzdCc7XG5pbXBvcnQgeyBzdGFydE9mRGF5LCBlbmRPZkRheSwgcGFyc2VJU08gfSBmcm9tICdkYXRlLWZucyc7XG5cbmNvbnN0IHJvdXRlciA9IFJvdXRlcigpO1xuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG4vLyBWYWxpZGF0aW9uIHNjaGVtYXNcbmNvbnN0IGNhbGVuZGFyRXZlbnRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHRpdGxlOiB6LnN0cmluZygpLm1pbigxKS5tYXgoMjU1KSxcbiAgZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgc3RhcnQ6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbiAgZW5kOiB6LnN0cmluZygpLmRhdGV0aW1lKCksXG4gIGFsbERheTogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG4gIGV2ZW50VHlwZTogei5lbnVtKFsnUERfREFZJywgJ0FTU0VNQkxZJywgJ1RSSVAnLCAnSE9MSURBWScsICdDVVNUT00nXSksXG4gIHNvdXJjZTogei5lbnVtKFsnTUFOVUFMJywgJ0lDQUxfRkVFRCcsICdTWVNURU0nXSkuZGVmYXVsdCgnTUFOVUFMJyksXG59KTtcblxuY29uc3QgcXVlcnlTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHN0YXJ0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGVuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBldmVudFR5cGU6IHouZW51bShbJ1BEX0RBWScsICdBU1NFTUJMWScsICdUUklQJywgJ0hPTElEQVknLCAnQ1VTVE9NJ10pLm9wdGlvbmFsKCksXG59KTtcblxuLy8gR2V0IGNhbGVuZGFyIGV2ZW50cyBmb3IgYSBkYXRlIHJhbmdlXG5yb3V0ZXIuZ2V0KCcvJywgcmVxdWlyZUF1dGgsIHZhbGlkYXRlUmVxdWVzdCh7IHF1ZXJ5OiBxdWVyeVNjaGVtYSB9KSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBzdGFydCwgZW5kLCBldmVudFR5cGUgfSA9IHJlcS5xdWVyeSBhcyB6LmluZmVyPHR5cGVvZiBxdWVyeVNjaGVtYT47XG4gICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIhLnVzZXJJZDtcblxuICAgIGNvbnN0IHdoZXJlOiBQcmlzbWEuQ2FsZW5kYXJFdmVudFdoZXJlSW5wdXQgPSB7XG4gICAgICBPUjogW1xuICAgICAgICB7IHRlYWNoZXJJZDogcGFyc2VJbnQodXNlcklkKSB9LFxuICAgICAgICB7IHRlYWNoZXJJZDogbnVsbCB9LCAvLyBTY2hvb2wtd2lkZSBldmVudHNcbiAgICAgIF0sXG4gICAgfTtcblxuICAgIGlmIChzdGFydCkge1xuICAgICAgd2hlcmUuc3RhcnQgPSB7IGd0ZTogcGFyc2VJU08oc3RhcnQpIH07XG4gICAgfVxuXG4gICAgaWYgKGVuZCkge1xuICAgICAgd2hlcmUuZW5kID0geyBsdGU6IGVuZE9mRGF5KHBhcnNlSVNPKGVuZCkpIH07XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50VHlwZSkge1xuICAgICAgd2hlcmUuZXZlbnRUeXBlID0gZXZlbnRUeXBlO1xuICAgIH1cblxuICAgIGNvbnN0IGV2ZW50cyA9IGF3YWl0IHByaXNtYS5jYWxlbmRhckV2ZW50LmZpbmRNYW55KHtcbiAgICAgIHdoZXJlLFxuICAgICAgb3JkZXJCeTogeyBzdGFydDogJ2FzYycgfSxcbiAgICB9KTtcblxuICAgIHJlcy5qc29uKGV2ZW50cyk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgY2FsZW5kYXIgZXZlbnRzOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIGNhbGVuZGFyIGV2ZW50cycgfSk7XG4gIH1cbn0pO1xuXG4vLyBDcmVhdGUgYSBuZXcgY2FsZW5kYXIgZXZlbnRcbnJvdXRlci5wb3N0KCcvJywgcmVxdWlyZUF1dGgsIHZhbGlkYXRlUmVxdWVzdCh7IGJvZHk6IGNhbGVuZGFyRXZlbnRTY2hlbWEgfSksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRhdGEgPSByZXEuYm9keSBhcyB6LmluZmVyPHR5cGVvZiBjYWxlbmRhckV2ZW50U2NoZW1hPjtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlciEudXNlcklkO1xuXG4gICAgY29uc3QgZXZlbnQgPSBhd2FpdCBwcmlzbWEuY2FsZW5kYXJFdmVudC5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB0aXRsZTogZGF0YS50aXRsZSxcbiAgICAgICAgZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgIHN0YXJ0OiBuZXcgRGF0ZShkYXRhLnN0YXJ0KSxcbiAgICAgICAgZW5kOiBuZXcgRGF0ZShkYXRhLmVuZCksXG4gICAgICAgIGFsbERheTogZGF0YS5hbGxEYXksXG4gICAgICAgIGV2ZW50VHlwZTogZGF0YS5ldmVudFR5cGUsXG4gICAgICAgIHNvdXJjZTogZGF0YS5zb3VyY2UsXG4gICAgICAgIHRlYWNoZXJJZDogcGFyc2VJbnQodXNlcklkKSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbihldmVudCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgY2FsZW5kYXIgZXZlbnQ6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIGNhbGVuZGFyIGV2ZW50JyB9KTtcbiAgfVxufSk7XG5cbi8vIFVwZGF0ZSBhIGNhbGVuZGFyIGV2ZW50XG5yb3V0ZXIucGF0Y2goJy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlciEudXNlcklkO1xuICAgIGNvbnN0IHVwZGF0ZXMgPSByZXEuYm9keTtcblxuICAgIC8vIENoZWNrIG93bmVyc2hpcFxuICAgIGNvbnN0IGV2ZW50ID0gYXdhaXQgcHJpc21hLmNhbGVuZGFyRXZlbnQuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBwYXJzZUludChpZCksXG4gICAgICAgIHRlYWNoZXJJZDogcGFyc2VJbnQodXNlcklkKSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIWV2ZW50KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0V2ZW50IG5vdCBmb3VuZCBvciB1bmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIC8vIENvbnZlcnQgZGF0ZSBzdHJpbmdzIHRvIERhdGUgb2JqZWN0cyBpZiBwcmVzZW50XG4gICAgaWYgKHVwZGF0ZXMuc3RhcnQpIHVwZGF0ZXMuc3RhcnQgPSBuZXcgRGF0ZSh1cGRhdGVzLnN0YXJ0KTtcbiAgICBpZiAodXBkYXRlcy5lbmQpIHVwZGF0ZXMuZW5kID0gbmV3IERhdGUodXBkYXRlcy5lbmQpO1xuXG4gICAgY29uc3QgdXBkYXRlZEV2ZW50ID0gYXdhaXQgcHJpc21hLmNhbGVuZGFyRXZlbnQudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBwYXJzZUludChpZCkgfSxcbiAgICAgIGRhdGE6IHVwZGF0ZXMsXG4gICAgfSk7XG5cbiAgICByZXMuanNvbih1cGRhdGVkRXZlbnQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIGNhbGVuZGFyIGV2ZW50OicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIHVwZGF0ZSBjYWxlbmRhciBldmVudCcgfSk7XG4gIH1cbn0pO1xuXG4vLyBEZWxldGUgYSBjYWxlbmRhciBldmVudFxucm91dGVyLmRlbGV0ZSgnLzppZCcsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyIS51c2VySWQ7XG5cbiAgICAvLyBDaGVjayBvd25lcnNoaXBcbiAgICBjb25zdCBldmVudCA9IGF3YWl0IHByaXNtYS5jYWxlbmRhckV2ZW50LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogcGFyc2VJbnQoaWQpLFxuICAgICAgICB0ZWFjaGVySWQ6IHBhcnNlSW50KHVzZXJJZCksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFldmVudCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdFdmVudCBub3QgZm91bmQgb3IgdW5hdXRob3JpemVkJyB9KTtcbiAgICB9XG5cbiAgICBhd2FpdCBwcmlzbWEuY2FsZW5kYXJFdmVudC5kZWxldGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHBhcnNlSW50KGlkKSB9LFxuICAgIH0pO1xuXG4gICAgcmVzLnN0YXR1cygyMDQpLnNlbmQoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBjYWxlbmRhciBldmVudDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byBkZWxldGUgY2FsZW5kYXIgZXZlbnQnIH0pO1xuICB9XG59KTtcblxuLy8gSW1wb3J0IGhvbGlkYXlzIGZyb20gYSBzdGFuZGFyZCBjYWxlbmRhclxucm91dGVyLnBvc3QoJy9pbXBvcnQtaG9saWRheXMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyB5ZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpIH0gPSByZXEuYm9keTtcblxuICAgIC8vIENvbW1vbiBPbnRhcmlvIHNjaG9vbCBob2xpZGF5c1xuICAgIGNvbnN0IGhvbGlkYXlzID0gW1xuICAgICAgeyB0aXRsZTogJ0xhYm91ciBEYXknLCBtb250aDogOSwgZGF5OiAxIH0sXG4gICAgICB7IHRpdGxlOiAnVGhhbmtzZ2l2aW5nJywgbW9udGg6IDEwLCBkYXk6IDIgfSwgLy8gMm5kIE1vbmRheVxuICAgICAgeyB0aXRsZTogJ1dpbnRlciBCcmVhayBTdGFydCcsIG1vbnRoOiAxMiwgZGF5OiAyMyB9LFxuICAgICAgeyB0aXRsZTogJ1dpbnRlciBCcmVhayBFbmQnLCBtb250aDogMSwgZGF5OiAyIH0sXG4gICAgICB7IHRpdGxlOiAnRmFtaWx5IERheScsIG1vbnRoOiAyLCBkYXk6IDMgfSwgLy8gM3JkIE1vbmRheVxuICAgICAgeyB0aXRsZTogJ01hcmNoIEJyZWFrIFN0YXJ0JywgbW9udGg6IDMsIGRheTogMiB9LCAvLyAybmQgd2Vla1xuICAgICAgeyB0aXRsZTogJ01hcmNoIEJyZWFrIEVuZCcsIG1vbnRoOiAzLCBkYXk6IDMgfSxcbiAgICAgIHsgdGl0bGU6ICdHb29kIEZyaWRheScsIG1vbnRoOiA0LCBkYXk6IDEgfSwgLy8gVmFyaWVzXG4gICAgICB7IHRpdGxlOiAnRWFzdGVyIE1vbmRheScsIG1vbnRoOiA0LCBkYXk6IDIgfSwgLy8gVmFyaWVzXG4gICAgICB7IHRpdGxlOiAnVmljdG9yaWEgRGF5JywgbW9udGg6IDUsIGRheTogMyB9LCAvLyBNb25kYXkgYmVmb3JlIE1heSAyNVxuICAgIF07XG5cbiAgICBjb25zdCBjcmVhdGVkRXZlbnRzID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGhvbGlkYXkgb2YgaG9saWRheXMpIHtcbiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh5ZWFyLCBob2xpZGF5Lm1vbnRoIC0gMSwgaG9saWRheS5kYXkpO1xuICAgICAgXG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS5jYWxlbmRhckV2ZW50LmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgdGl0bGU6IGhvbGlkYXkudGl0bGUsXG4gICAgICAgICAgc3RhcnQ6IHtcbiAgICAgICAgICAgIGd0ZTogc3RhcnRPZkRheShkYXRlKSxcbiAgICAgICAgICAgIGx0ZTogZW5kT2ZEYXkoZGF0ZSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWV4aXN0aW5nKSB7XG4gICAgICAgIGNvbnN0IGV2ZW50ID0gYXdhaXQgcHJpc21hLmNhbGVuZGFyRXZlbnQuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB0aXRsZTogaG9saWRheS50aXRsZSxcbiAgICAgICAgICAgIHN0YXJ0OiBzdGFydE9mRGF5KGRhdGUpLFxuICAgICAgICAgICAgZW5kOiBlbmRPZkRheShkYXRlKSxcbiAgICAgICAgICAgIGFsbERheTogdHJ1ZSxcbiAgICAgICAgICAgIGV2ZW50VHlwZTogQ2FsZW5kYXJFdmVudFR5cGUuSE9MSURBWSxcbiAgICAgICAgICAgIHNvdXJjZTogQ2FsZW5kYXJFdmVudFNvdXJjZS5TWVNURU0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNyZWF0ZWRFdmVudHMucHVzaChldmVudCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVzLmpzb24oe1xuICAgICAgbWVzc2FnZTogYEltcG9ydGVkICR7Y3JlYXRlZEV2ZW50cy5sZW5ndGh9IGhvbGlkYXlzYCxcbiAgICAgIGV2ZW50czogY3JlYXRlZEV2ZW50cyxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbXBvcnRpbmcgaG9saWRheXM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gaW1wb3J0IGhvbGlkYXlzJyB9KTtcbiAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjsiXSwidmVyc2lvbiI6M30=