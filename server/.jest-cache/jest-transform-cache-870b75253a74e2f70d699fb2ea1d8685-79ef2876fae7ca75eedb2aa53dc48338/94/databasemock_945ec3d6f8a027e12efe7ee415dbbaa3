e8d6e6f5a44b36ad0cd10e4a9ee2f289
/**
 * Optimized Database Mock
 * Provides a complete mock implementation of PrismaClient
 */
import { jest } from '@jest/globals';
// Helper to create a mock model with all CRUD operations
const createMockModel = (modelName, options = {}) => {
    const mockData = new Map();
    let idCounter = 1;
    // Models that use CUID format
    const cuidModels = ['curriculumImport', 'eTFOLessonPlan', 'longRangePlan', 'unitPlan', 'daybookEntry', 'curriculumExpectation'];
    const shouldUseStringIds = options.useStringIds || cuidModels.includes(modelName);
    const generateId = () => {
        if (shouldUseStringIds) {
            // Generate a CUID-like string
            return `c${Math.random().toString(36).substr(2, 24)}`;
        }
        return idCounter++;
    };
    return {
        findUnique: jest.fn(({ where }) => {
            const key = Object.values(where)[0];
            return Promise.resolve(mockData.get(String(key)) || null);
        }),
        findMany: jest.fn(() => {
            return Promise.resolve(Array.from(mockData.values()));
        }),
        findFirst: jest.fn(() => {
            const values = Array.from(mockData.values());
            return Promise.resolve(values[0] || null);
        }),
        create: jest.fn(({ data }) => {
            const id = data.id || generateId();
            const record = { id, ...data, createdAt: new Date(), updatedAt: new Date() };
            mockData.set(String(id), record);
            return Promise.resolve(record);
        }),
        createMany: jest.fn(({ data }) => {
            const created = data.map((item) => {
                const id = item.id || generateId();
                const record = { id, ...item, createdAt: new Date(), updatedAt: new Date() };
                mockData.set(String(id), record);
                return record;
            });
            return Promise.resolve({ count: created.length });
        }),
        update: jest.fn(({ where, data }) => {
            const key = String(Object.values(where)[0]);
            const existing = mockData.get(key);
            if (!existing)
                throw new Error('Record not found');
            const updated = { ...existing, ...data, updatedAt: new Date() };
            mockData.set(key, updated);
            return Promise.resolve(updated);
        }),
        updateMany: jest.fn(() => {
            return Promise.resolve({ count: mockData.size });
        }),
        delete: jest.fn(({ where }) => {
            const key = String(Object.values(where)[0]);
            const record = mockData.get(key);
            if (!record)
                throw new Error('Record not found');
            mockData.delete(key);
            return Promise.resolve(record);
        }),
        deleteMany: jest.fn(() => {
            const count = mockData.size;
            mockData.clear();
            return Promise.resolve({ count });
        }),
        count: jest.fn(() => Promise.resolve(mockData.size)),
        aggregate: jest.fn(() => Promise.resolve({})),
        groupBy: jest.fn(() => Promise.resolve([])),
        // Test helper to access mock data
        _getMockData: () => mockData,
        _reset: () => mockData.clear(),
    };
};
// Create mock Prisma client
export class PrismaClient {
    // Connection methods
    $connect = jest.fn().mockResolvedValue(undefined);
    $disconnect = jest.fn().mockResolvedValue(undefined);
    // Transaction support
    $transaction = jest.fn().mockImplementation((fn) => {
        if (typeof fn === 'function') {
            return fn(this);
        }
        return Promise.all(fn);
    });
    // Raw query methods (optimized)
    $queryRaw = jest.fn().mockResolvedValue([]);
    $queryRawUnsafe = jest.fn().mockResolvedValue([]);
    $executeRaw = jest.fn().mockResolvedValue(0);
    $executeRawUnsafe = jest.fn().mockResolvedValue(0);
    // All models
    user = createMockModel('user');
    outcome = createMockModel('outcome');
    outcomeEmbedding = createMockModel('outcomeEmbedding');
    curriculumExpectation = createMockModel('curriculumExpectation');
    curriculumExpectationEmbedding = createMockModel('curriculumExpectationEmbedding');
    curriculumImport = createMockModel('curriculumImport');
    outcomeCluster = createMockModel('outcomeCluster');
    subject = createMockModel('subject');
    milestone = createMockModel('milestone');
    activity = createMockModel('activity');
    activityOutcome = createMockModel('activityOutcome');
    lessonPlan = createMockModel('lessonPlan');
    lessonPlanActivity = createMockModel('lessonPlanActivity');
    aISuggestedActivity = createMockModel('aISuggestedActivity');
    note = createMockModel('note');
    evidence = createMockModel('evidence');
    milestone_alert = createMockModel('milestone_alert');
    notification = createMockModel('notification');
    studentGoal = createMockModel('studentGoal');
    goalReflection = createMockModel('goalReflection');
    assessmentResult = createMockModel('assessmentResult');
    assessmentTemplate = createMockModel('assessmentTemplate');
    calendarEvent = createMockModel('calendarEvent');
    student = createMockModel('student');
    classRoutine = createMockModel('classRoutine');
    teacherPreferences = createMockModel('teacherPreferences');
    dailyPlan = createMockModel('dailyPlan');
    dailyPlanItem = createMockModel('dailyPlanItem');
    resource = createMockModel('resource');
    longRangePlan = createMockModel('longRangePlan');
    unitPlan = createMockModel('unitPlan');
    eTFOLessonPlan = createMockModel('eTFOLessonPlan');
    daybookEntry = createMockModel('daybookEntry');
    // Test helper to reset all mock data
    _resetAllMocks = () => {
        Object.values(this).forEach((value) => {
            if (value && typeof value === 'object' && '_reset' in value) {
                value._reset();
            }
        });
    };
}
// Create singleton instance
export const prisma = new PrismaClient();
// Export enums and types
export const ImportStatus = {
    UPLOADING: 'UPLOADING',
    PROCESSING: 'PROCESSING',
    READY_FOR_REVIEW: 'READY_FOR_REVIEW',
    CONFIRMED: 'CONFIRMED',
    COMPLETED: 'COMPLETED',
    FAILED: 'FAILED',
    CANCELLED: 'CANCELLED',
};
export const Prisma = {
    PrismaClientKnownRequestError: class PrismaClientKnownRequestError extends Error {
        code;
        constructor(message, code) {
            super(message);
            this.code = code;
        }
    },
    PrismaClientValidationError: class PrismaClientValidationError extends Error {
    },
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL21vY2tzL2RhdGFiYXNlLm1vY2sudHMiLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHO0FBRUgsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVyQyx5REFBeUQ7QUFDekQsTUFBTSxlQUFlLEdBQUcsQ0FBQyxTQUFpQixFQUFFLFVBQXNDLEVBQUUsRUFBRSxFQUFFO0lBQ3RGLE1BQU0sUUFBUSxHQUFHLElBQUksR0FBRyxFQUFlLENBQUM7SUFDeEMsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDO0lBRWxCLDhCQUE4QjtJQUM5QixNQUFNLFVBQVUsR0FBRyxDQUFDLGtCQUFrQixFQUFFLGdCQUFnQixFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsY0FBYyxFQUFFLHVCQUF1QixDQUFDLENBQUM7SUFDaEksTUFBTSxrQkFBa0IsR0FBRyxPQUFPLENBQUMsWUFBWSxJQUFJLFVBQVUsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7SUFFbEYsTUFBTSxVQUFVLEdBQUcsR0FBRyxFQUFFO1FBQ3RCLElBQUksa0JBQWtCLEVBQUUsQ0FBQztZQUN2Qiw4QkFBOEI7WUFDOUIsT0FBTyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDO1FBQ3hELENBQUM7UUFDRCxPQUFPLFNBQVMsRUFBRSxDQUFDO0lBQ3JCLENBQUMsQ0FBQztJQUVGLE9BQU87UUFDTCxVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRTtZQUNoQyxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDO1FBQzVELENBQUMsQ0FBQztRQUVGLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRTtZQUNyQixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3hELENBQUMsQ0FBQztRQUVGLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRTtZQUN0QixNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzdDLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDO1FBRUYsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUU7WUFDM0IsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUNuQyxNQUFNLE1BQU0sR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsRUFBRSxDQUFDO1lBQzdFLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ2pDLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUM7UUFFRixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRTtZQUMvQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7Z0JBQ3JDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLElBQUksVUFBVSxFQUFFLENBQUM7Z0JBQ25DLE1BQU0sTUFBTSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxFQUFFLENBQUM7Z0JBQzdFLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUNqQyxPQUFPLE1BQU0sQ0FBQztZQUNoQixDQUFDLENBQUMsQ0FBQztZQUNILE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUNwRCxDQUFDLENBQUM7UUFFRixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUU7WUFDbEMsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QyxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxRQUFRO2dCQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUNuRCxNQUFNLE9BQU8sR0FBRyxFQUFFLEdBQUcsUUFBUSxFQUFFLEdBQUcsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxFQUFFLENBQUM7WUFDaEUsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDM0IsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQztRQUVGLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRTtZQUN2QixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFDbkQsQ0FBQyxDQUFDO1FBRUYsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUU7WUFDNUIsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QyxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pDLElBQUksQ0FBQyxNQUFNO2dCQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUNqRCxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3JCLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUM7UUFFRixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUU7WUFDdkIsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztZQUM1QixRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDakIsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUM7UUFFRixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwRCxTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzdDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFM0Msa0NBQWtDO1FBQ2xDLFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxRQUFRO1FBQzVCLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFO0tBQy9CLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRiw0QkFBNEI7QUFDNUIsTUFBTSxPQUFPLFlBQVk7SUFDdkIscUJBQXFCO0lBQ3JCLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbEQsV0FBVyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUVyRCxzQkFBc0I7SUFDdEIsWUFBWSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFO1FBQ2pELElBQUksT0FBTyxFQUFFLEtBQUssVUFBVSxFQUFFLENBQUM7WUFDN0IsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEIsQ0FBQztRQUNELE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILGdDQUFnQztJQUNoQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzVDLGVBQWUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDbEQsV0FBVyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3QyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFbkQsYUFBYTtJQUNiLElBQUksR0FBRyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0IsT0FBTyxHQUFHLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNyQyxnQkFBZ0IsR0FBRyxlQUFlLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUN2RCxxQkFBcUIsR0FBRyxlQUFlLENBQUMsdUJBQXVCLENBQUMsQ0FBQztJQUNqRSw4QkFBOEIsR0FBRyxlQUFlLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztJQUNuRixnQkFBZ0IsR0FBRyxlQUFlLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUN2RCxjQUFjLEdBQUcsZUFBZSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDbkQsT0FBTyxHQUFHLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNyQyxTQUFTLEdBQUcsZUFBZSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3pDLFFBQVEsR0FBRyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDdkMsZUFBZSxHQUFHLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ3JELFVBQVUsR0FBRyxlQUFlLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDM0Msa0JBQWtCLEdBQUcsZUFBZSxDQUFDLG9CQUFvQixDQUFDLENBQUM7SUFDM0QsbUJBQW1CLEdBQUcsZUFBZSxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDN0QsSUFBSSxHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvQixRQUFRLEdBQUcsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZDLGVBQWUsR0FBRyxlQUFlLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNyRCxZQUFZLEdBQUcsZUFBZSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQy9DLFdBQVcsR0FBRyxlQUFlLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDN0MsY0FBYyxHQUFHLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ25ELGdCQUFnQixHQUFHLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQ3ZELGtCQUFrQixHQUFHLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQzNELGFBQWEsR0FBRyxlQUFlLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDakQsT0FBTyxHQUFHLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNyQyxZQUFZLEdBQUcsZUFBZSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQy9DLGtCQUFrQixHQUFHLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQzNELFNBQVMsR0FBRyxlQUFlLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDekMsYUFBYSxHQUFHLGVBQWUsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNqRCxRQUFRLEdBQUcsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZDLGFBQWEsR0FBRyxlQUFlLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDakQsUUFBUSxHQUFHLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUN2QyxjQUFjLEdBQUcsZUFBZSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDbkQsWUFBWSxHQUFHLGVBQWUsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUUvQyxxQ0FBcUM7SUFDckMsY0FBYyxHQUFHLEdBQUcsRUFBRTtRQUNwQixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ3BDLElBQUksS0FBSyxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsSUFBSSxRQUFRLElBQUksS0FBSyxFQUFFLENBQUM7Z0JBQzVELEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNqQixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUM7Q0FDSDtBQUVELDRCQUE0QjtBQUM1QixNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUV6Qyx5QkFBeUI7QUFDekIsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHO0lBQzFCLFNBQVMsRUFBRSxXQUFXO0lBQ3RCLFVBQVUsRUFBRSxZQUFZO0lBQ3hCLGdCQUFnQixFQUFFLGtCQUFrQjtJQUNwQyxTQUFTLEVBQUUsV0FBVztJQUN0QixTQUFTLEVBQUUsV0FBVztJQUN0QixNQUFNLEVBQUUsUUFBUTtJQUNoQixTQUFTLEVBQUUsV0FBVztDQUN2QixDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sTUFBTSxHQUFHO0lBQ3BCLDZCQUE2QixFQUFFLE1BQU0sNkJBQThCLFNBQVEsS0FBSztRQUM5RSxJQUFJLENBQVM7UUFDYixZQUFZLE9BQWUsRUFBRSxJQUFZO1lBQ3ZDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNmLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ25CLENBQUM7S0FDRjtJQUNELDJCQUEyQixFQUFFLE1BQU0sMkJBQTRCLFNBQVEsS0FBSztLQUFHO0NBQ2hGLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL21vY2tzL2RhdGFiYXNlLm1vY2sudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcHRpbWl6ZWQgRGF0YWJhc2UgTW9ja1xuICogUHJvdmlkZXMgYSBjb21wbGV0ZSBtb2NrIGltcGxlbWVudGF0aW9uIG9mIFByaXNtYUNsaWVudFxuICovXG5cbmltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuLy8gSGVscGVyIHRvIGNyZWF0ZSBhIG1vY2sgbW9kZWwgd2l0aCBhbGwgQ1JVRCBvcGVyYXRpb25zXG5jb25zdCBjcmVhdGVNb2NrTW9kZWwgPSAobW9kZWxOYW1lOiBzdHJpbmcsIG9wdGlvbnM6IHsgdXNlU3RyaW5nSWRzPzogYm9vbGVhbiB9ID0ge30pID0+IHtcbiAgY29uc3QgbW9ja0RhdGEgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuICBsZXQgaWRDb3VudGVyID0gMTtcbiAgXG4gIC8vIE1vZGVscyB0aGF0IHVzZSBDVUlEIGZvcm1hdFxuICBjb25zdCBjdWlkTW9kZWxzID0gWydjdXJyaWN1bHVtSW1wb3J0JywgJ2VURk9MZXNzb25QbGFuJywgJ2xvbmdSYW5nZVBsYW4nLCAndW5pdFBsYW4nLCAnZGF5Ym9va0VudHJ5JywgJ2N1cnJpY3VsdW1FeHBlY3RhdGlvbiddO1xuICBjb25zdCBzaG91bGRVc2VTdHJpbmdJZHMgPSBvcHRpb25zLnVzZVN0cmluZ0lkcyB8fCBjdWlkTW9kZWxzLmluY2x1ZGVzKG1vZGVsTmFtZSk7XG5cbiAgY29uc3QgZ2VuZXJhdGVJZCA9ICgpID0+IHtcbiAgICBpZiAoc2hvdWxkVXNlU3RyaW5nSWRzKSB7XG4gICAgICAvLyBHZW5lcmF0ZSBhIENVSUQtbGlrZSBzdHJpbmdcbiAgICAgIHJldHVybiBgYyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDI0KX1gO1xuICAgIH1cbiAgICByZXR1cm4gaWRDb3VudGVyKys7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCh7IHdoZXJlIH0pID0+IHtcbiAgICAgIGNvbnN0IGtleSA9IE9iamVjdC52YWx1ZXMod2hlcmUpWzBdO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtb2NrRGF0YS5nZXQoU3RyaW5nKGtleSkpIHx8IG51bGwpO1xuICAgIH0pLFxuICAgIFxuICAgIGZpbmRNYW55OiBqZXN0LmZuKCgpID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoQXJyYXkuZnJvbShtb2NrRGF0YS52YWx1ZXMoKSkpO1xuICAgIH0pLFxuICAgIFxuICAgIGZpbmRGaXJzdDogamVzdC5mbigoKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZXMgPSBBcnJheS5mcm9tKG1vY2tEYXRhLnZhbHVlcygpKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodmFsdWVzWzBdIHx8IG51bGwpO1xuICAgIH0pLFxuICAgIFxuICAgIGNyZWF0ZTogamVzdC5mbigoeyBkYXRhIH0pID0+IHtcbiAgICAgIGNvbnN0IGlkID0gZGF0YS5pZCB8fCBnZW5lcmF0ZUlkKCk7XG4gICAgICBjb25zdCByZWNvcmQgPSB7IGlkLCAuLi5kYXRhLCBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9O1xuICAgICAgbW9ja0RhdGEuc2V0KFN0cmluZyhpZCksIHJlY29yZCk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlY29yZCk7XG4gICAgfSksXG4gICAgXG4gICAgY3JlYXRlTWFueTogamVzdC5mbigoeyBkYXRhIH0pID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZWQgPSBkYXRhLm1hcCgoaXRlbTogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IGlkID0gaXRlbS5pZCB8fCBnZW5lcmF0ZUlkKCk7XG4gICAgICAgIGNvbnN0IHJlY29yZCA9IHsgaWQsIC4uLml0ZW0sIGNyZWF0ZWRBdDogbmV3IERhdGUoKSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH07XG4gICAgICAgIG1vY2tEYXRhLnNldChTdHJpbmcoaWQpLCByZWNvcmQpO1xuICAgICAgICByZXR1cm4gcmVjb3JkO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgY291bnQ6IGNyZWF0ZWQubGVuZ3RoIH0pO1xuICAgIH0pLFxuICAgIFxuICAgIHVwZGF0ZTogamVzdC5mbigoeyB3aGVyZSwgZGF0YSB9KSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSBTdHJpbmcoT2JqZWN0LnZhbHVlcyh3aGVyZSlbMF0pO1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBtb2NrRGF0YS5nZXQoa2V5KTtcbiAgICAgIGlmICghZXhpc3RpbmcpIHRocm93IG5ldyBFcnJvcignUmVjb3JkIG5vdCBmb3VuZCcpO1xuICAgICAgY29uc3QgdXBkYXRlZCA9IHsgLi4uZXhpc3RpbmcsIC4uLmRhdGEsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9O1xuICAgICAgbW9ja0RhdGEuc2V0KGtleSwgdXBkYXRlZCk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVwZGF0ZWQpO1xuICAgIH0pLFxuICAgIFxuICAgIHVwZGF0ZU1hbnk6IGplc3QuZm4oKCkgPT4ge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IGNvdW50OiBtb2NrRGF0YS5zaXplIH0pO1xuICAgIH0pLFxuICAgIFxuICAgIGRlbGV0ZTogamVzdC5mbigoeyB3aGVyZSB9KSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSBTdHJpbmcoT2JqZWN0LnZhbHVlcyh3aGVyZSlbMF0pO1xuICAgICAgY29uc3QgcmVjb3JkID0gbW9ja0RhdGEuZ2V0KGtleSk7XG4gICAgICBpZiAoIXJlY29yZCkgdGhyb3cgbmV3IEVycm9yKCdSZWNvcmQgbm90IGZvdW5kJyk7XG4gICAgICBtb2NrRGF0YS5kZWxldGUoa2V5KTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVjb3JkKTtcbiAgICB9KSxcbiAgICBcbiAgICBkZWxldGVNYW55OiBqZXN0LmZuKCgpID0+IHtcbiAgICAgIGNvbnN0IGNvdW50ID0gbW9ja0RhdGEuc2l6ZTtcbiAgICAgIG1vY2tEYXRhLmNsZWFyKCk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgY291bnQgfSk7XG4gICAgfSksXG4gICAgXG4gICAgY291bnQ6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKG1vY2tEYXRhLnNpemUpKSxcbiAgICBhZ2dyZWdhdGU6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHt9KSksXG4gICAgZ3JvdXBCeTogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoW10pKSxcbiAgICBcbiAgICAvLyBUZXN0IGhlbHBlciB0byBhY2Nlc3MgbW9jayBkYXRhXG4gICAgX2dldE1vY2tEYXRhOiAoKSA9PiBtb2NrRGF0YSxcbiAgICBfcmVzZXQ6ICgpID0+IG1vY2tEYXRhLmNsZWFyKCksXG4gIH07XG59O1xuXG4vLyBDcmVhdGUgbW9jayBQcmlzbWEgY2xpZW50XG5leHBvcnQgY2xhc3MgUHJpc21hQ2xpZW50IHtcbiAgLy8gQ29ubmVjdGlvbiBtZXRob2RzXG4gICRjb25uZWN0ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG4gICRkaXNjb25uZWN0ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG4gIFxuICAvLyBUcmFuc2FjdGlvbiBzdXBwb3J0XG4gICR0cmFuc2FjdGlvbiA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGZuKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIGZuKHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoZm4pO1xuICB9KTtcbiAgXG4gIC8vIFJhdyBxdWVyeSBtZXRob2RzIChvcHRpbWl6ZWQpXG4gICRxdWVyeVJhdyA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICRxdWVyeVJhd1Vuc2FmZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICRleGVjdXRlUmF3ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKDApO1xuICAkZXhlY3V0ZVJhd1Vuc2FmZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgwKTtcbiAgXG4gIC8vIEFsbCBtb2RlbHNcbiAgdXNlciA9IGNyZWF0ZU1vY2tNb2RlbCgndXNlcicpO1xuICBvdXRjb21lID0gY3JlYXRlTW9ja01vZGVsKCdvdXRjb21lJyk7XG4gIG91dGNvbWVFbWJlZGRpbmcgPSBjcmVhdGVNb2NrTW9kZWwoJ291dGNvbWVFbWJlZGRpbmcnKTtcbiAgY3VycmljdWx1bUV4cGVjdGF0aW9uID0gY3JlYXRlTW9ja01vZGVsKCdjdXJyaWN1bHVtRXhwZWN0YXRpb24nKTtcbiAgY3VycmljdWx1bUV4cGVjdGF0aW9uRW1iZWRkaW5nID0gY3JlYXRlTW9ja01vZGVsKCdjdXJyaWN1bHVtRXhwZWN0YXRpb25FbWJlZGRpbmcnKTtcbiAgY3VycmljdWx1bUltcG9ydCA9IGNyZWF0ZU1vY2tNb2RlbCgnY3VycmljdWx1bUltcG9ydCcpO1xuICBvdXRjb21lQ2x1c3RlciA9IGNyZWF0ZU1vY2tNb2RlbCgnb3V0Y29tZUNsdXN0ZXInKTtcbiAgc3ViamVjdCA9IGNyZWF0ZU1vY2tNb2RlbCgnc3ViamVjdCcpO1xuICBtaWxlc3RvbmUgPSBjcmVhdGVNb2NrTW9kZWwoJ21pbGVzdG9uZScpO1xuICBhY3Rpdml0eSA9IGNyZWF0ZU1vY2tNb2RlbCgnYWN0aXZpdHknKTtcbiAgYWN0aXZpdHlPdXRjb21lID0gY3JlYXRlTW9ja01vZGVsKCdhY3Rpdml0eU91dGNvbWUnKTtcbiAgbGVzc29uUGxhbiA9IGNyZWF0ZU1vY2tNb2RlbCgnbGVzc29uUGxhbicpO1xuICBsZXNzb25QbGFuQWN0aXZpdHkgPSBjcmVhdGVNb2NrTW9kZWwoJ2xlc3NvblBsYW5BY3Rpdml0eScpO1xuICBhSVN1Z2dlc3RlZEFjdGl2aXR5ID0gY3JlYXRlTW9ja01vZGVsKCdhSVN1Z2dlc3RlZEFjdGl2aXR5Jyk7XG4gIG5vdGUgPSBjcmVhdGVNb2NrTW9kZWwoJ25vdGUnKTtcbiAgZXZpZGVuY2UgPSBjcmVhdGVNb2NrTW9kZWwoJ2V2aWRlbmNlJyk7XG4gIG1pbGVzdG9uZV9hbGVydCA9IGNyZWF0ZU1vY2tNb2RlbCgnbWlsZXN0b25lX2FsZXJ0Jyk7XG4gIG5vdGlmaWNhdGlvbiA9IGNyZWF0ZU1vY2tNb2RlbCgnbm90aWZpY2F0aW9uJyk7XG4gIHN0dWRlbnRHb2FsID0gY3JlYXRlTW9ja01vZGVsKCdzdHVkZW50R29hbCcpO1xuICBnb2FsUmVmbGVjdGlvbiA9IGNyZWF0ZU1vY2tNb2RlbCgnZ29hbFJlZmxlY3Rpb24nKTtcbiAgYXNzZXNzbWVudFJlc3VsdCA9IGNyZWF0ZU1vY2tNb2RlbCgnYXNzZXNzbWVudFJlc3VsdCcpO1xuICBhc3Nlc3NtZW50VGVtcGxhdGUgPSBjcmVhdGVNb2NrTW9kZWwoJ2Fzc2Vzc21lbnRUZW1wbGF0ZScpO1xuICBjYWxlbmRhckV2ZW50ID0gY3JlYXRlTW9ja01vZGVsKCdjYWxlbmRhckV2ZW50Jyk7XG4gIHN0dWRlbnQgPSBjcmVhdGVNb2NrTW9kZWwoJ3N0dWRlbnQnKTtcbiAgY2xhc3NSb3V0aW5lID0gY3JlYXRlTW9ja01vZGVsKCdjbGFzc1JvdXRpbmUnKTtcbiAgdGVhY2hlclByZWZlcmVuY2VzID0gY3JlYXRlTW9ja01vZGVsKCd0ZWFjaGVyUHJlZmVyZW5jZXMnKTtcbiAgZGFpbHlQbGFuID0gY3JlYXRlTW9ja01vZGVsKCdkYWlseVBsYW4nKTtcbiAgZGFpbHlQbGFuSXRlbSA9IGNyZWF0ZU1vY2tNb2RlbCgnZGFpbHlQbGFuSXRlbScpO1xuICByZXNvdXJjZSA9IGNyZWF0ZU1vY2tNb2RlbCgncmVzb3VyY2UnKTtcbiAgbG9uZ1JhbmdlUGxhbiA9IGNyZWF0ZU1vY2tNb2RlbCgnbG9uZ1JhbmdlUGxhbicpO1xuICB1bml0UGxhbiA9IGNyZWF0ZU1vY2tNb2RlbCgndW5pdFBsYW4nKTtcbiAgZVRGT0xlc3NvblBsYW4gPSBjcmVhdGVNb2NrTW9kZWwoJ2VURk9MZXNzb25QbGFuJyk7XG4gIGRheWJvb2tFbnRyeSA9IGNyZWF0ZU1vY2tNb2RlbCgnZGF5Ym9va0VudHJ5Jyk7XG5cbiAgLy8gVGVzdCBoZWxwZXIgdG8gcmVzZXQgYWxsIG1vY2sgZGF0YVxuICBfcmVzZXRBbGxNb2NrcyA9ICgpID0+IHtcbiAgICBPYmplY3QudmFsdWVzKHRoaXMpLmZvckVhY2goKHZhbHVlKSA9PiB7XG4gICAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiAnX3Jlc2V0JyBpbiB2YWx1ZSkge1xuICAgICAgICB2YWx1ZS5fcmVzZXQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbn1cblxuLy8gQ3JlYXRlIHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcblxuLy8gRXhwb3J0IGVudW1zIGFuZCB0eXBlc1xuZXhwb3J0IGNvbnN0IEltcG9ydFN0YXR1cyA9IHtcbiAgVVBMT0FESU5HOiAnVVBMT0FESU5HJyxcbiAgUFJPQ0VTU0lORzogJ1BST0NFU1NJTkcnLFxuICBSRUFEWV9GT1JfUkVWSUVXOiAnUkVBRFlfRk9SX1JFVklFVycsXG4gIENPTkZJUk1FRDogJ0NPTkZJUk1FRCcsXG4gIENPTVBMRVRFRDogJ0NPTVBMRVRFRCcsXG4gIEZBSUxFRDogJ0ZBSUxFRCcsXG4gIENBTkNFTExFRDogJ0NBTkNFTExFRCcsXG59O1xuXG5leHBvcnQgY29uc3QgUHJpc21hID0ge1xuICBQcmlzbWFDbGllbnRLbm93blJlcXVlc3RFcnJvcjogY2xhc3MgUHJpc21hQ2xpZW50S25vd25SZXF1ZXN0RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29kZTogc3RyaW5nO1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgY29kZTogc3RyaW5nKSB7XG4gICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgIHRoaXMuY29kZSA9IGNvZGU7XG4gICAgfVxuICB9LFxuICBQcmlzbWFDbGllbnRWYWxpZGF0aW9uRXJyb3I6IGNsYXNzIFByaXNtYUNsaWVudFZhbGlkYXRpb25FcnJvciBleHRlbmRzIEVycm9yIHt9LFxufTsiXSwidmVyc2lvbiI6M30=