{"file":"/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/src/services/connectors/educationWebConnector.ts","mappings":"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","names":[],"sources":["/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/src/services/connectors/educationWebConnector.ts"],"sourcesContent":["import { BaseConnector } from './baseConnector';\nimport { SearchParams } from '../activityDiscoveryService';\nimport { ExternalActivity } from '@teaching-engine/database';\nimport * as cheerio from 'cheerio';\n\ninterface EducationalSite {\n  id: string;\n  name: string;\n  baseUrl: string;\n  searchUrl: (query: string, params: SearchParams) => string;\n  parseResults: (html: string, $: cheerio.CheerioAPI, site: EducationalSite) => EducationalActivity[];\n  isActive: boolean;\n  language: 'en' | 'fr' | 'both';\n  crawlDelay: number; // milliseconds\n}\n\ninterface EducationalActivity {\n  title: string;\n  url: string;\n  description?: string;\n  grade?: string;\n  subject?: string;\n  type?: string;\n  materials?: string[];\n  duration?: number;\n  thumbnail?: string;\n  isFree?: boolean;\n  rating?: number;\n}\n\n/**\n * Educational Websites Connector\n * Searches multiple educational resource websites for activities and lessons\n */\nexport class EducationWebConnector extends BaseConnector {\n  private sites: EducationalSite[] = [\n    {\n      id: 'khan-academy',\n      name: 'Khan Academy',\n      baseUrl: 'https://www.khanacademy.org',\n      language: 'both',\n      isActive: true,\n      crawlDelay: 2000,\n      searchUrl: (query: string, params: SearchParams) => {\n        const searchParams = new URLSearchParams({\n          search: query,\n          sort: 'votes',\n        });\n        \n        if (params.grade) {\n          // Khan Academy uses different grade representations\n          if (params.grade >= 1 && params.grade <= 8) {\n            searchParams.append('class', `grade-${params.grade}`);\n          }\n        }\n        \n        if (params.subject) {\n          const subjectMap: Record<string, string> = {\n            'math': 'math',\n            'science': 'science',\n            'english': 'ela',\n            'social-studies': 'humanities',\n          };\n          const khanSubject = subjectMap[params.subject.toLowerCase()];\n          if (khanSubject) {\n            searchParams.append('subject', khanSubject);\n          }\n        }\n\n        return `https://www.khanacademy.org/search?${searchParams.toString()}`;\n      },\n      parseResults: (html: string, $: cheerio.CheerioAPI): EducationalActivity[] => {\n        const activities: EducationalActivity[] = [];\n\n        $('.search-results-list .result').each((_, element) => {\n          const $element = $(element);\n          const title = $element.find('.result-title a').text().trim();\n          const url = $element.find('.result-title a').attr('href');\n          const description = $element.find('.result-description').text().trim();\n          const thumbnail = $element.find('img').attr('src');\n\n          if (title && url) {\n            activities.push({\n              title,\n              url: url.startsWith('http') ? url : `https://www.khanacademy.org${url}`,\n              description,\n              type: 'video', // Khan Academy is primarily video-based\n              thumbnail,\n              isFree: true,\n            });\n          }\n        });\n\n        return activities;\n      },\n    },\n    {\n      id: 'teacher-resources',\n      name: 'Teacher Resources (Readworks, Scholastic)',\n      baseUrl: 'https://www.readworks.org',\n      language: 'en',\n      isActive: true,\n      crawlDelay: 3000,\n      searchUrl: (query: string, params: SearchParams) => {\n        const searchParams = new URLSearchParams({\n          q: query,\n        });\n        \n        if (params.grade) {\n          searchParams.append('grade', params.grade.toString());\n        }\n\n        return `https://www.readworks.org/find-content?${searchParams.toString()}`;\n      },\n      parseResults: (html: string, $: cheerio.CheerioAPI): EducationalActivity[] => {\n        const activities: EducationalActivity[] = [];\n\n        $('.search-result, .content-card').each((_, element) => {\n          const $element = $(element);\n          const title = $element.find('.title, h3, .card-title').first().text().trim();\n          const url = $element.find('a').first().attr('href');\n          const description = $element.find('.description, .excerpt, .card-text').first().text().trim();\n          const gradeText = $element.find('.grade, .grade-level').text().trim();\n\n          if (title && url) {\n            activities.push({\n              title,\n              url: url.startsWith('http') ? url : `https://www.readworks.org${url}`,\n              description,\n              grade: gradeText,\n              type: 'worksheet',\n              isFree: true,\n            });\n          }\n        });\n\n        return activities;\n      },\n    },\n    {\n      id: 'education-ca',\n      name: 'Education.ca Resources',\n      baseUrl: 'https://www.education.ca',\n      language: 'both',\n      isActive: true,\n      crawlDelay: 2500,\n      searchUrl: (query: string, params: SearchParams) => {\n        const searchParams = new URLSearchParams({\n          q: query,\n          sort: 'relevance',\n        });\n        \n        if (params.language === 'fr') {\n          searchParams.append('lang', 'fr');\n        }\n\n        return `https://www.education.ca/search?${searchParams.toString()}`;\n      },\n      parseResults: (html: string, $: cheerio.CheerioAPI): EducationalActivity[] => {\n        const activities: EducationalActivity[] = [];\n\n        $('.resource-item, .search-result').each((_, element) => {\n          const $element = $(element);\n          const title = $element.find('.resource-title, .title').text().trim();\n          const url = $element.find('a').first().attr('href');\n          const description = $element.find('.resource-description, .description').text().trim();\n          const gradeText = $element.find('.grade-level, .grade').text().trim();\n          const subjectText = $element.find('.subject').text().trim();\n\n          if (title && url) {\n            activities.push({\n              title,\n              url: url.startsWith('http') ? url : `https://www.education.ca${url}`,\n              description,\n              grade: gradeText,\n              subject: subjectText,\n              type: 'resource',\n              isFree: true,\n            });\n          }\n        });\n\n        return activities;\n      },\n    },\n    {\n      id: 'tvo-ilc',\n      name: 'TVO ILC (French Resources)',\n      baseUrl: 'https://www.tvoilc.ca',\n      language: 'fr',\n      isActive: true,\n      crawlDelay: 3000,\n      searchUrl: (query: string, params: SearchParams) => {\n        const searchParams = new URLSearchParams({\n          q: query,\n        });\n        \n        if (params.grade) {\n          searchParams.append('niveau', params.grade.toString());\n        }\n\n        return `https://www.tvoilc.ca/recherche?${searchParams.toString()}`;\n      },\n      parseResults: (html: string, $: cheerio.CheerioAPI): EducationalActivity[] => {\n        const activities: EducationalActivity[] = [];\n\n        $('.resource, .cours-item').each((_, element) => {\n          const $element = $(element);\n          const title = $element.find('.titre, .title, h3').first().text().trim();\n          const url = $element.find('a').first().attr('href');\n          const description = $element.find('.description, .resume').first().text().trim();\n\n          if (title && url) {\n            activities.push({\n              title,\n              url: url.startsWith('http') ? url : `https://www.tvoilc.ca${url}`,\n              description,\n              type: 'lesson_plan',\n              isFree: true,\n            });\n          }\n        });\n\n        return activities;\n      },\n    },\n    {\n      id: 'teachingideas',\n      name: 'Teaching Ideas & Worksheets',\n      baseUrl: 'https://www.teachingideas.co.uk',\n      language: 'en',\n      isActive: true,\n      crawlDelay: 2000,\n      searchUrl: (query: string, _params: SearchParams) => {\n        return `https://www.teachingideas.co.uk/search?q=${encodeURIComponent(query)}`;\n      },\n      parseResults: (html: string, $: cheerio.CheerioAPI): EducationalActivity[] => {\n        const activities: EducationalActivity[] = [];\n\n        $('.search-result, .resource-card').each((_, element) => {\n          const $element = $(element);\n          const title = $element.find('.title, h3, .resource-title').first().text().trim();\n          const url = $element.find('a').first().attr('href');\n          const description = $element.find('.excerpt, .description').first().text().trim();\n\n          if (title && url) {\n            activities.push({\n              title,\n              url: url.startsWith('http') ? url : `https://www.teachingideas.co.uk${url}`,\n              description,\n              type: this.inferTypeFromTitle(title),\n              isFree: true,\n            });\n          }\n        });\n\n        return activities;\n      },\n    },\n  ];\n\n  constructor() {\n    super('EducationWeb');\n  }\n\n  async search(\n    params: SearchParams,\n  ): Promise<Omit<ExternalActivity, 'id' | 'createdAt' | 'updatedAt'>[]> {\n    const activities: Omit<ExternalActivity, 'id' | 'createdAt' | 'updatedAt'>[] = [];\n\n    // Filter sites based on language preference\n    const sitesToSearch = this.sites.filter((site) => {\n      if (!site.isActive) return false;\n      if (params.language === 'fr' && site.language === 'en') return false;\n      if (params.language === 'en' && site.language === 'fr') return false;\n      return true;\n    });\n\n    // Search each site\n    for (const site of sitesToSearch) {\n      try {\n        console.log(`Searching ${site.name} for: ${params.query}`);\n        \n        const searchUrl = site.searchUrl(params.query || '', params);\n        const html = await this.fetchWithRetry(searchUrl);\n        \n        if (!html) continue;\n\n        const $ = cheerio.load(html);\n        const siteResults = site.parseResults(html, $, site);\n\n        // Transform results to ExternalActivity format\n        for (const result of siteResults) {\n          const activity = this.transformToExternalActivity(\n            result,\n            {\n              externalId: this.generateIdFromUrl(result.url),\n              source: this.sourceName,\n              url: result.url,\n              title: result.title,\n              description: result.description,\n              thumbnailUrl: result.thumbnail,\n              duration: result.duration || this.estimateDuration(result),\n              activityType: result.type || this.inferActivityType({\n                title: result.title,\n                description: result.description,\n              }),\n              gradeMin: this.extractGradeFromText(result.grade || result.description || '').min,\n              gradeMax: this.extractGradeFromText(result.grade || result.description || '').max,\n              subject: this.normalizeSubject(result.subject || this.inferSubject(result.title + ' ' + (result.description || ''))),\n              language: params.language || site.language === 'fr' ? 'fr' : 'en',\n              materials: result.materials || this.extractMaterials(result.description || ''),\n              sourceRating: result.rating,\n              isFree: result.isFree !== false, // Default to free\n              license: 'Educational Use',\n            }\n          );\n\n          activities.push(activity);\n        }\n\n        // Respect crawl delay between sites\n        await this.delay(site.crawlDelay);\n      } catch (error) {\n        console.error(`Error searching ${site.name}:`, error);\n      }\n    }\n\n    console.log(`Found ${activities.length} activities from educational websites`);\n    return activities;\n  }\n\n  async getActivityDetails(\n    _externalId: string,\n  ): Promise<Omit<ExternalActivity, 'id' | 'createdAt' | 'updatedAt'> | null> {\n    // For educational web connector, we'd need to store the original URL mapping\n    // This is a simplified implementation\n    try {\n      // In a real implementation, we'd reconstruct the URL from the external ID\n      // or store the mapping in a database\n      return null;\n    } catch (error) {\n      console.error('Error getting activity details:', error);\n      return null;\n    }\n  }\n\n  private async fetchWithRetry(\n    url: string,\n    maxRetries: number = 3,\n    delay: number = 1000\n  ): Promise<string | null> {\n    const headers = {\n      'User-Agent': 'Teaching Engine 2.0 Educational Resource Bot (+https://teaching-engine.ca/bot)',\n      'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n      'Accept-Language': 'en-US,en;q=0.9,fr;q=0.8',\n    };\n\n    // Use the new fetchWithRetryAndTimeout from base class\n    return this.fetchWithRetryAndTimeout(\n      url,\n      { headers },\n      maxRetries,\n      30000, // 30 second timeout per request\n      delay\n    );\n  }\n\n  private generateIdFromUrl(url: string): string {\n    // Create a unique ID from the URL\n    const hash = Buffer.from(url).toString('base64');\n    return hash.replace(/[^a-zA-Z0-9]/g, '').substring(0, 20);\n  }\n\n  private extractGradeFromText(text: string): { min: number; max: number } {\n    const gradeMatch = text.match(/grade\\s*(\\d+)(?:\\s*-\\s*(\\d+))?|(\\d+)(?:st|nd|rd|th)\\s*grade/i);\n    \n    if (gradeMatch) {\n      const grade1 = parseInt(gradeMatch[1] || gradeMatch[3]);\n      const grade2 = gradeMatch[2] ? parseInt(gradeMatch[2]) : grade1;\n      \n      return {\n        min: Math.min(grade1, grade2),\n        max: Math.max(grade1, grade2),\n      };\n    }\n\n    // Default for elementary\n    return { min: 1, max: 8 };\n  }\n\n  private inferSubject(text: string): string {\n    const lowerText = text.toLowerCase();\n    \n    if (lowerText.includes('math') || lowerText.includes('number') || lowerText.includes('calculation')) {\n      return 'mathematics';\n    }\n    if (lowerText.includes('science') || lowerText.includes('experiment') || lowerText.includes('biology')) {\n      return 'science';\n    }\n    if (lowerText.includes('english') || lowerText.includes('reading') || lowerText.includes('writing')) {\n      return 'english';\n    }\n    if (lowerText.includes('french') || lowerText.includes('fran√ßais')) {\n      return 'french';\n    }\n    if (lowerText.includes('history') || lowerText.includes('geography') || lowerText.includes('social')) {\n      return 'social-studies';\n    }\n    if (lowerText.includes('art') || lowerText.includes('music') || lowerText.includes('drama')) {\n      return 'arts';\n    }\n    if (lowerText.includes('physical') || lowerText.includes('pe') || lowerText.includes('sport')) {\n      return 'physical-education';\n    }\n\n    return 'general';\n  }\n\n  private inferTypeFromTitle(title: string): string {\n    const lowerTitle = title.toLowerCase();\n    \n    if (lowerTitle.includes('worksheet') || lowerTitle.includes('printable')) {\n      return 'worksheet';\n    }\n    if (lowerTitle.includes('game') || lowerTitle.includes('activity')) {\n      return 'game';\n    }\n    if (lowerTitle.includes('lesson') || lowerTitle.includes('plan')) {\n      return 'lesson_plan';\n    }\n    if (lowerTitle.includes('video') || lowerTitle.includes('watch')) {\n      return 'video';\n    }\n    if (lowerTitle.includes('experiment') || lowerTitle.includes('investigation')) {\n      return 'experiment';\n    }\n\n    return 'worksheet';\n  }\n\n  private estimateDuration(activity: EducationalActivity): number {\n    const text = (activity.title + ' ' + (activity.description || '')).toLowerCase();\n    \n    // Look for explicit duration mentions\n    const durationMatch = text.match(/(\\d+)\\s*(?:minutes?|mins?|hours?)/i);\n    if (durationMatch) {\n      const value = parseInt(durationMatch[1]);\n      const unit = durationMatch[0].toLowerCase();\n      \n      if (unit.includes('hour')) {\n        return value * 60;\n      }\n      return value;\n    }\n\n    // Estimate based on activity type\n    if (activity.type === 'video') return 10;\n    if (activity.type === 'game') return 20;\n    if (activity.type === 'worksheet') return 25;\n    if (activity.type === 'lesson_plan') return 45;\n    if (activity.type === 'experiment') return 60;\n\n    return 30; // Default\n  }\n\n}"],"version":3}