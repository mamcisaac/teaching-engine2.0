706bb59f77311792c74107ec4909cb4b
import { prisma } from '../prisma';
import { generateContent } from './llmService';
import logger from '../logger';
export class ReportGeneratorService {
    async generateReport(request) {
        try {
            // Fetch student data
            const student = await prisma.student.findUnique({
                where: { id: request.studentId },
                include: {
                    user: true,
                    artifacts: {
                        where: {
                            createdAt: {
                                gte: request.startDate,
                                lte: request.endDate,
                            },
                        },
                    },
                    reflections: {
                        where: {
                            createdAt: {
                                gte: request.startDate,
                                lte: request.endDate,
                            },
                        },
                    },
                    goals: {
                        where: {
                            OR: [
                                { status: 'active' },
                                { status: 'completed' },
                            ],
                        },
                    },
                },
            });
            if (!student) {
                throw new Error('Student not found');
            }
            // Generate report based on type
            let report;
            switch (request.reportType) {
                case 'progress':
                    report = await this.generateProgressReport(student, request);
                    break;
                case 'narrative':
                    report = await this.generateNarrativeReport(student, request);
                    break;
                case 'term_summary':
                    report = await this.generateTermSummary(student, request);
                    break;
                case 'report_card':
                    report = await this.generateReportCard(student, request);
                    break;
                default:
                    throw new Error('Invalid report type');
            }
            return report;
        }
        catch (error) {
            logger.error('Failed to generate report:', error);
            throw error;
        }
    }
    async generateProgressReport(student, request) {
        const sections = [];
        // Assessment functionality removed - focus on artifacts and reflections
        if (student.artifacts.length > 0 || student.reflections.length > 0) {
            sections.push({
                title: request.language === 'fr' ? 'Progrès académique' : 'Academic Progress',
                content: await this.generateProgressFromArtifacts(student.artifacts, student.reflections, request.language),
                data: { artifacts: student.artifacts, reflections: student.reflections },
            });
        }
        // Goals Section
        if (request.includeGoals && student.goals.length > 0) {
            sections.push({
                title: request.language === 'fr' ? 'Objectifs' : 'Goals',
                content: await this.generateGoalsNarrative(student.goals, request.language),
                data: { goals: student.goals },
            });
        }
        // Overall Comments
        const overallComments = await this.generateOverallComments(student, sections, request.language);
        // Next Steps
        const nextSteps = await this.generateNextSteps(student, sections, request.language);
        return {
            studentName: `${student.firstName} ${student.lastName}`,
            period: `${request.startDate.toLocaleDateString()} - ${request.endDate.toLocaleDateString()}`,
            sections,
            overallComments,
            nextSteps,
        };
    }
    async generateNarrativeReport(student, request) {
        // Gather comprehensive data
        const learningJourney = this.compileLearningJourney(student);
        // Generate narrative using LLM
        const prompt = request.language === 'fr'
            ? `Générez un rapport narratif détaillé pour ${student.firstName} ${student.lastName}, couvrant la période du ${request.startDate.toLocaleDateString()} au ${request.endDate.toLocaleDateString()}. Incluez les réalisations, les défis et les domaines de croissance.`
            : `Generate a detailed narrative report for ${student.firstName} ${student.lastName}, covering the period from ${request.startDate.toLocaleDateString()} to ${request.endDate.toLocaleDateString()}. Include achievements, challenges, and areas of growth.`;
        const narrative = await generateContent(prompt, JSON.stringify(learningJourney));
        return {
            studentName: `${student.firstName} ${student.lastName}`,
            period: `${request.startDate.toLocaleDateString()} - ${request.endDate.toLocaleDateString()}`,
            sections: [{
                    title: request.language === 'fr' ? 'Rapport narratif' : 'Narrative Report',
                    content: narrative,
                }],
            overallComments: '',
            nextSteps: [],
        };
    }
    async generateTermSummary(student, request) {
        const sections = [];
        // Get subject-specific progress
        const subjectProgress = await this.getSubjectProgress(student);
        for (const subject of subjectProgress) {
            sections.push({
                title: subject.name,
                content: await this.generateSubjectSummary(subject, request.language),
                data: subject,
            });
        }
        // Overall term performance
        const overallComments = await this.generateTermOverview(student, subjectProgress, request.language);
        // Recommendations for next term
        const nextSteps = await this.generateTermRecommendations(student, subjectProgress, request.language);
        return {
            studentName: `${student.firstName} ${student.lastName}`,
            period: request.language === 'fr' ? 'Résumé du trimestre' : 'Term Summary',
            sections,
            overallComments,
            nextSteps,
        };
    }
    async generateReportCard(student, request) {
        const sections = [];
        // Get formal grades/assessments by subject
        const reportCardData = await this.compileReportCardData(student);
        for (const subject of reportCardData) {
            // Generate teacher comments for each subject
            const comments = await this.generateSubjectComments(subject, student, request.language);
            sections.push({
                title: subject.name,
                content: comments,
                data: {
                    grade: subject.grade,
                    outcomes: subject.outcomes,
                },
            });
        }
        // General comments
        const overallComments = await this.generateReportCardComments(student, reportCardData, request.language);
        return {
            studentName: `${student.firstName} ${student.lastName}`,
            period: request.language === 'fr' ? 'Bulletin scolaire' : 'Report Card',
            sections,
            overallComments,
            nextSteps: [],
        };
    }
    // Helper methods
    async generateProgressFromArtifacts(artifacts, reflections, language) {
        const context = {
            artifactCount: artifacts.length,
            reflectionCount: reflections.length,
            recentArtifacts: artifacts.slice(0, 3).map(a => ({ title: a.title, description: a.description })),
            recentReflections: reflections.slice(0, 3).map(r => ({ content: r.content }))
        };
        const prompt = language === 'fr'
            ? `Décrivez le progrès académique basé sur ${artifacts.length} artefacts et ${reflections.length} réflexions.`
            : `Describe academic progress based on ${artifacts.length} artifacts and ${reflections.length} reflections.`;
        return generateContent(prompt, JSON.stringify(context));
    }
    async generateGoalsNarrative(goals, language) {
        const activeGoals = goals.filter(g => g.status === 'active');
        const completedGoals = goals.filter(g => g.status === 'completed');
        const context = {
            active: activeGoals.map(g => ({ text: g.text })),
            completed: completedGoals.map(g => ({ text: g.text })),
        };
        const prompt = language === 'fr'
            ? `Décrivez le progrès vers les objectifs de l'élève: ${JSON.stringify(context)}`
            : `Describe the student's progress toward their goals: ${JSON.stringify(context)}`;
        return generateContent(prompt);
    }
    async generateOverallComments(student, sections, language) {
        const context = {
            studentName: `${student.firstName} ${student.lastName}`,
            sectionsCount: sections.length,
            sectionTitles: sections.map(s => s.title),
        };
        const prompt = language === 'fr'
            ? `Générez des commentaires généraux positifs et encourageants pour ${context.studentName} basés sur leur rapport de progrès.`
            : `Generate positive and encouraging overall comments for ${context.studentName} based on their progress report.`;
        return generateContent(prompt, JSON.stringify(context));
    }
    async generateNextSteps(student, sections, language) {
        const prompt = language === 'fr'
            ? `Suggérez 3-5 prochaines étapes spécifiques pour ${student.firstName} pour continuer leur progrès.`
            : `Suggest 3-5 specific next steps for ${student.firstName} to continue their progress.`;
        const suggestions = await generateContent(prompt, JSON.stringify(sections.map(s => ({ title: s.title, summary: s.content.substring(0, 100) }))));
        // Parse the suggestions into an array
        return suggestions.split('\n').filter(s => s.trim().length > 0).slice(0, 5);
    }
    compileLearningJourney(student) {
        return {
            artifacts: student.artifacts.map((a) => ({
                title: a.title,
                description: a.description,
                createdAt: a.createdAt,
            })),
            reflections: student.reflections.map((r) => ({
                content: r.content,
                createdAt: r.createdAt,
            })),
            goals: student.goals,
        };
    }
    async getSubjectProgress(student) {
        // Simplified subject progress without deep relations
        const subjects = await prisma.subject.findMany({
            where: { userId: student.userId },
        });
        return subjects.map(subject => ({
            id: subject.id,
            name: subject.name,
            outcomes: [],
            averageScore: 0, // Assessment functionality removed
        }));
    }
    async generateSubjectSummary(subject, language) {
        const prompt = language === 'fr'
            ? `Résumez la performance de l'élève en ${subject.name} avec une note moyenne de ${subject.averageScore.toFixed(1)}% et couvrant ${subject.outcomes.length} résultats d'apprentissage.`
            : `Summarize the student's performance in ${subject.name} with an average score of ${subject.averageScore.toFixed(1)}% and covering ${subject.outcomes.length} learning outcomes.`;
        return generateContent(prompt);
    }
    async generateTermOverview(student, subjectProgress, language) {
        const overallAverage = subjectProgress.reduce((sum, s) => sum + s.averageScore, 0) / subjectProgress.length;
        const prompt = language === 'fr'
            ? `Générez un aperçu du trimestre pour ${student.firstName} avec une moyenne générale de ${overallAverage.toFixed(1)}% à travers ${subjectProgress.length} matières.`
            : `Generate a term overview for ${student.firstName} with an overall average of ${overallAverage.toFixed(1)}% across ${subjectProgress.length} subjects.`;
        return generateContent(prompt, JSON.stringify(subjectProgress.map(s => ({ name: s.name, average: s.averageScore }))));
    }
    async generateTermRecommendations(student, subjectProgress, language) {
        const weakSubjects = subjectProgress.filter(s => s.averageScore < 70);
        const strongSubjects = subjectProgress.filter(s => s.averageScore >= 85);
        const prompt = language === 'fr'
            ? `Suggérez 3-5 recommandations pour le prochain trimestre basées sur les forces (${strongSubjects.map(s => s.name).join(', ')}) et les domaines à améliorer (${weakSubjects.map(s => s.name).join(', ')}).`
            : `Suggest 3-5 recommendations for the next term based on strengths (${strongSubjects.map(s => s.name).join(', ')}) and areas for improvement (${weakSubjects.map(s => s.name).join(', ')}).`;
        const recommendations = await generateContent(prompt);
        return recommendations.split('\n').filter(r => r.trim().length > 0).slice(0, 5);
    }
    async compileReportCardData(student) {
        const subjects = await prisma.subject.findMany({
            where: { userId: student.userId },
        });
        return subjects.map(subject => ({
            id: subject.id,
            name: subject.name,
            grade: 'N/A', // Assessment functionality removed
            outcomes: [],
        }));
    }
    scoreToGrade(score) {
        if (score >= 90)
            return 'A';
        if (score >= 80)
            return 'B';
        if (score >= 70)
            return 'C';
        if (score >= 60)
            return 'D';
        return 'F';
    }
    async generateSubjectComments(subject, student, language) {
        const prompt = language === 'fr'
            ? `Générez des commentaires d'enseignant pour ${student.firstName} en ${subject.name} avec une note de ${subject.grade}. Soyez spécifique et encourageant.`
            : `Generate teacher comments for ${student.firstName} in ${subject.name} with a grade of ${subject.grade}. Be specific and encouraging.`;
        return generateContent(prompt, JSON.stringify({
            outcomes: subject.outcomes.length,
        }));
    }
    async generateReportCardComments(student, reportCardData, language) {
        const overallGrade = reportCardData.reduce((sum, s) => {
            const gradeValue = { A: 4, B: 3, C: 2, D: 1, F: 0 }[s.grade] || 0;
            return sum + gradeValue;
        }, 0) / reportCardData.length;
        const prompt = language === 'fr'
            ? `Générez des commentaires généraux de bulletin pour ${student.firstName} ${student.lastName} avec une performance globale de ${overallGrade.toFixed(1)}/4.0.`
            : `Generate overall report card comments for ${student.firstName} ${student.lastName} with an overall performance of ${overallGrade.toFixed(1)}/4.0.`;
        return generateContent(prompt, JSON.stringify(reportCardData.map(s => ({ subject: s.name, grade: s.grade }))));
    }
}
export const reportGeneratorService = new ReportGeneratorService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9zZXJ2aWNlcy9yZXBvcnRHZW5lcmF0b3JTZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDbkMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMvQyxPQUFPLE1BQU0sTUFBTSxXQUFXLENBQUM7QUEyRS9CLE1BQU0sT0FBTyxzQkFBc0I7SUFDakMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxPQUFnQztRQUNuRCxJQUFJLENBQUM7WUFDSCxxQkFBcUI7WUFDckIsTUFBTSxPQUFPLEdBQUcsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztnQkFDOUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLE9BQU8sQ0FBQyxTQUFTLEVBQUU7Z0JBQ2hDLE9BQU8sRUFBRTtvQkFDUCxJQUFJLEVBQUUsSUFBSTtvQkFDVixTQUFTLEVBQUU7d0JBQ1QsS0FBSyxFQUFFOzRCQUNMLFNBQVMsRUFBRTtnQ0FDVCxHQUFHLEVBQUUsT0FBTyxDQUFDLFNBQVM7Z0NBQ3RCLEdBQUcsRUFBRSxPQUFPLENBQUMsT0FBTzs2QkFDckI7eUJBQ0Y7cUJBQ0Y7b0JBQ0QsV0FBVyxFQUFFO3dCQUNYLEtBQUssRUFBRTs0QkFDTCxTQUFTLEVBQUU7Z0NBQ1QsR0FBRyxFQUFFLE9BQU8sQ0FBQyxTQUFTO2dDQUN0QixHQUFHLEVBQUUsT0FBTyxDQUFDLE9BQU87NkJBQ3JCO3lCQUNGO3FCQUNGO29CQUNELEtBQUssRUFBRTt3QkFDTCxLQUFLLEVBQUU7NEJBQ0wsRUFBRSxFQUFFO2dDQUNGLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRTtnQ0FDcEIsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFOzZCQUN4Qjt5QkFDRjtxQkFDRjtpQkFDRjthQUNGLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztn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UUFBcUI7UUFFckIsTUFBTSxZQUFZLEdBQUcsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNwRCxNQUFNLFVBQVUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEUsT0FBTyxHQUFHLEdBQUcsVUFBVSxDQUFDO1FBQzFCLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxjQUFjLENBQUMsTUFBTSxDQUFDO1FBRTlCLE1BQU0sTUFBTSxHQUFHLFFBQVEsS0FBSyxJQUFJO1lBQzlCLENBQUMsQ0FBQyxzREFBc0QsT0FBTyxDQUFDLFNBQVMsSUFBSSxPQUFPLENBQUMsUUFBUSxvQ0FBb0MsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTztZQUMvSixDQUFDLENBQUMsNkNBQTZDLE9BQU8sQ0FBQyxTQUFTLElBQUksT0FBTyxDQUFDLFFBQVEsbUNBQW1DLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUV4SixPQUFPLGVBQWUsQ0FDcEIsTUFBTSxFQUNOLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUMvRSxDQUFDO0lBQ0osQ0FBQztDQUNGO0FBRUQsTUFBTSxDQUFDLE1BQU0sc0JBQXNCLEdBQUcsSUFBSSxzQkFBc0IsRUFBRSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWNoYWVsbWNpc2FhYy9HaXRIdWIvdGVhY2hpbmctZW5naW5lMi4wL3NlcnZlci9zcmMvc2VydmljZXMvcmVwb3J0R2VuZXJhdG9yU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuLi9wcmlzbWEnO1xuaW1wb3J0IHsgZ2VuZXJhdGVDb250ZW50IH0gZnJvbSAnLi9sbG1TZXJ2aWNlJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vbG9nZ2VyJztcblxuZXhwb3J0IGludGVyZmFjZSBSZXBvcnRHZW5lcmF0aW9uUmVxdWVzdCB7XG4gIHN0dWRlbnRJZDogbnVtYmVyO1xuICByZXBvcnRUeXBlOiAncHJvZ3Jlc3MnIHwgJ25hcnJhdGl2ZScgfCAndGVybV9zdW1tYXJ5JyB8ICdyZXBvcnRfY2FyZCc7XG4gIHRlcm1JZD86IG51bWJlcjtcbiAgc3ViamVjdElkPzogbnVtYmVyO1xuICBzdGFydERhdGU6IERhdGU7XG4gIGVuZERhdGU6IERhdGU7XG4gIGxhbmd1YWdlOiAnZW4nIHwgJ2ZyJztcbiAgaW5jbHVkZUFzc2Vzc21lbnRzPzogYm9vbGVhbjtcbiAgaW5jbHVkZUF0dGVuZGFuY2U/OiBib29sZWFuO1xuICBpbmNsdWRlR29hbHM/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyYXRlZFJlcG9ydCB7XG4gIHN0dWRlbnROYW1lOiBzdHJpbmc7XG4gIHBlcmlvZDogc3RyaW5nO1xuICBzZWN0aW9uczogUmVwb3J0U2VjdGlvbltdO1xuICBvdmVyYWxsQ29tbWVudHM6IHN0cmluZztcbiAgbmV4dFN0ZXBzOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZXBvcnRTZWN0aW9uIHtcbiAgdGl0bGU6IHN0cmluZztcbiAgY29udGVudDogc3RyaW5nO1xuICBkYXRhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG59XG5cbi8vIFR5cGUgZGVmaW5pdGlvbnMgZm9yIHN0dWRlbnQgZGF0YSB3aXRoIHJlbGF0aW9uc1xuaW50ZXJmYWNlIFN0dWRlbnRXaXRoUmVsYXRpb25zIHtcbiAgaWQ6IG51bWJlcjtcbiAgZmlyc3ROYW1lOiBzdHJpbmc7XG4gIGxhc3ROYW1lOiBzdHJpbmc7XG4gIHVzZXJJZDogbnVtYmVyO1xuICBhcnRpZmFjdHM6IEFydGlmYWN0W107XG4gIHJlZmxlY3Rpb25zOiBSZWZsZWN0aW9uW107XG4gIGdvYWxzOiBHb2FsW107XG59XG5cblxuaW50ZXJmYWNlIEFydGlmYWN0IHtcbiAgaWQ6IG51bWJlcjtcbiAgdGl0bGU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZyB8IG51bGw7XG4gIGNyZWF0ZWRBdDogRGF0ZTtcbn1cblxuaW50ZXJmYWNlIFJlZmxlY3Rpb24ge1xuICBpZDogbnVtYmVyO1xuICBjb250ZW50OiBzdHJpbmc7XG4gIGNyZWF0ZWRBdDogRGF0ZTtcbn1cblxuaW50ZXJmYWNlIEdvYWwge1xuICBpZDogbnVtYmVyO1xuICB0ZXh0OiBzdHJpbmc7XG4gIHN0YXR1czogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgU3ViamVjdFByb2dyZXNzIHtcbiAgaWQ6IG51bWJlcjtcbiAgbmFtZTogc3RyaW5nO1xuICBvdXRjb21lczogc3RyaW5nW107XG4gIGF2ZXJhZ2VTY29yZTogbnVtYmVyO1xuICBba2V5OiBzdHJpbmddOiB1bmtub3duO1xufVxuXG5pbnRlcmZhY2UgU3ViamVjdFJlcG9ydENhcmQge1xuICBpZDogbnVtYmVyO1xuICBuYW1lOiBzdHJpbmc7XG4gIGdyYWRlOiBzdHJpbmc7XG4gIG91dGNvbWVzOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGNsYXNzIFJlcG9ydEdlbmVyYXRvclNlcnZpY2Uge1xuICBhc3luYyBnZW5lcmF0ZVJlcG9ydChyZXF1ZXN0OiBSZXBvcnRHZW5lcmF0aW9uUmVxdWVzdCk6IFByb21pc2U8R2VuZXJhdGVkUmVwb3J0PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEZldGNoIHN0dWRlbnQgZGF0YVxuICAgICAgY29uc3Qgc3R1ZGVudCA9IGF3YWl0IHByaXNtYS5zdHVkZW50LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogcmVxdWVzdC5zdHVkZW50SWQgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHRydWUsXG4gICAgICAgICAgYXJ0aWZhY3RzOiB7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgICAgICBndGU6IHJlcXVlc3Quc3RhcnREYXRlLFxuICAgICAgICAgICAgICAgIGx0ZTogcmVxdWVzdC5lbmREYXRlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlZmxlY3Rpb25zOiB7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgICAgICBndGU6IHJlcXVlc3Quc3RhcnREYXRlLFxuICAgICAgICAgICAgICAgIGx0ZTogcmVxdWVzdC5lbmREYXRlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdvYWxzOiB7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgIHsgc3RhdHVzOiAnYWN0aXZlJyB9LFxuICAgICAgICAgICAgICAgIHsgc3RhdHVzOiAnY29tcGxldGVkJyB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghc3R1ZGVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N0dWRlbnQgbm90IGZvdW5kJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdlbmVyYXRlIHJlcG9ydCBiYXNlZCBvbiB0eXBlXG4gICAgICBsZXQgcmVwb3J0OiBHZW5lcmF0ZWRSZXBvcnQ7XG4gICAgICBcbiAgICAgIHN3aXRjaCAocmVxdWVzdC5yZXBvcnRUeXBlKSB7XG4gICAgICAgIGNhc2UgJ3Byb2dyZXNzJzpcbiAgICAgICAgICByZXBvcnQgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUHJvZ3Jlc3NSZXBvcnQoc3R1ZGVudCwgcmVxdWVzdCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ25hcnJhdGl2ZSc6XG4gICAgICAgICAgcmVwb3J0ID0gYXdhaXQgdGhpcy5nZW5lcmF0ZU5hcnJhdGl2ZVJlcG9ydChzdHVkZW50LCByZXF1ZXN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAndGVybV9zdW1tYXJ5JzpcbiAgICAgICAgICByZXBvcnQgPSBhd2FpdCB0aGlzLmdlbmVyYXRlVGVybVN1bW1hcnkoc3R1ZGVudCwgcmVxdWVzdCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3JlcG9ydF9jYXJkJzpcbiAgICAgICAgICByZXBvcnQgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUmVwb3J0Q2FyZChzdHVkZW50LCByZXF1ZXN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcmVwb3J0IHR5cGUnKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlcG9ydDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2VuZXJhdGUgcmVwb3J0OicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVQcm9ncmVzc1JlcG9ydChcbiAgICBzdHVkZW50OiBTdHVkZW50V2l0aFJlbGF0aW9ucyxcbiAgICByZXF1ZXN0OiBSZXBvcnRHZW5lcmF0aW9uUmVxdWVzdFxuICApOiBQcm9taXNlPEdlbmVyYXRlZFJlcG9ydD4ge1xuICAgIGNvbnN0IHNlY3Rpb25zOiBSZXBvcnRTZWN0aW9uW10gPSBbXTtcblxuICAgIC8vIEFzc2Vzc21lbnQgZnVuY3Rpb25hbGl0eSByZW1vdmVkIC0gZm9jdXMgb24gYXJ0aWZhY3RzIGFuZCByZWZsZWN0aW9uc1xuICAgIGlmIChzdHVkZW50LmFydGlmYWN0cy5sZW5ndGggPiAwIHx8IHN0dWRlbnQucmVmbGVjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgc2VjdGlvbnMucHVzaCh7XG4gICAgICAgIHRpdGxlOiByZXF1ZXN0Lmxhbmd1YWdlID09PSAnZnInID8gJ1Byb2dyw6hzIGFjYWTDqW1pcXVlJyA6ICdBY2FkZW1pYyBQcm9ncmVzcycsXG4gICAgICAgIGNvbnRlbnQ6IGF3YWl0IHRoaXMuZ2VuZXJhdGVQcm9ncmVzc0Zyb21BcnRpZmFjdHMoc3R1ZGVudC5hcnRpZmFjdHMsIHN0dWRlbnQucmVmbGVjdGlvbnMsIHJlcXVlc3QubGFuZ3VhZ2UpLFxuICAgICAgICBkYXRhOiB7IGFydGlmYWN0czogc3R1ZGVudC5hcnRpZmFjdHMsIHJlZmxlY3Rpb25zOiBzdHVkZW50LnJlZmxlY3Rpb25zIH0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBHb2FscyBTZWN0aW9uXG4gICAgaWYgKHJlcXVlc3QuaW5jbHVkZUdvYWxzICYmIHN0dWRlbnQuZ29hbHMubGVuZ3RoID4gMCkge1xuICAgICAgc2VjdGlvbnMucHVzaCh7XG4gICAgICAgIHRpdGxlOiByZXF1ZXN0Lmxhbmd1YWdlID09PSAnZnInID8gJ09iamVjdGlmcycgOiAnR29hbHMnLFxuICAgICAgICBjb250ZW50OiBhd2FpdCB0aGlzLmdlbmVyYXRlR29hbHNOYXJyYXRpdmUoc3R1ZGVudC5nb2FscywgcmVxdWVzdC5sYW5ndWFnZSksXG4gICAgICAgIGRhdGE6IHsgZ29hbHM6IHN0dWRlbnQuZ29hbHMgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE92ZXJhbGwgQ29tbWVudHNcbiAgICBjb25zdCBvdmVyYWxsQ29tbWVudHMgPSBhd2FpdCB0aGlzLmdlbmVyYXRlT3ZlcmFsbENvbW1lbnRzKFxuICAgICAgc3R1ZGVudCxcbiAgICAgIHNlY3Rpb25zLFxuICAgICAgcmVxdWVzdC5sYW5ndWFnZVxuICAgICk7XG5cbiAgICAvLyBOZXh0IFN0ZXBzXG4gICAgY29uc3QgbmV4dFN0ZXBzID0gYXdhaXQgdGhpcy5nZW5lcmF0ZU5leHRTdGVwcyhzdHVkZW50LCBzZWN0aW9ucywgcmVxdWVzdC5sYW5ndWFnZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3R1ZGVudE5hbWU6IGAke3N0dWRlbnQuZmlyc3ROYW1lfSAke3N0dWRlbnQubGFzdE5hbWV9YCxcbiAgICAgIHBlcmlvZDogYCR7cmVxdWVzdC5zdGFydERhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCl9IC0gJHtyZXF1ZXN0LmVuZERhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCl9YCxcbiAgICAgIHNlY3Rpb25zLFxuICAgICAgb3ZlcmFsbENvbW1lbnRzLFxuICAgICAgbmV4dFN0ZXBzLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlTmFycmF0aXZlUmVwb3J0KFxuICAgIHN0dWRlbnQ6IFN0dWRlbnRXaXRoUmVsYXRpb25zLFxuICAgIHJlcXVlc3Q6IFJlcG9ydEdlbmVyYXRpb25SZXF1ZXN0XG4gICk6IFByb21pc2U8R2VuZXJhdGVkUmVwb3J0PiB7XG4gICAgLy8gR2F0aGVyIGNvbXByZWhlbnNpdmUgZGF0YVxuICAgIGNvbnN0IGxlYXJuaW5nSm91cm5leSA9IHRoaXMuY29tcGlsZUxlYXJuaW5nSm91cm5leShzdHVkZW50KTtcbiAgICBcbiAgICAvLyBHZW5lcmF0ZSBuYXJyYXRpdmUgdXNpbmcgTExNXG4gICAgY29uc3QgcHJvbXB0ID0gcmVxdWVzdC5sYW5ndWFnZSA9PT0gJ2ZyJyBcbiAgICAgID8gYEfDqW7DqXJleiB1biByYXBwb3J0IG5hcnJhdGlmIGTDqXRhaWxsw6kgcG91ciAke3N0dWRlbnQuZmlyc3ROYW1lfSAke3N0dWRlbnQubGFzdE5hbWV9LCBjb3V2cmFudCBsYSBww6lyaW9kZSBkdSAke3JlcXVlc3Quc3RhcnREYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygpfSBhdSAke3JlcXVlc3QuZW5kRGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKX0uIEluY2x1ZXogbGVzIHLDqWFsaXNhdGlvbnMsIGxlcyBkw6lmaXMgZXQgbGVzIGRvbWFpbmVzIGRlIGNyb2lzc2FuY2UuYFxuICAgICAgOiBgR2VuZXJhdGUgYSBkZXRhaWxlZCBuYXJyYXRpdmUgcmVwb3J0IGZvciAke3N0dWRlbnQuZmlyc3ROYW1lfSAke3N0dWRlbnQubGFzdE5hbWV9LCBjb3ZlcmluZyB0aGUgcGVyaW9kIGZyb20gJHtyZXF1ZXN0LnN0YXJ0RGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKX0gdG8gJHtyZXF1ZXN0LmVuZERhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCl9LiBJbmNsdWRlIGFjaGlldmVtZW50cywgY2hhbGxlbmdlcywgYW5kIGFyZWFzIG9mIGdyb3d0aC5gO1xuXG4gICAgY29uc3QgbmFycmF0aXZlID0gYXdhaXQgZ2VuZXJhdGVDb250ZW50KHByb21wdCwgSlNPTi5zdHJpbmdpZnkobGVhcm5pbmdKb3VybmV5KSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3R1ZGVudE5hbWU6IGAke3N0dWRlbnQuZmlyc3ROYW1lfSAke3N0dWRlbnQubGFzdE5hbWV9YCxcbiAgICAgIHBlcmlvZDogYCR7cmVxdWVzdC5zdGFydERhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCl9IC0gJHtyZXF1ZXN0LmVuZERhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCl9YCxcbiAgICAgIHNlY3Rpb25zOiBbe1xuICAgICAgICB0aXRsZTogcmVxdWVzdC5sYW5ndWFnZSA9PT0gJ2ZyJyA/ICdSYXBwb3J0IG5hcnJhdGlmJyA6ICdOYXJyYXRpdmUgUmVwb3J0JyxcbiAgICAgICAgY29udGVudDogbmFycmF0aXZlLFxuICAgICAgfV0sXG4gICAgICBvdmVyYWxsQ29tbWVudHM6ICcnLFxuICAgICAgbmV4dFN0ZXBzOiBbXSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVRlcm1TdW1tYXJ5KFxuICAgIHN0dWRlbnQ6IFN0dWRlbnRXaXRoUmVsYXRpb25zLFxuICAgIHJlcXVlc3Q6IFJlcG9ydEdlbmVyYXRpb25SZXF1ZXN0XG4gICk6IFByb21pc2U8R2VuZXJhdGVkUmVwb3J0PiB7XG4gICAgY29uc3Qgc2VjdGlvbnM6IFJlcG9ydFNlY3Rpb25bXSA9IFtdO1xuXG4gICAgLy8gR2V0IHN1YmplY3Qtc3BlY2lmaWMgcHJvZ3Jlc3NcbiAgICBjb25zdCBzdWJqZWN0UHJvZ3Jlc3MgPSBhd2FpdCB0aGlzLmdldFN1YmplY3RQcm9ncmVzcyhzdHVkZW50KTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IHN1YmplY3Qgb2Ygc3ViamVjdFByb2dyZXNzKSB7XG4gICAgICBzZWN0aW9ucy5wdXNoKHtcbiAgICAgICAgdGl0bGU6IHN1YmplY3QubmFtZSxcbiAgICAgICAgY29udGVudDogYXdhaXQgdGhpcy5nZW5lcmF0ZVN1YmplY3RTdW1tYXJ5KHN1YmplY3QsIHJlcXVlc3QubGFuZ3VhZ2UpLFxuICAgICAgICBkYXRhOiBzdWJqZWN0LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gT3ZlcmFsbCB0ZXJtIHBlcmZvcm1hbmNlXG4gICAgY29uc3Qgb3ZlcmFsbENvbW1lbnRzID0gYXdhaXQgdGhpcy5nZW5lcmF0ZVRlcm1PdmVydmlldyhcbiAgICAgIHN0dWRlbnQsXG4gICAgICBzdWJqZWN0UHJvZ3Jlc3MsXG4gICAgICByZXF1ZXN0Lmxhbmd1YWdlXG4gICAgKTtcblxuICAgIC8vIFJlY29tbWVuZGF0aW9ucyBmb3IgbmV4dCB0ZXJtXG4gICAgY29uc3QgbmV4dFN0ZXBzID0gYXdhaXQgdGhpcy5nZW5lcmF0ZVRlcm1SZWNvbW1lbmRhdGlvbnMoXG4gICAgICBzdHVkZW50LFxuICAgICAgc3ViamVjdFByb2dyZXNzLFxuICAgICAgcmVxdWVzdC5sYW5ndWFnZVxuICAgICk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3R1ZGVudE5hbWU6IGAke3N0dWRlbnQuZmlyc3ROYW1lfSAke3N0dWRlbnQubGFzdE5hbWV9YCxcbiAgICAgIHBlcmlvZDogcmVxdWVzdC5sYW5ndWFnZSA9PT0gJ2ZyJyA/ICdSw6lzdW3DqSBkdSB0cmltZXN0cmUnIDogJ1Rlcm0gU3VtbWFyeScsXG4gICAgICBzZWN0aW9ucyxcbiAgICAgIG92ZXJhbGxDb21tZW50cyxcbiAgICAgIG5leHRTdGVwcyxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVJlcG9ydENhcmQoXG4gICAgc3R1ZGVudDogU3R1ZGVudFdpdGhSZWxhdGlvbnMsXG4gICAgcmVxdWVzdDogUmVwb3J0R2VuZXJhdGlvblJlcXVlc3RcbiAgKTogUHJvbWlzZTxHZW5lcmF0ZWRSZXBvcnQ+IHtcbiAgICBjb25zdCBzZWN0aW9uczogUmVwb3J0U2VjdGlvbltdID0gW107XG5cbiAgICAvLyBHZXQgZm9ybWFsIGdyYWRlcy9hc3Nlc3NtZW50cyBieSBzdWJqZWN0XG4gICAgY29uc3QgcmVwb3J0Q2FyZERhdGEgPSBhd2FpdCB0aGlzLmNvbXBpbGVSZXBvcnRDYXJkRGF0YShzdHVkZW50KTtcblxuICAgIGZvciAoY29uc3Qgc3ViamVjdCBvZiByZXBvcnRDYXJkRGF0YSkge1xuICAgICAgLy8gR2VuZXJhdGUgdGVhY2hlciBjb21tZW50cyBmb3IgZWFjaCBzdWJqZWN0XG4gICAgICBjb25zdCBjb21tZW50cyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVTdWJqZWN0Q29tbWVudHMoXG4gICAgICAgIHN1YmplY3QsXG4gICAgICAgIHN0dWRlbnQsXG4gICAgICAgIHJlcXVlc3QubGFuZ3VhZ2VcbiAgICAgICk7XG5cbiAgICAgIHNlY3Rpb25zLnB1c2goe1xuICAgICAgICB0aXRsZTogc3ViamVjdC5uYW1lLFxuICAgICAgICBjb250ZW50OiBjb21tZW50cyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGdyYWRlOiBzdWJqZWN0LmdyYWRlLFxuICAgICAgICAgIG91dGNvbWVzOiBzdWJqZWN0Lm91dGNvbWVzLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhbCBjb21tZW50c1xuICAgIGNvbnN0IG92ZXJhbGxDb21tZW50cyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVSZXBvcnRDYXJkQ29tbWVudHMoXG4gICAgICBzdHVkZW50LFxuICAgICAgcmVwb3J0Q2FyZERhdGEsXG4gICAgICByZXF1ZXN0Lmxhbmd1YWdlXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdHVkZW50TmFtZTogYCR7c3R1ZGVudC5maXJzdE5hbWV9ICR7c3R1ZGVudC5sYXN0TmFtZX1gLFxuICAgICAgcGVyaW9kOiByZXF1ZXN0Lmxhbmd1YWdlID09PSAnZnInID8gJ0J1bGxldGluIHNjb2xhaXJlJyA6ICdSZXBvcnQgQ2FyZCcsXG4gICAgICBzZWN0aW9ucyxcbiAgICAgIG92ZXJhbGxDb21tZW50cyxcbiAgICAgIG5leHRTdGVwczogW10sXG4gICAgfTtcbiAgfVxuXG4gIC8vIEhlbHBlciBtZXRob2RzXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVQcm9ncmVzc0Zyb21BcnRpZmFjdHMoXG4gICAgYXJ0aWZhY3RzOiBBcnRpZmFjdFtdLFxuICAgIHJlZmxlY3Rpb25zOiBSZWZsZWN0aW9uW10sXG4gICAgbGFuZ3VhZ2U6ICdlbicgfCAnZnInXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgY29udGV4dCA9IHtcbiAgICAgIGFydGlmYWN0Q291bnQ6IGFydGlmYWN0cy5sZW5ndGgsXG4gICAgICByZWZsZWN0aW9uQ291bnQ6IHJlZmxlY3Rpb25zLmxlbmd0aCxcbiAgICAgIHJlY2VudEFydGlmYWN0czogYXJ0aWZhY3RzLnNsaWNlKDAsIDMpLm1hcChhID0+ICh7IHRpdGxlOiBhLnRpdGxlLCBkZXNjcmlwdGlvbjogYS5kZXNjcmlwdGlvbiB9KSksXG4gICAgICByZWNlbnRSZWZsZWN0aW9uczogcmVmbGVjdGlvbnMuc2xpY2UoMCwgMykubWFwKHIgPT4gKHsgY29udGVudDogci5jb250ZW50IH0pKVxuICAgIH07XG5cbiAgICBjb25zdCBwcm9tcHQgPSBsYW5ndWFnZSA9PT0gJ2ZyJ1xuICAgICAgPyBgRMOpY3JpdmV6IGxlIHByb2dyw6hzIGFjYWTDqW1pcXVlIGJhc8OpIHN1ciAke2FydGlmYWN0cy5sZW5ndGh9IGFydGVmYWN0cyBldCAke3JlZmxlY3Rpb25zLmxlbmd0aH0gcsOpZmxleGlvbnMuYFxuICAgICAgOiBgRGVzY3JpYmUgYWNhZGVtaWMgcHJvZ3Jlc3MgYmFzZWQgb24gJHthcnRpZmFjdHMubGVuZ3RofSBhcnRpZmFjdHMgYW5kICR7cmVmbGVjdGlvbnMubGVuZ3RofSByZWZsZWN0aW9ucy5gO1xuXG4gICAgcmV0dXJuIGdlbmVyYXRlQ29udGVudChwcm9tcHQsIEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTtcbiAgfVxuXG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZUdvYWxzTmFycmF0aXZlKFxuICAgIGdvYWxzOiBHb2FsW10sXG4gICAgbGFuZ3VhZ2U6ICdlbicgfCAnZnInXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgYWN0aXZlR29hbHMgPSBnb2Fscy5maWx0ZXIoZyA9PiBnLnN0YXR1cyA9PT0gJ2FjdGl2ZScpO1xuICAgIGNvbnN0IGNvbXBsZXRlZEdvYWxzID0gZ29hbHMuZmlsdGVyKGcgPT4gZy5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKTtcblxuICAgIGNvbnN0IGNvbnRleHQgPSB7XG4gICAgICBhY3RpdmU6IGFjdGl2ZUdvYWxzLm1hcChnID0+ICh7IHRleHQ6IGcudGV4dCB9KSksXG4gICAgICBjb21wbGV0ZWQ6IGNvbXBsZXRlZEdvYWxzLm1hcChnID0+ICh7IHRleHQ6IGcudGV4dCB9KSksXG4gICAgfTtcblxuICAgIGNvbnN0IHByb21wdCA9IGxhbmd1YWdlID09PSAnZnInXG4gICAgICA/IGBEw6ljcml2ZXogbGUgcHJvZ3LDqHMgdmVycyBsZXMgb2JqZWN0aWZzIGRlIGwnw6lsw6h2ZTogJHtKU09OLnN0cmluZ2lmeShjb250ZXh0KX1gXG4gICAgICA6IGBEZXNjcmliZSB0aGUgc3R1ZGVudCdzIHByb2dyZXNzIHRvd2FyZCB0aGVpciBnb2FsczogJHtKU09OLnN0cmluZ2lmeShjb250ZXh0KX1gO1xuXG4gICAgcmV0dXJuIGdlbmVyYXRlQ29udGVudChwcm9tcHQpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZU92ZXJhbGxDb21tZW50cyhcbiAgICBzdHVkZW50OiBTdHVkZW50V2l0aFJlbGF0aW9ucyxcbiAgICBzZWN0aW9uczogUmVwb3J0U2VjdGlvbltdLFxuICAgIGxhbmd1YWdlOiAnZW4nIHwgJ2ZyJ1xuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGNvbnRleHQgPSB7XG4gICAgICBzdHVkZW50TmFtZTogYCR7c3R1ZGVudC5maXJzdE5hbWV9ICR7c3R1ZGVudC5sYXN0TmFtZX1gLFxuICAgICAgc2VjdGlvbnNDb3VudDogc2VjdGlvbnMubGVuZ3RoLFxuICAgICAgc2VjdGlvblRpdGxlczogc2VjdGlvbnMubWFwKHMgPT4gcy50aXRsZSksXG4gICAgfTtcblxuICAgIGNvbnN0IHByb21wdCA9IGxhbmd1YWdlID09PSAnZnInXG4gICAgICA/IGBHw6luw6lyZXogZGVzIGNvbW1lbnRhaXJlcyBnw6luw6lyYXV4IHBvc2l0aWZzIGV0IGVuY291cmFnZWFudHMgcG91ciAke2NvbnRleHQuc3R1ZGVudE5hbWV9IGJhc8OpcyBzdXIgbGV1ciByYXBwb3J0IGRlIHByb2dyw6hzLmBcbiAgICAgIDogYEdlbmVyYXRlIHBvc2l0aXZlIGFuZCBlbmNvdXJhZ2luZyBvdmVyYWxsIGNvbW1lbnRzIGZvciAke2NvbnRleHQuc3R1ZGVudE5hbWV9IGJhc2VkIG9uIHRoZWlyIHByb2dyZXNzIHJlcG9ydC5gO1xuXG4gICAgcmV0dXJuIGdlbmVyYXRlQ29udGVudChwcm9tcHQsIEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVOZXh0U3RlcHMoXG4gICAgc3R1ZGVudDogU3R1ZGVudFdpdGhSZWxhdGlvbnMsXG4gICAgc2VjdGlvbnM6IFJlcG9ydFNlY3Rpb25bXSxcbiAgICBsYW5ndWFnZTogJ2VuJyB8ICdmcidcbiAgKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IHByb21wdCA9IGxhbmd1YWdlID09PSAnZnInXG4gICAgICA/IGBTdWdnw6lyZXogMy01IHByb2NoYWluZXMgw6l0YXBlcyBzcMOpY2lmaXF1ZXMgcG91ciAke3N0dWRlbnQuZmlyc3ROYW1lfSBwb3VyIGNvbnRpbnVlciBsZXVyIHByb2dyw6hzLmBcbiAgICAgIDogYFN1Z2dlc3QgMy01IHNwZWNpZmljIG5leHQgc3RlcHMgZm9yICR7c3R1ZGVudC5maXJzdE5hbWV9IHRvIGNvbnRpbnVlIHRoZWlyIHByb2dyZXNzLmA7XG5cbiAgICBjb25zdCBzdWdnZXN0aW9ucyA9IGF3YWl0IGdlbmVyYXRlQ29udGVudChcbiAgICAgIHByb21wdCwgXG4gICAgICBKU09OLnN0cmluZ2lmeShzZWN0aW9ucy5tYXAocyA9PiAoeyB0aXRsZTogcy50aXRsZSwgc3VtbWFyeTogcy5jb250ZW50LnN1YnN0cmluZygwLCAxMDApIH0pKSlcbiAgICApO1xuXG4gICAgLy8gUGFyc2UgdGhlIHN1Z2dlc3Rpb25zIGludG8gYW4gYXJyYXlcbiAgICByZXR1cm4gc3VnZ2VzdGlvbnMuc3BsaXQoJ1xcbicpLmZpbHRlcihzID0+IHMudHJpbSgpLmxlbmd0aCA+IDApLnNsaWNlKDAsIDUpO1xuICB9XG5cbiAgcHJpdmF0ZSBjb21waWxlTGVhcm5pbmdKb3VybmV5KHN0dWRlbnQ6IFN0dWRlbnRXaXRoUmVsYXRpb25zKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFydGlmYWN0czogc3R1ZGVudC5hcnRpZmFjdHMubWFwKChhKSA9PiAoe1xuICAgICAgICB0aXRsZTogYS50aXRsZSxcbiAgICAgICAgZGVzY3JpcHRpb246IGEuZGVzY3JpcHRpb24sXG4gICAgICAgIGNyZWF0ZWRBdDogYS5jcmVhdGVkQXQsXG4gICAgICB9KSksXG4gICAgICByZWZsZWN0aW9uczogc3R1ZGVudC5yZWZsZWN0aW9ucy5tYXAoKHIpID0+ICh7XG4gICAgICAgIGNvbnRlbnQ6IHIuY29udGVudCxcbiAgICAgICAgY3JlYXRlZEF0OiByLmNyZWF0ZWRBdCxcbiAgICAgIH0pKSxcbiAgICAgIGdvYWxzOiBzdHVkZW50LmdvYWxzLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFN1YmplY3RQcm9ncmVzcyhzdHVkZW50OiBTdHVkZW50V2l0aFJlbGF0aW9ucyk6IFByb21pc2U8U3ViamVjdFByb2dyZXNzW10+IHtcbiAgICAvLyBTaW1wbGlmaWVkIHN1YmplY3QgcHJvZ3Jlc3Mgd2l0aG91dCBkZWVwIHJlbGF0aW9uc1xuICAgIGNvbnN0IHN1YmplY3RzID0gYXdhaXQgcHJpc21hLnN1YmplY3QuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHsgdXNlcklkOiBzdHVkZW50LnVzZXJJZCB9LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN1YmplY3RzLm1hcChzdWJqZWN0ID0+ICh7XG4gICAgICBpZDogc3ViamVjdC5pZCxcbiAgICAgIG5hbWU6IHN1YmplY3QubmFtZSxcbiAgICAgIG91dGNvbWVzOiBbXSxcbiAgICAgIGF2ZXJhZ2VTY29yZTogMCwgLy8gQXNzZXNzbWVudCBmdW5jdGlvbmFsaXR5IHJlbW92ZWRcbiAgICB9KSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlU3ViamVjdFN1bW1hcnkoc3ViamVjdDogU3ViamVjdFByb2dyZXNzLCBsYW5ndWFnZTogJ2VuJyB8ICdmcicpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHByb21wdCA9IGxhbmd1YWdlID09PSAnZnInXG4gICAgICA/IGBSw6lzdW1leiBsYSBwZXJmb3JtYW5jZSBkZSBsJ8OpbMOodmUgZW4gJHtzdWJqZWN0Lm5hbWV9IGF2ZWMgdW5lIG5vdGUgbW95ZW5uZSBkZSAke3N1YmplY3QuYXZlcmFnZVNjb3JlLnRvRml4ZWQoMSl9JSBldCBjb3V2cmFudCAke3N1YmplY3Qub3V0Y29tZXMubGVuZ3RofSByw6lzdWx0YXRzIGQnYXBwcmVudGlzc2FnZS5gXG4gICAgICA6IGBTdW1tYXJpemUgdGhlIHN0dWRlbnQncyBwZXJmb3JtYW5jZSBpbiAke3N1YmplY3QubmFtZX0gd2l0aCBhbiBhdmVyYWdlIHNjb3JlIG9mICR7c3ViamVjdC5hdmVyYWdlU2NvcmUudG9GaXhlZCgxKX0lIGFuZCBjb3ZlcmluZyAke3N1YmplY3Qub3V0Y29tZXMubGVuZ3RofSBsZWFybmluZyBvdXRjb21lcy5gO1xuXG4gICAgcmV0dXJuIGdlbmVyYXRlQ29udGVudChwcm9tcHQpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVRlcm1PdmVydmlldyhcbiAgICBzdHVkZW50OiBTdHVkZW50V2l0aFJlbGF0aW9ucyxcbiAgICBzdWJqZWN0UHJvZ3Jlc3M6IFN1YmplY3RQcm9ncmVzc1tdLFxuICAgIGxhbmd1YWdlOiAnZW4nIHwgJ2ZyJ1xuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IG92ZXJhbGxBdmVyYWdlID0gc3ViamVjdFByb2dyZXNzLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBzLmF2ZXJhZ2VTY29yZSwgMCkgLyBzdWJqZWN0UHJvZ3Jlc3MubGVuZ3RoO1xuICAgIFxuICAgIGNvbnN0IHByb21wdCA9IGxhbmd1YWdlID09PSAnZnInXG4gICAgICA/IGBHw6luw6lyZXogdW4gYXBlcsOndSBkdSB0cmltZXN0cmUgcG91ciAke3N0dWRlbnQuZmlyc3ROYW1lfSBhdmVjIHVuZSBtb3llbm5lIGfDqW7DqXJhbGUgZGUgJHtvdmVyYWxsQXZlcmFnZS50b0ZpeGVkKDEpfSUgw6AgdHJhdmVycyAke3N1YmplY3RQcm9ncmVzcy5sZW5ndGh9IG1hdGnDqHJlcy5gXG4gICAgICA6IGBHZW5lcmF0ZSBhIHRlcm0gb3ZlcnZpZXcgZm9yICR7c3R1ZGVudC5maXJzdE5hbWV9IHdpdGggYW4gb3ZlcmFsbCBhdmVyYWdlIG9mICR7b3ZlcmFsbEF2ZXJhZ2UudG9GaXhlZCgxKX0lIGFjcm9zcyAke3N1YmplY3RQcm9ncmVzcy5sZW5ndGh9IHN1YmplY3RzLmA7XG5cbiAgICByZXR1cm4gZ2VuZXJhdGVDb250ZW50KFxuICAgICAgcHJvbXB0LFxuICAgICAgSlNPTi5zdHJpbmdpZnkoc3ViamVjdFByb2dyZXNzLm1hcChzID0+ICh7IG5hbWU6IHMubmFtZSwgYXZlcmFnZTogcy5hdmVyYWdlU2NvcmUgfSkpKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlVGVybVJlY29tbWVuZGF0aW9ucyhcbiAgICBzdHVkZW50OiBTdHVkZW50V2l0aFJlbGF0aW9ucyxcbiAgICBzdWJqZWN0UHJvZ3Jlc3M6IFN1YmplY3RQcm9ncmVzc1tdLFxuICAgIGxhbmd1YWdlOiAnZW4nIHwgJ2ZyJ1xuICApOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3Qgd2Vha1N1YmplY3RzID0gc3ViamVjdFByb2dyZXNzLmZpbHRlcihzID0+IHMuYXZlcmFnZVNjb3JlIDwgNzApO1xuICAgIGNvbnN0IHN0cm9uZ1N1YmplY3RzID0gc3ViamVjdFByb2dyZXNzLmZpbHRlcihzID0+IHMuYXZlcmFnZVNjb3JlID49IDg1KTtcblxuICAgIGNvbnN0IHByb21wdCA9IGxhbmd1YWdlID09PSAnZnInXG4gICAgICA/IGBTdWdnw6lyZXogMy01IHJlY29tbWFuZGF0aW9ucyBwb3VyIGxlIHByb2NoYWluIHRyaW1lc3RyZSBiYXPDqWVzIHN1ciBsZXMgZm9yY2VzICgke3N0cm9uZ1N1YmplY3RzLm1hcChzID0+IHMubmFtZSkuam9pbignLCAnKX0pIGV0IGxlcyBkb21haW5lcyDDoCBhbcOpbGlvcmVyICgke3dlYWtTdWJqZWN0cy5tYXAocyA9PiBzLm5hbWUpLmpvaW4oJywgJyl9KS5gXG4gICAgICA6IGBTdWdnZXN0IDMtNSByZWNvbW1lbmRhdGlvbnMgZm9yIHRoZSBuZXh0IHRlcm0gYmFzZWQgb24gc3RyZW5ndGhzICgke3N0cm9uZ1N1YmplY3RzLm1hcChzID0+IHMubmFtZSkuam9pbignLCAnKX0pIGFuZCBhcmVhcyBmb3IgaW1wcm92ZW1lbnQgKCR7d2Vha1N1YmplY3RzLm1hcChzID0+IHMubmFtZSkuam9pbignLCAnKX0pLmA7XG5cbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBhd2FpdCBnZW5lcmF0ZUNvbnRlbnQocHJvbXB0KTtcblxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnMuc3BsaXQoJ1xcbicpLmZpbHRlcihyID0+IHIudHJpbSgpLmxlbmd0aCA+IDApLnNsaWNlKDAsIDUpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjb21waWxlUmVwb3J0Q2FyZERhdGEoc3R1ZGVudDogU3R1ZGVudFdpdGhSZWxhdGlvbnMpOiBQcm9taXNlPFN1YmplY3RSZXBvcnRDYXJkW10+IHtcbiAgICBjb25zdCBzdWJqZWN0cyA9IGF3YWl0IHByaXNtYS5zdWJqZWN0LmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7IHVzZXJJZDogc3R1ZGVudC51c2VySWQgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiBzdWJqZWN0cy5tYXAoc3ViamVjdCA9PiAoe1xuICAgICAgaWQ6IHN1YmplY3QuaWQsXG4gICAgICBuYW1lOiBzdWJqZWN0Lm5hbWUsXG4gICAgICBncmFkZTogJ04vQScsIC8vIEFzc2Vzc21lbnQgZnVuY3Rpb25hbGl0eSByZW1vdmVkXG4gICAgICBvdXRjb21lczogW10sXG4gICAgfSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBzY29yZVRvR3JhZGUoc2NvcmU6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKHNjb3JlID49IDkwKSByZXR1cm4gJ0EnO1xuICAgIGlmIChzY29yZSA+PSA4MCkgcmV0dXJuICdCJztcbiAgICBpZiAoc2NvcmUgPj0gNzApIHJldHVybiAnQyc7XG4gICAgaWYgKHNjb3JlID49IDYwKSByZXR1cm4gJ0QnO1xuICAgIHJldHVybiAnRic7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlU3ViamVjdENvbW1lbnRzKFxuICAgIHN1YmplY3Q6IFN1YmplY3RSZXBvcnRDYXJkLFxuICAgIHN0dWRlbnQ6IFN0dWRlbnRXaXRoUmVsYXRpb25zLFxuICAgIGxhbmd1YWdlOiAnZW4nIHwgJ2ZyJ1xuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHByb21wdCA9IGxhbmd1YWdlID09PSAnZnInXG4gICAgICA/IGBHw6luw6lyZXogZGVzIGNvbW1lbnRhaXJlcyBkJ2Vuc2VpZ25hbnQgcG91ciAke3N0dWRlbnQuZmlyc3ROYW1lfSBlbiAke3N1YmplY3QubmFtZX0gYXZlYyB1bmUgbm90ZSBkZSAke3N1YmplY3QuZ3JhZGV9LiBTb3lleiBzcMOpY2lmaXF1ZSBldCBlbmNvdXJhZ2VhbnQuYFxuICAgICAgOiBgR2VuZXJhdGUgdGVhY2hlciBjb21tZW50cyBmb3IgJHtzdHVkZW50LmZpcnN0TmFtZX0gaW4gJHtzdWJqZWN0Lm5hbWV9IHdpdGggYSBncmFkZSBvZiAke3N1YmplY3QuZ3JhZGV9LiBCZSBzcGVjaWZpYyBhbmQgZW5jb3VyYWdpbmcuYDtcblxuICAgIHJldHVybiBnZW5lcmF0ZUNvbnRlbnQoXG4gICAgICBwcm9tcHQsXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG91dGNvbWVzOiBzdWJqZWN0Lm91dGNvbWVzLmxlbmd0aCxcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVSZXBvcnRDYXJkQ29tbWVudHMoXG4gICAgc3R1ZGVudDogU3R1ZGVudFdpdGhSZWxhdGlvbnMsXG4gICAgcmVwb3J0Q2FyZERhdGE6IFN1YmplY3RSZXBvcnRDYXJkW10sXG4gICAgbGFuZ3VhZ2U6ICdlbicgfCAnZnInXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3Qgb3ZlcmFsbEdyYWRlID0gcmVwb3J0Q2FyZERhdGEucmVkdWNlKChzdW0sIHMpID0+IHtcbiAgICAgIGNvbnN0IGdyYWRlVmFsdWUgPSB7IEE6IDQsIEI6IDMsIEM6IDIsIEQ6IDEsIEY6IDAgfVtzLmdyYWRlXSB8fCAwO1xuICAgICAgcmV0dXJuIHN1bSArIGdyYWRlVmFsdWU7XG4gICAgfSwgMCkgLyByZXBvcnRDYXJkRGF0YS5sZW5ndGg7XG5cbiAgICBjb25zdCBwcm9tcHQgPSBsYW5ndWFnZSA9PT0gJ2ZyJ1xuICAgICAgPyBgR8OpbsOpcmV6IGRlcyBjb21tZW50YWlyZXMgZ8OpbsOpcmF1eCBkZSBidWxsZXRpbiBwb3VyICR7c3R1ZGVudC5maXJzdE5hbWV9ICR7c3R1ZGVudC5sYXN0TmFtZX0gYXZlYyB1bmUgcGVyZm9ybWFuY2UgZ2xvYmFsZSBkZSAke292ZXJhbGxHcmFkZS50b0ZpeGVkKDEpfS80LjAuYFxuICAgICAgOiBgR2VuZXJhdGUgb3ZlcmFsbCByZXBvcnQgY2FyZCBjb21tZW50cyBmb3IgJHtzdHVkZW50LmZpcnN0TmFtZX0gJHtzdHVkZW50Lmxhc3ROYW1lfSB3aXRoIGFuIG92ZXJhbGwgcGVyZm9ybWFuY2Ugb2YgJHtvdmVyYWxsR3JhZGUudG9GaXhlZCgxKX0vNC4wLmA7XG5cbiAgICByZXR1cm4gZ2VuZXJhdGVDb250ZW50KFxuICAgICAgcHJvbXB0LFxuICAgICAgSlNPTi5zdHJpbmdpZnkocmVwb3J0Q2FyZERhdGEubWFwKHMgPT4gKHsgc3ViamVjdDogcy5uYW1lLCBncmFkZTogcy5ncmFkZSB9KSkpXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgcmVwb3J0R2VuZXJhdG9yU2VydmljZSA9IG5ldyBSZXBvcnRHZW5lcmF0b3JTZXJ2aWNlKCk7Il0sInZlcnNpb24iOjN9