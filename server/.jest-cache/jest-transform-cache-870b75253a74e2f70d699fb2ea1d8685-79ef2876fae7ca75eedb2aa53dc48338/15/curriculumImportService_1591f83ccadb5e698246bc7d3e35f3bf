edf6026588e7f894b4c914907d726823
/* eslint-disable @typescript-eslint/no-explicit-any */
// import { embeddingService } from './embeddingService'; // Currently unused
import BaseService from './base/BaseService';
import { ImportStatus } from '@teaching-engine/database';
// Import pdf-parse dynamically to avoid loading test files during module initialization
let pdf;
import mammoth from 'mammoth';
import OpenAI from 'openai';
export class CurriculumImportService extends BaseService {
    openai = null;
    constructor() {
        super('CurriculumImportService');
        // Only initialize OpenAI if we have an API key
        const apiKey = process.env.OPENAI_API_KEY;
        if (apiKey) {
            this.openai = new OpenAI({ apiKey });
        }
        else {
            this.logger.warn('OpenAI API key not found - AI features will be disabled');
        }
    }
    /**
     * Confirm import and create curriculum expectations
     */
    async confirmImport(importId) {
        try {
            const importRecord = await this.prisma.curriculumImport.findUnique({
                where: { id: importId },
            });
            if (!importRecord) {
                throw new Error('Import session not found');
            }
            if (importRecord.status !== ImportStatus.READY_FOR_REVIEW) {
                throw new Error('Import is not ready for confirmation');
            }
            // Get parsed subjects from metadata
            const metadata = importRecord.metadata;
            const subjects = metadata?.parsedSubjects || [];
            let createdCount = 0;
            // Create curriculum expectations
            for (const subject of subjects) {
                for (const expectation of subject.expectations) {
                    try {
                        // Check if expectation already exists
                        const existing = await this.prisma.curriculumExpectation.findUnique({
                            where: { code: expectation.code },
                        });
                        if (!existing) {
                            await this.prisma.curriculumExpectation.create({
                                data: {
                                    code: expectation.code,
                                    description: expectation.description,
                                    descriptionFr: expectation.descriptionFr || null,
                                    strand: expectation.strand,
                                    substrand: expectation.substrand || null,
                                    grade: expectation.grade,
                                    subject: expectation.subject,
                                },
                            });
                            createdCount++;
                        }
                    }
                    catch (error) {
                        this.logger.warn({ error, code: expectation.code }, 'Failed to create expectation, skipping');
                    }
                }
            }
            // Update import status
            await this.updateImportStatus(importId, ImportStatus.COMPLETED);
            await this.setCompletionTime(importId);
            this.logger.info({ importId, created: createdCount }, 'Import confirmed and expectations created');
            return { created: createdCount };
        }
        catch (error) {
            this.logger.error({ error, importId }, 'Failed to confirm import');
            throw error;
        }
    }
    /**
     * Start a new curriculum import session
     */
    async startImport(userId, grade, subject, sourceFormat, sourceFile, metadata) {
        try {
            const curriculumImport = await this.prisma.curriculumImport.create({
                data: {
                    userId,
                    grade,
                    subject,
                    sourceFormat,
                    sourceFile,
                    status: ImportStatus.UPLOADING,
                    metadata: (metadata || {}),
                },
            });
            this.logger.info({ importId: curriculumImport.id, userId, grade, subject, sourceFormat }, 'Started curriculum import session');
            return curriculumImport.id;
        }
        catch (error) {
            this.logger.error({ error, userId, grade, subject }, 'Failed to start curriculum import');
            throw new Error('Failed to start import session');
        }
    }
    /**
     * Parse CSV content into curriculum expectations
     */
    parseCSV(csvContent) {
        try {
            const lines = csvContent.split('\n');
            // Parse header line handling quoted values
            const headerLine = lines[0].toLowerCase();
            const headers = [];
            let current = '';
            let inQuotes = false;
            for (let j = 0; j < headerLine.length; j++) {
                const char = headerLine[j];
                if (char === '"') {
                    inQuotes = !inQuotes;
                }
                else if (char === ',' && !inQuotes) {
                    headers.push(current.trim().replace(/^"(.*)"$/, '$1'));
                    current = '';
                }
                else {
                    current += char;
                }
            }
            headers.push(current.trim().replace(/^"(.*)"$/, '$1'));
            const codeIndex = headers.indexOf('code');
            const descriptionIndex = headers.indexOf('description');
            const subjectIndex = headers.indexOf('subject');
            const gradeIndex = headers.indexOf('grade');
            const domainIndex = headers.indexOf('domain');
            if (codeIndex === -1 || descriptionIndex === -1) {
                throw new Error('CSV must contain "code" and "description" columns');
            }
            const expectations = [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line)
                    continue;
                // Parse CSV line handling quoted values properly
                const columns = [];
                let current = '';
                let inQuotes = false;
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    }
                    else if (char === ',' && !inQuotes) {
                        columns.push(current.trim().replace(/^"(.*)"$/, '$1'));
                        current = '';
                    }
                    else {
                        current += char;
                    }
                }
                // Don't forget the last column
                columns.push(current.trim().replace(/^"(.*)"$/, '$1'));
                if (columns.length < Math.max(codeIndex, descriptionIndex) + 1) {
                    this.logger.warn({ lineNumber: i + 1, line }, 'Skipping invalid CSV line');
                    continue;
                }
                const expectation = {
                    code: columns[codeIndex],
                    description: columns[descriptionIndex],
                    subject: subjectIndex >= 0 ? columns[subjectIndex] : 'Unknown',
                    grade: gradeIndex >= 0 ? parseInt(columns[gradeIndex]) || 0 : 0,
                    strand: domainIndex >= 0 ? columns[domainIndex] : 'General',
                };
                expectations.push(expectation);
            }
            return expectations;
        }
        catch (error) {
            this.logger.error({ error }, 'Failed to parse CSV content');
            throw new Error(`CSV parsing failed: ${error.message}`);
        }
    }
    /**
     * Extract curriculum expectations from PDF using pdf-parse and AI
     */
    async parsePDF(fileBuffer) {
        try {
            this.logger.info('Starting PDF parsing');
            // Lazy load pdf-parse to avoid initialization issues
            if (!pdf) {
                pdf = (await import('pdf-parse')).default;
            }
            // Extract text from PDF
            const pdfData = await pdf(fileBuffer);
            const text = pdfData.text;
            if (!text || text.length < 100) {
                throw new Error('PDF appears to be empty or too short');
            }
            this.logger.info(`Extracted ${text.length} characters from PDF`);
            // Use AI to parse the curriculum text
            const expectations = await this.parseTextWithAI(text);
            this.logger.info(`Parsed ${expectations.length} expectations from PDF`);
            return expectations;
        }
        catch (error) {
            this.logger.error({ error }, 'Failed to parse PDF');
            throw new Error(`PDF parsing failed: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Extract curriculum expectations from DOCX using mammoth and AI
     */
    async parseDOCX(fileBuffer) {
        try {
            this.logger.info('Starting DOCX parsing');
            // Extract text from DOCX
            const result = await mammoth.extractRawText({ buffer: fileBuffer });
            const text = result.value;
            if (!text || text.length < 100) {
                throw new Error('DOCX appears to be empty or too short');
            }
            this.logger.info(`Extracted ${text.length} characters from DOCX`);
            // Use AI to parse the curriculum text
            const expectations = await this.parseTextWithAI(text);
            this.logger.info(`Parsed ${expectations.length} expectations from DOCX`);
            return expectations;
        }
        catch (error) {
            this.logger.error({ error }, 'Failed to parse DOCX');
            throw new Error(`DOCX parsing failed: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    /**
     * Get import progress
     */
    async getImportProgress(importId) {
        try {
            const importRecord = await this.prisma.curriculumImport.findUnique({
                where: { id: importId },
            });
            if (!importRecord)
                return null;
            return {
                importId,
                status: importRecord.status,
                totalOutcomes: importRecord.totalOutcomes,
                processedOutcomes: importRecord.processedOutcomes,
                errors: importRecord.errorLog || [],
            };
        }
        catch (error) {
            this.logger.error({ error, importId }, 'Failed to get import progress');
            return null;
        }
    }
    /**
     * Cancel an import session
     */
    async cancelImport(importId) {
        try {
            await this.updateImportStatus(importId, ImportStatus.CANCELLED);
            this.logger.info({ importId }, 'Cancelled curriculum import');
            return true;
        }
        catch (error) {
            this.logger.error({ error, importId }, 'Failed to cancel import');
            return false;
        }
    }
    /**
     * Get import history for a user
     */
    async getImportHistory(userId, limit = 20) {
        try {
            const imports = await this.prisma.curriculumImport.findMany({
                where: { userId },
                orderBy: { createdAt: 'desc' },
                take: limit,
                include: {
                    clusters: {
                        select: {
                            id: true,
                            clusterName: true,
                            clusterType: true,
                        },
                    },
                    _count: {
                        select: {
                            curriculumExpectations: true,
                        },
                    },
                },
            });
            return imports;
        }
        catch (error) {
            this.logger.error({ error, userId }, 'Failed to get import history');
            return [];
        }
    }
    // Private helper methods
    async updateImportStatus(importId, status, totalOutcomes) {
        const updateData = { status };
        if (totalOutcomes !== undefined) {
            updateData.totalOutcomes = totalOutcomes;
        }
        await this.prisma.curriculumImport.update({
            where: { id: importId },
            data: updateData,
        });
    }
    async updateProgress(importId, processedOutcomes) {
        await this.prisma.curriculumImport.update({
            where: { id: importId },
            data: { processedOutcomes },
        });
    }
    async setCompletionTime(importId) {
        await this.prisma.curriculumImport.update({
            where: { id: importId },
            data: { completedAt: new Date() },
        });
    }
    async logErrors(importId, errors) {
        await this.prisma.curriculumImport.update({
            where: { id: importId },
            data: { errorLog: errors },
        });
    }
    /**
     * Parse curriculum text using AI to extract expectations
     */
    async parseTextWithAI(text) {
        try {
            // Detect if document is in French or bilingual
            const isFrench = this.detectLanguage(text);
            const isBilingual = this.detectBilingual(text);
            // Split text into chunks if it's too long (GPT-4 has token limits)
            const chunks = this.chunkText(text, 3000); // ~750 words per chunk
            const allExpectations = [];
            for (let i = 0; i < chunks.length; i++) {
                this.logger.info(`Processing chunk ${i + 1} of ${chunks.length}`);
                const languageInfo = isFrench ? 'French' : isBilingual ? 'bilingual (English and French)' : 'English';
                const prompt = `You are an expert in curriculum design for elementary education. Extract curriculum expectations from the following ${languageInfo} text.

Please extract and return in JSON format:
- Subject name
- Grade level
- For each expectation:
  - Code (e.g., "A1.1", "B2.3")
  - Type ("overall" or "specific")
  - Description (the full text of the expectation)
  - Strand (major category like "Oral Communication", "Reading", etc.)
  - Domain (if applicable)

Return ONLY a JSON object with this structure:
{
  "subject": "Subject Name",
  "grade": 1,
  "expectations": [
    {
      "code": "A1.1",
      "type": "overall",
      "description": "Full expectation text",
      "strand": "Strand Name",
      "domain": "Domain Name (optional)"
    }
  ]
}

Only include data you are confident about. Do not invent or hallucinate expectations.

Text to parse:
"""
${chunks[i]}
"""`;
                if (!this.openai) {
                    throw new Error('OpenAI API key not configured');
                }
                const response = await this.openai.chat.completions.create({
                    model: 'gpt-4',
                    messages: [
                        {
                            role: 'system',
                            content: 'You are an expert curriculum analyst. Extract curriculum expectations accurately.',
                        },
                        { role: 'user', content: prompt },
                    ],
                    temperature: 0.1, // Low temperature for accuracy
                    max_tokens: 2000,
                });
                const content = response.choices[0]?.message?.content;
                if (!content) {
                    this.logger.warn(`No content returned for chunk ${i + 1}`);
                    continue;
                }
                try {
                    const parsed = JSON.parse(content);
                    if (parsed.expectations && Array.isArray(parsed.expectations)) {
                        const expectations = parsed.expectations.map((exp) => ({
                            code: exp.code || `AUTO_${i}_${allExpectations.length}`,
                            description: exp.description || '',
                            descriptionFr: exp.descriptionFr,
                            subject: parsed.subject || 'Unknown',
                            grade: parsed.grade || 1,
                            strand: exp.strand || exp.domain || 'General',
                            strandFr: exp.strandFr,
                            substrand: exp.substrand,
                            substrandFr: exp.substrandFr,
                        }));
                        allExpectations.push(...expectations);
                    }
                }
                catch (parseError) {
                    this.logger.error({ parseError, chunk: i }, 'Failed to parse AI response');
                }
            }
            return allExpectations;
        }
        catch (error) {
            this.logger.error({ error }, 'Failed to parse text with AI');
            throw new Error('AI parsing failed');
        }
    }
    /**
     * Detect if text is primarily in French
     */
    detectLanguage(text) {
        const frenchIndicators = [
            'attentes', 'domaine', 'année', 'élève', 'apprentissage',
            'français', 'mathématiques', 'sciences', 'études sociales',
            'contenus d\'apprentissage', 'pistes de réflexion'
        ];
        const textLower = text.toLowerCase();
        const frenchCount = frenchIndicators.filter(indicator => textLower.includes(indicator)).length;
        return frenchCount >= 3;
    }
    /**
     * Detect if text contains both English and French
     */
    detectBilingual(text) {
        const englishIndicators = ['expectations', 'strand', 'grade', 'student', 'learning'];
        const frenchIndicators = ['attentes', 'domaine', 'année', 'élève', 'apprentissage'];
        const textLower = text.toLowerCase();
        const hasEnglish = englishIndicators.some(indicator => textLower.includes(indicator));
        const hasFrench = frenchIndicators.some(indicator => textLower.includes(indicator));
        return hasEnglish && hasFrench;
    }
    /**
     * Split text into manageable chunks for AI processing
     */
    chunkText(text, maxCharsPerChunk) {
        const chunks = [];
        const paragraphs = text.split(/\n\n+/);
        let currentChunk = '';
        for (const paragraph of paragraphs) {
            if (currentChunk.length + paragraph.length > maxCharsPerChunk && currentChunk.length > 0) {
                chunks.push(currentChunk.trim());
                currentChunk = paragraph;
            }
            else {
                currentChunk += (currentChunk ? '\n\n' : '') + paragraph;
            }
        }
        if (currentChunk.trim()) {
            chunks.push(currentChunk.trim());
        }
        return chunks;
    }
    /**
     * Determine if an expectation is overall or specific based on code pattern
     */
    determineExpectationType(code, description) {
        // Common patterns for overall expectations:
        // - Single letter or number (e.g., "A", "1")
        // - Ends with .0 (e.g., "A1.0")
        // - Contains "overall" in description
        if (code.length === 1)
            return 'overall';
        if (code.endsWith('.0'))
            return 'overall';
        if (description.toLowerCase().includes('overall'))
            return 'overall';
        if (code.match(/^[A-Z]\d*$/))
            return 'overall'; // e.g., "A1", "B2"
        // Everything else is specific
        return 'specific';
    }
    /**
     * Store uploaded file content for parsing
     */
    async storeUploadedFile(importId, file) {
        try {
            // Store file metadata and content
            await this.prisma.curriculumImport.update({
                where: { id: importId },
                data: {
                    sourceFile: file.originalname,
                    metadata: {
                        filename: file.originalname,
                        mimetype: file.mimetype,
                        size: file.size,
                        uploadedAt: new Date().toISOString(),
                    },
                    // Store file content as base64 for now (in production, would use cloud storage)
                    rawText: file.buffer.toString('base64'),
                },
            });
            this.logger.info(`File stored for import ${importId}: ${file.originalname}`);
        }
        catch (error) {
            this.logger.error({ error, importId }, 'Failed to store uploaded file');
            throw error;
        }
    }
    /**
     * Parse uploaded file and extract curriculum expectations
     */
    async parseUploadedFile(importId, _options = {}) {
        try {
            const importRecord = await this.prisma.curriculumImport.findUnique({
                where: { id: importId },
            });
            if (!importRecord) {
                throw new Error('Import session not found');
            }
            if (!importRecord.rawText) {
                throw new Error('No file content found for parsing');
            }
            // Update status to processing
            await this.updateImportStatus(importId, ImportStatus.PROCESSING);
            // Decode the file content from base64
            const fileBuffer = Buffer.from(importRecord.rawText, 'base64');
            // Parse based on file format
            let expectations = [];
            if (importRecord.sourceFormat === 'pdf') {
                expectations = await this.parsePDF(fileBuffer);
            }
            else if (importRecord.sourceFormat === 'docx') {
                expectations = await this.parseDOCX(fileBuffer);
            }
            else if (importRecord.sourceFormat === 'csv') {
                // Convert buffer to string for CSV
                const csvContent = fileBuffer.toString('utf-8');
                expectations = this.parseCSV(csvContent);
            }
            else {
                throw new Error(`Unsupported file format: ${importRecord.sourceFormat}`);
            }
            // Group expectations by subject
            const subjectMap = new Map();
            for (const expectation of expectations) {
                const subjectName = expectation.subject || 'Unknown';
                if (!subjectMap.has(subjectName)) {
                    subjectMap.set(subjectName, {
                        name: subjectName,
                        expectations: [],
                    });
                }
                const subject = subjectMap.get(subjectName);
                subject.expectations.push({
                    code: expectation.code,
                    type: this.determineExpectationType(expectation.code, expectation.description),
                    description: expectation.description,
                    strand: expectation.strand || 'General',
                    substrand: expectation.substrand,
                    subject: subjectName,
                    grade: expectation.grade || importRecord.grade,
                });
            }
            const subjects = Array.from(subjectMap.values());
            // Store parsed subjects in metadata for later use
            await this.prisma.curriculumImport.update({
                where: { id: importId },
                data: {
                    metadata: {
                        ...(importRecord.metadata || {}),
                        parsedSubjects: subjects,
                    },
                },
            });
            // Update status to ready for review
            await this.updateImportStatus(importId, ImportStatus.READY_FOR_REVIEW);
            this.logger.info(`File parsed for import ${importId}: ${subjects.length} subjects`);
            return {
                subjects: subjects,
                errors: [],
            };
        }
        catch (error) {
            this.logger.error({ error, importId }, 'Failed to parse uploaded file');
            await this.updateImportStatus(importId, ImportStatus.FAILED);
            throw error;
        }
    }
    /**
     * Load preset curriculum data
     */
    async loadPresetCurriculum(userId, presetId) {
        try {
            // Create new import session for preset
            const sessionId = await this.startImport(userId, 1, // Default grade for presets
            'Multi-Subject', 'manual', `Preset: ${presetId}`);
            // Mock preset data based on presetId
            let subjects = [];
            switch (presetId) {
                case 'pei-grade1-french':
                    subjects = [
                        {
                            name: 'Français Langue Première',
                            expectations: [
                                {
                                    code: 'CO1',
                                    type: 'overall',
                                    description: 'Comprendre des messages oraux en français',
                                    strand: 'Communication orale',
                                    subject: 'Français Langue Première',
                                    grade: 1,
                                },
                                {
                                    code: 'CO1.1',
                                    type: 'specific',
                                    description: 'Suivre des instructions orales simples',
                                    strand: 'Communication orale',
                                    substrand: 'Écoute',
                                    subject: 'Français Langue Première',
                                    grade: 1,
                                },
                            ],
                        },
                        {
                            name: 'Mathématiques',
                            expectations: [
                                {
                                    code: 'N1',
                                    type: 'overall',
                                    description: 'Comprendre les nombres de 0 à 20',
                                    strand: 'Nombre',
                                    subject: 'Mathématiques',
                                    grade: 1,
                                },
                            ],
                        },
                    ];
                    break;
                case 'ontario-grade1-english':
                    subjects = [
                        {
                            name: 'Language',
                            expectations: [
                                {
                                    code: '1.O1',
                                    type: 'overall',
                                    description: 'Listen in order to understand and respond appropriately',
                                    strand: 'Oral Communication',
                                    subject: 'Language',
                                    grade: 1,
                                },
                            ],
                        },
                        {
                            name: 'Mathematics',
                            expectations: [
                                {
                                    code: '1.N1',
                                    type: 'overall',
                                    description: 'Count to 50 and represent numbers to 20',
                                    strand: 'Number Sense and Numeration',
                                    subject: 'Mathematics',
                                    grade: 1,
                                },
                            ],
                        },
                    ];
                    break;
                case 'bc-grade1-core':
                    subjects = [
                        {
                            name: 'English Language Arts',
                            expectations: [
                                {
                                    code: 'ELA1-O1',
                                    type: 'overall',
                                    description: 'Use speaking and listening to interact with others',
                                    strand: 'Oral Language',
                                    subject: 'English Language Arts',
                                    grade: 1,
                                },
                            ],
                        },
                    ];
                    break;
                default:
                    throw new Error(`Unknown preset: ${presetId}`);
            }
            // Store parsed subjects in metadata for later use
            await this.prisma.curriculumImport.update({
                where: { id: sessionId },
                data: {
                    metadata: {
                        presetId,
                        parsedSubjects: subjects,
                        loadedAt: new Date().toISOString(),
                    },
                },
            });
            // Update import status
            await this.updateImportStatus(sessionId, 'READY_FOR_REVIEW');
            this.logger.info(`Preset curriculum loaded: ${presetId} for user ${userId}`);
            return {
                sessionId,
                subjects,
            };
        }
        catch (error) {
            this.logger.error({ error, presetId, userId }, 'Failed to load preset curriculum');
            throw error;
        }
    }
    /**
     * Finalize import and create actual curriculum expectations in the ETFO system
     */
    async finalizeImport(importId, _userId) {
        try {
            const importRecord = await this.prisma.curriculumImport.findUnique({
                where: { id: importId },
                include: {
                    curriculumExpectations: true,
                },
            });
            if (!importRecord) {
                throw new Error('Import session not found');
            }
            // Get the parsed subjects from the import metadata
            const parsedSubjects = importRecord.metadata?.parsedSubjects || [];
            let totalExpectations = 0;
            const subjects = [];
            // Create curriculum expectations for each subject
            for (const subject of parsedSubjects) {
                subjects.push(subject.name);
                for (const expectation of subject.expectations) {
                    await this.prisma.curriculumExpectation.create({
                        data: {
                            code: expectation.code,
                            description: expectation.description,
                            strand: expectation.strand,
                            substrand: expectation.substrand,
                            grade: expectation.grade,
                            subject: expectation.subject,
                            importId,
                        },
                    });
                    totalExpectations++;
                }
            }
            // Update import status to completed
            await this.updateImportStatus(importId, 'COMPLETED');
            await this.setCompletionTime(importId);
            // Store final results in metadata
            await this.prisma.curriculumImport.update({
                where: { id: importId },
                data: {
                    metadata: {
                        ...(importRecord.metadata || {}),
                        finalResults: {
                            totalExpectations,
                            subjects,
                            completedAt: new Date().toISOString(),
                        },
                    },
                },
            });
            this.logger.info(`Import finalized: ${importId}, created ${totalExpectations} expectations`);
            return {
                totalExpectations,
                subjects,
            };
        }
        catch (error) {
            this.logger.error({ error, importId }, 'Failed to finalize import');
            await this.updateImportStatus(importId, 'FAILED');
            throw error;
        }
    }
}
// Export singleton instance
export const curriculumImportService = new CurriculumImportService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9zZXJ2aWNlcy9jdXJyaWN1bHVtSW1wb3J0U2VydmljZS50cyIsIm1hcHBpbmdzIjoiQUFBQSx1REFBdUQ7QUFDdkQsNkVBQTZFO0FBQzdFLE9BQU8sV0FBVyxNQUFNLG9CQUFvQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCx3RkFBd0Y7QUFDeEYsSUFBSSxHQUFRLENBQUM7QUFDYixPQUFPLE9BQU8sTUFBTSxTQUFTLENBQUM7QUFDOUIsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBVTVCLE1BQU0sT0FBTyx1QkFBd0IsU0FBUSxXQUFXO0lBQzlDLE1BQU0sR0FBa0IsSUFBSSxDQUFDO0lBRXJDO1FBQ0UsS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDakMsK0NBQStDO1FBQy9DLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDO1FBQzFDLElBQUksTUFBTSxFQUFFLENBQUM7WUFDWCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUN2QyxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLHlEQUF5RCxDQUFDLENBQUM7UUFDOUUsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxhQUFhLENBQUMsUUFBZ0I7UUFDbEMsSUFBSSxDQUFDO1lBQ0gsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQztnQkFDakUsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRTthQUN4QixDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7Z0JBQ2xCLE1BQU0sSUFBSSxLQUFLLENBQUMs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QkFBaUI7NEJBQ2pCLFFBQVE7NEJBQ1IsV0FBVyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO3lCQUN0QztxQkFDRjtpQkFDRjthQUNGLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLHFCQUFxQixRQUFRLGFBQWEsaUJBQWlCLGVBQWUsQ0FBQyxDQUFDO1lBRTdGLE9BQU87Z0JBQ0wsaUJBQWlCO2dCQUNqQixRQUFRO2FBQ1QsQ0FBQztRQUNKLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsMkJBQTJCLENBQUMsQ0FBQztZQUNwRSxNQUFNLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDbEQsTUFBTSxLQUFLLENBQUM7UUFDZCxDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBRUQsNEJBQTRCO0FBQzVCLE1BQU0sQ0FBQyxNQUFNLHVCQUF1QixHQUFHLElBQUksdUJBQXVCLEVBQUUsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWljaGFlbG1jaXNhYWMvR2l0SHViL3RlYWNoaW5nLWVuZ2luZTIuMC9zZXJ2ZXIvc3JjL3NlcnZpY2VzL2N1cnJpY3VsdW1JbXBvcnRTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkgKi9cbi8vIGltcG9ydCB7IGVtYmVkZGluZ1NlcnZpY2UgfSBmcm9tICcuL2VtYmVkZGluZ1NlcnZpY2UnOyAvLyBDdXJyZW50bHkgdW51c2VkXG5pbXBvcnQgQmFzZVNlcnZpY2UgZnJvbSAnLi9iYXNlL0Jhc2VTZXJ2aWNlJztcbmltcG9ydCB7IEltcG9ydFN0YXR1cyB9IGZyb20gJ0B0ZWFjaGluZy1lbmdpbmUvZGF0YWJhc2UnO1xuLy8gSW1wb3J0IHBkZi1wYXJzZSBkeW5hbWljYWxseSB0byBhdm9pZCBsb2FkaW5nIHRlc3QgZmlsZXMgZHVyaW5nIG1vZHVsZSBpbml0aWFsaXphdGlvblxubGV0IHBkZjogYW55O1xuaW1wb3J0IG1hbW1vdGggZnJvbSAnbWFtbW90aCc7XG5pbXBvcnQgT3BlbkFJIGZyb20gJ29wZW5haSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW1wb3J0UHJvZ3Jlc3Mge1xuICBpbXBvcnRJZDogc3RyaW5nO1xuICBzdGF0dXM6IEltcG9ydFN0YXR1cztcbiAgdG90YWxPdXRjb21lczogbnVtYmVyO1xuICBwcm9jZXNzZWRPdXRjb21lczogbnVtYmVyO1xuICBlcnJvcnM6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgY2xhc3MgQ3VycmljdWx1bUltcG9ydFNlcnZpY2UgZXh0ZW5kcyBCYXNlU2VydmljZSB7XG4gIHByaXZhdGUgb3BlbmFpOiBPcGVuQUkgfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcignQ3VycmljdWx1bUltcG9ydFNlcnZpY2UnKTtcbiAgICAvLyBPbmx5IGluaXRpYWxpemUgT3BlbkFJIGlmIHdlIGhhdmUgYW4gQVBJIGtleVxuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZO1xuICAgIGlmIChhcGlLZXkpIHtcbiAgICAgIHRoaXMub3BlbmFpID0gbmV3IE9wZW5BSSh7IGFwaUtleSB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5sb2dnZXIud2FybignT3BlbkFJIEFQSSBrZXkgbm90IGZvdW5kIC0gQUkgZmVhdHVyZXMgd2lsbCBiZSBkaXNhYmxlZCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maXJtIGltcG9ydCBhbmQgY3JlYXRlIGN1cnJpY3VsdW0gZXhwZWN0YXRpb25zXG4gICAqL1xuICBhc3luYyBjb25maXJtSW1wb3J0KGltcG9ydElkOiBzdHJpbmcpOiBQcm9taXNlPHsgY3JlYXRlZDogbnVtYmVyIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaW1wb3J0UmVjb3JkID0gYXdhaXQgdGhpcy5wcmlzbWEuY3VycmljdWx1bUltcG9ydC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGltcG9ydElkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFpbXBvcnRSZWNvcmQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbXBvcnQgc2Vzc2lvbiBub3QgZm91bmQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGltcG9ydFJlY29yZC5zdGF0dXMgIT09IEltcG9ydFN0YXR1cy5SRUFEWV9GT1JfUkVWSUVXKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW1wb3J0IGlzIG5vdCByZWFkeSBmb3IgY29uZmlybWF0aW9uJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBwYXJzZWQgc3ViamVjdHMgZnJvbSBtZXRhZGF0YVxuICAgICAgY29uc3QgbWV0YWRhdGEgPSBpbXBvcnRSZWNvcmQubWV0YWRhdGEgYXMgYW55O1xuICAgICAgY29uc3Qgc3ViamVjdHMgPSBtZXRhZGF0YT8ucGFyc2VkU3ViamVjdHMgfHwgW107XG5cbiAgICAgIGxldCBjcmVhdGVkQ291bnQgPSAwO1xuXG4gICAgICAvLyBDcmVhdGUgY3VycmljdWx1bSBleHBlY3RhdGlvbnNcbiAgICAgIGZvciAoY29uc3Qgc3ViamVjdCBvZiBzdWJqZWN0cykge1xuICAgICAgICBmb3IgKGNvbnN0IGV4cGVjdGF0aW9uIG9mIHN1YmplY3QuZXhwZWN0YXRpb25zKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGV4cGVjdGF0aW9uIGFscmVhZHkgZXhpc3RzXG4gICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHRoaXMucHJpc21hLmN1cnJpY3VsdW1FeHBlY3RhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgICAgd2hlcmU6IHsgY29kZTogZXhwZWN0YXRpb24uY29kZSB9LFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuY3VycmljdWx1bUV4cGVjdGF0aW9uLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgY29kZTogZXhwZWN0YXRpb24uY29kZSxcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBleHBlY3RhdGlvbi5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uRnI6IGV4cGVjdGF0aW9uLmRlc2NyaXB0aW9uRnIgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgIHN0cmFuZDogZXhwZWN0YXRpb24uc3RyYW5kLFxuICAgICAgICAgICAgICAgICAgc3Vic3RyYW5kOiBleHBlY3RhdGlvbi5zdWJzdHJhbmQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgIGdyYWRlOiBleHBlY3RhdGlvbi5ncmFkZSxcbiAgICAgICAgICAgICAgICAgIHN1YmplY3Q6IGV4cGVjdGF0aW9uLnN1YmplY3QsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGNyZWF0ZWRDb3VudCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICAgICAgICB7IGVycm9yLCBjb2RlOiBleHBlY3RhdGlvbi5jb2RlIH0sXG4gICAgICAgICAgICAgICdGYWlsZWQgdG8gY3JlYXRlIGV4cGVjdGF0aW9uLCBza2lwcGluZycsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgaW1wb3J0IHN0YXR1c1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVJbXBvcnRTdGF0dXMoaW1wb3J0SWQsIEltcG9ydFN0YXR1cy5DT01QTEVURUQpO1xuICAgICAgYXdhaXQgdGhpcy5zZXRDb21wbGV0aW9uVGltZShpbXBvcnRJZCk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oXG4gICAgICAgIHsgaW1wb3J0SWQsIGNyZWF0ZWQ6IGNyZWF0ZWRDb3VudCB9LFxuICAgICAgICAnSW1wb3J0IGNvbmZpcm1lZCBhbmQgZXhwZWN0YXRpb25zIGNyZWF0ZWQnLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHsgY3JlYXRlZDogY3JlYXRlZENvdW50IH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKHsgZXJyb3IsIGltcG9ydElkIH0sICdGYWlsZWQgdG8gY29uZmlybSBpbXBvcnQnKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCBhIG5ldyBjdXJyaWN1bHVtIGltcG9ydCBzZXNzaW9uXG4gICAqL1xuICBhc3luYyBzdGFydEltcG9ydChcbiAgICB1c2VySWQ6IG51bWJlcixcbiAgICBncmFkZTogbnVtYmVyLFxuICAgIHN1YmplY3Q6IHN0cmluZyxcbiAgICBzb3VyY2VGb3JtYXQ6ICdjc3YnIHwgJ3BkZicgfCAnZG9jeCcgfCAnbWFudWFsJyxcbiAgICBzb3VyY2VGaWxlPzogc3RyaW5nLFxuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJpY3VsdW1JbXBvcnQgPSBhd2FpdCB0aGlzLnByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgZ3JhZGUsXG4gICAgICAgICAgc3ViamVjdCxcbiAgICAgICAgICBzb3VyY2VGb3JtYXQsXG4gICAgICAgICAgc291cmNlRmlsZSxcbiAgICAgICAgICBzdGF0dXM6IEltcG9ydFN0YXR1cy5VUExPQURJTkcsXG4gICAgICAgICAgbWV0YWRhdGE6IChtZXRhZGF0YSB8fCB7fSkgYXMgYW55LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oXG4gICAgICAgIHsgaW1wb3J0SWQ6IGN1cnJpY3VsdW1JbXBvcnQuaWQsIHVzZXJJZCwgZ3JhZGUsIHN1YmplY3QsIHNvdXJjZUZvcm1hdCB9LFxuICAgICAgICAnU3RhcnRlZCBjdXJyaWN1bHVtIGltcG9ydCBzZXNzaW9uJyxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBjdXJyaWN1bHVtSW1wb3J0LmlkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcih7IGVycm9yLCB1c2VySWQsIGdyYWRlLCBzdWJqZWN0IH0sICdGYWlsZWQgdG8gc3RhcnQgY3VycmljdWx1bSBpbXBvcnQnKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHN0YXJ0IGltcG9ydCBzZXNzaW9uJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIENTViBjb250ZW50IGludG8gY3VycmljdWx1bSBleHBlY3RhdGlvbnNcbiAgICovXG4gIHBhcnNlQ1NWKGNzdkNvbnRlbnQ6IHN0cmluZyk6IEFycmF5PHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBzdWJqZWN0OiBzdHJpbmc7XG4gICAgZ3JhZGU6IG51bWJlcjtcbiAgICBzdHJhbmQ/OiBzdHJpbmc7XG4gICAgc3Vic3RyYW5kPzogc3RyaW5nO1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGxpbmVzID0gY3N2Q29udGVudC5zcGxpdCgnXFxuJyk7XG4gICAgICAvLyBQYXJzZSBoZWFkZXIgbGluZSBoYW5kbGluZyBxdW90ZWQgdmFsdWVzXG4gICAgICBjb25zdCBoZWFkZXJMaW5lID0gbGluZXNbMF0udG9Mb3dlckNhc2UoKTtcbiAgICAgIGNvbnN0IGhlYWRlcnM6IHN0cmluZ1tdID0gW107XG4gICAgICBsZXQgY3VycmVudCA9ICcnO1xuICAgICAgbGV0IGluUXVvdGVzID0gZmFsc2U7XG5cbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaGVhZGVyTGluZS5sZW5ndGg7IGorKykge1xuICAgICAgICBjb25zdCBjaGFyID0gaGVhZGVyTGluZVtqXTtcblxuICAgICAgICBpZiAoY2hhciA9PT0gJ1wiJykge1xuICAgICAgICAgIGluUXVvdGVzID0gIWluUXVvdGVzO1xuICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT09ICcsJyAmJiAhaW5RdW90ZXMpIHtcbiAgICAgICAgICBoZWFkZXJzLnB1c2goY3VycmVudC50cmltKCkucmVwbGFjZSgvXlwiKC4qKVwiJC8sICckMScpKTtcbiAgICAgICAgICBjdXJyZW50ID0gJyc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3VycmVudCArPSBjaGFyO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBoZWFkZXJzLnB1c2goY3VycmVudC50cmltKCkucmVwbGFjZSgvXlwiKC4qKVwiJC8sICckMScpKTtcblxuICAgICAgY29uc3QgY29kZUluZGV4ID0gaGVhZGVycy5pbmRleE9mKCdjb2RlJyk7XG4gICAgICBjb25zdCBkZXNjcmlwdGlvbkluZGV4ID0gaGVhZGVycy5pbmRleE9mKCdkZXNjcmlwdGlvbicpO1xuICAgICAgY29uc3Qgc3ViamVjdEluZGV4ID0gaGVhZGVycy5pbmRleE9mKCdzdWJqZWN0Jyk7XG4gICAgICBjb25zdCBncmFkZUluZGV4ID0gaGVhZGVycy5pbmRleE9mKCdncmFkZScpO1xuICAgICAgY29uc3QgZG9tYWluSW5kZXggPSBoZWFkZXJzLmluZGV4T2YoJ2RvbWFpbicpO1xuXG4gICAgICBpZiAoY29kZUluZGV4ID09PSAtMSB8fCBkZXNjcmlwdGlvbkluZGV4ID09PSAtMSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NTViBtdXN0IGNvbnRhaW4gXCJjb2RlXCIgYW5kIFwiZGVzY3JpcHRpb25cIiBjb2x1bW5zJyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGV4cGVjdGF0aW9uczogQXJyYXk8e1xuICAgICAgICBjb2RlOiBzdHJpbmc7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgICAgIHN1YmplY3Q6IHN0cmluZztcbiAgICAgICAgZ3JhZGU6IG51bWJlcjtcbiAgICAgICAgc3RyYW5kPzogc3RyaW5nO1xuICAgICAgICBzdWJzdHJhbmQ/OiBzdHJpbmc7XG4gICAgICB9PiA9IFtdO1xuXG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXS50cmltKCk7XG4gICAgICAgIGlmICghbGluZSkgY29udGludWU7XG5cbiAgICAgICAgLy8gUGFyc2UgQ1NWIGxpbmUgaGFuZGxpbmcgcXVvdGVkIHZhbHVlcyBwcm9wZXJseVxuICAgICAgICBjb25zdCBjb2x1bW5zOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICBsZXQgY3VycmVudCA9ICcnO1xuICAgICAgICBsZXQgaW5RdW90ZXMgPSBmYWxzZTtcblxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxpbmUubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBjb25zdCBjaGFyID0gbGluZVtqXTtcblxuICAgICAgICAgIGlmIChjaGFyID09PSAnXCInKSB7XG4gICAgICAgICAgICBpblF1b3RlcyA9ICFpblF1b3RlcztcbiAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT09ICcsJyAmJiAhaW5RdW90ZXMpIHtcbiAgICAgICAgICAgIGNvbHVtbnMucHVzaChjdXJyZW50LnRyaW0oKS5yZXBsYWNlKC9eXCIoLiopXCIkLywgJyQxJykpO1xuICAgICAgICAgICAgY3VycmVudCA9ICcnO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjdXJyZW50ICs9IGNoYXI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRG9uJ3QgZm9yZ2V0IHRoZSBsYXN0IGNvbHVtblxuICAgICAgICBjb2x1bW5zLnB1c2goY3VycmVudC50cmltKCkucmVwbGFjZSgvXlwiKC4qKVwiJC8sICckMScpKTtcblxuICAgICAgICBpZiAoY29sdW1ucy5sZW5ndGggPCBNYXRoLm1heChjb2RlSW5kZXgsIGRlc2NyaXB0aW9uSW5kZXgpICsgMSkge1xuICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oeyBsaW5lTnVtYmVyOiBpICsgMSwgbGluZSB9LCAnU2tpcHBpbmcgaW52YWxpZCBDU1YgbGluZScpO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZXhwZWN0YXRpb24gPSB7XG4gICAgICAgICAgY29kZTogY29sdW1uc1tjb2RlSW5kZXhdLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBjb2x1bW5zW2Rlc2NyaXB0aW9uSW5kZXhdLFxuICAgICAgICAgIHN1YmplY3Q6IHN1YmplY3RJbmRleCA+PSAwID8gY29sdW1uc1tzdWJqZWN0SW5kZXhdIDogJ1Vua25vd24nLFxuICAgICAgICAgIGdyYWRlOiBncmFkZUluZGV4ID49IDAgPyBwYXJzZUludChjb2x1bW5zW2dyYWRlSW5kZXhdKSB8fCAwIDogMCxcbiAgICAgICAgICBzdHJhbmQ6IGRvbWFpbkluZGV4ID49IDAgPyBjb2x1bW5zW2RvbWFpbkluZGV4XSA6ICdHZW5lcmFsJyxcbiAgICAgICAgfTtcblxuICAgICAgICBleHBlY3RhdGlvbnMucHVzaChleHBlY3RhdGlvbik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBleHBlY3RhdGlvbnM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKHsgZXJyb3IgfSwgJ0ZhaWxlZCB0byBwYXJzZSBDU1YgY29udGVudCcpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDU1YgcGFyc2luZyBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdCBjdXJyaWN1bHVtIGV4cGVjdGF0aW9ucyBmcm9tIFBERiB1c2luZyBwZGYtcGFyc2UgYW5kIEFJXG4gICAqL1xuICBhc3luYyBwYXJzZVBERihmaWxlQnVmZmVyOiBCdWZmZXIpOiBQcm9taXNlPFxuICAgIEFycmF5PHtcbiAgICAgIGNvZGU6IHN0cmluZztcbiAgICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgICBzdWJqZWN0OiBzdHJpbmc7XG4gICAgICBncmFkZTogbnVtYmVyO1xuICAgICAgc3RyYW5kPzogc3RyaW5nO1xuICAgICAgc3Vic3RyYW5kPzogc3RyaW5nO1xuICAgIH0+XG4gID4ge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCdTdGFydGluZyBQREYgcGFyc2luZycpO1xuXG4gICAgICAvLyBMYXp5IGxvYWQgcGRmLXBhcnNlIHRvIGF2b2lkIGluaXRpYWxpemF0aW9uIGlzc3Vlc1xuICAgICAgaWYgKCFwZGYpIHtcbiAgICAgICAgcGRmID0gKGF3YWl0IGltcG9ydCgncGRmLXBhcnNlJykpLmRlZmF1bHQ7XG4gICAgICB9XG5cbiAgICAgIC8vIEV4dHJhY3QgdGV4dCBmcm9tIFBERlxuICAgICAgY29uc3QgcGRmRGF0YSA9IGF3YWl0IHBkZihmaWxlQnVmZmVyKTtcbiAgICAgIGNvbnN0IHRleHQgPSBwZGZEYXRhLnRleHQ7XG5cbiAgICAgIGlmICghdGV4dCB8fCB0ZXh0Lmxlbmd0aCA8IDEwMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BERiBhcHBlYXJzIHRvIGJlIGVtcHR5IG9yIHRvbyBzaG9ydCcpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKGBFeHRyYWN0ZWQgJHt0ZXh0Lmxlbmd0aH0gY2hhcmFjdGVycyBmcm9tIFBERmApO1xuXG4gICAgICAvLyBVc2UgQUkgdG8gcGFyc2UgdGhlIGN1cnJpY3VsdW0gdGV4dFxuICAgICAgY29uc3QgZXhwZWN0YXRpb25zID0gYXdhaXQgdGhpcy5wYXJzZVRleHRXaXRoQUkodGV4dCk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oYFBhcnNlZCAke2V4cGVjdGF0aW9ucy5sZW5ndGh9IGV4cGVjdGF0aW9ucyBmcm9tIFBERmApO1xuICAgICAgcmV0dXJuIGV4cGVjdGF0aW9ucztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoeyBlcnJvciB9LCAnRmFpbGVkIHRvIHBhcnNlIFBERicpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgUERGIHBhcnNpbmcgZmFpbGVkOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWAsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IGN1cnJpY3VsdW0gZXhwZWN0YXRpb25zIGZyb20gRE9DWCB1c2luZyBtYW1tb3RoIGFuZCBBSVxuICAgKi9cbiAgYXN5bmMgcGFyc2VET0NYKGZpbGVCdWZmZXI6IEJ1ZmZlcik6IFByb21pc2U8XG4gICAgQXJyYXk8e1xuICAgICAgY29kZTogc3RyaW5nO1xuICAgICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICAgIHN1YmplY3Q6IHN0cmluZztcbiAgICAgIGdyYWRlOiBudW1iZXI7XG4gICAgICBzdHJhbmQ/OiBzdHJpbmc7XG4gICAgICBzdWJzdHJhbmQ/OiBzdHJpbmc7XG4gICAgfT5cbiAgPiB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIERPQ1ggcGFyc2luZycpO1xuXG4gICAgICAvLyBFeHRyYWN0IHRleHQgZnJvbSBET0NYXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtYW1tb3RoLmV4dHJhY3RSYXdUZXh0KHsgYnVmZmVyOiBmaWxlQnVmZmVyIH0pO1xuICAgICAgY29uc3QgdGV4dCA9IHJlc3VsdC52YWx1ZTtcblxuICAgICAgaWYgKCF0ZXh0IHx8IHRleHQubGVuZ3RoIDwgMTAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRE9DWCBhcHBlYXJzIHRvIGJlIGVtcHR5IG9yIHRvbyBzaG9ydCcpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKGBFeHRyYWN0ZWQgJHt0ZXh0Lmxlbmd0aH0gY2hhcmFjdGVycyBmcm9tIERPQ1hgKTtcblxuICAgICAgLy8gVXNlIEFJIHRvIHBhcnNlIHRoZSBjdXJyaWN1bHVtIHRleHRcbiAgICAgIGNvbnN0IGV4cGVjdGF0aW9ucyA9IGF3YWl0IHRoaXMucGFyc2VUZXh0V2l0aEFJKHRleHQpO1xuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKGBQYXJzZWQgJHtleHBlY3RhdGlvbnMubGVuZ3RofSBleHBlY3RhdGlvbnMgZnJvbSBET0NYYCk7XG4gICAgICByZXR1cm4gZXhwZWN0YXRpb25zO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcih7IGVycm9yIH0sICdGYWlsZWQgdG8gcGFyc2UgRE9DWCcpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgRE9DWCBwYXJzaW5nIGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGltcG9ydCBwcm9ncmVzc1xuICAgKi9cbiAgYXN5bmMgZ2V0SW1wb3J0UHJvZ3Jlc3MoaW1wb3J0SWQ6IHN0cmluZyk6IFByb21pc2U8SW1wb3J0UHJvZ3Jlc3MgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGltcG9ydFJlY29yZCA9IGF3YWl0IHRoaXMucHJpc21hLmN1cnJpY3VsdW1JbXBvcnQuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBpbXBvcnRJZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghaW1wb3J0UmVjb3JkKSByZXR1cm4gbnVsbDtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaW1wb3J0SWQsXG4gICAgICAgIHN0YXR1czogaW1wb3J0UmVjb3JkLnN0YXR1cyxcbiAgICAgICAgdG90YWxPdXRjb21lczogaW1wb3J0UmVjb3JkLnRvdGFsT3V0Y29tZXMsXG4gICAgICAgIHByb2Nlc3NlZE91dGNvbWVzOiBpbXBvcnRSZWNvcmQucHJvY2Vzc2VkT3V0Y29tZXMsXG4gICAgICAgIGVycm9yczogKGltcG9ydFJlY29yZC5lcnJvckxvZyBhcyBzdHJpbmdbXSkgfHwgW10sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcih7IGVycm9yLCBpbXBvcnRJZCB9LCAnRmFpbGVkIHRvIGdldCBpbXBvcnQgcHJvZ3Jlc3MnKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYW5jZWwgYW4gaW1wb3J0IHNlc3Npb25cbiAgICovXG4gIGFzeW5jIGNhbmNlbEltcG9ydChpbXBvcnRJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlSW1wb3J0U3RhdHVzKGltcG9ydElkLCBJbXBvcnRTdGF0dXMuQ0FOQ0VMTEVEKTtcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oeyBpbXBvcnRJZCB9LCAnQ2FuY2VsbGVkIGN1cnJpY3VsdW0gaW1wb3J0Jyk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoeyBlcnJvciwgaW1wb3J0SWQgfSwgJ0ZhaWxlZCB0byBjYW5jZWwgaW1wb3J0Jyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBpbXBvcnQgaGlzdG9yeSBmb3IgYSB1c2VyXG4gICAqL1xuICBhc3luYyBnZXRJbXBvcnRIaXN0b3J5KHVzZXJJZDogbnVtYmVyLCBsaW1pdDogbnVtYmVyID0gMjApOiBQcm9taXNlPHVua25vd25bXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBpbXBvcnRzID0gYXdhaXQgdGhpcy5wcmlzbWEuY3VycmljdWx1bUltcG9ydC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZCB9LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgY2x1c3RlcnM6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgY2x1c3Rlck5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGNsdXN0ZXJUeXBlOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGN1cnJpY3VsdW1FeHBlY3RhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGltcG9ydHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKHsgZXJyb3IsIHVzZXJJZCB9LCAnRmFpbGVkIHRvIGdldCBpbXBvcnQgaGlzdG9yeScpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIC8vIFByaXZhdGUgaGVscGVyIG1ldGhvZHNcblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZUltcG9ydFN0YXR1cyhcbiAgICBpbXBvcnRJZDogc3RyaW5nLFxuICAgIHN0YXR1czogSW1wb3J0U3RhdHVzLFxuICAgIHRvdGFsT3V0Y29tZXM/OiBudW1iZXIsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHsgc3RhdHVzIH07XG4gICAgaWYgKHRvdGFsT3V0Y29tZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdXBkYXRlRGF0YS50b3RhbE91dGNvbWVzID0gdG90YWxPdXRjb21lcztcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogaW1wb3J0SWQgfSxcbiAgICAgIGRhdGE6IHVwZGF0ZURhdGEsXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZVByb2dyZXNzKGltcG9ydElkOiBzdHJpbmcsIHByb2Nlc3NlZE91dGNvbWVzOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogaW1wb3J0SWQgfSxcbiAgICAgIGRhdGE6IHsgcHJvY2Vzc2VkT3V0Y29tZXMgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2V0Q29tcGxldGlvblRpbWUoaW1wb3J0SWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMucHJpc21hLmN1cnJpY3VsdW1JbXBvcnQudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBpbXBvcnRJZCB9LFxuICAgICAgZGF0YTogeyBjb21wbGV0ZWRBdDogbmV3IERhdGUoKSB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBsb2dFcnJvcnMoaW1wb3J0SWQ6IHN0cmluZywgZXJyb3JzOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMucHJpc21hLmN1cnJpY3VsdW1JbXBvcnQudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBpbXBvcnRJZCB9LFxuICAgICAgZGF0YTogeyBlcnJvckxvZzogZXJyb3JzIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUGFyc2UgY3VycmljdWx1bSB0ZXh0IHVzaW5nIEFJIHRvIGV4dHJhY3QgZXhwZWN0YXRpb25zXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHBhcnNlVGV4dFdpdGhBSSh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPFxuICAgIEFycmF5PHtcbiAgICAgIGNvZGU6IHN0cmluZztcbiAgICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgICBkZXNjcmlwdGlvbkZyPzogc3RyaW5nO1xuICAgICAgc3ViamVjdDogc3RyaW5nO1xuICAgICAgZ3JhZGU6IG51bWJlcjtcbiAgICAgIHN0cmFuZD86IHN0cmluZztcbiAgICAgIHN0cmFuZEZyPzogc3RyaW5nO1xuICAgICAgc3Vic3RyYW5kPzogc3RyaW5nO1xuICAgICAgc3Vic3RyYW5kRnI/OiBzdHJpbmc7XG4gICAgfT5cbiAgPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIERldGVjdCBpZiBkb2N1bWVudCBpcyBpbiBGcmVuY2ggb3IgYmlsaW5ndWFsXG4gICAgICBjb25zdCBpc0ZyZW5jaCA9IHRoaXMuZGV0ZWN0TGFuZ3VhZ2UodGV4dCk7XG4gICAgICBjb25zdCBpc0JpbGluZ3VhbCA9IHRoaXMuZGV0ZWN0QmlsaW5ndWFsKHRleHQpO1xuICAgICAgXG4gICAgICAvLyBTcGxpdCB0ZXh0IGludG8gY2h1bmtzIGlmIGl0J3MgdG9vIGxvbmcgKEdQVC00IGhhcyB0b2tlbiBsaW1pdHMpXG4gICAgICBjb25zdCBjaHVua3MgPSB0aGlzLmNodW5rVGV4dCh0ZXh0LCAzMDAwKTsgLy8gfjc1MCB3b3JkcyBwZXIgY2h1bmtcbiAgICAgIGNvbnN0IGFsbEV4cGVjdGF0aW9uczogQXJyYXk8e1xuICAgICAgICBjb2RlOiBzdHJpbmc7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgICAgIGRlc2NyaXB0aW9uRnI/OiBzdHJpbmc7XG4gICAgICAgIHN1YmplY3Q6IHN0cmluZztcbiAgICAgICAgZ3JhZGU6IG51bWJlcjtcbiAgICAgICAgc3RyYW5kPzogc3RyaW5nO1xuICAgICAgICBzdHJhbmRGcj86IHN0cmluZztcbiAgICAgICAgc3Vic3RyYW5kPzogc3RyaW5nO1xuICAgICAgICBzdWJzdHJhbmRGcj86IHN0cmluZztcbiAgICAgIH0+ID0gW107XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2h1bmtzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oYFByb2Nlc3NpbmcgY2h1bmsgJHtpICsgMX0gb2YgJHtjaHVua3MubGVuZ3RofWApO1xuXG4gICAgICAgIGNvbnN0IGxhbmd1YWdlSW5mbyA9IGlzRnJlbmNoID8gJ0ZyZW5jaCcgOiBpc0JpbGluZ3VhbCA/ICdiaWxpbmd1YWwgKEVuZ2xpc2ggYW5kIEZyZW5jaCknIDogJ0VuZ2xpc2gnO1xuICAgICAgICBjb25zdCBwcm9tcHQgPSBgWW91IGFyZSBhbiBleHBlcnQgaW4gY3VycmljdWx1bSBkZXNpZ24gZm9yIGVsZW1lbnRhcnkgZWR1Y2F0aW9uLiBFeHRyYWN0IGN1cnJpY3VsdW0gZXhwZWN0YXRpb25zIGZyb20gdGhlIGZvbGxvd2luZyAke2xhbmd1YWdlSW5mb30gdGV4dC5cblxuUGxlYXNlIGV4dHJhY3QgYW5kIHJldHVybiBpbiBKU09OIGZvcm1hdDpcbi0gU3ViamVjdCBuYW1lXG4tIEdyYWRlIGxldmVsXG4tIEZvciBlYWNoIGV4cGVjdGF0aW9uOlxuICAtIENvZGUgKGUuZy4sIFwiQTEuMVwiLCBcIkIyLjNcIilcbiAgLSBUeXBlIChcIm92ZXJhbGxcIiBvciBcInNwZWNpZmljXCIpXG4gIC0gRGVzY3JpcHRpb24gKHRoZSBmdWxsIHRleHQgb2YgdGhlIGV4cGVjdGF0aW9uKVxuICAtIFN0cmFuZCAobWFqb3IgY2F0ZWdvcnkgbGlrZSBcIk9yYWwgQ29tbXVuaWNhdGlvblwiLCBcIlJlYWRpbmdcIiwgZXRjLilcbiAgLSBEb21haW4gKGlmIGFwcGxpY2FibGUpXG5cblJldHVybiBPTkxZIGEgSlNPTiBvYmplY3Qgd2l0aCB0aGlzIHN0cnVjdHVyZTpcbntcbiAgXCJzdWJqZWN0XCI6IFwiU3ViamVjdCBOYW1lXCIsXG4gIFwiZ3JhZGVcIjogMSxcbiAgXCJleHBlY3RhdGlvbnNcIjogW1xuICAgIHtcbiAgICAgIFwiY29kZVwiOiBcIkExLjFcIixcbiAgICAgIFwidHlwZVwiOiBcIm92ZXJhbGxcIixcbiAgICAgIFwiZGVzY3JpcHRpb25cIjogXCJGdWxsIGV4cGVjdGF0aW9uIHRleHRcIixcbiAgICAgIFwic3RyYW5kXCI6IFwiU3RyYW5kIE5hbWVcIixcbiAgICAgIFwiZG9tYWluXCI6IFwiRG9tYWluIE5hbWUgKG9wdGlvbmFsKVwiXG4gICAgfVxuICBdXG59XG5cbk9ubHkgaW5jbHVkZSBkYXRhIHlvdSBhcmUgY29uZmlkZW50IGFib3V0LiBEbyBub3QgaW52ZW50IG9yIGhhbGx1Y2luYXRlIGV4cGVjdGF0aW9ucy5cblxuVGV4dCB0byBwYXJzZTpcblwiXCJcIlxuJHtjaHVua3NbaV19XG5cIlwiXCJgO1xuXG4gICAgICAgIGlmICghdGhpcy5vcGVuYWkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ09wZW5BSSBBUEkga2V5IG5vdCBjb25maWd1cmVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMub3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgICAgICBtb2RlbDogJ2dwdC00JyxcbiAgICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICByb2xlOiAnc3lzdGVtJyxcbiAgICAgICAgICAgICAgY29udGVudDpcbiAgICAgICAgICAgICAgICAnWW91IGFyZSBhbiBleHBlcnQgY3VycmljdWx1bSBhbmFseXN0LiBFeHRyYWN0IGN1cnJpY3VsdW0gZXhwZWN0YXRpb25zIGFjY3VyYXRlbHkuJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHJvbGU6ICd1c2VyJywgY29udGVudDogcHJvbXB0IH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICB0ZW1wZXJhdHVyZTogMC4xLCAvLyBMb3cgdGVtcGVyYXR1cmUgZm9yIGFjY3VyYWN5XG4gICAgICAgICAgbWF4X3Rva2VuczogMjAwMCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY29udGVudCA9IHJlc3BvbnNlLmNob2ljZXNbMF0/Lm1lc3NhZ2U/LmNvbnRlbnQ7XG4gICAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oYE5vIGNvbnRlbnQgcmV0dXJuZWQgZm9yIGNodW5rICR7aSArIDF9YCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoY29udGVudCk7XG4gICAgICAgICAgaWYgKHBhcnNlZC5leHBlY3RhdGlvbnMgJiYgQXJyYXkuaXNBcnJheShwYXJzZWQuZXhwZWN0YXRpb25zKSkge1xuICAgICAgICAgICAgY29uc3QgZXhwZWN0YXRpb25zID0gcGFyc2VkLmV4cGVjdGF0aW9ucy5tYXAoKGV4cDogYW55KSA9PiAoe1xuICAgICAgICAgICAgICBjb2RlOiBleHAuY29kZSB8fCBgQVVUT18ke2l9XyR7YWxsRXhwZWN0YXRpb25zLmxlbmd0aH1gLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZXhwLmRlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbkZyOiBleHAuZGVzY3JpcHRpb25GcixcbiAgICAgICAgICAgICAgc3ViamVjdDogcGFyc2VkLnN1YmplY3QgfHwgJ1Vua25vd24nLFxuICAgICAgICAgICAgICBncmFkZTogcGFyc2VkLmdyYWRlIHx8IDEsXG4gICAgICAgICAgICAgIHN0cmFuZDogZXhwLnN0cmFuZCB8fCBleHAuZG9tYWluIHx8ICdHZW5lcmFsJyxcbiAgICAgICAgICAgICAgc3RyYW5kRnI6IGV4cC5zdHJhbmRGcixcbiAgICAgICAgICAgICAgc3Vic3RyYW5kOiBleHAuc3Vic3RyYW5kLFxuICAgICAgICAgICAgICBzdWJzdHJhbmRGcjogZXhwLnN1YnN0cmFuZEZyLFxuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICBhbGxFeHBlY3RhdGlvbnMucHVzaCguLi5leHBlY3RhdGlvbnMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKHsgcGFyc2VFcnJvciwgY2h1bms6IGkgfSwgJ0ZhaWxlZCB0byBwYXJzZSBBSSByZXNwb25zZScpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhbGxFeHBlY3RhdGlvbnM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKHsgZXJyb3IgfSwgJ0ZhaWxlZCB0byBwYXJzZSB0ZXh0IHdpdGggQUknKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQUkgcGFyc2luZyBmYWlsZWQnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGV0ZWN0IGlmIHRleHQgaXMgcHJpbWFyaWx5IGluIEZyZW5jaFxuICAgKi9cbiAgcHJpdmF0ZSBkZXRlY3RMYW5ndWFnZSh0ZXh0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCBmcmVuY2hJbmRpY2F0b3JzID0gW1xuICAgICAgJ2F0dGVudGVzJywgJ2RvbWFpbmUnLCAnYW5uw6llJywgJ8OpbMOodmUnLCAnYXBwcmVudGlzc2FnZScsXG4gICAgICAnZnJhbsOnYWlzJywgJ21hdGjDqW1hdGlxdWVzJywgJ3NjaWVuY2VzJywgJ8OpdHVkZXMgc29jaWFsZXMnLFxuICAgICAgJ2NvbnRlbnVzIGRcXCdhcHByZW50aXNzYWdlJywgJ3Bpc3RlcyBkZSByw6lmbGV4aW9uJ1xuICAgIF07XG4gICAgXG4gICAgY29uc3QgdGV4dExvd2VyID0gdGV4dC50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGZyZW5jaENvdW50ID0gZnJlbmNoSW5kaWNhdG9ycy5maWx0ZXIoaW5kaWNhdG9yID0+IFxuICAgICAgdGV4dExvd2VyLmluY2x1ZGVzKGluZGljYXRvcilcbiAgICApLmxlbmd0aDtcbiAgICBcbiAgICByZXR1cm4gZnJlbmNoQ291bnQgPj0gMztcbiAgfVxuICBcbiAgLyoqXG4gICAqIERldGVjdCBpZiB0ZXh0IGNvbnRhaW5zIGJvdGggRW5nbGlzaCBhbmQgRnJlbmNoXG4gICAqL1xuICBwcml2YXRlIGRldGVjdEJpbGluZ3VhbCh0ZXh0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCBlbmdsaXNoSW5kaWNhdG9ycyA9IFsnZXhwZWN0YXRpb25zJywgJ3N0cmFuZCcsICdncmFkZScsICdzdHVkZW50JywgJ2xlYXJuaW5nJ107XG4gICAgY29uc3QgZnJlbmNoSW5kaWNhdG9ycyA9IFsnYXR0ZW50ZXMnLCAnZG9tYWluZScsICdhbm7DqWUnLCAnw6lsw6h2ZScsICdhcHByZW50aXNzYWdlJ107XG4gICAgXG4gICAgY29uc3QgdGV4dExvd2VyID0gdGV4dC50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGhhc0VuZ2xpc2ggPSBlbmdsaXNoSW5kaWNhdG9ycy5zb21lKGluZGljYXRvciA9PiB0ZXh0TG93ZXIuaW5jbHVkZXMoaW5kaWNhdG9yKSk7XG4gICAgY29uc3QgaGFzRnJlbmNoID0gZnJlbmNoSW5kaWNhdG9ycy5zb21lKGluZGljYXRvciA9PiB0ZXh0TG93ZXIuaW5jbHVkZXMoaW5kaWNhdG9yKSk7XG4gICAgXG4gICAgcmV0dXJuIGhhc0VuZ2xpc2ggJiYgaGFzRnJlbmNoO1xuICB9XG5cbiAgLyoqXG4gICAqIFNwbGl0IHRleHQgaW50byBtYW5hZ2VhYmxlIGNodW5rcyBmb3IgQUkgcHJvY2Vzc2luZ1xuICAgKi9cbiAgcHJpdmF0ZSBjaHVua1RleHQodGV4dDogc3RyaW5nLCBtYXhDaGFyc1BlckNodW5rOiBudW1iZXIpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgY2h1bmtzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHBhcmFncmFwaHMgPSB0ZXh0LnNwbGl0KC9cXG5cXG4rLyk7XG4gICAgbGV0IGN1cnJlbnRDaHVuayA9ICcnO1xuXG4gICAgZm9yIChjb25zdCBwYXJhZ3JhcGggb2YgcGFyYWdyYXBocykge1xuICAgICAgaWYgKGN1cnJlbnRDaHVuay5sZW5ndGggKyBwYXJhZ3JhcGgubGVuZ3RoID4gbWF4Q2hhcnNQZXJDaHVuayAmJiBjdXJyZW50Q2h1bmsubGVuZ3RoID4gMCkge1xuICAgICAgICBjaHVua3MucHVzaChjdXJyZW50Q2h1bmsudHJpbSgpKTtcbiAgICAgICAgY3VycmVudENodW5rID0gcGFyYWdyYXBoO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVudENodW5rICs9IChjdXJyZW50Q2h1bmsgPyAnXFxuXFxuJyA6ICcnKSArIHBhcmFncmFwaDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY3VycmVudENodW5rLnRyaW0oKSkge1xuICAgICAgY2h1bmtzLnB1c2goY3VycmVudENodW5rLnRyaW0oKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNodW5rcztcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmUgaWYgYW4gZXhwZWN0YXRpb24gaXMgb3ZlcmFsbCBvciBzcGVjaWZpYyBiYXNlZCBvbiBjb2RlIHBhdHRlcm5cbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lRXhwZWN0YXRpb25UeXBlKGNvZGU6IHN0cmluZywgZGVzY3JpcHRpb246IHN0cmluZyk6ICdvdmVyYWxsJyB8ICdzcGVjaWZpYycge1xuICAgIC8vIENvbW1vbiBwYXR0ZXJucyBmb3Igb3ZlcmFsbCBleHBlY3RhdGlvbnM6XG4gICAgLy8gLSBTaW5nbGUgbGV0dGVyIG9yIG51bWJlciAoZS5nLiwgXCJBXCIsIFwiMVwiKVxuICAgIC8vIC0gRW5kcyB3aXRoIC4wIChlLmcuLCBcIkExLjBcIilcbiAgICAvLyAtIENvbnRhaW5zIFwib3ZlcmFsbFwiIGluIGRlc2NyaXB0aW9uXG5cbiAgICBpZiAoY29kZS5sZW5ndGggPT09IDEpIHJldHVybiAnb3ZlcmFsbCc7XG4gICAgaWYgKGNvZGUuZW5kc1dpdGgoJy4wJykpIHJldHVybiAnb3ZlcmFsbCc7XG4gICAgaWYgKGRlc2NyaXB0aW9uLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ292ZXJhbGwnKSkgcmV0dXJuICdvdmVyYWxsJztcbiAgICBpZiAoY29kZS5tYXRjaCgvXltBLVpdXFxkKiQvKSkgcmV0dXJuICdvdmVyYWxsJzsgLy8gZS5nLiwgXCJBMVwiLCBcIkIyXCJcblxuICAgIC8vIEV2ZXJ5dGhpbmcgZWxzZSBpcyBzcGVjaWZpY1xuICAgIHJldHVybiAnc3BlY2lmaWMnO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIHVwbG9hZGVkIGZpbGUgY29udGVudCBmb3IgcGFyc2luZ1xuICAgKi9cbiAgYXN5bmMgc3RvcmVVcGxvYWRlZEZpbGUoaW1wb3J0SWQ6IHN0cmluZywgZmlsZTogRXhwcmVzcy5NdWx0ZXIuRmlsZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBTdG9yZSBmaWxlIG1ldGFkYXRhIGFuZCBjb250ZW50XG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBpbXBvcnRJZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc291cmNlRmlsZTogZmlsZS5vcmlnaW5hbG5hbWUsXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlLm9yaWdpbmFsbmFtZSxcbiAgICAgICAgICAgIG1pbWV0eXBlOiBmaWxlLm1pbWV0eXBlLFxuICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAgdXBsb2FkZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gU3RvcmUgZmlsZSBjb250ZW50IGFzIGJhc2U2NCBmb3Igbm93IChpbiBwcm9kdWN0aW9uLCB3b3VsZCB1c2UgY2xvdWQgc3RvcmFnZSlcbiAgICAgICAgICByYXdUZXh0OiBmaWxlLmJ1ZmZlci50b1N0cmluZygnYmFzZTY0JyksXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgRmlsZSBzdG9yZWQgZm9yIGltcG9ydCAke2ltcG9ydElkfTogJHtmaWxlLm9yaWdpbmFsbmFtZX1gKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoeyBlcnJvciwgaW1wb3J0SWQgfSwgJ0ZhaWxlZCB0byBzdG9yZSB1cGxvYWRlZCBmaWxlJyk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUGFyc2UgdXBsb2FkZWQgZmlsZSBhbmQgZXh0cmFjdCBjdXJyaWN1bHVtIGV4cGVjdGF0aW9uc1xuICAgKi9cbiAgYXN5bmMgcGFyc2VVcGxvYWRlZEZpbGUoXG4gICAgaW1wb3J0SWQ6IHN0cmluZyxcbiAgICBfb3B0aW9uczogeyB1c2VBST86IGJvb2xlYW4gfSA9IHt9LFxuICApOiBQcm9taXNlPHtcbiAgICBzdWJqZWN0czogQXJyYXk8e1xuICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgZXhwZWN0YXRpb25zOiBBcnJheTx7XG4gICAgICAgIGNvZGU6IHN0cmluZztcbiAgICAgICAgdHlwZTogJ292ZXJhbGwnIHwgJ3NwZWNpZmljJztcbiAgICAgICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICAgICAgc3RyYW5kOiBzdHJpbmc7XG4gICAgICAgIHN1YnN0cmFuZD86IHN0cmluZztcbiAgICAgICAgc3ViamVjdDogc3RyaW5nO1xuICAgICAgICBncmFkZTogbnVtYmVyO1xuICAgICAgfT47XG4gICAgfT47XG4gICAgZXJyb3JzPzogc3RyaW5nW107XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaW1wb3J0UmVjb3JkID0gYXdhaXQgdGhpcy5wcmlzbWEuY3VycmljdWx1bUltcG9ydC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGltcG9ydElkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFpbXBvcnRSZWNvcmQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbXBvcnQgc2Vzc2lvbiBub3QgZm91bmQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpbXBvcnRSZWNvcmQucmF3VGV4dCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGZpbGUgY29udGVudCBmb3VuZCBmb3IgcGFyc2luZycpO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgc3RhdHVzIHRvIHByb2Nlc3NpbmdcbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlSW1wb3J0U3RhdHVzKGltcG9ydElkLCBJbXBvcnRTdGF0dXMuUFJPQ0VTU0lORyk7XG5cbiAgICAgIC8vIERlY29kZSB0aGUgZmlsZSBjb250ZW50IGZyb20gYmFzZTY0XG4gICAgICBjb25zdCBmaWxlQnVmZmVyID0gQnVmZmVyLmZyb20oaW1wb3J0UmVjb3JkLnJhd1RleHQsICdiYXNlNjQnKTtcblxuICAgICAgLy8gUGFyc2UgYmFzZWQgb24gZmlsZSBmb3JtYXRcbiAgICAgIGxldCBleHBlY3RhdGlvbnM6IEFycmF5PHtcbiAgICAgICAgY29kZTogc3RyaW5nO1xuICAgICAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgICAgICBzdWJqZWN0OiBzdHJpbmc7XG4gICAgICAgIGdyYWRlOiBudW1iZXI7XG4gICAgICAgIHN0cmFuZD86IHN0cmluZztcbiAgICAgICAgc3Vic3RyYW5kPzogc3RyaW5nO1xuICAgICAgfT4gPSBbXTtcblxuICAgICAgaWYgKGltcG9ydFJlY29yZC5zb3VyY2VGb3JtYXQgPT09ICdwZGYnKSB7XG4gICAgICAgIGV4cGVjdGF0aW9ucyA9IGF3YWl0IHRoaXMucGFyc2VQREYoZmlsZUJ1ZmZlcik7XG4gICAgICB9IGVsc2UgaWYgKGltcG9ydFJlY29yZC5zb3VyY2VGb3JtYXQgPT09ICdkb2N4Jykge1xuICAgICAgICBleHBlY3RhdGlvbnMgPSBhd2FpdCB0aGlzLnBhcnNlRE9DWChmaWxlQnVmZmVyKTtcbiAgICAgIH0gZWxzZSBpZiAoaW1wb3J0UmVjb3JkLnNvdXJjZUZvcm1hdCA9PT0gJ2NzdicpIHtcbiAgICAgICAgLy8gQ29udmVydCBidWZmZXIgdG8gc3RyaW5nIGZvciBDU1ZcbiAgICAgICAgY29uc3QgY3N2Q29udGVudCA9IGZpbGVCdWZmZXIudG9TdHJpbmcoJ3V0Zi04Jyk7XG4gICAgICAgIGV4cGVjdGF0aW9ucyA9IHRoaXMucGFyc2VDU1YoY3N2Q29udGVudCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIGZpbGUgZm9ybWF0OiAke2ltcG9ydFJlY29yZC5zb3VyY2VGb3JtYXR9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdyb3VwIGV4cGVjdGF0aW9ucyBieSBzdWJqZWN0XG4gICAgICBjb25zdCBzdWJqZWN0TWFwID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcblxuICAgICAgZm9yIChjb25zdCBleHBlY3RhdGlvbiBvZiBleHBlY3RhdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgc3ViamVjdE5hbWUgPSBleHBlY3RhdGlvbi5zdWJqZWN0IHx8ICdVbmtub3duJztcblxuICAgICAgICBpZiAoIXN1YmplY3RNYXAuaGFzKHN1YmplY3ROYW1lKSkge1xuICAgICAgICAgIHN1YmplY3RNYXAuc2V0KHN1YmplY3ROYW1lLCB7XG4gICAgICAgICAgICBuYW1lOiBzdWJqZWN0TmFtZSxcbiAgICAgICAgICAgIGV4cGVjdGF0aW9uczogW10sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdWJqZWN0ID0gc3ViamVjdE1hcC5nZXQoc3ViamVjdE5hbWUpO1xuICAgICAgICBzdWJqZWN0LmV4cGVjdGF0aW9ucy5wdXNoKHtcbiAgICAgICAgICBjb2RlOiBleHBlY3RhdGlvbi5jb2RlLFxuICAgICAgICAgIHR5cGU6IHRoaXMuZGV0ZXJtaW5lRXhwZWN0YXRpb25UeXBlKGV4cGVjdGF0aW9uLmNvZGUsIGV4cGVjdGF0aW9uLmRlc2NyaXB0aW9uKSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogZXhwZWN0YXRpb24uZGVzY3JpcHRpb24sXG4gICAgICAgICAgc3RyYW5kOiBleHBlY3RhdGlvbi5zdHJhbmQgfHwgJ0dlbmVyYWwnLFxuICAgICAgICAgIHN1YnN0cmFuZDogZXhwZWN0YXRpb24uc3Vic3RyYW5kLFxuICAgICAgICAgIHN1YmplY3Q6IHN1YmplY3ROYW1lLFxuICAgICAgICAgIGdyYWRlOiBleHBlY3RhdGlvbi5ncmFkZSB8fCBpbXBvcnRSZWNvcmQuZ3JhZGUsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzdWJqZWN0cyA9IEFycmF5LmZyb20oc3ViamVjdE1hcC52YWx1ZXMoKSk7XG5cbiAgICAgIC8vIFN0b3JlIHBhcnNlZCBzdWJqZWN0cyBpbiBtZXRhZGF0YSBmb3IgbGF0ZXIgdXNlXG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBpbXBvcnRJZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIC4uLigoaW1wb3J0UmVjb3JkLm1ldGFkYXRhIGFzIGFueSkgfHwge30pLFxuICAgICAgICAgICAgcGFyc2VkU3ViamVjdHM6IHN1YmplY3RzLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gVXBkYXRlIHN0YXR1cyB0byByZWFkeSBmb3IgcmV2aWV3XG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZUltcG9ydFN0YXR1cyhpbXBvcnRJZCwgSW1wb3J0U3RhdHVzLlJFQURZX0ZPUl9SRVZJRVcpO1xuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKGBGaWxlIHBhcnNlZCBmb3IgaW1wb3J0ICR7aW1wb3J0SWR9OiAke3N1YmplY3RzLmxlbmd0aH0gc3ViamVjdHNgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3ViamVjdHM6IHN1YmplY3RzLFxuICAgICAgICBlcnJvcnM6IFtdLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoeyBlcnJvciwgaW1wb3J0SWQgfSwgJ0ZhaWxlZCB0byBwYXJzZSB1cGxvYWRlZCBmaWxlJyk7XG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZUltcG9ydFN0YXR1cyhpbXBvcnRJZCwgSW1wb3J0U3RhdHVzLkZBSUxFRCk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBwcmVzZXQgY3VycmljdWx1bSBkYXRhXG4gICAqL1xuICBhc3luYyBsb2FkUHJlc2V0Q3VycmljdWx1bShcbiAgICB1c2VySWQ6IG51bWJlcixcbiAgICBwcmVzZXRJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPHtcbiAgICBzZXNzaW9uSWQ6IHN0cmluZztcbiAgICBzdWJqZWN0czogQXJyYXk8e1xuICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgZXhwZWN0YXRpb25zOiBBcnJheTx7XG4gICAgICAgIGNvZGU6IHN0cmluZztcbiAgICAgICAgdHlwZTogJ292ZXJhbGwnIHwgJ3NwZWNpZmljJztcbiAgICAgICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICAgICAgc3RyYW5kOiBzdHJpbmc7XG4gICAgICAgIHN1YnN0cmFuZD86IHN0cmluZztcbiAgICAgICAgc3ViamVjdDogc3RyaW5nO1xuICAgICAgICBncmFkZTogbnVtYmVyO1xuICAgICAgfT47XG4gICAgfT47XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ3JlYXRlIG5ldyBpbXBvcnQgc2Vzc2lvbiBmb3IgcHJlc2V0XG4gICAgICBjb25zdCBzZXNzaW9uSWQgPSBhd2FpdCB0aGlzLnN0YXJ0SW1wb3J0KFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIDEsIC8vIERlZmF1bHQgZ3JhZGUgZm9yIHByZXNldHNcbiAgICAgICAgJ011bHRpLVN1YmplY3QnLFxuICAgICAgICAnbWFudWFsJyxcbiAgICAgICAgYFByZXNldDogJHtwcmVzZXRJZH1gLFxuICAgICAgKTtcblxuICAgICAgLy8gTW9jayBwcmVzZXQgZGF0YSBiYXNlZCBvbiBwcmVzZXRJZFxuICAgICAgbGV0IHN1YmplY3RzOiBBcnJheTx7XG4gICAgICAgIG5hbWU6IHN0cmluZztcbiAgICAgICAgZXhwZWN0YXRpb25zOiBBcnJheTx7XG4gICAgICAgICAgY29kZTogc3RyaW5nO1xuICAgICAgICAgIHR5cGU6ICdvdmVyYWxsJyB8ICdzcGVjaWZpYyc7XG4gICAgICAgICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICAgICAgICBzdHJhbmQ6IHN0cmluZztcbiAgICAgICAgICBzdWJzdHJhbmQ/OiBzdHJpbmc7XG4gICAgICAgICAgc3ViamVjdDogc3RyaW5nO1xuICAgICAgICAgIGdyYWRlOiBudW1iZXI7XG4gICAgICAgIH0+O1xuICAgICAgfT4gPSBbXTtcblxuICAgICAgc3dpdGNoIChwcmVzZXRJZCkge1xuICAgICAgICBjYXNlICdwZWktZ3JhZGUxLWZyZW5jaCc6XG4gICAgICAgICAgc3ViamVjdHMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdGcmFuw6dhaXMgTGFuZ3VlIFByZW1pw6hyZScsXG4gICAgICAgICAgICAgIGV4cGVjdGF0aW9uczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGNvZGU6ICdDTzEnLFxuICAgICAgICAgICAgICAgICAgdHlwZTogJ292ZXJhbGwnLFxuICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdDb21wcmVuZHJlIGRlcyBtZXNzYWdlcyBvcmF1eCBlbiBmcmFuw6dhaXMnLFxuICAgICAgICAgICAgICAgICAgc3RyYW5kOiAnQ29tbXVuaWNhdGlvbiBvcmFsZScsXG4gICAgICAgICAgICAgICAgICBzdWJqZWN0OiAnRnJhbsOnYWlzIExhbmd1ZSBQcmVtacOocmUnLFxuICAgICAgICAgICAgICAgICAgZ3JhZGU6IDEsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBjb2RlOiAnQ08xLjEnLFxuICAgICAgICAgICAgICAgICAgdHlwZTogJ3NwZWNpZmljJyxcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnU3VpdnJlIGRlcyBpbnN0cnVjdGlvbnMgb3JhbGVzIHNpbXBsZXMnLFxuICAgICAgICAgICAgICAgICAgc3RyYW5kOiAnQ29tbXVuaWNhdGlvbiBvcmFsZScsXG4gICAgICAgICAgICAgICAgICBzdWJzdHJhbmQ6ICfDiWNvdXRlJyxcbiAgICAgICAgICAgICAgICAgIHN1YmplY3Q6ICdGcmFuw6dhaXMgTGFuZ3VlIFByZW1pw6hyZScsXG4gICAgICAgICAgICAgICAgICBncmFkZTogMSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbmFtZTogJ01hdGjDqW1hdGlxdWVzJyxcbiAgICAgICAgICAgICAgZXhwZWN0YXRpb25zOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgY29kZTogJ04xJyxcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdvdmVyYWxsJyxcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ29tcHJlbmRyZSBsZXMgbm9tYnJlcyBkZSAwIMOgIDIwJyxcbiAgICAgICAgICAgICAgICAgIHN0cmFuZDogJ05vbWJyZScsXG4gICAgICAgICAgICAgICAgICBzdWJqZWN0OiAnTWF0aMOpbWF0aXF1ZXMnLFxuICAgICAgICAgICAgICAgICAgZ3JhZGU6IDEsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdvbnRhcmlvLWdyYWRlMS1lbmdsaXNoJzpcbiAgICAgICAgICBzdWJqZWN0cyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbmFtZTogJ0xhbmd1YWdlJyxcbiAgICAgICAgICAgICAgZXhwZWN0YXRpb25zOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgY29kZTogJzEuTzEnLFxuICAgICAgICAgICAgICAgICAgdHlwZTogJ292ZXJhbGwnLFxuICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdMaXN0ZW4gaW4gb3JkZXIgdG8gdW5kZXJzdGFuZCBhbmQgcmVzcG9uZCBhcHByb3ByaWF0ZWx5JyxcbiAgICAgICAgICAgICAgICAgIHN0cmFuZDogJ09yYWwgQ29tbXVuaWNhdGlvbicsXG4gICAgICAgICAgICAgICAgICBzdWJqZWN0OiAnTGFuZ3VhZ2UnLFxuICAgICAgICAgICAgICAgICAgZ3JhZGU6IDEsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdNYXRoZW1hdGljcycsXG4gICAgICAgICAgICAgIGV4cGVjdGF0aW9uczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGNvZGU6ICcxLk4xJyxcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdvdmVyYWxsJyxcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ291bnQgdG8gNTAgYW5kIHJlcHJlc2VudCBudW1iZXJzIHRvIDIwJyxcbiAgICAgICAgICAgICAgICAgIHN0cmFuZDogJ051bWJlciBTZW5zZSBhbmQgTnVtZXJhdGlvbicsXG4gICAgICAgICAgICAgICAgICBzdWJqZWN0OiAnTWF0aGVtYXRpY3MnLFxuICAgICAgICAgICAgICAgICAgZ3JhZGU6IDEsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdiYy1ncmFkZTEtY29yZSc6XG4gICAgICAgICAgc3ViamVjdHMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdFbmdsaXNoIExhbmd1YWdlIEFydHMnLFxuICAgICAgICAgICAgICBleHBlY3RhdGlvbnM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBjb2RlOiAnRUxBMS1PMScsXG4gICAgICAgICAgICAgICAgICB0eXBlOiAnb3ZlcmFsbCcsXG4gICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1VzZSBzcGVha2luZyBhbmQgbGlzdGVuaW5nIHRvIGludGVyYWN0IHdpdGggb3RoZXJzJyxcbiAgICAgICAgICAgICAgICAgIHN0cmFuZDogJ09yYWwgTGFuZ3VhZ2UnLFxuICAgICAgICAgICAgICAgICAgc3ViamVjdDogJ0VuZ2xpc2ggTGFuZ3VhZ2UgQXJ0cycsXG4gICAgICAgICAgICAgICAgICBncmFkZTogMSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHByZXNldDogJHtwcmVzZXRJZH1gKTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RvcmUgcGFyc2VkIHN1YmplY3RzIGluIG1ldGFkYXRhIGZvciBsYXRlciB1c2VcbiAgICAgIGF3YWl0IHRoaXMucHJpc21hLmN1cnJpY3VsdW1JbXBvcnQudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHNlc3Npb25JZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIHByZXNldElkLFxuICAgICAgICAgICAgcGFyc2VkU3ViamVjdHM6IHN1YmplY3RzLFxuICAgICAgICAgICAgbG9hZGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFVwZGF0ZSBpbXBvcnQgc3RhdHVzXG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZUltcG9ydFN0YXR1cyhzZXNzaW9uSWQsICdSRUFEWV9GT1JfUkVWSUVXJyk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oYFByZXNldCBjdXJyaWN1bHVtIGxvYWRlZDogJHtwcmVzZXRJZH0gZm9yIHVzZXIgJHt1c2VySWR9YCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgc3ViamVjdHMsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcih7IGVycm9yLCBwcmVzZXRJZCwgdXNlcklkIH0sICdGYWlsZWQgdG8gbG9hZCBwcmVzZXQgY3VycmljdWx1bScpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZpbmFsaXplIGltcG9ydCBhbmQgY3JlYXRlIGFjdHVhbCBjdXJyaWN1bHVtIGV4cGVjdGF0aW9ucyBpbiB0aGUgRVRGTyBzeXN0ZW1cbiAgICovXG4gIGFzeW5jIGZpbmFsaXplSW1wb3J0KFxuICAgIGltcG9ydElkOiBzdHJpbmcsXG4gICAgX3VzZXJJZDogbnVtYmVyLFxuICApOiBQcm9taXNlPHtcbiAgICB0b3RhbEV4cGVjdGF0aW9uczogbnVtYmVyO1xuICAgIHN1YmplY3RzOiBzdHJpbmdbXTtcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBpbXBvcnRSZWNvcmQgPSBhd2FpdCB0aGlzLnByaXNtYS5jdXJyaWN1bHVtSW1wb3J0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogaW1wb3J0SWQgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGN1cnJpY3VsdW1FeHBlY3RhdGlvbnM6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFpbXBvcnRSZWNvcmQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbXBvcnQgc2Vzc2lvbiBub3QgZm91bmQnKTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHRoZSBwYXJzZWQgc3ViamVjdHMgZnJvbSB0aGUgaW1wb3J0IG1ldGFkYXRhXG4gICAgICBjb25zdCBwYXJzZWRTdWJqZWN0cyA9IChpbXBvcnRSZWNvcmQubWV0YWRhdGEgYXMgYW55KT8ucGFyc2VkU3ViamVjdHMgfHwgW107XG5cbiAgICAgIGxldCB0b3RhbEV4cGVjdGF0aW9ucyA9IDA7XG4gICAgICBjb25zdCBzdWJqZWN0czogc3RyaW5nW10gPSBbXTtcblxuICAgICAgLy8gQ3JlYXRlIGN1cnJpY3VsdW0gZXhwZWN0YXRpb25zIGZvciBlYWNoIHN1YmplY3RcbiAgICAgIGZvciAoY29uc3Qgc3ViamVjdCBvZiBwYXJzZWRTdWJqZWN0cykge1xuICAgICAgICBzdWJqZWN0cy5wdXNoKHN1YmplY3QubmFtZSk7XG5cbiAgICAgICAgZm9yIChjb25zdCBleHBlY3RhdGlvbiBvZiBzdWJqZWN0LmV4cGVjdGF0aW9ucykge1xuICAgICAgICAgIGF3YWl0IHRoaXMucHJpc21hLmN1cnJpY3VsdW1FeHBlY3RhdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBjb2RlOiBleHBlY3RhdGlvbi5jb2RlLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZXhwZWN0YXRpb24uZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgIHN0cmFuZDogZXhwZWN0YXRpb24uc3RyYW5kLFxuICAgICAgICAgICAgICBzdWJzdHJhbmQ6IGV4cGVjdGF0aW9uLnN1YnN0cmFuZCxcbiAgICAgICAgICAgICAgZ3JhZGU6IGV4cGVjdGF0aW9uLmdyYWRlLFxuICAgICAgICAgICAgICBzdWJqZWN0OiBleHBlY3RhdGlvbi5zdWJqZWN0LFxuICAgICAgICAgICAgICBpbXBvcnRJZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdG90YWxFeHBlY3RhdGlvbnMrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgaW1wb3J0IHN0YXR1cyB0byBjb21wbGV0ZWRcbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlSW1wb3J0U3RhdHVzKGltcG9ydElkLCAnQ09NUExFVEVEJyk7XG4gICAgICBhd2FpdCB0aGlzLnNldENvbXBsZXRpb25UaW1lKGltcG9ydElkKTtcblxuICAgICAgLy8gU3RvcmUgZmluYWwgcmVzdWx0cyBpbiBtZXRhZGF0YVxuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuY3VycmljdWx1bUltcG9ydC51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZDogaW1wb3J0SWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAuLi4oKGltcG9ydFJlY29yZC5tZXRhZGF0YSBhcyBhbnkpIHx8IHt9KSxcbiAgICAgICAgICAgIGZpbmFsUmVzdWx0czoge1xuICAgICAgICAgICAgICB0b3RhbEV4cGVjdGF0aW9ucyxcbiAgICAgICAgICAgICAgc3ViamVjdHMsXG4gICAgICAgICAgICAgIGNvbXBsZXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgSW1wb3J0IGZpbmFsaXplZDogJHtpbXBvcnRJZH0sIGNyZWF0ZWQgJHt0b3RhbEV4cGVjdGF0aW9uc30gZXhwZWN0YXRpb25zYCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvdGFsRXhwZWN0YXRpb25zLFxuICAgICAgICBzdWJqZWN0cyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKHsgZXJyb3IsIGltcG9ydElkIH0sICdGYWlsZWQgdG8gZmluYWxpemUgaW1wb3J0Jyk7XG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZUltcG9ydFN0YXR1cyhpbXBvcnRJZCwgJ0ZBSUxFRCcpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBjdXJyaWN1bHVtSW1wb3J0U2VydmljZSA9IG5ldyBDdXJyaWN1bHVtSW1wb3J0U2VydmljZSgpO1xuIl0sInZlcnNpb24iOjN9