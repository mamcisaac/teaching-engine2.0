f795317f544ebf3639b8e3d95ff46414
/**
 * Optimized Database Mock
 * Provides a complete mock implementation of PrismaClient
 */
import { jest } from '@jest/globals';
// Helper to create a mock model with all CRUD operations
const createMockModel = (modelName) => {
    const mockData = new Map();
    let idCounter = 1;
    return {
        findUnique: jest.fn(({ where }) => {
            const key = Object.values(where)[0];
            return Promise.resolve(mockData.get(key) || null);
        }),
        findMany: jest.fn(() => {
            return Promise.resolve(Array.from(mockData.values()));
        }),
        findFirst: jest.fn(() => {
            const values = Array.from(mockData.values());
            return Promise.resolve(values[0] || null);
        }),
        create: jest.fn(({ data }) => {
            const id = data.id || idCounter++;
            const record = { id, ...data, createdAt: new Date(), updatedAt: new Date() };
            mockData.set(id.toString(), record);
            return Promise.resolve(record);
        }),
        createMany: jest.fn(({ data }) => {
            const created = data.map((item) => {
                const id = item.id || idCounter++;
                const record = { id, ...item, createdAt: new Date(), updatedAt: new Date() };
                mockData.set(id.toString(), record);
                return record;
            });
            return Promise.resolve({ count: created.length });
        }),
        update: jest.fn(({ where, data }) => {
            const key = Object.values(where)[0];
            const existing = mockData.get(key);
            if (!existing)
                throw new Error('Record not found');
            const updated = { ...existing, ...data, updatedAt: new Date() };
            mockData.set(key, updated);
            return Promise.resolve(updated);
        }),
        updateMany: jest.fn(() => {
            return Promise.resolve({ count: mockData.size });
        }),
        delete: jest.fn(({ where }) => {
            const key = Object.values(where)[0];
            const record = mockData.get(key);
            if (!record)
                throw new Error('Record not found');
            mockData.delete(key);
            return Promise.resolve(record);
        }),
        deleteMany: jest.fn(() => {
            const count = mockData.size;
            mockData.clear();
            return Promise.resolve({ count });
        }),
        count: jest.fn(() => Promise.resolve(mockData.size)),
        aggregate: jest.fn(() => Promise.resolve({})),
        groupBy: jest.fn(() => Promise.resolve([])),
        // Test helper to access mock data
        _getMockData: () => mockData,
        _reset: () => mockData.clear(),
    };
};
// Create mock Prisma client
export class PrismaClient {
    // Connection methods
    $connect = jest.fn().mockResolvedValue(undefined);
    $disconnect = jest.fn().mockResolvedValue(undefined);
    // Transaction support
    $transaction = jest.fn().mockImplementation((fn) => {
        if (typeof fn === 'function') {
            return fn(this);
        }
        return Promise.all(fn);
    });
    // Raw query methods (optimized)
    $queryRaw = jest.fn().mockResolvedValue([]);
    $queryRawUnsafe = jest.fn().mockResolvedValue([]);
    $executeRaw = jest.fn().mockResolvedValue(0);
    $executeRawUnsafe = jest.fn().mockResolvedValue(0);
    // All models
    user = createMockModel('user');
    outcome = createMockModel('outcome');
    outcomeEmbedding = createMockModel('outcomeEmbedding');
    curriculumExpectation = createMockModel('curriculumExpectation');
    curriculumExpectationEmbedding = createMockModel('curriculumExpectationEmbedding');
    curriculumImport = createMockModel('curriculumImport');
    outcomeCluster = createMockModel('outcomeCluster');
    subject = createMockModel('subject');
    milestone = createMockModel('milestone');
    activity = createMockModel('activity');
    activityOutcome = createMockModel('activityOutcome');
    lessonPlan = createMockModel('lessonPlan');
    lessonPlanActivity = createMockModel('lessonPlanActivity');
    aISuggestedActivity = createMockModel('aISuggestedActivity');
    note = createMockModel('note');
    evidence = createMockModel('evidence');
    milestone_alert = createMockModel('milestone_alert');
    notification = createMockModel('notification');
    studentGoal = createMockModel('studentGoal');
    goalReflection = createMockModel('goalReflection');
    assessmentResult = createMockModel('assessmentResult');
    assessmentTemplate = createMockModel('assessmentTemplate');
    calendarEvent = createMockModel('calendarEvent');
    student = createMockModel('student');
    classRoutine = createMockModel('classRoutine');
    teacherPreferences = createMockModel('teacherPreferences');
    dailyPlan = createMockModel('dailyPlan');
    dailyPlanItem = createMockModel('dailyPlanItem');
    resource = createMockModel('resource');
    longRangePlan = createMockModel('longRangePlan');
    unitPlan = createMockModel('unitPlan');
    eTFOLessonPlan = createMockModel('eTFOLessonPlan');
    daybookEntry = createMockModel('daybookEntry');
    // Test helper to reset all mock data
    _resetAllMocks = () => {
        Object.values(this).forEach((value) => {
            if (value && typeof value === 'object' && '_reset' in value) {
                value._reset();
            }
        });
    };
}
// Create singleton instance
export const prisma = new PrismaClient();
// Export enums and types
export const ImportStatus = {
    UPLOADING: 'UPLOADING',
    PROCESSING: 'PROCESSING',
    READY_FOR_REVIEW: 'READY_FOR_REVIEW',
    CONFIRMED: 'CONFIRMED',
    COMPLETED: 'COMPLETED',
    FAILED: 'FAILED',
    CANCELLED: 'CANCELLED',
};
export const Prisma = {
    PrismaClientKnownRequestError: class PrismaClientKnownRequestError extends Error {
        code;
        constructor(message, code) {
            super(message);
            this.code = code;
        }
    },
    PrismaClientValidationError: class PrismaClientValidationError extends Error {
    },
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL21vY2tzL2RhdGFiYXNlLm1vY2sudHMiLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHO0FBRUgsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVyQyx5REFBeUQ7QUFDekQsTUFBTSxlQUFlLEdBQUcsQ0FBQyxTQUFpQixFQUFFLEVBQUU7SUFDNUMsTUFBTSxRQUFRLEdBQUcsSUFBSSxHQUFHLEVBQWUsQ0FBQztJQUN4QyxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7SUFFbEIsT0FBTztRQUNMLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFO1lBQ2hDLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEMsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUM7UUFDcEQsQ0FBQyxDQUFDO1FBRUYsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFO1lBQ3JCLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDO1FBRUYsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFO1lBQ3RCLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDN0MsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQUM7UUFFRixNQUFNLEVBQUUsSUFBSSxD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Q0FBQyxDQUFDO0lBRS9DLHFDQUFxQztJQUNyQyxjQUFjLEdBQUcsR0FBRyxFQUFFO1FBQ3BCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDcEMsSUFBSSxLQUFLLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLFFBQVEsSUFBSSxLQUFLLEVBQUUsQ0FBQztnQkFDNUQsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2pCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQztDQUNIO0FBRUQsNEJBQTRCO0FBQzVCLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0FBRXpDLHlCQUF5QjtBQUN6QixNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUc7SUFDMUIsU0FBUyxFQUFFLFdBQVc7SUFDdEIsVUFBVSxFQUFFLFlBQVk7SUFDeEIsZ0JBQWdCLEVBQUUsa0JBQWtCO0lBQ3BDLFNBQVMsRUFBRSxXQUFXO0lBQ3RCLFNBQVMsRUFBRSxXQUFXO0lBQ3RCLE1BQU0sRUFBRSxRQUFRO0lBQ2hCLFNBQVMsRUFBRSxXQUFXO0NBQ3ZCLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUc7SUFDcEIsNkJBQTZCLEVBQUUsTUFBTSw2QkFBOEIsU0FBUSxLQUFLO1FBQzlFLElBQUksQ0FBUztRQUNiLFlBQVksT0FBZSxFQUFFLElBQVk7WUFDdkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2YsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbkIsQ0FBQztLQUNGO0lBQ0QsMkJBQTJCLEVBQUUsTUFBTSwyQkFBNEIsU0FBUSxLQUFLO0tBQUc7Q0FDaEYsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWljaGFlbG1jaXNhYWMvR2l0SHViL3RlYWNoaW5nLWVuZ2luZTIuMC9zZXJ2ZXIvdGVzdHMvbW9ja3MvZGF0YWJhc2UubW9jay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE9wdGltaXplZCBEYXRhYmFzZSBNb2NrXG4gKiBQcm92aWRlcyBhIGNvbXBsZXRlIG1vY2sgaW1wbGVtZW50YXRpb24gb2YgUHJpc21hQ2xpZW50XG4gKi9cblxuaW1wb3J0IHsgamVzdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuXG4vLyBIZWxwZXIgdG8gY3JlYXRlIGEgbW9jayBtb2RlbCB3aXRoIGFsbCBDUlVEIG9wZXJhdGlvbnNcbmNvbnN0IGNyZWF0ZU1vY2tNb2RlbCA9IChtb2RlbE5hbWU6IHN0cmluZykgPT4ge1xuICBjb25zdCBtb2NrRGF0YSA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XG4gIGxldCBpZENvdW50ZXIgPSAxO1xuXG4gIHJldHVybiB7XG4gICAgZmluZFVuaXF1ZTogamVzdC5mbigoeyB3aGVyZSB9KSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSBPYmplY3QudmFsdWVzKHdoZXJlKVswXTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobW9ja0RhdGEuZ2V0KGtleSkgfHwgbnVsbCk7XG4gICAgfSksXG4gICAgXG4gICAgZmluZE1hbnk6IGplc3QuZm4oKCkgPT4ge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShBcnJheS5mcm9tKG1vY2tEYXRhLnZhbHVlcygpKSk7XG4gICAgfSksXG4gICAgXG4gICAgZmluZEZpcnN0OiBqZXN0LmZuKCgpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlcyA9IEFycmF5LmZyb20obW9ja0RhdGEudmFsdWVzKCkpO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZXNbMF0gfHwgbnVsbCk7XG4gICAgfSksXG4gICAgXG4gICAgY3JlYXRlOiBqZXN0LmZuKCh7IGRhdGEgfSkgPT4ge1xuICAgICAgY29uc3QgaWQgPSBkYXRhLmlkIHx8IGlkQ291bnRlcisrO1xuICAgICAgY29uc3QgcmVjb3JkID0geyBpZCwgLi4uZGF0YSwgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfTtcbiAgICAgIG1vY2tEYXRhLnNldChpZC50b1N0cmluZygpLCByZWNvcmQpO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZWNvcmQpO1xuICAgIH0pLFxuICAgIFxuICAgIGNyZWF0ZU1hbnk6IGplc3QuZm4oKHsgZGF0YSB9KSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVkID0gZGF0YS5tYXAoKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICBjb25zdCBpZCA9IGl0ZW0uaWQgfHwgaWRDb3VudGVyKys7XG4gICAgICAgIGNvbnN0IHJlY29yZCA9IHsgaWQsIC4uLml0ZW0sIGNyZWF0ZWRBdDogbmV3IERhdGUoKSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH07XG4gICAgICAgIG1vY2tEYXRhLnNldChpZC50b1N0cmluZygpLCByZWNvcmQpO1xuICAgICAgICByZXR1cm4gcmVjb3JkO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgY291bnQ6IGNyZWF0ZWQubGVuZ3RoIH0pO1xuICAgIH0pLFxuICAgIFxuICAgIHVwZGF0ZTogamVzdC5mbigoeyB3aGVyZSwgZGF0YSB9KSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSBPYmplY3QudmFsdWVzKHdoZXJlKVswXTtcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gbW9ja0RhdGEuZ2V0KGtleSk7XG4gICAgICBpZiAoIWV4aXN0aW5nKSB0aHJvdyBuZXcgRXJyb3IoJ1JlY29yZCBub3QgZm91bmQnKTtcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSB7IC4uLmV4aXN0aW5nLCAuLi5kYXRhLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfTtcbiAgICAgIG1vY2tEYXRhLnNldChrZXksIHVwZGF0ZWQpO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1cGRhdGVkKTtcbiAgICB9KSxcbiAgICBcbiAgICB1cGRhdGVNYW55OiBqZXN0LmZuKCgpID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyBjb3VudDogbW9ja0RhdGEuc2l6ZSB9KTtcbiAgICB9KSxcbiAgICBcbiAgICBkZWxldGU6IGplc3QuZm4oKHsgd2hlcmUgfSkgPT4ge1xuICAgICAgY29uc3Qga2V5ID0gT2JqZWN0LnZhbHVlcyh3aGVyZSlbMF07XG4gICAgICBjb25zdCByZWNvcmQgPSBtb2NrRGF0YS5nZXQoa2V5KTtcbiAgICAgIGlmICghcmVjb3JkKSB0aHJvdyBuZXcgRXJyb3IoJ1JlY29yZCBub3QgZm91bmQnKTtcbiAgICAgIG1vY2tEYXRhLmRlbGV0ZShrZXkpO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZWNvcmQpO1xuICAgIH0pLFxuICAgIFxuICAgIGRlbGV0ZU1hbnk6IGplc3QuZm4oKCkgPT4ge1xuICAgICAgY29uc3QgY291bnQgPSBtb2NrRGF0YS5zaXplO1xuICAgICAgbW9ja0RhdGEuY2xlYXIoKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyBjb3VudCB9KTtcbiAgICB9KSxcbiAgICBcbiAgICBjb3VudDogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUobW9ja0RhdGEuc2l6ZSkpLFxuICAgIGFnZ3JlZ2F0ZTogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoe30pKSxcbiAgICBncm91cEJ5OiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZShbXSkpLFxuICAgIFxuICAgIC8vIFRlc3QgaGVscGVyIHRvIGFjY2VzcyBtb2NrIGRhdGFcbiAgICBfZ2V0TW9ja0RhdGE6ICgpID0+IG1vY2tEYXRhLFxuICAgIF9yZXNldDogKCkgPT4gbW9ja0RhdGEuY2xlYXIoKSxcbiAgfTtcbn07XG5cbi8vIENyZWF0ZSBtb2NrIFByaXNtYSBjbGllbnRcbmV4cG9ydCBjbGFzcyBQcmlzbWFDbGllbnQge1xuICAvLyBDb25uZWN0aW9uIG1ldGhvZHNcbiAgJGNvbm5lY3QgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgJGRpc2Nvbm5lY3QgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgXG4gIC8vIFRyYW5zYWN0aW9uIHN1cHBvcnRcbiAgJHRyYW5zYWN0aW9uID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoZm4pID0+IHtcbiAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gZm4odGhpcyk7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLmFsbChmbik7XG4gIH0pO1xuICBcbiAgLy8gUmF3IHF1ZXJ5IG1ldGhvZHMgKG9wdGltaXplZClcbiAgJHF1ZXJ5UmF3ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgJHF1ZXJ5UmF3VW5zYWZlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgJGV4ZWN1dGVSYXcgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoMCk7XG4gICRleGVjdXRlUmF3VW5zYWZlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKDApO1xuICBcbiAgLy8gQWxsIG1vZGVsc1xuICB1c2VyID0gY3JlYXRlTW9ja01vZGVsKCd1c2VyJyk7XG4gIG91dGNvbWUgPSBjcmVhdGVNb2NrTW9kZWwoJ291dGNvbWUnKTtcbiAgb3V0Y29tZUVtYmVkZGluZyA9IGNyZWF0ZU1vY2tNb2RlbCgnb3V0Y29tZUVtYmVkZGluZycpO1xuICBjdXJyaWN1bHVtRXhwZWN0YXRpb24gPSBjcmVhdGVNb2NrTW9kZWwoJ2N1cnJpY3VsdW1FeHBlY3RhdGlvbicpO1xuICBjdXJyaWN1bHVtRXhwZWN0YXRpb25FbWJlZGRpbmcgPSBjcmVhdGVNb2NrTW9kZWwoJ2N1cnJpY3VsdW1FeHBlY3RhdGlvbkVtYmVkZGluZycpO1xuICBjdXJyaWN1bHVtSW1wb3J0ID0gY3JlYXRlTW9ja01vZGVsKCdjdXJyaWN1bHVtSW1wb3J0Jyk7XG4gIG91dGNvbWVDbHVzdGVyID0gY3JlYXRlTW9ja01vZGVsKCdvdXRjb21lQ2x1c3RlcicpO1xuICBzdWJqZWN0ID0gY3JlYXRlTW9ja01vZGVsKCdzdWJqZWN0Jyk7XG4gIG1pbGVzdG9uZSA9IGNyZWF0ZU1vY2tNb2RlbCgnbWlsZXN0b25lJyk7XG4gIGFjdGl2aXR5ID0gY3JlYXRlTW9ja01vZGVsKCdhY3Rpdml0eScpO1xuICBhY3Rpdml0eU91dGNvbWUgPSBjcmVhdGVNb2NrTW9kZWwoJ2FjdGl2aXR5T3V0Y29tZScpO1xuICBsZXNzb25QbGFuID0gY3JlYXRlTW9ja01vZGVsKCdsZXNzb25QbGFuJyk7XG4gIGxlc3NvblBsYW5BY3Rpdml0eSA9IGNyZWF0ZU1vY2tNb2RlbCgnbGVzc29uUGxhbkFjdGl2aXR5Jyk7XG4gIGFJU3VnZ2VzdGVkQWN0aXZpdHkgPSBjcmVhdGVNb2NrTW9kZWwoJ2FJU3VnZ2VzdGVkQWN0aXZpdHknKTtcbiAgbm90ZSA9IGNyZWF0ZU1vY2tNb2RlbCgnbm90ZScpO1xuICBldmlkZW5jZSA9IGNyZWF0ZU1vY2tNb2RlbCgnZXZpZGVuY2UnKTtcbiAgbWlsZXN0b25lX2FsZXJ0ID0gY3JlYXRlTW9ja01vZGVsKCdtaWxlc3RvbmVfYWxlcnQnKTtcbiAgbm90aWZpY2F0aW9uID0gY3JlYXRlTW9ja01vZGVsKCdub3RpZmljYXRpb24nKTtcbiAgc3R1ZGVudEdvYWwgPSBjcmVhdGVNb2NrTW9kZWwoJ3N0dWRlbnRHb2FsJyk7XG4gIGdvYWxSZWZsZWN0aW9uID0gY3JlYXRlTW9ja01vZGVsKCdnb2FsUmVmbGVjdGlvbicpO1xuICBhc3Nlc3NtZW50UmVzdWx0ID0gY3JlYXRlTW9ja01vZGVsKCdhc3Nlc3NtZW50UmVzdWx0Jyk7XG4gIGFzc2Vzc21lbnRUZW1wbGF0ZSA9IGNyZWF0ZU1vY2tNb2RlbCgnYXNzZXNzbWVudFRlbXBsYXRlJyk7XG4gIGNhbGVuZGFyRXZlbnQgPSBjcmVhdGVNb2NrTW9kZWwoJ2NhbGVuZGFyRXZlbnQnKTtcbiAgc3R1ZGVudCA9IGNyZWF0ZU1vY2tNb2RlbCgnc3R1ZGVudCcpO1xuICBjbGFzc1JvdXRpbmUgPSBjcmVhdGVNb2NrTW9kZWwoJ2NsYXNzUm91dGluZScpO1xuICB0ZWFjaGVyUHJlZmVyZW5jZXMgPSBjcmVhdGVNb2NrTW9kZWwoJ3RlYWNoZXJQcmVmZXJlbmNlcycpO1xuICBkYWlseVBsYW4gPSBjcmVhdGVNb2NrTW9kZWwoJ2RhaWx5UGxhbicpO1xuICBkYWlseVBsYW5JdGVtID0gY3JlYXRlTW9ja01vZGVsKCdkYWlseVBsYW5JdGVtJyk7XG4gIHJlc291cmNlID0gY3JlYXRlTW9ja01vZGVsKCdyZXNvdXJjZScpO1xuICBsb25nUmFuZ2VQbGFuID0gY3JlYXRlTW9ja01vZGVsKCdsb25nUmFuZ2VQbGFuJyk7XG4gIHVuaXRQbGFuID0gY3JlYXRlTW9ja01vZGVsKCd1bml0UGxhbicpO1xuICBlVEZPTGVzc29uUGxhbiA9IGNyZWF0ZU1vY2tNb2RlbCgnZVRGT0xlc3NvblBsYW4nKTtcbiAgZGF5Ym9va0VudHJ5ID0gY3JlYXRlTW9ja01vZGVsKCdkYXlib29rRW50cnknKTtcblxuICAvLyBUZXN0IGhlbHBlciB0byByZXNldCBhbGwgbW9jayBkYXRhXG4gIF9yZXNldEFsbE1vY2tzID0gKCkgPT4ge1xuICAgIE9iamVjdC52YWx1ZXModGhpcykuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmICdfcmVzZXQnIGluIHZhbHVlKSB7XG4gICAgICAgIHZhbHVlLl9yZXNldCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xufVxuXG4vLyBDcmVhdGUgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG4vLyBFeHBvcnQgZW51bXMgYW5kIHR5cGVzXG5leHBvcnQgY29uc3QgSW1wb3J0U3RhdHVzID0ge1xuICBVUExPQURJTkc6ICdVUExPQURJTkcnLFxuICBQUk9DRVNTSU5HOiAnUFJPQ0VTU0lORycsXG4gIFJFQURZX0ZPUl9SRVZJRVc6ICdSRUFEWV9GT1JfUkVWSUVXJyxcbiAgQ09ORklSTUVEOiAnQ09ORklSTUVEJyxcbiAgQ09NUExFVEVEOiAnQ09NUExFVEVEJyxcbiAgRkFJTEVEOiAnRkFJTEVEJyxcbiAgQ0FOQ0VMTEVEOiAnQ0FOQ0VMTEVEJyxcbn07XG5cbmV4cG9ydCBjb25zdCBQcmlzbWEgPSB7XG4gIFByaXNtYUNsaWVudEtub3duUmVxdWVzdEVycm9yOiBjbGFzcyBQcmlzbWFDbGllbnRLbm93blJlcXVlc3RFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nLCBjb2RlOiBzdHJpbmcpIHtcbiAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgICAgdGhpcy5jb2RlID0gY29kZTtcbiAgICB9XG4gIH0sXG4gIFByaXNtYUNsaWVudFZhbGlkYXRpb25FcnJvcjogY2xhc3MgUHJpc21hQ2xpZW50VmFsaWRhdGlvbkVycm9yIGV4dGVuZHMgRXJyb3Ige30sXG59OyJdLCJ2ZXJzaW9uIjozfQ==