{"file":"/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/tests/unit/reportGeneratorService.coverage.test.ts","mappings":"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","names":[],"sources":["/Users/michaelmcisaac/GitHub/teaching-engine2.0/server/tests/unit/reportGeneratorService.coverage.test.ts"],"sourcesContent":["/**\n * Additional Test Coverage for Report Generator Service\n * \n * Tests critical paths and edge cases that weren't covered in existing tests\n * to improve overall test coverage for the report generation functionality\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals';\nimport { ReportGeneratorService } from '../../src/services/reportGeneratorService';\nimport { getTestPrismaClient, createTestData } from '../jest.setup';\nimport { addDays, subDays, format } from 'date-fns';\n\n// Mock dependencies\njest.mock('pdfkit', () => {\n  return jest.fn().mockImplementation(() => ({\n    fontSize: jest.fn().mockReturnThis(),\n    text: jest.fn().mockReturnThis(),\n    moveDown: jest.fn().mockReturnThis(),\n    font: jest.fn().mockReturnThis(),\n    fillColor: jest.fn().mockReturnThis(),\n    rect: jest.fn().mockReturnThis(),\n    fill: jest.fn().mockReturnThis(),\n    pipe: jest.fn(),\n    end: jest.fn(),\n    on: jest.fn((event, callback) => {\n      if (event === 'end') {\n        setTimeout(callback, 10);\n      }\n    }),\n  }));\n});\n\njest.mock('fs/promises', () => ({\n  writeFile: jest.fn(),\n  readFile: jest.fn(),\n  mkdir: jest.fn(),\n  unlink: jest.fn(),\n}));\n\njest.mock('canvas', () => ({\n  createCanvas: jest.fn(() => ({\n    getContext: jest.fn(() => ({\n      fillStyle: '',\n      fillRect: jest.fn(),\n      fillText: jest.fn(),\n      measureText: jest.fn(() => ({ width: 100 })),\n      font: '',\n    })),\n    toDataURL: jest.fn(() => 'data:image/png;base64,test'),\n  })),\n}));\n\ndescribe('ReportGeneratorService Coverage Tests', () => {\n  let service: ReportGeneratorService;\n  let mockUser: any;\n  let mockStudent: any;\n  let mockOutcomes: any[];\n\n  beforeEach(async () => {\n    // Create test data\n    const testData = await createTestData(async (prisma) => {\n      const user = await prisma.user.create({\n        data: {\n          email: 'teacher@example.com',\n          password: 'hashed_password',\n          name: 'Test Teacher',\n          role: 'teacher',\n        },\n      });\n\n      const student = await prisma.student.create({\n        data: {\n          firstName: 'Test',\n          lastName: 'Student',\n          grade: 5,\n          userId: user.id,\n        },\n      });\n\n      // Create test outcomes\n      const outcomes = await Promise.all([\n        prisma.outcome.create({\n          data: {\n            code: 'A1.1',\n            description: 'Demonstrate understanding of numbers',\n            subject: 'Mathematics',\n            grade: 5,\n            domain: 'Number',\n            userId: user.id,\n          },\n        }),\n        prisma.outcome.create({\n          data: {\n            code: 'B2.2',\n            description: 'Solve problems involving addition',\n            subject: 'Mathematics',\n            grade: 5,\n            domain: 'Number',\n            userId: user.id,\n          },\n        }),\n      ]);\n\n      return { user, student, outcomes };\n    });\n\n    mockUser = testData.user;\n    mockStudent = testData.student;\n    mockOutcomes = testData.outcomes;\n    service = new ReportGeneratorService();\n  });\n\n  describe('Progress Report Generation', () => {\n    it('should generate progress report with no data', async () => {\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      const result = await service.generateProgressReport(\n        mockStudent.id,\n        startDate,\n        endDate,\n        mockUser.id\n      );\n\n      expect(result).toBeDefined();\n      expect(result.studentName).toBe('Test Student');\n      expect(result.reportPeriod).toBeDefined();\n    });\n\n    it('should handle invalid date ranges', async () => {\n      const startDate = new Date();\n      const endDate = subDays(new Date(), 30); // End before start\n\n      await expect(\n        service.generateProgressReport(\n          mockStudent.id,\n          startDate,\n          endDate,\n          mockUser.id\n        )\n      ).rejects.toThrow();\n    });\n\n    it('should handle student not found', async () => {\n      const invalidStudentId = 99999;\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      await expect(\n        service.generateProgressReport(\n          invalidStudentId,\n          startDate,\n          endDate,\n          mockUser.id\n        )\n      ).rejects.toThrow();\n    });\n\n    it('should handle unauthorized access to student', async () => {\n      const otherUser = await createTestData(async (prisma) => {\n        return await prisma.user.create({\n          data: {\n            email: 'other@example.com',\n            password: 'hashed_password',\n            name: 'Other Teacher',\n            role: 'teacher',\n          },\n        });\n      });\n\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      await expect(\n        service.generateProgressReport(\n          mockStudent.id,\n          startDate,\n          endDate,\n          otherUser.id\n        )\n      ).rejects.toThrow();\n    });\n  });\n\n  describe('PDF Generation', () => {\n    it('should generate PDF with complex data', async () => {\n      // Create comprehensive test data\n      const complexData = await createTestData(async (prisma) => {\n        // Create activities with various statuses\n        const milestone = await prisma.milestone.create({\n          data: {\n            title: 'Test Milestone',\n            subjectId: 1,\n            userId: mockUser.id,\n          },\n        });\n\n        const activities = await Promise.all([\n          prisma.activity.create({\n            data: {\n              title: 'Completed Activity',\n              milestoneId: milestone.id,\n              completedAt: new Date(),\n              userId: mockUser.id,\n            },\n          }),\n          prisma.activity.create({\n            data: {\n              title: 'In Progress Activity',\n              milestoneId: milestone.id,\n              userId: mockUser.id,\n            },\n          }),\n        ]);\n\n        return { milestone, activities };\n      });\n\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      const report = await service.generateProgressReport(\n        mockStudent.id,\n        startDate,\n        endDate,\n        mockUser.id\n      );\n\n      const pdfBuffer = await service.generatePDF(report);\n      expect(pdfBuffer).toBeInstanceOf(Buffer);\n      expect(pdfBuffer.length).toBeGreaterThan(0);\n    });\n\n    it('should handle PDF generation errors', async () => {\n      const PDFDocument = require('pdfkit');\n      PDFDocument.mockImplementationOnce(() => {\n        throw new Error('PDF generation failed');\n      });\n\n      const report = {\n        studentName: 'Test Student',\n        reportPeriod: 'Test Period',\n        outcomes: [],\n        activities: [],\n        progress: {},\n      };\n\n      await expect(\n        service.generatePDF(report)\n      ).rejects.toThrow('PDF generation failed');\n    });\n\n    it('should handle large reports with many sections', async () => {\n      // Create a report with many items\n      const largeReport = {\n        studentName: 'Test Student',\n        reportPeriod: 'Large Report Period',\n        outcomes: Array(100).fill(null).map((_, i) => ({\n          code: `A${i}.1`,\n          description: `Test outcome ${i}`,\n          progress: Math.random(),\n        })),\n        activities: Array(50).fill(null).map((_, i) => ({\n          title: `Activity ${i}`,\n          completed: i % 2 === 0,\n          date: new Date(),\n        })),\n        progress: {\n          overall: 0.75,\n          bySubject: {\n            Mathematics: 0.8,\n            Science: 0.7,\n          },\n        },\n      };\n\n      const pdfBuffer = await service.generatePDF(largeReport);\n      expect(pdfBuffer).toBeInstanceOf(Buffer);\n    });\n  });\n\n  describe('Chart Generation', () => {\n    it('should generate progress charts', async () => {\n      const progressData = {\n        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],\n        values: [0.2, 0.4, 0.6, 0.8],\n      };\n\n      const chartDataUrl = await service.generateProgressChart(progressData);\n      expect(chartDataUrl).toMatch(/^data:image\\/png;base64,/);\n    });\n\n    it('should handle empty chart data', async () => {\n      const emptyData = {\n        labels: [],\n        values: [],\n      };\n\n      const chartDataUrl = await service.generateProgressChart(emptyData);\n      expect(chartDataUrl).toMatch(/^data:image\\/png;base64,/);\n    });\n\n    it('should handle mismatched label and value arrays', async () => {\n      const mismatchedData = {\n        labels: ['Week 1', 'Week 2'],\n        values: [0.5], // One less value than labels\n      };\n\n      await expect(\n        service.generateProgressChart(mismatchedData)\n      ).rejects.toThrow();\n    });\n\n    it('should handle invalid chart values', async () => {\n      const invalidData = {\n        labels: ['Week 1', 'Week 2'],\n        values: [NaN, Infinity], // Invalid numbers\n      };\n\n      await expect(\n        service.generateProgressChart(invalidData)\n      ).rejects.toThrow();\n    });\n  });\n\n  describe('Data Aggregation', () => {\n    it('should calculate progress statistics correctly', async () => {\n      // Create test activities with known completion dates\n      const testData = await createTestData(async (prisma) => {\n        const milestone = await prisma.milestone.create({\n          data: {\n            title: 'Test Milestone',\n            subjectId: 1,\n            userId: mockUser.id,\n          },\n        });\n\n        const activities = await Promise.all([\n          prisma.activity.create({\n            data: {\n              title: 'Activity 1',\n              milestoneId: milestone.id,\n              completedAt: subDays(new Date(), 5),\n              userId: mockUser.id,\n            },\n          }),\n          prisma.activity.create({\n            data: {\n              title: 'Activity 2',\n              milestoneId: milestone.id,\n              completedAt: subDays(new Date(), 3),\n              userId: mockUser.id,\n            },\n          }),\n          prisma.activity.create({\n            data: {\n              title: 'Activity 3',\n              milestoneId: milestone.id,\n              // Not completed\n              userId: mockUser.id,\n            },\n          }),\n        ]);\n\n        return activities;\n      });\n\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      const stats = await service.calculateProgressStatistics(\n        mockStudent.id,\n        startDate,\n        endDate,\n        mockUser.id\n      );\n\n      expect(stats).toBeDefined();\n      expect(stats.totalActivities).toBeGreaterThan(0);\n      expect(stats.completedActivities).toBeGreaterThan(0);\n      expect(stats.completionRate).toBeGreaterThanOrEqual(0);\n      expect(stats.completionRate).toBeLessThanOrEqual(1);\n    });\n\n    it('should handle edge case with all activities completed', async () => {\n      const testData = await createTestData(async (prisma) => {\n        const milestone = await prisma.milestone.create({\n          data: {\n            title: 'Completed Milestone',\n            subjectId: 1,\n            userId: mockUser.id,\n          },\n        });\n\n        await prisma.activity.create({\n          data: {\n            title: 'Completed Activity',\n            milestoneId: milestone.id,\n            completedAt: new Date(),\n            userId: mockUser.id,\n          },\n        });\n\n        return milestone;\n      });\n\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      const stats = await service.calculateProgressStatistics(\n        mockStudent.id,\n        startDate,\n        endDate,\n        mockUser.id\n      );\n\n      expect(stats.completionRate).toBe(1);\n    });\n\n    it('should handle edge case with no activities', async () => {\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      const stats = await service.calculateProgressStatistics(\n        mockStudent.id,\n        startDate,\n        endDate,\n        mockUser.id\n      );\n\n      expect(stats.totalActivities).toBe(0);\n      expect(stats.completedActivities).toBe(0);\n      expect(stats.completionRate).toBe(0);\n    });\n  });\n\n  describe('Template System', () => {\n    it('should use custom report templates', async () => {\n      const customTemplate = {\n        title: 'Custom Report Template',\n        sections: ['overview', 'progress', 'recommendations'],\n        styling: {\n          primaryColor: '#007acc',\n          fontSize: 12,\n        },\n      };\n\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      const report = await service.generateProgressReport(\n        mockStudent.id,\n        startDate,\n        endDate,\n        mockUser.id,\n        customTemplate\n      );\n\n      expect(report).toBeDefined();\n      expect(report.template).toBe(customTemplate);\n    });\n\n    it('should validate template configuration', async () => {\n      const invalidTemplate = {\n        // Missing required fields\n        styling: {},\n      };\n\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      await expect(\n        service.generateProgressReport(\n          mockStudent.id,\n          startDate,\n          endDate,\n          mockUser.id,\n          invalidTemplate\n        )\n      ).rejects.toThrow();\n    });\n  });\n\n  describe('Export Formats', () => {\n    it('should export to multiple formats', async () => {\n      const report = {\n        studentName: 'Test Student',\n        reportPeriod: 'Test Period',\n        outcomes: [],\n        activities: [],\n        progress: {},\n      };\n\n      const formats = ['pdf', 'html', 'json'];\n      \n      for (const format of formats) {\n        const exported = await service.exportReport(report, format);\n        expect(exported).toBeDefined();\n        \n        if (format === 'pdf') {\n          expect(exported).toBeInstanceOf(Buffer);\n        } else if (format === 'html') {\n          expect(typeof exported).toBe('string');\n          expect(exported).toContain('<html>');\n        } else if (format === 'json') {\n          expect(typeof exported).toBe('string');\n          const parsed = JSON.parse(exported);\n          expect(parsed.studentName).toBe('Test Student');\n        }\n      }\n    });\n\n    it('should handle unsupported export formats', async () => {\n      const report = {\n        studentName: 'Test Student',\n        reportPeriod: 'Test Period',\n        outcomes: [],\n        activities: [],\n        progress: {},\n      };\n\n      await expect(\n        service.exportReport(report, 'unsupported')\n      ).rejects.toThrow();\n    });\n  });\n\n  describe('Error Handling and Edge Cases', () => {\n    it('should handle database connection failures', async () => {\n      const prisma = getTestPrismaClient();\n      const originalFind = prisma.student.findFirst;\n      prisma.student.findFirst = jest.fn().mockRejectedValue(new Error('Database connection failed'));\n\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      await expect(\n        service.generateProgressReport(\n          mockStudent.id,\n          startDate,\n          endDate,\n          mockUser.id\n        )\n      ).rejects.toThrow('Database connection failed');\n\n      // Restore original method\n      prisma.student.findFirst = originalFind;\n    });\n\n    it('should handle memory constraints with large datasets', async () => {\n      // Mock a scenario with very large amounts of data\n      const prisma = getTestPrismaClient();\n      const originalFind = prisma.activity.findMany;\n      \n      prisma.activity.findMany = jest.fn().mockResolvedValue(\n        Array(10000).fill(null).map((_, i) => ({\n          id: i,\n          title: `Activity ${i}`,\n          completedAt: i % 2 === 0 ? new Date() : null,\n          milestoneId: 1,\n          userId: mockUser.id,\n        }))\n      );\n\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      const report = await service.generateProgressReport(\n        mockStudent.id,\n        startDate,\n        endDate,\n        mockUser.id\n      );\n\n      expect(report).toBeDefined();\n      expect(report.activities.length).toBeLessThanOrEqual(1000); // Should limit for performance\n\n      // Restore original method\n      prisma.activity.findMany = originalFind;\n    });\n\n    it('should sanitize user input in reports', async () => {\n      const maliciousStudent = await createTestData(async (prisma) => {\n        return await prisma.student.create({\n          data: {\n            firstName: '<script>alert(\"xss\")</script>',\n            lastName: '<img src=\"x\" onerror=\"alert(1)\">',\n            grade: 5,\n            userId: mockUser.id,\n          },\n        });\n      });\n\n      const startDate = subDays(new Date(), 30);\n      const endDate = new Date();\n\n      const report = await service.generateProgressReport(\n        maliciousStudent.id,\n        startDate,\n        endDate,\n        mockUser.id\n      );\n\n      // Student name should be sanitized\n      expect(report.studentName).not.toContain('<script>');\n      expect(report.studentName).not.toContain('onerror');\n      expect(report.studentName).not.toContain('<img');\n    });\n  });\n});"],"version":3}