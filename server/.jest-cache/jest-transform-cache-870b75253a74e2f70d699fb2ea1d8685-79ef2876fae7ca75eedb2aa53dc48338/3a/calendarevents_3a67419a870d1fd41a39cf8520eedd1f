ba1e94b1ee979a4403dd7a91bb1433b3
import { Router } from 'express';
import { z } from 'zod';
import { CalendarEventType, CalendarEventSource } from '@teaching-engine/database';
import { requireAuth } from '../middleware/auth';
import { validateRequest } from '../middleware/validateRequest';
import { startOfDay, endOfDay, parseISO } from 'date-fns';
import { prisma } from '../prisma';
const router = Router();
// Validation schemas
const calendarEventSchema = z.object({
    title: z.string().min(1).max(255),
    description: z.string().optional(),
    start: z.string().datetime(),
    end: z.string().datetime(),
    allDay: z.boolean().default(false),
    eventType: z.enum(['PD_DAY', 'ASSEMBLY', 'TRIP', 'HOLIDAY', 'CUSTOM']),
    source: z.enum(['MANUAL', 'ICAL_FEED']).default('MANUAL'),
});
const querySchema = z.object({
    start: z.string().optional(),
    end: z.string().optional(),
    eventType: z.enum(['PD_DAY', 'ASSEMBLY', 'TRIP', 'HOLIDAY', 'CUSTOM']).optional(),
});
// Get calendar events for a date range
router.get('/', requireAuth, validateRequest({ query: querySchema }), async (req, res) => {
    try {
        const { start, end, eventType } = req.query;
        const userId = req.user.userId;
        const where = {
            OR: [
                { teacherId: parseInt(userId) },
                { teacherId: null }, // School-wide events
            ],
        };
        if (start) {
            where.start = { gte: parseISO(start) };
        }
        if (end) {
            where.end = { lte: endOfDay(parseISO(end)) };
        }
        if (eventType) {
            where.eventType = eventType;
        }
        const events = await prisma.calendarEvent.findMany({
            where,
            orderBy: { start: 'asc' },
        });
        res.json(events);
    }
    catch (error) {
        console.error('Error fetching calendar events:', error);
        res.status(500).json({ error: 'Failed to fetch calendar events' });
    }
});
// Create a new calendar event
router.post('/', requireAuth, validateRequest({ body: calendarEventSchema }), async (req, res) => {
    try {
        const data = req.body;
        const userId = req.user.userId;
        const event = await prisma.calendarEvent.create({
            data: {
                title: data.title,
                description: data.description,
                start: new Date(data.start),
                end: new Date(data.end),
                allDay: data.allDay,
                eventType: data.eventType,
                source: data.source,
                teacherId: parseInt(userId),
            },
        });
        res.status(201).json(event);
    }
    catch (error) {
        console.error('Error creating calendar event:', error);
        res.status(500).json({ error: 'Failed to create calendar event' });
    }
});
// Update a calendar event
router.patch('/:id', requireAuth, async (req, res) => {
    try {
        const { id } = req.params;
        const userId = req.user.userId;
        const updates = req.body;
        // Check ownership
        const event = await prisma.calendarEvent.findFirst({
            where: {
                id: parseInt(id),
                teacherId: parseInt(userId),
            },
        });
        if (!event) {
            return res.status(404).json({ error: 'Event not found or unauthorized' });
        }
        // Convert date strings to Date objects if present
        if (updates.start)
            updates.start = new Date(updates.start);
        if (updates.end)
            updates.end = new Date(updates.end);
        const updatedEvent = await prisma.calendarEvent.update({
            where: { id: parseInt(id) },
            data: updates,
        });
        res.json(updatedEvent);
    }
    catch (error) {
        console.error('Error updating calendar event:', error);
        res.status(500).json({ error: 'Failed to update calendar event' });
    }
});
// Delete a calendar event
router.delete('/:id', requireAuth, async (req, res) => {
    try {
        const { id } = req.params;
        const userId = req.user.userId;
        // Check ownership
        const event = await prisma.calendarEvent.findFirst({
            where: {
                id: parseInt(id),
                teacherId: parseInt(userId),
            },
        });
        if (!event) {
            return res.status(404).json({ error: 'Event not found or unauthorized' });
        }
        await prisma.calendarEvent.delete({
            where: { id: parseInt(id) },
        });
        res.status(204).send();
    }
    catch (error) {
        console.error('Error deleting calendar event:', error);
        res.status(500).json({ error: 'Failed to delete calendar event' });
    }
});
// Import holidays from a standard calendar
router.post('/import-holidays', requireAuth, async (req, res) => {
    try {
        const { year = new Date().getFullYear() } = req.body;
        // Common Ontario school holidays
        const holidays = [
            { title: 'Labour Day', month: 9, day: 1 },
            { title: 'Thanksgiving', month: 10, day: 2 }, // 2nd Monday
            { title: 'Winter Break Start', month: 12, day: 23 },
            { title: 'Winter Break End', month: 1, day: 2 },
            { title: 'Family Day', month: 2, day: 3 }, // 3rd Monday
            { title: 'March Break Start', month: 3, day: 2 }, // 2nd week
            { title: 'March Break End', month: 3, day: 3 },
            { title: 'Good Friday', month: 4, day: 1 }, // Varies
            { title: 'Easter Monday', month: 4, day: 2 }, // Varies
            { title: 'Victoria Day', month: 5, day: 3 }, // Monday before May 25
        ];
        const createdEvents = [];
        for (const holiday of holidays) {
            const date = new Date(year, holiday.month - 1, holiday.day);
            const existing = await prisma.calendarEvent.findFirst({
                where: {
                    title: holiday.title,
                    start: {
                        gte: startOfDay(date),
                        lte: endOfDay(date),
                    },
                },
            });
            if (!existing) {
                const event = await prisma.calendarEvent.create({
                    data: {
                        title: holiday.title,
                        start: startOfDay(date),
                        end: endOfDay(date),
                        allDay: true,
                        eventType: CalendarEventType.HOLIDAY,
                        source: CalendarEventSource.SYSTEM,
                    },
                });
                createdEvents.push(event);
            }
        }
        res.json({
            message: `Imported ${createdEvents.length} holidays`,
            events: createdEvents,
        });
    }
    catch (error) {
        console.error('Error importing holidays:', error);
        res.status(500).json({ error: 'Failed to import holidays' });
    }
});
export default router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3NyYy9yb3V0ZXMvY2FsZW5kYXItZXZlbnRzLnRzIiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDakMsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLEtBQUssQ0FBQztBQUN4QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsbUJBQW1CLEVBQVUsTUFBTSwyQkFBMkIsQ0FBQztBQUMzRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDakQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUMxRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRW5DLE1BQU0sTUFBTSxHQUFHLE1BQU0sRUFBRSxDQUFDO0FBRXhCLHFCQUFxQjtBQUNyQixNQUFNLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7SUFDbkMsS0FBSyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztJQUNqQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUNsQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUM1QixHQUFHLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUMxQixNQUFNLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7SUFDbEMsU0FBUyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxTQUFT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LFdBQVc7WUFDcEQsTUFBTSxFQUFFLGFBQWE7U0FDdEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLDJCQUEyQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2xELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLDJCQUEyQixFQUFFLENBQUMsQ0FBQztJQUMvRCxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFSCxlQUFlLE1BQU0sQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWljaGFlbG1jaXNhYWMvR2l0SHViL3RlYWNoaW5nLWVuZ2luZTIuMC9zZXJ2ZXIvc3JjL3JvdXRlcy9jYWxlbmRhci1ldmVudHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcbmltcG9ydCB7IENhbGVuZGFyRXZlbnRUeXBlLCBDYWxlbmRhckV2ZW50U291cmNlLCBQcmlzbWEgfSBmcm9tICdAdGVhY2hpbmctZW5naW5lL2RhdGFiYXNlJztcbmltcG9ydCB7IHJlcXVpcmVBdXRoIH0gZnJvbSAnLi4vbWlkZGxld2FyZS9hdXRoJztcbmltcG9ydCB7IHZhbGlkYXRlUmVxdWVzdCB9IGZyb20gJy4uL21pZGRsZXdhcmUvdmFsaWRhdGVSZXF1ZXN0JztcbmltcG9ydCB7IHN0YXJ0T2ZEYXksIGVuZE9mRGF5LCBwYXJzZUlTTyB9IGZyb20gJ2RhdGUtZm5zJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uL3ByaXNtYSc7XG5cbmNvbnN0IHJvdXRlciA9IFJvdXRlcigpO1xuXG4vLyBWYWxpZGF0aW9uIHNjaGVtYXNcbmNvbnN0IGNhbGVuZGFyRXZlbnRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHRpdGxlOiB6LnN0cmluZygpLm1pbigxKS5tYXgoMjU1KSxcbiAgZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgc3RhcnQ6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbiAgZW5kOiB6LnN0cmluZygpLmRhdGV0aW1lKCksXG4gIGFsbERheTogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG4gIGV2ZW50VHlwZTogei5lbnVtKFsnUERfREFZJywgJ0FTU0VNQkxZJywgJ1RSSVAnLCAnSE9MSURBWScsICdDVVNUT00nXSksXG4gIHNvdXJjZTogei5lbnVtKFsnTUFOVUFMJywgJ0lDQUxfRkVFRCddKS5kZWZhdWx0KCdNQU5VQUwnKSxcbn0pO1xuXG5jb25zdCBxdWVyeVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgc3RhcnQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgZW5kOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGV2ZW50VHlwZTogei5lbnVtKFsnUERfREFZJywgJ0FTU0VNQkxZJywgJ1RSSVAnLCAnSE9MSURBWScsICdDVVNUT00nXSkub3B0aW9uYWwoKSxcbn0pO1xuXG4vLyBHZXQgY2FsZW5kYXIgZXZlbnRzIGZvciBhIGRhdGUgcmFuZ2VcbnJvdXRlci5nZXQoJy8nLCByZXF1aXJlQXV0aCwgdmFsaWRhdGVSZXF1ZXN0KHsgcXVlcnk6IHF1ZXJ5U2NoZW1hIH0pLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHN0YXJ0LCBlbmQsIGV2ZW50VHlwZSB9ID0gcmVxLnF1ZXJ5IGFzIHouaW5mZXI8dHlwZW9mIHF1ZXJ5U2NoZW1hPjtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlciEudXNlcklkO1xuXG4gICAgY29uc3Qgd2hlcmU6IFByaXNtYS5DYWxlbmRhckV2ZW50V2hlcmVJbnB1dCA9IHtcbiAgICAgIE9SOiBbXG4gICAgICAgIHsgdGVhY2hlcklkOiBwYXJzZUludCh1c2VySWQpIH0sXG4gICAgICAgIHsgdGVhY2hlcklkOiBudWxsIH0sIC8vIFNjaG9vbC13aWRlIGV2ZW50c1xuICAgICAgXSxcbiAgICB9O1xuXG4gICAgaWYgKHN0YXJ0KSB7XG4gICAgICB3aGVyZS5zdGFydCA9IHsgZ3RlOiBwYXJzZUlTTyhzdGFydCkgfTtcbiAgICB9XG5cbiAgICBpZiAoZW5kKSB7XG4gICAgICB3aGVyZS5lbmQgPSB7IGx0ZTogZW5kT2ZEYXkocGFyc2VJU08oZW5kKSkgfTtcbiAgICB9XG5cbiAgICBpZiAoZXZlbnRUeXBlKSB7XG4gICAgICB3aGVyZS5ldmVudFR5cGUgPSBldmVudFR5cGU7XG4gICAgfVxuXG4gICAgY29uc3QgZXZlbnRzID0gYXdhaXQgcHJpc21hLmNhbGVuZGFyRXZlbnQuZmluZE1hbnkoe1xuICAgICAgd2hlcmUsXG4gICAgICBvcmRlckJ5OiB7IHN0YXJ0OiAnYXNjJyB9LFxuICAgIH0pO1xuXG4gICAgcmVzLmpzb24oZXZlbnRzKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBjYWxlbmRhciBldmVudHM6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggY2FsZW5kYXIgZXZlbnRzJyB9KTtcbiAgfVxufSk7XG5cbi8vIENyZWF0ZSBhIG5ldyBjYWxlbmRhciBldmVudFxucm91dGVyLnBvc3QoJy8nLCByZXF1aXJlQXV0aCwgdmFsaWRhdGVSZXF1ZXN0KHsgYm9keTogY2FsZW5kYXJFdmVudFNjaGVtYSB9KSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGF0YSA9IHJlcS5ib2R5IGFzIHouaW5mZXI8dHlwZW9mIGNhbGVuZGFyRXZlbnRTY2hlbWE+O1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyIS51c2VySWQ7XG5cbiAgICBjb25zdCBldmVudCA9IGF3YWl0IHByaXNtYS5jYWxlbmRhckV2ZW50LmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLFxuICAgICAgICBkZXNjcmlwdGlvbjogZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgc3RhcnQ6IG5ldyBEYXRlKGRhdGEuc3RhcnQpLFxuICAgICAgICBlbmQ6IG5ldyBEYXRlKGRhdGEuZW5kKSxcbiAgICAgICAgYWxsRGF5OiBkYXRhLmFsbERheSxcbiAgICAgICAgZXZlbnRUeXBlOiBkYXRhLmV2ZW50VHlwZSxcbiAgICAgICAgc291cmNlOiBkYXRhLnNvdXJjZSxcbiAgICAgICAgdGVhY2hlcklkOiBwYXJzZUludCh1c2VySWQpLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKGV2ZW50KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBjYWxlbmRhciBldmVudDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgY2FsZW5kYXIgZXZlbnQnIH0pO1xuICB9XG59KTtcblxuLy8gVXBkYXRlIGEgY2FsZW5kYXIgZXZlbnRcbnJvdXRlci5wYXRjaCgnLzppZCcsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyIS51c2VySWQ7XG4gICAgY29uc3QgdXBkYXRlcyA9IHJlcS5ib2R5O1xuXG4gICAgLy8gQ2hlY2sgb3duZXJzaGlwXG4gICAgY29uc3QgZXZlbnQgPSBhd2FpdCBwcmlzbWEuY2FsZW5kYXJFdmVudC5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IHBhcnNlSW50KGlkKSxcbiAgICAgICAgdGVhY2hlcklkOiBwYXJzZUludCh1c2VySWQpLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghZXZlbnQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnRXZlbnQgbm90IGZvdW5kIG9yIHVuYXV0aG9yaXplZCcgfSk7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydCBkYXRlIHN0cmluZ3MgdG8gRGF0ZSBvYmplY3RzIGlmIHByZXNlbnRcbiAgICBpZiAodXBkYXRlcy5zdGFydCkgdXBkYXRlcy5zdGFydCA9IG5ldyBEYXRlKHVwZGF0ZXMuc3RhcnQpO1xuICAgIGlmICh1cGRhdGVzLmVuZCkgdXBkYXRlcy5lbmQgPSBuZXcgRGF0ZSh1cGRhdGVzLmVuZCk7XG5cbiAgICBjb25zdCB1cGRhdGVkRXZlbnQgPSBhd2FpdCBwcmlzbWEuY2FsZW5kYXJFdmVudC51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHBhcnNlSW50KGlkKSB9LFxuICAgICAgZGF0YTogdXBkYXRlcyxcbiAgICB9KTtcblxuICAgIHJlcy5qc29uKHVwZGF0ZWRFdmVudCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgY2FsZW5kYXIgZXZlbnQ6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gdXBkYXRlIGNhbGVuZGFyIGV2ZW50JyB9KTtcbiAgfVxufSk7XG5cbi8vIERlbGV0ZSBhIGNhbGVuZGFyIGV2ZW50XG5yb3V0ZXIuZGVsZXRlKCcvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG4gICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIhLnVzZXJJZDtcblxuICAgIC8vIENoZWNrIG93bmVyc2hpcFxuICAgIGNvbnN0IGV2ZW50ID0gYXdhaXQgcHJpc21hLmNhbGVuZGFyRXZlbnQuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBwYXJzZUludChpZCksXG4gICAgICAgIHRlYWNoZXJJZDogcGFyc2VJbnQodXNlcklkKSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIWV2ZW50KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0V2ZW50IG5vdCBmb3VuZCBvciB1bmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cblxuICAgIGF3YWl0IHByaXNtYS5jYWxlbmRhckV2ZW50LmRlbGV0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogcGFyc2VJbnQoaWQpIH0sXG4gICAgfSk7XG5cbiAgICByZXMuc3RhdHVzKDIwNCkuc2VuZCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRlbGV0aW5nIGNhbGVuZGFyIGV2ZW50OicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIGRlbGV0ZSBjYWxlbmRhciBldmVudCcgfSk7XG4gIH1cbn0pO1xuXG4vLyBJbXBvcnQgaG9saWRheXMgZnJvbSBhIHN0YW5kYXJkIGNhbGVuZGFyXG5yb3V0ZXIucG9zdCgnL2ltcG9ydC1ob2xpZGF5cycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gQ29tbW9uIE9udGFyaW8gc2Nob29sIGhvbGlkYXlzXG4gICAgY29uc3QgaG9saWRheXMgPSBbXG4gICAgICB7IHRpdGxlOiAnTGFib3VyIERheScsIG1vbnRoOiA5LCBkYXk6IDEgfSxcbiAgICAgIHsgdGl0bGU6ICdUaGFua3NnaXZpbmcnLCBtb250aDogMTAsIGRheTogMiB9LCAvLyAybmQgTW9uZGF5XG4gICAgICB7IHRpdGxlOiAnV2ludGVyIEJyZWFrIFN0YXJ0JywgbW9udGg6IDEyLCBkYXk6IDIzIH0sXG4gICAgICB7IHRpdGxlOiAnV2ludGVyIEJyZWFrIEVuZCcsIG1vbnRoOiAxLCBkYXk6IDIgfSxcbiAgICAgIHsgdGl0bGU6ICdGYW1pbHkgRGF5JywgbW9udGg6IDIsIGRheTogMyB9LCAvLyAzcmQgTW9uZGF5XG4gICAgICB7IHRpdGxlOiAnTWFyY2ggQnJlYWsgU3RhcnQnLCBtb250aDogMywgZGF5OiAyIH0sIC8vIDJuZCB3ZWVrXG4gICAgICB7IHRpdGxlOiAnTWFyY2ggQnJlYWsgRW5kJywgbW9udGg6IDMsIGRheTogMyB9LFxuICAgICAgeyB0aXRsZTogJ0dvb2QgRnJpZGF5JywgbW9udGg6IDQsIGRheTogMSB9LCAvLyBWYXJpZXNcbiAgICAgIHsgdGl0bGU6ICdFYXN0ZXIgTW9uZGF5JywgbW9udGg6IDQsIGRheTogMiB9LCAvLyBWYXJpZXNcbiAgICAgIHsgdGl0bGU6ICdWaWN0b3JpYSBEYXknLCBtb250aDogNSwgZGF5OiAzIH0sIC8vIE1vbmRheSBiZWZvcmUgTWF5IDI1XG4gICAgXTtcblxuICAgIGNvbnN0IGNyZWF0ZWRFdmVudHMgPSBbXTtcblxuICAgIGZvciAoY29uc3QgaG9saWRheSBvZiBob2xpZGF5cykge1xuICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHllYXIsIGhvbGlkYXkubW9udGggLSAxLCBob2xpZGF5LmRheSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgcHJpc21hLmNhbGVuZGFyRXZlbnQuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB0aXRsZTogaG9saWRheS50aXRsZSxcbiAgICAgICAgICBzdGFydDoge1xuICAgICAgICAgICAgZ3RlOiBzdGFydE9mRGF5KGRhdGUpLFxuICAgICAgICAgICAgbHRlOiBlbmRPZkRheShkYXRlKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgICAgY29uc3QgZXZlbnQgPSBhd2FpdCBwcmlzbWEuY2FsZW5kYXJFdmVudC5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRpdGxlOiBob2xpZGF5LnRpdGxlLFxuICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0T2ZEYXkoZGF0ZSksXG4gICAgICAgICAgICBlbmQ6IGVuZE9mRGF5KGRhdGUpLFxuICAgICAgICAgICAgYWxsRGF5OiB0cnVlLFxuICAgICAgICAgICAgZXZlbnRUeXBlOiBDYWxlbmRhckV2ZW50VHlwZS5IT0xJREFZLFxuICAgICAgICAgICAgc291cmNlOiBDYWxlbmRhckV2ZW50U291cmNlLlNZU1RFTSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgY3JlYXRlZEV2ZW50cy5wdXNoKGV2ZW50KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXMuanNvbih7XG4gICAgICBtZXNzYWdlOiBgSW1wb3J0ZWQgJHtjcmVhdGVkRXZlbnRzLmxlbmd0aH0gaG9saWRheXNgLFxuICAgICAgZXZlbnRzOiBjcmVhdGVkRXZlbnRzLFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGltcG9ydGluZyBob2xpZGF5czonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byBpbXBvcnQgaG9saWRheXMnIH0pO1xuICB9XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyOyJdLCJ2ZXJzaW9uIjozfQ==