1bf931112f52a445cff0ec6d6fd55cc7
import { jest, describe, it, beforeEach, expect } from '@jest/globals';
import { extractWeeklyPlan } from '../../src/services/weeklyPlanExtractor';
// Get the mocked prisma from global
const mockPrisma = jest.mocked(global.testPrismaClient);
describe('WeeklyPlanExtractor', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('extractWeeklyPlan', () => {
        it('should extract weekly plan data for multiple days', async () => {
            // Mock data
            const mockSubject = {
                id: 1,
                name: 'Mathematics',
                nameEn: 'Mathematics',
                nameFr: 'Mathématiques',
            };
            const mockMilestone = {
                id: 1,
                title: 'Number Operations',
                targetDate: new Date('2024-01-31'),
                subject: mockSubject,
                activities: [],
            };
            const mockActivity = {
                id: 1,
                title: 'Addition Practice',
                milestone: { subject: mockSubject },
                outcomes: [],
            };
            const mockDailyPlan = {
                id: 1,
                date: new Date('2024-01-15'),
                items: [
                    {
                        id: 1,
                        startMin: 540, // 9:00 AM
                        activity: mockActivity,
                        slot: { subject: mockSubject },
                    },
                ],
            };
            // Setup mocks
            mockPrisma.dailyPlan.findMany.mockResolvedValue([mockDailyPlan]);
            mockPrisma.milestone.findMany.mockResolvedValue([mockMilestone]);
            mockPrisma.assessmentResult.findMany.mockResolvedValue([]);
            mockPrisma.calendarEvent.findMany.mockResolvedValue([]);
            mockPrisma.subject.findMany.mockResolvedValue([mockSubject]);
            const result = await extractWeeklyPlan('2024-01-15', 3, { userId: 1 });
            expect(result).toHaveProperty('startDate', '2024-01-15');
            expect(result).toHaveProperty('days');
            expect(result.days).toHaveLength(3);
            expect(result).toHaveProperty('weeklyOverview');
            expect(result.weeklyOverview).toHaveProperty('subjects');
            expect(result.weeklyOverview).toHaveProperty('milestones');
            expect(result).toHaveProperty('continuityNotes');
            expect(result).toHaveProperty('emergencyBackupPlans');
        });
        it('should generate continuity notes between days', async () => {
            // Setup mock data for consecutive days with related activities
            const mockSubject = { id: 1, name: 'Mathematics' };
            const mockPlans = [
                {
                    id: 1,
                    date: new Date('2024-01-15'),
                    items: [
                        {
                            id: 1,
                            startMin: 540,
                            activity: {
                                id: 1,
                                title: 'Introduction to Fractions',
                                milestone: { subject: mockSubject },
                            },
                            slot: { subject: mockSubject },
                        },
                    ],
                },
                {
                    id: 2,
                    date: new Date('2024-01-16'),
                    items: [
                        {
                            id: 2,
                            startMin: 540,
                            activity: {
                                id: 2,
                                title: 'Fraction Operations',
                                milestone: { subject: mockSubject },
                            },
                            slot: { subject: mockSubject },
                        },
                    ],
                },
            ];
            mockPrisma.dailyPlan.findMany.mockResolvedValue(mockPlans);
            mockPrisma.milestone.findMany.mockResolvedValue([]);
            mockPrisma.assessmentResult.findMany.mockResolvedValue([]);
            mockPrisma.calendarEvent.findMany.mockResolvedValue([]);
            mockPrisma.subject.findMany.mockResolvedValue([mockSubject]);
            const result = await extractWeeklyPlan('2024-01-15', 2, { userId: 1 });
            expect(result.continuityNotes).toHaveLength(2);
            const day2Notes = result.continuityNotes[1];
            expect(day2Notes.connections.length).toBeGreaterThan(0);
            expect(day2Notes.connections[0]).toContain('Mathematics');
            expect(day2Notes.connections[0]).toContain('Introduction to Fractions');
            expect(day2Notes.connections[0]).toContain('Fraction Operations');
        });
        it('should generate emergency backup plans by subject', async () => {
            const mockSubjects = [
                {
                    id: 1,
                    name: 'Mathematics',
                    activities: [
                        { id: 1, title: 'Math Review Worksheets', isFallback: true },
                        { id: 2, title: 'Number Games', isFallback: true },
                    ],
                },
                {
                    id: 2,
                    name: 'Language Arts',
                    activities: [{ id: 3, title: 'Silent Reading', isFallback: true }],
                },
            ];
            mockPrisma.dailyPlan.findMany.mockResolvedValue([]);
            mockPrisma.milestone.findMany.mockResolvedValue([]);
            mockPrisma.assessmentResult.findMany.mockResolvedValue([]);
            mockPrisma.calendarEvent.findMany.mockResolvedValue([]);
            mockPrisma.subject.findMany.mockResolvedValue(mockSubjects);
            const result = await extractWeeklyPlan('2024-01-15', 1, { userId: 1 });
            expect(result.emergencyBackupPlans).toHaveLength(2);
            const mathPlan = result.emergencyBackupPlans.find((p) => p.subject === 'Mathematics');
            expect(mathPlan).toBeDefined();
            expect(mathPlan?.activities).toContain('Math Review Worksheets');
            expect(mathPlan?.activities).toContain('Number Games');
            expect(mathPlan?.materials).toContain('Math manipulatives');
            const langPlan = result.emergencyBackupPlans.find((p) => p.subject === 'Language Arts');
            expect(langPlan).toBeDefined();
            expect(langPlan?.activities).toContain('Silent Reading');
            expect(langPlan?.materials).toContain('Reading books');
        });
        it('should calculate subject hours and topics correctly', async () => {
            const mockSubject = { id: 1, name: 'Mathematics' };
            const mockDailyPlan = {
                id: 1,
                date: new Date('2024-01-15'),
                items: [
                    {
                        id: 1,
                        startMin: 540, // 9:00 AM - assuming 15-minute slots
                        activity: {
                            id: 1,
                            title: 'Addition',
                            milestone: { subject: mockSubject },
                            outcomes: [],
                        },
                        slot: { subject: mockSubject },
                    },
                    {
                        id: 2,
                        startMin: 555, // 9:15 AM
                        activity: {
                            id: 2,
                            title: 'Subtraction',
                            milestone: { subject: mockSubject },
                            outcomes: [],
                        },
                        slot: { subject: mockSubject },
                    },
                    {
                        id: 3,
                        startMin: 570, // 9:30 AM
                        activity: {
                            id: 3,
                            title: 'Word Problems',
                            milestone: { subject: mockSubject },
                            outcomes: [],
                        },
                        slot: { subject: mockSubject },
                    },
                ],
            };
            mockPrisma.dailyPlan.findMany.mockResolvedValue([mockDailyPlan]);
            mockPrisma.milestone.findMany.mockResolvedValue([]);
            mockPrisma.assessmentResult.findMany.mockResolvedValue([]);
            mockPrisma.calendarEvent.findMany.mockResolvedValue([]);
            mockPrisma.subject.findMany.mockResolvedValue([mockSubject]);
            const result = await extractWeeklyPlan('2024-01-15', 1, { userId: 1 });
            const mathSubject = result.weeklyOverview.subjects.find((s) => s.name === 'Mathematics');
            expect(mathSubject).toBeDefined();
            expect(mathSubject?.totalHours).toBe(0.75); // 3 slots × 0.25 hours each
            expect(mathSubject?.keyTopics).toContain('Addition');
            expect(mathSubject?.keyTopics).toContain('Subtraction');
            expect(mathSubject?.keyTopics).toContain('Word Problems');
        });
        it('should handle empty days gracefully', async () => {
            mockPrisma.dailyPlan.findMany.mockResolvedValue([]);
            mockPrisma.milestone.findMany.mockResolvedValue([]);
            mockPrisma.assessmentResult.findMany.mockResolvedValue([]);
            mockPrisma.calendarEvent.findMany.mockResolvedValue([]);
            mockPrisma.subject.findMany.mockResolvedValue([]);
            const result = await extractWeeklyPlan('2024-01-15', 3, { userId: 1 });
            expect(result.startDate).toBe('2024-01-15');
            expect(result.days).toHaveLength(3);
            expect(result.weeklyOverview.subjects).toHaveLength(0);
            expect(result.weeklyOverview.milestones).toHaveLength(0);
            expect(result.continuityNotes).toHaveLength(3);
            expect(result.emergencyBackupPlans).toHaveLength(0);
        });
        it('should respect user options for data inclusion', async () => {
            const mockDailyPlan = {
                id: 1,
                date: new Date('2024-01-15'),
                items: [],
            };
            mockPrisma.dailyPlan.findMany.mockResolvedValue([mockDailyPlan]);
            mockPrisma.milestone.findMany.mockResolvedValue([]);
            mockPrisma.assessmentResult.findMany.mockResolvedValue([]);
            mockPrisma.calendarEvent.findMany.mockResolvedValue([]);
            mockPrisma.subject.findMany.mockResolvedValue([]);
            // Test with includeGoals: false
            const result = await extractWeeklyPlan('2024-01-15', 1, {
                userId: 1,
                includeGoals: false,
                includeRoutines: false,
                includePlans: false,
            });
            expect(result.days[0].goals).toBeUndefined();
            expect(result.days[0].routines).toBeUndefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvd2Vla2x5UGxhbkV4dHJhY3Rvci51bml0LnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFFM0Usb0NBQW9DO0FBQ3BDLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUUsTUFBYyxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFFakUsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsbURBQW1ELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDakUsWUFBWTtZQUNaLE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFFLEVBQUUsQ0FBQztnQkFDTCxJQUFJLEVBQUUsYUFBYTtnQkFDbkIsTUFBTSxFQUFFLGFBQWE7Z0JBQ3JCLE1BQU0sRUFBRSxlQUFlO2FBQ3hCLENBQUM7WUFFRixNQUFNLGFBQWEsR0FBRztnQkFDcEIsRUFBRSxFQUFFLENBQUM7Z0JBQ0wsS0FBSyxFQUFFLG1CQUFtQjtnQkFDMUIsVUFBVSxFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztnQkFDbEMsT0FBTyxFQUFFLFdBQVc7Z0JBQ3BCLFVBQVUsRUFBRSxFQUFFO2FBQ2YsQ0FBQztZQUVGLE1BQU0sWUFBWSxHQUFHO2dCQUNuQixFQUFFLEVBQUUsQ0FBQztnQkFDTCxLQUFLLEVBQUUsbUJBQW1CO2dCQUMxQixTQUFTLEVBQUUsRUFBRSxP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LENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21pY2hhZWxtY2lzYWFjL0dpdEh1Yi90ZWFjaGluZy1lbmdpbmUyLjAvc2VydmVyL3Rlc3RzL3VuaXQvd2Vla2x5UGxhbkV4dHJhY3Rvci51bml0LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgamVzdCwgZGVzY3JpYmUsIGl0LCBiZWZvcmVFYWNoLCBleHBlY3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB7IGV4dHJhY3RXZWVrbHlQbGFuIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL3dlZWtseVBsYW5FeHRyYWN0b3InO1xuXG4vLyBHZXQgdGhlIG1vY2tlZCBwcmlzbWEgZnJvbSBnbG9iYWxcbmNvbnN0IG1vY2tQcmlzbWEgPSBqZXN0Lm1vY2tlZCgoZ2xvYmFsIGFzIGFueSkudGVzdFByaXNtYUNsaWVudCk7XG5cbmRlc2NyaWJlKCdXZWVrbHlQbGFuRXh0cmFjdG9yJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V4dHJhY3RXZWVrbHlQbGFuJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXh0cmFjdCB3ZWVrbHkgcGxhbiBkYXRhIGZvciBtdWx0aXBsZSBkYXlzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBkYXRhXG4gICAgICBjb25zdCBtb2NrU3ViamVjdCA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIG5hbWU6ICdNYXRoZW1hdGljcycsXG4gICAgICAgIG5hbWVFbjogJ01hdGhlbWF0aWNzJyxcbiAgICAgICAgbmFtZUZyOiAnTWF0aMOpbWF0aXF1ZXMnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja01pbGVzdG9uZSA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIHRpdGxlOiAnTnVtYmVyIE9wZXJhdGlvbnMnLFxuICAgICAgICB0YXJnZXREYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0zMScpLFxuICAgICAgICBzdWJqZWN0OiBtb2NrU3ViamVjdCxcbiAgICAgICAgYWN0aXZpdGllczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrQWN0aXZpdHkgPSB7XG4gICAgICAgIGlkOiAxLFxuICAgICAgICB0aXRsZTogJ0FkZGl0aW9uIFByYWN0aWNlJyxcbiAgICAgICAgbWlsZXN0b25lOiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgIG91dGNvbWVzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tEYWlseVBsYW4gPSB7XG4gICAgICAgIGlkOiAxLFxuICAgICAgICBkYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0xNScpLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgICAgc3RhcnRNaW46IDU0MCwgLy8gOTowMCBBTVxuICAgICAgICAgICAgYWN0aXZpdHk6IG1vY2tBY3Rpdml0eSxcbiAgICAgICAgICAgIHNsb3Q6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgLy8gU2V0dXAgbW9ja3NcbiAgICAgIG1vY2tQcmlzbWEuZGFpbHlQbGFuLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrRGFpbHlQbGFuXSk7XG4gICAgICBtb2NrUHJpc21hLm1pbGVzdG9uZS5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbbW9ja01pbGVzdG9uZV0pO1xuICAgICAgbW9ja1ByaXNtYS5hc3Nlc3NtZW50UmVzdWx0LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgICAgIG1vY2tQcmlzbWEuY2FsZW5kYXJFdmVudC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBtb2NrUHJpc21hLnN1YmplY3QuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tTdWJqZWN0XSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3RXZWVrbHlQbGFuKCcyMDI0LTAxLTE1JywgMywgeyB1c2VySWQ6IDEgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdzdGFydERhdGUnLCAnMjAyNC0wMS0xNScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2RheXMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF5cykudG9IYXZlTGVuZ3RoKDMpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3dlZWtseU92ZXJ2aWV3Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LndlZWtseU92ZXJ2aWV3KS50b0hhdmVQcm9wZXJ0eSgnc3ViamVjdHMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2Vla2x5T3ZlcnZpZXcpLnRvSGF2ZVByb3BlcnR5KCdtaWxlc3RvbmVzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnY29udGludWl0eU5vdGVzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnZW1lcmdlbmN5QmFja3VwUGxhbnMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgY29udGludWl0eSBub3RlcyBiZXR3ZWVuIGRheXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTZXR1cCBtb2NrIGRhdGEgZm9yIGNvbnNlY3V0aXZlIGRheXMgd2l0aCByZWxhdGVkIGFjdGl2aXRpZXNcbiAgICAgIGNvbnN0IG1vY2tTdWJqZWN0ID0geyBpZDogMSwgbmFtZTogJ01hdGhlbWF0aWNzJyB9O1xuXG4gICAgICBjb25zdCBtb2NrUGxhbnMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogMSxcbiAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0xNScpLFxuICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgICAgICBzdGFydE1pbjogNTQwLFxuICAgICAgICAgICAgICBhY3Rpdml0eToge1xuICAgICAgICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnSW50cm9kdWN0aW9uIHRvIEZyYWN0aW9ucycsXG4gICAgICAgICAgICAgICAgbWlsZXN0b25lOiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHNsb3Q6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAyLFxuICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCcyMDI0LTAxLTE2JyksXG4gICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaWQ6IDIsXG4gICAgICAgICAgICAgIHN0YXJ0TWluOiA1NDAsXG4gICAgICAgICAgICAgIGFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgICAgaWQ6IDIsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdGcmFjdGlvbiBPcGVyYXRpb25zJyxcbiAgICAgICAgICAgICAgICBtaWxlc3RvbmU6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc2xvdDogeyBzdWJqZWN0OiBtb2NrU3ViamVjdCB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1ByaXNtYS5kYWlseVBsYW4uZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BsYW5zKTtcbiAgICAgIG1vY2tQcmlzbWEubWlsZXN0b25lLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgICAgIG1vY2tQcmlzbWEuYXNzZXNzbWVudFJlc3VsdC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBtb2NrUHJpc21hLmNhbGVuZGFyRXZlbnQuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgbW9ja1ByaXNtYS5zdWJqZWN0LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrU3ViamVjdF0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0V2Vla2x5UGxhbignMjAyNC0wMS0xNScsIDIsIHsgdXNlcklkOiAxIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmNvbnRpbnVpdHlOb3RlcykudG9IYXZlTGVuZ3RoKDIpO1xuXG4gICAgICBjb25zdCBkYXkyTm90ZXMgPSByZXN1bHQuY29udGludWl0eU5vdGVzWzFdO1xuICAgICAgZXhwZWN0KGRheTJOb3Rlcy5jb25uZWN0aW9ucy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChkYXkyTm90ZXMuY29ubmVjdGlvbnNbMF0pLnRvQ29udGFpbignTWF0aGVtYXRpY3MnKTtcbiAgICAgIGV4cGVjdChkYXkyTm90ZXMuY29ubmVjdGlvbnNbMF0pLnRvQ29udGFpbignSW50cm9kdWN0aW9uIHRvIEZyYWN0aW9ucycpO1xuICAgICAgZXhwZWN0KGRheTJOb3Rlcy5jb25uZWN0aW9uc1swXSkudG9Db250YWluKCdGcmFjdGlvbiBPcGVyYXRpb25zJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGVtZXJnZW5jeSBiYWNrdXAgcGxhbnMgYnkgc3ViamVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdWJqZWN0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgIG5hbWU6ICdNYXRoZW1hdGljcycsXG4gICAgICAgICAgYWN0aXZpdGllczogW1xuICAgICAgICAgICAgeyBpZDogMSwgdGl0bGU6ICdNYXRoIFJldmlldyBXb3Jrc2hlZXRzJywgaXNGYWxsYmFjazogdHJ1ZSB9LFxuICAgICAgICAgICAgeyBpZDogMiwgdGl0bGU6ICdOdW1iZXIgR2FtZXMnLCBpc0ZhbGxiYWNrOiB0cnVlIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAyLFxuICAgICAgICAgIG5hbWU6ICdMYW5ndWFnZSBBcnRzJyxcbiAgICAgICAgICBhY3Rpdml0aWVzOiBbeyBpZDogMywgdGl0bGU6ICdTaWxlbnQgUmVhZGluZycsIGlzRmFsbGJhY2s6IHRydWUgfV0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBtb2NrUHJpc21hLmRhaWx5UGxhbi5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBtb2NrUHJpc21hLm1pbGVzdG9uZS5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBtb2NrUHJpc21hLmFzc2Vzc21lbnRSZXN1bHQuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgbW9ja1ByaXNtYS5jYWxlbmRhckV2ZW50LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgICAgIG1vY2tQcmlzbWEuc3ViamVjdC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3ViamVjdHMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0V2Vla2x5UGxhbignMjAyNC0wMS0xNScsIDEsIHsgdXNlcklkOiAxIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmVtZXJnZW5jeUJhY2t1cFBsYW5zKS50b0hhdmVMZW5ndGgoMik7XG5cbiAgICAgIGNvbnN0IG1hdGhQbGFuID0gcmVzdWx0LmVtZXJnZW5jeUJhY2t1cFBsYW5zLmZpbmQoKHApID0+IHAuc3ViamVjdCA9PT0gJ01hdGhlbWF0aWNzJyk7XG4gICAgICBleHBlY3QobWF0aFBsYW4pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobWF0aFBsYW4/LmFjdGl2aXRpZXMpLnRvQ29udGFpbignTWF0aCBSZXZpZXcgV29ya3NoZWV0cycpO1xuICAgICAgZXhwZWN0KG1hdGhQbGFuPy5hY3Rpdml0aWVzKS50b0NvbnRhaW4oJ051bWJlciBHYW1lcycpO1xuICAgICAgZXhwZWN0KG1hdGhQbGFuPy5tYXRlcmlhbHMpLnRvQ29udGFpbignTWF0aCBtYW5pcHVsYXRpdmVzJyk7XG5cbiAgICAgIGNvbnN0IGxhbmdQbGFuID0gcmVzdWx0LmVtZXJnZW5jeUJhY2t1cFBsYW5zLmZpbmQoKHApID0+IHAuc3ViamVjdCA9PT0gJ0xhbmd1YWdlIEFydHMnKTtcbiAgICAgIGV4cGVjdChsYW5nUGxhbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChsYW5nUGxhbj8uYWN0aXZpdGllcykudG9Db250YWluKCdTaWxlbnQgUmVhZGluZycpO1xuICAgICAgZXhwZWN0KGxhbmdQbGFuPy5tYXRlcmlhbHMpLnRvQ29udGFpbignUmVhZGluZyBib29rcycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgc3ViamVjdCBob3VycyBhbmQgdG9waWNzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdWJqZWN0ID0geyBpZDogMSwgbmFtZTogJ01hdGhlbWF0aWNzJyB9O1xuXG4gICAgICBjb25zdCBtb2NrRGFpbHlQbGFuID0ge1xuICAgICAgICBpZDogMSxcbiAgICAgICAgZGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMTUnKSxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogMSxcbiAgICAgICAgICAgIHN0YXJ0TWluOiA1NDAsIC8vIDk6MDAgQU0gLSBhc3N1bWluZyAxNS1taW51dGUgc2xvdHNcbiAgICAgICAgICAgIGFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgICAgICB0aXRsZTogJ0FkZGl0aW9uJyxcbiAgICAgICAgICAgICAgbWlsZXN0b25lOiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgICAgIG91dGNvbWVzOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzbG90OiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogMixcbiAgICAgICAgICAgIHN0YXJ0TWluOiA1NTUsIC8vIDk6MTUgQU1cbiAgICAgICAgICAgIGFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgIGlkOiAyLFxuICAgICAgICAgICAgICB0aXRsZTogJ1N1YnRyYWN0aW9uJyxcbiAgICAgICAgICAgICAgbWlsZXN0b25lOiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgICAgIG91dGNvbWVzOiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzbG90OiB7IHN1YmplY3Q6IG1vY2tTdWJqZWN0IH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogMyxcbiAgICAgICAgICAgIHN0YXJ0TWluOiA1NzAsIC8vIDk6MzAgQU1cbiAgICAgICAgICAgIGFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgIGlkOiAzLFxuICAgICAgICAgICAgICB0aXRsZTogJ1dvcmQgUHJvYmxlbXMnLFxuICAgICAgICAgICAgICBtaWxlc3RvbmU6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICAgICAgb3V0Y29tZXM6IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNsb3Q6IHsgc3ViamVjdDogbW9ja1N1YmplY3QgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja1ByaXNtYS5kYWlseVBsYW4uZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tEYWlseVBsYW5dKTtcbiAgICAgIG1vY2tQcmlzbWEubWlsZXN0b25lLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgICAgIG1vY2tQcmlzbWEuYXNzZXNzbWVudFJlc3VsdC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBtb2NrUHJpc21hLmNhbGVuZGFyRXZlbnQuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgbW9ja1ByaXNtYS5zdWJqZWN0LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrU3ViamVjdF0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0V2Vla2x5UGxhbignMjAyNC0wMS0xNScsIDEsIHsgdXNlcklkOiAxIH0pO1xuXG4gICAgICBjb25zdCBtYXRoU3ViamVjdCA9IHJlc3VsdC53ZWVrbHlPdmVydmlldy5zdWJqZWN0cy5maW5kKChzKSA9PiBzLm5hbWUgPT09ICdNYXRoZW1hdGljcycpO1xuICAgICAgZXhwZWN0KG1hdGhTdWJqZWN0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1hdGhTdWJqZWN0Py50b3RhbEhvdXJzKS50b0JlKDAuNzUpOyAvLyAzIHNsb3RzIMOXIDAuMjUgaG91cnMgZWFjaFxuICAgICAgZXhwZWN0KG1hdGhTdWJqZWN0Py5rZXlUb3BpY3MpLnRvQ29udGFpbignQWRkaXRpb24nKTtcbiAgICAgIGV4cGVjdChtYXRoU3ViamVjdD8ua2V5VG9waWNzKS50b0NvbnRhaW4oJ1N1YnRyYWN0aW9uJyk7XG4gICAgICBleHBlY3QobWF0aFN1YmplY3Q/LmtleVRvcGljcykudG9Db250YWluKCdXb3JkIFByb2JsZW1zJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBkYXlzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUHJpc21hLmRhaWx5UGxhbi5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBtb2NrUHJpc21hLm1pbGVzdG9uZS5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBtb2NrUHJpc21hLmFzc2Vzc21lbnRSZXN1bHQuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgbW9ja1ByaXNtYS5jYWxlbmRhckV2ZW50LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgICAgIG1vY2tQcmlzbWEuc3ViamVjdC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4dHJhY3RXZWVrbHlQbGFuKCcyMDI0LTAxLTE1JywgMywgeyB1c2VySWQ6IDEgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhcnREYXRlKS50b0JlKCcyMDI0LTAxLTE1Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRheXMpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2Vla2x5T3ZlcnZpZXcuc3ViamVjdHMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2Vla2x5T3ZlcnZpZXcubWlsZXN0b25lcykudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb250aW51aXR5Tm90ZXMpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZW1lcmdlbmN5QmFja3VwUGxhbnMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzcGVjdCB1c2VyIG9wdGlvbnMgZm9yIGRhdGEgaW5jbHVzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0RhaWx5UGxhbiA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKCcyMDI0LTAxLTE1JyksXG4gICAgICAgIGl0ZW1zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcmlzbWEuZGFpbHlQbGFuLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrRGFpbHlQbGFuXSk7XG4gICAgICBtb2NrUHJpc21hLm1pbGVzdG9uZS5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBtb2NrUHJpc21hLmFzc2Vzc21lbnRSZXN1bHQuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgbW9ja1ByaXNtYS5jYWxlbmRhckV2ZW50LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgICAgIG1vY2tQcmlzbWEuc3ViamVjdC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG5cbiAgICAgIC8vIFRlc3Qgd2l0aCBpbmNsdWRlR29hbHM6IGZhbHNlXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0V2Vla2x5UGxhbignMjAyNC0wMS0xNScsIDEsIHtcbiAgICAgICAgdXNlcklkOiAxLFxuICAgICAgICBpbmNsdWRlR29hbHM6IGZhbHNlLFxuICAgICAgICBpbmNsdWRlUm91dGluZXM6IGZhbHNlLFxuICAgICAgICBpbmNsdWRlUGxhbnM6IGZhbHNlLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZGF5c1swXS5nb2FscykudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kYXlzWzBdLnJvdXRpbmVzKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=