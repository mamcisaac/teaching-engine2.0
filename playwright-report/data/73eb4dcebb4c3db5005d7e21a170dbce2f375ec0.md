# Test info

- Name: Activity to Planner Workflow >> activity suggestions and outcome coverage
- Location: /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/activity-to-planner-workflow.spec.ts:265:7

# Error details

```
Error: locator.isVisible: Error: strict mode violation: locator('[data-testid*="outcome"], .outcome-badge, :has-text("Outcome")') resolved to 36 elements:
    1) <html lang="en">‚Ä¶</html> aka locator('html')
    2) <body class="p-4">‚Ä¶</body> aka locator('body')
    3) <div id="root">‚Ä¶</div> aka locator('#root')
    4) <div class="flex h-screen bg-gray-100">‚Ä¶</div> aka locator('div').filter({ hasText: 'Teacher PlannerPlanning' }).nth(1)
    5) <div class="bg-indigo-800 text-white transition-all duration-300 ease-in-out w-64 fixed h-full z-10">‚Ä¶</div> aka getByText('Teacher PlannerPlanning')
    6) <div class="py-4">‚Ä¶</div> aka getByText('Planning ToolsYear PlanUnit')
    7) <a href="/outcomes" class="flex items-center py-2 px-4 text-indigo-100 hover:bg-indigo-700 false">‚Ä¶</a> aka getByRole('link', { name: 'Outcomes' })
    8) <span>Outcomes</span> aka getByRole('link', { name: 'Outcomes' })
    9) <div class="flex-1 transition-all duration-300 ease-in-out ml-64">‚Ä¶</div> aka getByText('Weekly Plannerüá®üá¶EnglishTPWeekly PlannerJun 15 - Jun 19, 2025Auto FillüìùAdd')
    10) <div class="p-6 h-[calc(100vh-64px)] overflow-y-auto">‚Ä¶</div> aka locator('#root div').filter({ hasText: 'Weekly PlannerJun 15 - Jun 19, 2025Auto FillüìùAdd AssessmentPreserve daily' }).nth(2)
    ...

Call log:
    - checking visibility of locator('[data-testid*="outcome"], .outcome-badge, :has-text("Outcome")')

    at /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/activity-to-planner-workflow.spec.ts:305:35
```

# Page snapshot

```yaml
- heading "Teacher Planner" [level=1]
- button:
    - img
- text: Planning Tools
- link "Year Plan":
    - /url: /planner/year
    - img
    - text: Year Plan
- link "Unit Planner":
    - /url: /subjects
    - img
    - text: Unit Planner
- link "Weekly Planner":
    - /url: /planner/week
    - img
    - text: Weekly Planner
- link "Daily Planner":
    - /url: /planner/day
    - img
    - text: Daily Planner
- link "Outcomes":
    - /url: /outcomes
    - img
    - text: Outcomes
- link "Coverage":
    - /url: /coverage
    - img
    - text: Coverage
- text: Resources
- link "Notes":
    - /url: /notes
    - img
    - text: Notes
- link "Reflections":
    - /url: /reflections
    - img
    - text: Reflections
- link "Parent Messages":
    - /url: /parent-messages
    - img
    - text: Parent Messages
- link "Settings":
    - /url: /settings
    - img
    - text: Settings
- button "Logout":
    - img
    - text: Logout
- text: Weekly Planner
- button "Switch language":
    - text: üá®üá¶ English
    - img
- text: TP
- heading "Weekly Planner" [level=1]
- paragraph: Jun 15 - Jun 19, 2025
- textbox: 2025-06-16
- button "Auto Fill"
- button "üìù Add Assessment"
- checkbox "Preserve daily buffer block" [checked]
- text: Preserve daily buffer block
- checkbox "Skip lowest priority activity on short weeks" [checked]
- text: Skip lowest priority activity on short weeks Mon Monday Tue Tuesday Wed Wednesday Thu Thursday Fri Friday Unknown Subject Plant Parts No outcomes linked Unknown Subject 1 + 1 No outcomes linked Unknown Subject Animal Habitats No outcomes linked Unknown Subject 2 + 3 No outcomes linked Unknown Subject Healthy Bodies No outcomes linked Unknown Subject Subtraction Basics No outcomes linked Unknown Subject Number Patterns No outcomes linked Unknown Subject Healthy Minds No outcomes linked Unknown Subject Math Games No outcomes linked
- heading "Week Resources" [level=3]
- button "Download Printables"
- text: üß†
- heading "Language Transfer This Week" [level=4]
- paragraph: No cognate pairs scheduled this week. Consider adding some to reinforce French-English connections!
- button "üì∞ Create Newsletter"
- heading "Suggested Activities" [level=3]
- checkbox "HandsOn" [checked]
- text: HandsOn
- checkbox "Worksheet" [checked]
- text: Worksheet
- checkbox "Video" [checked]
- text: Video
- heading "General Suggestions" [level=3]
- button "High Priority Activity Test Milestone 1750192413590 General":
    - heading "High Priority Activity" [level=4]
    - paragraph: Test Milestone 1750192413590
    - text: General
- button "Medium Priority Activity Test Milestone 1750192413590 General":
    - heading "Medium Priority Activity" [level=4]
    - paragraph: Test Milestone 1750192413590
    - text: General
- button "Low Priority Activity Test Milestone 1750192413590 General":
    - heading "Low Priority Activity" [level=4]
    - paragraph: Test Milestone 1750192413590
    - text: General
- status
- region "Notifications alt+T"
```

# Test source

```ts
  205 |     let testData: TestDataFactory;
  206 |
  207 |     try {
  208 |       const token = await login(page);
  209 |       testData = new TestDataFactory(page, token);
  210 |
  211 |       // Create multiple activities for reordering
  212 |       const subject = await testData.createSubject('Reorder Test Subject');
  213 |       const milestone = await testData.createMilestone(subject.id);
  214 |
  215 |       const activities = await Promise.all([
  216 |         testData.createActivity(milestone.id, 'First Activity'),
  217 |         testData.createActivity(milestone.id, 'Second Activity'),
  218 |         testData.createActivity(milestone.id, 'Third Activity'),
  219 |       ]);
  220 |
  221 |       // Create multiple time slots
  222 |       await testData.createTimetableSlot(subject.id, 1, 540, 600); // 9:00-10:00
  223 |       await testData.createTimetableSlot(subject.id, 1, 600, 660); // 10:00-11:00
  224 |       await testData.createTimetableSlot(subject.id, 1, 660, 720); // 11:00-12:00
  225 |
  226 |       // Navigate to planner
  227 |       const planner = new PlannerPageObject(page);
  228 |       await planner.navigate();
  229 |
  230 |       // Schedule activities in time slots
  231 |       const timeSlots = page.locator('[data-testid="day-1"]').locator('[data-testid*="time-slot"]');
  232 |
  233 |       for (let i = 0; i < activities.length && i < 3; i++) {
  234 |         const activityElement = page.locator(`text="${activities[i].title}"`);
  235 |         const slot = timeSlots.nth(i);
  236 |
  237 |         if (await activityElement.isVisible({ timeout: 3000 }) && await slot.isVisible()) {
  238 |           await activityElement.dragTo(slot);
  239 |           await page.waitForTimeout(1000);
  240 |         }
  241 |       }
  242 |
  243 |       // Test reordering activities within the day
  244 |       const scheduledActivities = page.locator('[data-testid="day-1"]').locator('[data-testid*="activity"], .activity');
  245 |
  246 |       if (await scheduledActivities.count() >= 2) {
  247 |         const firstActivity = scheduledActivities.first();
  248 |         const secondActivity = scheduledActivities.nth(1);
  249 |
  250 |         // Drag first activity to second position
  251 |         await firstActivity.dragTo(secondActivity);
  252 |         await page.waitForLoadState('networkidle');
  253 |
  254 |         // Verify order changed
  255 |         await page.waitForTimeout(1000);
  256 |         console.log('Activity reordering test completed');
  257 |       }
  258 |
  259 |     } catch (error) {
  260 |       await capturePageState(page, 'activity-reordering-failure');
  261 |       throw error;
  262 |     }
  263 |   });
  264 |
  265 |   test('activity suggestions and outcome coverage', async ({ page }) => {
  266 |     let testData: TestDataFactory;
  267 |
  268 |     try {
  269 |       const token = await login(page);
  270 |       testData = new TestDataFactory(page, token);
  271 |
  272 |       // Create test data
  273 |       const subject = await testData.createSubject('Suggestions Test Subject');
  274 |       const milestone = await testData.createMilestone(subject.id);
  275 |
  276 |       // Create multiple activities
  277 |       const activities = await Promise.all([
  278 |         testData.createActivity(milestone.id, 'High Priority Activity'),
  279 |         testData.createActivity(milestone.id, 'Medium Priority Activity'),
  280 |         testData.createActivity(milestone.id, 'Low Priority Activity'),
  281 |       ]);
  282 |
  283 |       // Navigate to planner
  284 |       const planner = new PlannerPageObject(page);
  285 |       await planner.navigate();
  286 |
  287 |       // Look for suggestions panel or section
  288 |       const suggestionsPanel = page.locator('[data-testid="suggestions"], .suggestions').or(page.locator('text="Suggested Activities"'));
  289 |
  290 |       if (await suggestionsPanel.isVisible({ timeout: 5000 })) {
  291 |         // Verify activities appear in suggestions
  292 |         for (const activity of activities) {
  293 |           await expect(page.locator(`text="${activity.title}"`)).toBeVisible({ timeout: 5000 });
  294 |         }
  295 |
  296 |         // Test suggestion priority/ordering
  297 |         const suggestionItems = suggestionsPanel.locator('.suggestion-item, [data-testid*="suggestion"]');
  298 |         if (await suggestionItems.count() > 0) {
  299 |           console.log('Activity suggestions are available');
  300 |         }
  301 |       }
  302 |
  303 |       // Test outcome coverage indicators if available
  304 |       const outcomeIndicators = page.locator('[data-testid*="outcome"], .outcome-badge, :has-text("Outcome")');
> 305 |       if (await outcomeIndicators.isVisible({ timeout: 3000 })) {
      |                                   ^ Error: locator.isVisible: Error: strict mode violation: locator('[data-testid*="outcome"], .outcome-badge, :has-text("Outcome")') resolved to 36 elements:
  306 |         console.log('Outcome coverage indicators are available');
  307 |       }
  308 |
  309 |     } catch (error) {
  310 |       await capturePageState(page, 'activity-suggestions-failure');
  311 |       throw error;
  312 |     }
  313 |   });
  314 |
  315 |   test('activity planning across multiple days', async ({ page }) => {
  316 |     let testData: TestDataFactory;
  317 |
  318 |     try {
  319 |       const token = await login(page);
  320 |       testData = new TestDataFactory(page, token);
  321 |
  322 |       // Create test data
  323 |       const subject = await testData.createSubject('Multi-day Subject');
  324 |       const milestone = await testData.createMilestone(subject.id);
  325 |       const activity = await testData.createActivity(milestone.id, 'Multi-day Activity');
  326 |
  327 |       // Create timetable slots across multiple days
  328 |       await testData.createTimetableSlot(subject.id, 1, 540, 600); // Monday
  329 |       await testData.createTimetableSlot(subject.id, 3, 540, 600); // Wednesday
  330 |       await testData.createTimetableSlot(subject.id, 5, 540, 600); // Friday
  331 |
  332 |       // Navigate to planner
  333 |       const planner = new PlannerPageObject(page);
  334 |       await planner.navigate();
  335 |
  336 |       // Verify all days are visible
  337 |       await expect(page.locator('[data-testid="day-1"]')).toBeVisible({ timeout: 10000 });
  338 |       await expect(page.locator('[data-testid="day-3"]')).toBeVisible({ timeout: 10000 });
  339 |       await expect(page.locator('[data-testid="day-5"]')).toBeVisible({ timeout: 10000 });
  340 |
  341 |       // Test scheduling activity on different days
  342 |       const activityElement = page.locator(`text="${activity.title}"`);
  343 |
  344 |       if (await activityElement.isVisible({ timeout: 5000 })) {
  345 |         // Schedule on Monday
  346 |         const mondaySlot = page.locator('[data-testid="day-1"]').locator('[data-testid*="time-slot"]').first();
  347 |         await activityElement.dragTo(mondaySlot);
  348 |         await page.waitForLoadState('networkidle');
  349 |
  350 |         await planner.expectActivityInDay('day-1', activity.title);
  351 |
  352 |         // Move to Wednesday
  353 |         const mondayActivity = page.locator('[data-testid="day-1"]').locator(`text="${activity.title}"`);
  354 |         const wednesdaySlot = page.locator('[data-testid="day-3"]').locator('[data-testid*="time-slot"]').first();
  355 |
  356 |         if (await mondayActivity.isVisible() && await wednesdaySlot.isVisible()) {
  357 |           await mondayActivity.dragTo(wednesdaySlot);
  358 |           await page.waitForLoadState('networkidle');
  359 |
  360 |           await planner.expectActivityInDay('day-3', activity.title);
  361 |           await planner.expectActivityInDay('day-1', activity.title, false);
  362 |         }
  363 |       }
  364 |
  365 |     } catch (error) {
  366 |       await capturePageState(page, 'multi-day-planning-failure');
  367 |       throw error;
  368 |     }
  369 |   });
  370 |
  371 |   test('activity planning with calendar events integration', async ({ page }) => {
  372 |     let testData: TestDataFactory;
  373 |
  374 |     try {
  375 |       const token = await login(page);
  376 |       testData = new TestDataFactory(page, token);
  377 |
  378 |       // Create test data
  379 |       const subject = await testData.createSubject('Calendar Integration Subject');
  380 |       const milestone = await testData.createMilestone(subject.id);
  381 |       const activity = await testData.createActivity(milestone.id, 'Blocked Activity');
  382 |
  383 |       // Create timetable slot
  384 |       await testData.createTimetableSlot(subject.id, 1, 540, 600); // Monday 9:00-10:00
  385 |
  386 |       // Create calendar event that blocks the time slot
  387 |       const eventStart = new Date();
  388 |       eventStart.setHours(9, 0, 0, 0);
  389 |       const eventEnd = new Date();
  390 |       eventEnd.setHours(10, 0, 0, 0);
  391 |
  392 |       await testData.createCalendarEvent('Assembly', eventStart, eventEnd, {
  393 |         eventType: 'ASSEMBLY',
  394 |         allDay: false,
  395 |       });
  396 |
  397 |       // Navigate to planner
  398 |       const planner = new PlannerPageObject(page);
  399 |       await planner.navigate();
  400 |
  401 |       // Verify calendar event is blocking the time slot
  402 |       await planner.expectCalendarEvent('Assembly');
  403 |
  404 |       // Try to schedule activity in blocked slot
  405 |       const activityElement = page.locator(`text="${activity.title}"`);
```
