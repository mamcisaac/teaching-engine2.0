# Test info

- Name: Activity Reorder >> should allow reordering activities
- Location: /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/activity-reorder.spec.ts:48:7

# Error details

```
TimeoutError: page.waitForURL: Timeout 30010ms exceeded.
=========================== logs ===========================
waiting for navigation to "**/subjects" until "load"
============================================================
    at /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/activity-reorder.spec.ts:53:16
```

# Page snapshot

```yaml
- heading "Teacher Planner" [level=1]
- button:
    - img
- text: Planning Tools
- link "Year Plan":
    - /url: /planner/year
    - img
    - text: Year Plan
- link "Unit Planner":
    - /url: /subjects
    - img
    - text: Unit Planner
- link "Weekly Planner":
    - /url: /planner/week
    - img
    - text: Weekly Planner
- link "Daily Planner":
    - /url: /planner/day
    - img
    - text: Daily Planner
- link "Outcomes":
    - /url: /outcomes
    - img
    - text: Outcomes
- link "Coverage":
    - /url: /coverage
    - img
    - text: Coverage
- text: Resources
- link "Notes":
    - /url: /notes
    - img
    - text: Notes
- link "Reflections":
    - /url: /reflections
    - img
    - text: Reflections
- link "Settings":
    - /url: /settings
    - img
    - text: Settings
- button "Logout":
    - img
    - text: Logout
- text: Dashboard TP
- textbox: 2025-06-09
- button "Auto Fill"
- checkbox "Preserve daily buffer block" [checked]
- text: Preserve daily buffer block
- checkbox "Skip lowest priority activity on short weeks" [checked]
- text: Skip lowest priority activity on short weeks Mon Monday Tue Tuesday Wed Wednesday Thu Thursday Fri Friday Unknown Subject Plant Parts No outcomes linked Unknown Subject 1 + 1 No outcomes linked Unknown Subject Animal Habitats No outcomes linked Unknown Subject 2 + 3 No outcomes linked Unknown Subject Healthy Bodies No outcomes linked Unknown Subject Subtraction Basics No outcomes linked Unknown Subject Number Patterns No outcomes linked Unknown Subject Healthy Minds No outcomes linked Unknown Subject Math Games No outcomes linked
- button "Download Printables"
- heading "Suggestions" [level=2]
- list:
    - button "Activity 1"
    - button "Activity M"
    - button "Activity 2"
    - button "1 + 1"
    - button "2 + 3"
    - button "Subtraction Basics"
    - button "Number Patterns"
    - button "Math Games"
    - button "Plant Parts"
    - button "Animal Habitats"
    - button "Life Cycles"
    - button "Ecosystems"
    - button "Science Experiment"
    - button "Healthy Bodies"
    - button "Healthy Minds"
    - button "Nutrition"
    - button "Exercise"
    - button "Mindfulness"
    - button "Reading Short Stories"
    - button "Creative Writing"
    - button "Spelling Practice"
    - button "Reading Comprehension"
    - button "Show and Tell"
    - button "Community Helpers"
    - button "Cultural Celebrations"
    - button "Map Skills"
    - button "Historical Figures"
    - button "Current Events"
    - button "Math Worksheet"
    - button "Science Experiment"
    - button "Health Discussion"
    - button "Free Reading"
    - button "Current Events"
- status
- button "+ Add Event"
- text: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30
- region "Notifications alt+T"
```

# Test source

```ts
   1 | import { test, expect, Page } from '@playwright/test';
   2 | import { login } from './helpers';
   3 |
   4 | const API_BASE = process.env.API_BASE || 'http://localhost:3001';
   5 |
   6 | // Initialize API context before all tests
   7 | test.beforeAll(async () => {
   8 |   // Check if the server is running
   9 |   try {
   10 |     const response = await fetch(`${process.env.API_BASE || 'http://localhost:3001'}/api/health`);
   11 |     if (!response.ok) {
   12 |       console.error(
   13 |         'Server is not running or not responding correctly. Please start the server on port 3001.',
   14 |       );
   15 |       process.exit(1);
   16 |     }
   17 |   } catch (error) {
   18 |     console.error('Failed to connect to the server:', error);
   19 |     console.error('Please make sure the server is running on port 3001.');
   20 |     process.exit(1);
   21 |   }
   22 | });
   23 |
   24 | // Helper function to capture page state for debugging
   25 | async function capturePageState(page: Page, name: string) {
   26 |   try {
   27 |     await page.screenshot({ path: `test-results/${name}.png`, fullPage: true });
   28 |     console.log(`Screenshot saved: ${name}.png`);
   29 |
   30 |     // Note: To collect console logs, set up page.on('console', ...) in the test
   31 |     // and collect logs in an array that can be accessed here
   32 |
   33 |     const errors = await page.evaluate(() => {
   34 |       return Array.from(document.querySelectorAll('script[src]'))
   35 |         .map((script) => script.src)
   36 |         .filter((src: string) => !src.includes('localhost'));
   37 |     });
   38 |
   39 |     if (errors.length > 0) {
   40 |       console.error('External script errors detected:', errors);
   41 |     }
   42 |   } catch (error) {
   43 |     console.error('Error capturing page state:', error);
   44 |   }
   45 | }
   46 |
   47 | test.describe('Activity Reorder', () => {
   48 |   test('should allow reordering activities', async ({ page }) => {
   49 |     // Login first
   50 |     await login(page);
   51 |
   52 |     // Wait for navigation to complete
>  53 |     await page.waitForURL('**/subjects', { timeout: 30010 });
      |                ^ TimeoutError: page.waitForURL: Timeout 30010ms exceeded.
   54 |
   55 |     // Verify we're on the subjects page
   56 |     await expect(page.getByRole('heading', { name: 'Subjects' })).toBeVisible();
   57 |
   58 |     // Get authentication token
   59 |     const token = await page.evaluate(() => localStorage.getItem('token'));
   60 |     if (!token) {
   61 |       throw new Error('No authentication token found');
   62 |     }
   63 |
   64 |     // Create test data
   65 |     const timestamp = Date.now();
   66 |
   67 |     try {
   68 |       // Create a test subject
   69 |       const subjectData = {
   70 |         name: `Test Subject ${timestamp}`,
   71 |         description: 'Test subject for activity reorder test',
   72 |       };
   73 |
   74 |       const subjectRes = await page.evaluate(
   75 |         async ({ url, data, token }) => {
   76 |           const response = await fetch(url, {
   77 |             method: 'POST',
   78 |             headers: {
   79 |               'Content-Type': 'application/json',
   80 |               Authorization: `Bearer ${token}`,
   81 |             },
   82 |             body: JSON.stringify(data),
   83 |           });
   84 |           return await response.json();
   85 |         },
   86 |         {
   87 |           url: `${API_BASE}/api/subjects`,
   88 |           data: subjectData,
   89 |           token,
   90 |         },
   91 |       );
   92 |
   93 |       if (!subjectRes || !subjectRes.id) {
   94 |         throw new Error('Failed to create test subject');
   95 |       }
   96 |
   97 |       const subject = subjectRes;
   98 |
   99 |       // Create a test milestone
  100 |       const milestoneData = {
  101 |         subjectId: subject.id,
  102 |         title: `Test Milestone ${timestamp}`,
  103 |         description: 'Test milestone for activity reorder test',
  104 |         dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
  105 |       };
  106 |
  107 |       const milestoneRes = await page.evaluate(
  108 |         async ({ url, data, token }) => {
  109 |           const response = await fetch(url, {
  110 |             method: 'POST',
  111 |             headers: {
  112 |               'Content-Type': 'application/json',
  113 |               Authorization: `Bearer ${token}`,
  114 |             },
  115 |             body: JSON.stringify(data),
  116 |           });
  117 |           return await response.json();
  118 |         },
  119 |         {
  120 |           url: `${API_BASE}/api/milestones`,
  121 |           data: milestoneData,
  122 |           token,
  123 |         },
  124 |       );
  125 |
  126 |       if (!milestoneRes || !milestoneRes.id) {
  127 |         throw new Error('Failed to create test milestone');
  128 |       }
  129 |
  130 |       const milestone = milestoneRes;
  131 |
  132 |       // Create test activities
  133 |       const activities = [
  134 |         { title: `Activity A ${timestamp}`, description: 'First activity' },
  135 |         { title: `Activity B ${timestamp}`, description: 'Second activity' },
  136 |         { title: `Activity C ${timestamp}`, description: 'Third activity' },
  137 |       ];
  138 |
  139 |       const createdActivities = [];
  140 |
  141 |       for (const activity of activities) {
  142 |         const activityRes = await page.evaluate(
  143 |           async ({ url, data, token }) => {
  144 |             const response = await fetch(url, {
  145 |               method: 'POST',
  146 |               headers: {
  147 |                 'Content-Type': 'application/json',
  148 |                 Authorization: `Bearer ${token}`,
  149 |               },
  150 |               body: JSON.stringify(data),
  151 |             });
  152 |             return await response.json();
  153 |           },
```
