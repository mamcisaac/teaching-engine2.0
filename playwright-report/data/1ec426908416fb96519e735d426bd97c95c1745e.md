# Test info

- Name: planner skips holiday dates
- Location: /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/holiday-planner.spec.ts:6:5

# Error details

```
TimeoutError: page.waitForSelector: Timeout 10000ms exceeded.
Call log:
  - waiting for locator('.planner-grid') to be visible

    at /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/holiday-planner.spec.ts:35:14
```

# Page snapshot

```yaml
- img
- heading "Something went wrong" [level=1]
- paragraph: We're sorry, but something unexpected happened. Please refresh the page and try again.
- button "Refresh Page"
- group: Error Details (Development)
- region "Notifications alt+T"
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { login, API_BASE } from './helpers';
   3 |
   4 | // Ensure planner skips holidays when auto-filling
   5 |
   6 | test('planner skips holiday dates', async ({ page }) => {
   7 |   const ts = Date.now();
   8 |   const token = await login(page);
   9 |   const subRes = await page.request.post(`${API_BASE}/api/subjects`, {
  10 |     headers: { Authorization: `Bearer ${token}` },
  11 |     data: { name: `H${ts}` },
  12 |   });
  13 |   const subjectId = (await subRes.json()).id as number;
  14 |   const msRes = await page.request.post(`${API_BASE}/api/milestones`, {
  15 |     headers: { Authorization: `Bearer ${token}` },
  16 |     data: { title: 'HM', subjectId },
  17 |   });
  18 |   const milestoneId = (await msRes.json()).id as number;
  19 |   await page.request.post(`${API_BASE}/api/activities`, {
  20 |     headers: { Authorization: `Bearer ${token}` },
  21 |     data: { title: 'HA', milestoneId },
  22 |   });
  23 |   await page.request.put(`${API_BASE}/api/timetable`, {
  24 |     headers: { Authorization: `Bearer ${token}` },
  25 |     data: [{ day: 3, startMin: 540, endMin: 600, subjectId }],
  26 |   });
  27 |
  28 |   await page.goto('/settings');
  29 |   await page.fill('input[type="date"]', '2025-12-25');
  30 |   await page.fill('input[placeholder="Holiday name"]', 'Christmas');
  31 |   await page.click('button:has-text("Add")');
  32 |   await expect(page.locator('text=Christmas')).toBeVisible();
  33 |
  34 |   await page.goto('/planner');
> 35 |   await page.waitForSelector('.planner-grid', { timeout: 10000 });
     |              ^ TimeoutError: page.waitForSelector: Timeout 10000ms exceeded.
  36 |   await page.waitForResponse((r) => r.url().includes('/api/calendar-events') && r.status() === 200);
  37 |   await page.fill('input[type="date"]', '2025-12-22');
  38 |   await page.click('text=Auto Fill');
  39 |   await expect(page.getByText('Christmas')).toBeVisible();
  40 |   await expect(page.locator('[data-testid="day-3"] >> text=HA')).toHaveCount(0);
  41 | });
  42 |
```
