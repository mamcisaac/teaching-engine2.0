# Test info

- Name: rejects drop when activity longer than slot
- Location: /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/duration-conflict.spec.ts:6:5

# Error details

```
TimeoutError: page.waitForSelector: Timeout 10000ms exceeded.
Call log:
  - waiting for locator('.planner-grid') to be visible

    at /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/duration-conflict.spec.ts:66:14
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { login, API_BASE } from './helpers';
   3 |
   4 | // dragging long activity into short slot should be rejected
   5 |
   6 | test('rejects drop when activity longer than slot', async ({ page }) => {
   7 |   const ts = Date.now();
   8 |   const token = await login(page);
   9 |   const subjectRes = await page.request.post(`${API_BASE}/api/subjects`, {
  10 |     headers: { Authorization: `Bearer ${token}` },
  11 |     data: { name: `Dur${ts}` },
  12 |   });
  13 |   const subjectId = (await subjectRes.json()).id as number;
  14 |
  15 |   const milestoneRes = await page.request.post(`${API_BASE}/api/milestones`, {
  16 |     headers: { Authorization: `Bearer ${token}` },
  17 |     data: { title: 'Mdur', subjectId },
  18 |   });
  19 |   const milestoneId = (await milestoneRes.json()).id as number;
  20 |
  21 |   await page.goto(`/milestones/${milestoneId}`);
  22 |
  23 |   await page.request.post(`${API_BASE}/api/activities`, {
  24 |     headers: { Authorization: `Bearer ${token}` },
  25 |     data: { title: 'LongAct', milestoneId, durationMins: 60 },
  26 |   });
  27 |   await page.request.post(`${API_BASE}/api/activities`, {
  28 |     headers: { Authorization: `Bearer ${token}` },
  29 |     data: { title: 'ShortAct', milestoneId, durationMins: 30 },
  30 |   });
  31 |   await page.request.put(`${API_BASE}/api/timetable`, {
  32 |     headers: { Authorization: `Bearer ${token}` },
  33 |     data: [{ day: 0, startMin: 540, endMin: 585, subjectId: 1 }],
  34 |   });
  35 |
  36 |   const weekStart = new Date().toISOString().split('T')[0];
  37 |   await page.route('**/api/lesson-plans/*', async (route) => {
  38 |     if (route.request().method() === 'GET') {
  39 |       await route.fulfill({
  40 |         status: 200,
  41 |         contentType: 'application/json',
  42 |         body: JSON.stringify({ id: 1, weekStart, schedule: [] }),
  43 |       });
  44 |     } else {
  45 |       await route.fallback();
  46 |     }
  47 |   });
  48 |   await page.route('**/api/timetable', async (route) => {
  49 |     await route.fulfill({
  50 |       status: 200,
  51 |       contentType: 'application/json',
  52 |       body: JSON.stringify([
  53 |         {
  54 |           id: 1,
  55 |           day: 0,
  56 |           startMin: 540,
  57 |           endMin: 585,
  58 |           subjectId: 1,
  59 |           subject: { id: 1, name: 'Math', milestones: [] },
  60 |         },
  61 |       ]),
  62 |     });
  63 |   });
  64 |
  65 |   await page.goto('/planner');
> 66 |   await page.waitForSelector('.planner-grid', { timeout: 10000 });
     |              ^ TimeoutError: page.waitForSelector: Timeout 10000ms exceeded.
  67 |   await page.waitForResponse((r) => r.url().includes('/calendar-events') && r.status() === 200);
  68 |   const card = page.locator('text=LongAct').first();
  69 |   const target = page.locator('[data-testid="day-0"]');
  70 |   await card.dragTo(target);
  71 |   await expect(page.locator('text=Too long for this slot')).toBeVisible();
  72 | });
  73 |
```
