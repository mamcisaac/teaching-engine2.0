# Test info

- Name: filters notes by subject and type
- Location: /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/reflections-filter.spec.ts:4:5

# Error details

```
Error: Timed out 10000ms waiting for expect(locator).toHaveCount(expected)

Locator: locator('text=Math Private')
Expected: 0
Received: 1
Call log:
  - expect.toHaveCount with timeout 10000ms
  - waiting for locator('text=Math Private')
    14 Ã— locator resolved to 1 element
       - unexpected value "1"

    at /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/reflections-filter.spec.ts:93:51
```

# Page snapshot

```yaml
- heading "Teacher Planner" [level=1]
- button:
    - img
- text: Planning Tools
- link "Year Plan":
    - /url: /planner/year
    - img
    - text: Year Plan
- link "Unit Planner":
    - /url: /subjects
    - img
    - text: Unit Planner
- link "Weekly Planner":
    - /url: /planner/week
    - img
    - text: Weekly Planner
- link "Daily Planner":
    - /url: /planner/day
    - img
    - text: Daily Planner
- link "Outcomes":
    - /url: /outcomes
    - img
    - text: Outcomes
- link "Coverage":
    - /url: /coverage
    - img
    - text: Coverage
- text: Resources
- link "Notes":
    - /url: /notes
    - img
    - text: Notes
- link "Reflections":
    - /url: /reflections
    - img
    - text: Reflections
- link "Settings":
    - /url: /settings
    - img
    - text: Settings
- button "Logout":
    - img
    - text: Logout
- text: Reflections TP
- heading "Reflections" [level=1]
- combobox:
    - option "All Subjects"
    - option "Math"
    - option "Language Arts"
    - option "Science"
    - option "Social Studies"
    - option "Health"
    - option "Dur1749932214277"
    - option "H1749932219772"
    - option "F1749932220150"
    - option "Math1749932222462" [selected]
    - option "Sci1749932222462"
- textbox
- textbox
- checkbox "Public" [checked]
- text: Public
- checkbox "Private" [checked]
- text: Private
- table:
    - rowgroup:
        - row "Date Subject Activity Type Excerpt":
            - cell "Date"
            - cell "Subject"
            - cell "Activity"
            - cell "Type"
            - cell "Excerpt"
    - rowgroup:
        - row "6/14/2025 Math1749932222462 A11749932222462 Private Math Private":
            - cell "6/14/2025"
            - cell "Math1749932222462"
            - cell "A11749932222462"
            - cell "Private"
            - cell "Math Private"
        - row "6/14/2025 Math1749932222462 A11749932222462 Public Math Public":
            - cell "6/14/2025"
            - cell "Math1749932222462"
            - cell "A11749932222462"
            - cell "Public"
            - cell "Math Public"
- region "Notifications alt+T"
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { login, API_BASE } from './helpers';
   3 |
   4 | test('filters notes by subject and type', async ({ page }) => {
   5 |   const ts = Date.now();
   6 |   const token = await login(page);
   7 |   await page.request.post(`${API_BASE}/api/subjects`, {
   8 |     headers: { Authorization: `Bearer ${token}` },
   9 |     data: { name: `Math${ts}` },
  10 |   });
  11 |   await page.request.post(`${API_BASE}/api/subjects`, {
  12 |     headers: { Authorization: `Bearer ${token}` },
  13 |     data: { name: `Sci${ts}` },
  14 |   });
  15 |
  16 |   const subjectsRes = await page.request.get(`${API_BASE}/api/subjects`, {
  17 |     headers: { Authorization: `Bearer ${token}` },
  18 |   });
  19 |   const subjects = (await subjectsRes.json()) as Array<{ id: number; name: string }>;
  20 |   const mathId = subjects.find((s) => s.name === `Math${ts}`)!.id;
  21 |   const sciId = subjects.find((s) => s.name === `Sci${ts}`)!.id;
  22 |
  23 |   await page.request.post(`${API_BASE}/api/milestones`, {
  24 |     headers: { Authorization: `Bearer ${token}` },
  25 |     data: { title: `M1${ts}`, subjectId: mathId },
  26 |   });
  27 |   await page.request.post(`${API_BASE}/api/milestones`, {
  28 |     headers: { Authorization: `Bearer ${token}` },
  29 |     data: { title: `M2${ts}`, subjectId: sciId },
  30 |   });
  31 |   const milestones = (await (
  32 |     await page.request.get(`${API_BASE}/api/milestones`, {
  33 |       headers: { Authorization: `Bearer ${token}` },
  34 |     })
  35 |   ).json()) as Array<{
  36 |     id: number;
  37 |     title: string;
  38 |   }>;
  39 |   const mathMilestoneId = milestones.find((m) => m.title === `M1${ts}`)!.id;
  40 |   const sciMilestoneId = milestones.find((m) => m.title === `M2${ts}`)!.id;
  41 |
  42 |   await page.request.post(`${API_BASE}/api/activities`, {
  43 |     headers: { Authorization: `Bearer ${token}` },
  44 |     data: { title: `A1${ts}`, milestoneId: mathMilestoneId },
  45 |   });
  46 |   await page.request.post(`${API_BASE}/api/activities`, {
  47 |     headers: { Authorization: `Bearer ${token}` },
  48 |     data: { title: `A2${ts}`, milestoneId: sciMilestoneId },
  49 |   });
  50 |   const activities = (await (
  51 |     await page.request.get(`${API_BASE}/api/activities`, {
  52 |       headers: { Authorization: `Bearer ${token}` },
  53 |     })
  54 |   ).json()) as Array<{
  55 |     id: number;
  56 |     title: string;
  57 |   }>;
  58 |   const mathActId = activities.find((a) => a.title === `A1${ts}`)!.id;
  59 |   const sciActId = activities.find((a) => a.title === `A2${ts}`)!.id;
  60 |
  61 |   await page.request.post(`${API_BASE}/api/notes`, {
  62 |     headers: { Authorization: `Bearer ${token}` },
  63 |     data: { content: 'Math Public', type: 'public', activityId: mathActId },
  64 |   });
  65 |   await page.request.post(`${API_BASE}/api/notes`, {
  66 |     headers: { Authorization: `Bearer ${token}` },
  67 |     data: { content: 'Math Private', type: 'private', activityId: mathActId },
  68 |   });
  69 |   await page.request.post(`${API_BASE}/api/notes`, {
  70 |     headers: { Authorization: `Bearer ${token}` },
  71 |     data: { content: 'Sci Public', type: 'public', activityId: sciActId },
  72 |   });
  73 |
  74 |   await page.goto('/reflections');
  75 |
  76 |   // Wait for the page to load and data to be fetched
  77 |   await page.waitForSelector('select', { timeout: 10000 });
  78 |   await page.waitForLoadState('networkidle');
  79 |
  80 |   // Wait for the select to have options (subjects loaded)
  81 |   await page.waitForFunction(
  82 |     () => {
  83 |       const select = document.querySelector('select');
  84 |       return select && select.options.length > 1; // More than just "All Subjects"
  85 |     },
  86 |     { timeout: 10000 },
  87 |   );
  88 |
  89 |   await page.selectOption('select', `${mathId}`);
  90 |   await page.check('label:has-text("Public") input');
  91 |
  92 |   await expect(page.locator('text=Math Public')).toBeVisible();
> 93 |   await expect(page.locator('text=Math Private')).toHaveCount(0);
     |                                                   ^ Error: Timed out 10000ms waiting for expect(locator).toHaveCount(expected)
  94 |   await expect(page.locator('text=Sci Public')).toHaveCount(0);
  95 | });
  96 |
```
