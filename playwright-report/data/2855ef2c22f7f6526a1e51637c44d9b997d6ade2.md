# Test info

- Name: rejects drop when activity longer than slot
- Location: /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/duration-conflict.spec.ts:5:5

# Error details

```
Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/subjects
Call log:
  - navigating to "http://localhost:5173/subjects", waiting until "load"

    at /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/duration-conflict.spec.ts:7:14
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | // dragging long activity into short slot should be rejected
   4 |
   5 | test('rejects drop when activity longer than slot', async ({ page }) => {
   6 |   const ts = Date.now();
>  7 |   await page.goto('/subjects');
     |              ^ Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:5173/subjects
   8 |   await page.click('text=Add Subject');
   9 |   await page.fill('input[placeholder="New subject"]', `Dur${ts}`);
  10 |   await page.click('button:has-text("Save")');
  11 |   await page.click(`text=Dur${ts}`);
  12 |
  13 |   await page.click('text=Add Milestone');
  14 |   await page.fill('input[placeholder="New milestone"]', 'Mdur');
  15 |   await page.click('button:has-text("Save")');
  16 |   await page.click('text=Mdur');
  17 |
  18 |   const mRes = await page.request.get('/api/milestones');
  19 |   const milestoneList = (await mRes.json()) as Array<{ id: number; title: string }>;
  20 |   const milestoneId = milestoneList.find((m) => m.title === 'Mdur')!.id;
  21 |   await page.request.post('/api/activities', {
  22 |     data: { title: 'LongAct', milestoneId, durationMins: 60 },
  23 |   });
  24 |   await page.request.post('/api/activities', {
  25 |     data: { title: 'ShortAct', milestoneId, durationMins: 30 },
  26 |   });
  27 |   await page.request.put('/api/timetable', {
  28 |     data: [{ day: 0, startMin: 540, endMin: 585, subjectId: 1 }],
  29 |   });
  30 |
  31 |   const weekStart = new Date().toISOString().split('T')[0];
  32 |   await page.route('**/api/lesson-plans/*', async (route) => {
  33 |     if (route.request().method() === 'GET') {
  34 |       await route.fulfill({
  35 |         status: 200,
  36 |         contentType: 'application/json',
  37 |         body: JSON.stringify({ id: 1, weekStart, schedule: [] }),
  38 |       });
  39 |     } else {
  40 |       await route.fallback();
  41 |     }
  42 |   });
  43 |   await page.route('**/api/timetable', async (route) => {
  44 |     await route.fulfill({
  45 |       status: 200,
  46 |       contentType: 'application/json',
  47 |       body: JSON.stringify([
  48 |         {
  49 |           id: 1,
  50 |           day: 0,
  51 |           startMin: 540,
  52 |           endMin: 585,
  53 |           subjectId: 1,
  54 |           subject: { id: 1, name: 'Math', milestones: [] },
  55 |         },
  56 |       ]),
  57 |     });
  58 |   });
  59 |
  60 |   await page.goto('/planner');
  61 |   const card = page.locator('text=LongAct').first();
  62 |   const target = page.locator('[data-testid="day-0"]');
  63 |   await card.dragTo(target);
  64 |   await expect(page.locator('text=Too long for this slot')).toBeVisible();
  65 | });
  66 |
```
