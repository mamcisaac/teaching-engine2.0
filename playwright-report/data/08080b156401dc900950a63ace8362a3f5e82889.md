# Test info

- Name: debug login network
- Location: /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/debug-login-network.spec.ts:403:5

# Error details

```
TimeoutError: page.waitForURL: Timeout 30000ms exceeded.
=========================== logs ===========================
waiting for navigation to "**/subjects" until "networkidle"
============================================================
    at /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/debug-login-network.spec.ts:450:16
```

# Page snapshot

```yaml
- heading "Welcome to Teaching Engine" [level=2]
- list:
  - listitem: Auto-fill your week plan.
  - listitem: Prepare materials.
  - listitem: Send a newsletter.
- button "Got it"
- textbox: 2025-06-09
- button "Auto Fill"
- checkbox "Preserve daily buffer block" [checked]
- text: Preserve daily buffer block
- checkbox "Skip lowest priority activity on short weeks" [checked]
- text: Skip lowest priority activity on short weeks Mon Math Plant Parts 1 + 1 Tue Math Animal Habitats 2 + 3 Wed Math Healthy Bodies Subtraction Basics Thu Math Number Patterns Fri Math Healthy Minds Math Games
- button "Download Printables"
- heading "Suggestions" [level=2]
- list:
  - button "Activity 1"
  - button "Activity M"
  - button "Activity 2"
  - button "1 + 1"
  - button "2 + 3"
  - button "Subtraction Basics"
  - button "Number Patterns"
  - button "Math Games"
  - button "Plant Parts"
  - button "Animal Habitats"
  - button "Life Cycles"
  - button "Ecosystems"
  - button "Science Experiment"
  - button "Healthy Bodies"
  - button "Healthy Minds"
  - button "Nutrition"
  - button "Exercise"
  - button "Mindfulness"
  - button "Reading Short Stories"
  - button "Creative Writing"
  - button "Spelling Practice"
  - button "Reading Comprehension"
  - button "Show and Tell"
  - button "Community Helpers"
  - button "Cultural Celebrations"
  - button "Map Skills"
  - button "Historical Figures"
  - button "Current Events"
  - button "Math Worksheet"
  - button "Science Experiment"
  - button "Health Discussion"
  - button "Free Reading"
  - button "Current Events"
- status
- button "+ Add Event"
- text: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30
- region "Notifications alt+T"
```

# Test source

```ts
  350 |       const subjectsTitle = page.locator('h1:has-text("Subjects")');
  351 |       await expect(subjectsTitle).toBeVisible({ timeout: 10000 });
  352 |       
  353 |       console.log('âœ… Successfully loaded subjects page');
  354 |       await page.screenshot({ path: 'subjects-page.png' });
  355 |       console.log('ðŸ“¸ Screenshot saved: subjects-page.png');
  356 |       
  357 |       // Final auth state check
  358 |       await checkAuthState(page, 'after navigation to subjects');
  359 |       
  360 |       console.log('\n=== Test completed successfully! ===');
  361 |       
  362 |     } catch (error) {
  363 |       console.error('\nâŒ Test failed with error:', error);
  364 |       
  365 |       // Capture detailed error information
  366 |       try {
  367 |         await page.screenshot({ path: 'test-failure.png' });
  368 |         console.log('ðŸ“¸ Screenshot saved: test-failure.png');
  369 |         
  370 |         const pageContent = await page.content();
  371 |         console.log('\nPage content at time of failure:', pageContent.substring(0, 1000) + '...');
  372 |         
  373 |         // Check for any error messages or alerts on the page
  374 |         const errorMessages = await page.$$eval('*', elements => 
  375 |           elements
  376 |             .filter(el => {
  377 |               const text = el.textContent?.trim() || '';
  378 |               return text.length > 0 && text.length < 200 && 
  379 |                     (text.toLowerCase().includes('error') || 
  380 |                      text.toLowerCase().includes('fail') ||
  381 |                      text.toLowerCase().includes('invalid'));
  382 |             })
  383 |             .map(el => ({
  384 |               text: el.textContent?.trim(),
  385 |               tag: el.tagName,
  386 |               id: el.id || 'no-id',
  387 |               class: el.className || 'no-class'
  388 |             }))
  389 |         );
  390 |         
  391 |         if (errorMessages.length > 0) {
  392 |           console.error('Error messages on page:', JSON.stringify(errorMessages, null, 2));
  393 |         }
  394 |       } catch (screenshotError) {
  395 |         console.error('Failed to capture error details:', screenshotError);
  396 |       }
  397 |       
  398 |       throw error;
  399 |     }
  400 |   });
  401 | });
  402 |
  403 | test('debug login network', async ({ page }) => {
  404 |   // Enable request interception
  405 |   await page.route('**/*', (route) => {
  406 |     console.log(`Request: ${route.request().method()} ${route.request().url()}`);
  407 |     route.continue();
  408 |   });
  409 |
  410 |   // Listen to all responses
  411 |   page.on('response', (response) => {
  412 |     const url = response.url();
  413 |     const status = response.status();
  414 |     console.log(`Response: ${status} ${response.statusText()} - ${url}`);
  415 |     
  416 |     // Log API responses with errors
  417 |     if (status >= 400) {
  418 |       console.log(`Error response from ${url}:`, status, response.statusText());
  419 |       response.text()
  420 |         .then(body => console.log('Response body:', body))
  421 |         .catch(e => console.log('Could not read response body:', e));
  422 |     }
  423 |   });
  424 |
  425 |   // Navigate to the login page first
  426 |   console.log('Navigating to login page...');
  427 |   await page.goto('http://localhost:5173/login', { waitUntil: 'networkidle' });
  428 |   console.log('Page title after navigation:', await page.title());
  429 |
  430 |   // Check if already logged in by looking for the logout button
  431 |   const isLoggedIn = await page.locator('button:has-text("Logout")').isVisible().catch(() => false);
  432 |   
  433 |   if (isLoggedIn) {
  434 |     console.log('Already logged in, proceeding to subjects page');
  435 |     await page.goto('http://localhost:5173/subjects', { waitUntil: 'networkidle' });
  436 |   } else {
  437 |     console.log('Filling login form...');
  438 |     await page.fill('input[name="email"]', 'teacher@example.com');
  439 |     await page.fill('input[name="password"]', 'password123');
  440 |
  441 |     console.log('Submitting form...');
  442 |     await Promise.all([
  443 |       page.waitForNavigation({ waitUntil: 'networkidle' }),
  444 |       page.click('button[type="submit"]')
  445 |     ]);
  446 |   }
  447 |
  448 |   // Wait for navigation to complete or timeout
  449 |   try {
> 450 |     await page.waitForURL('**/subjects', { 
      |                ^ TimeoutError: page.waitForURL: Timeout 30000ms exceeded.
  451 |       timeout: 30000, // Increased timeout
  452 |       waitUntil: 'networkidle'
  453 |     });
  454 |     console.log('Successfully navigated to subjects page');
  455 |     
  456 |     // Verify we're on the subjects page by checking for a unique element
  457 |     await expect(page.locator('h1:has-text("Subjects")')).toBeVisible({ timeout: 5000 });
  458 |     console.log('Subjects page verified');
  459 |     
  460 |   } catch (error) {
  461 |     console.error('Navigation to subjects page failed. Current URL:', page.url());
  462 |     console.error('Page title:', await page.title());
  463 |     
  464 |     // Take a screenshot for debugging
  465 |     await page.screenshot({ path: 'login-failure.png' });
  466 |     console.log('Screenshot saved as login-failure.png');
  467 |     
  468 |     // Check for common error messages
  469 |     const errorMessages = await page.$$eval('*', (elements) =>
  470 |       elements
  471 |         .filter((el) => {
  472 |           const text = el.textContent?.trim() || '';
  473 |           return (
  474 |             text.length > 0 &&
  475 |             text.length < 200 &&
  476 |             (text.toLowerCase().includes('error') ||
  477 |               text.toLowerCase().includes('fail') ||
  478 |               text.toLowerCase().includes('invalid') ||
  479 |               text.toLowerCase().includes('incorrect'))
  480 |           );
  481 |         })
  482 |         .map((el) => ({
  483 |           text: el.textContent?.trim(),
  484 |           tag: el.tagName,
  485 |           id: el.id,
  486 |           class: el.className,
  487 |         }))
  488 |     );
  489 |
  490 |     if (errorMessages.length > 0) {
  491 |       console.error('Error messages on page:', JSON.stringify(errorMessages, null, 2));
  492 |     } else {
  493 |       console.log('No error messages found on the page');
  494 |       console.log('Page content:', await page.content());
  495 |     }
  496 |
  497 |     throw error;
  498 |   }
  499 | });
  500 |
```