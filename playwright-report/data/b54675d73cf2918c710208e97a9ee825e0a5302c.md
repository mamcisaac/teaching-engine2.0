# Test info

- Name: ical import blocks planner and sub plan lists event
- Location: /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/subplan-ical.spec.ts:14:5

# Error details

```
TimeoutError: page.waitForSelector: Timeout 10000ms exceeded.
Call log:
  - waiting for locator('.planner-grid') to be visible

    at /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/subplan-ical.spec.ts:31:14
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { login, API_BASE } from './helpers';
   3 | import http from 'http';
   4 | import fs from 'fs';
   5 | import path from 'path';
   6 |
   7 | const icsPath = path.join(__dirname, '../../server/tests/fixtures/sample.ics');
   8 |
   9 | /**
  10 |  * E2E scenario: Teacher imports iCal feed, planner blocks event, and sub plan includes it
  11 |  * Previously skipped due to dependency on external iCal feed in test environment.
  12 |  * Now enabled with a local test fixture for reliable testing.
  13 |  */
  14 | test('ical import blocks planner and sub plan lists event', async ({ page }) => {
  15 |   const ics = fs.readFileSync(icsPath);
  16 |   const srv = http.createServer((req, res) => {
  17 |     res.writeHead(200, { 'Content-Type': 'text/calendar' });
  18 |     res.end(ics);
  19 |   });
  20 |   await new Promise((r) => srv.listen(0, r));
  21 |   const { port } = srv.address() as import('net').AddressInfo;
  22 |   const feedUrl = `http://127.0.0.1:${port}/sample.ics`;
  23 |
  24 |   const token = await login(page);
  25 |   await page.request.post(`${API_BASE}/api/calendar-events/sync/ical`, {
  26 |     headers: { Authorization: `Bearer ${token}` },
  27 |     data: { feedUrl },
  28 |   });
  29 |
  30 |   await page.goto('/planner');
> 31 |   await page.waitForSelector('.planner-grid', { timeout: 10000 });
     |              ^ TimeoutError: page.waitForSelector: Timeout 10000ms exceeded.
  32 |   await page.waitForResponse((r) => r.url().includes('/calendar-events') && r.status() === 200);
  33 |   const dateInput = page.locator('input[type="date"]');
  34 |   await dateInput.waitFor({ state: 'visible' });
  35 |   await dateInput.fill('2025-01-01', { force: true });
  36 |   await page.waitForResponse(
  37 |     (r) => r.url().includes('/calendar-events') && r.request().method() === 'GET',
  38 |   );
  39 |   await expect(page.getByText('Test Event').first()).toBeVisible();
  40 |
  41 |   const resp = await page.request.post(`${API_BASE}/api/subplan/generate?date=2025-01-01`, {
  42 |     headers: { Authorization: `Bearer ${token}` },
  43 |   });
  44 |   expect(resp.ok()).toBe(true);
  45 |
  46 |   srv.close();
  47 | });
  48 |
```
