# Test info

- Name: Milestone Management >> deletes a milestone
- Location: /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/milestone-management.spec.ts:122:7

# Error details

```
Error: expect(received).toBe(expected) // Object.is equality

Expected: 200
Received: 204
    at /Users/michaelmcisaac/GitHub/teaching-engine2.0/tests/e2e/milestone-management.spec.ts:164:37
```

# Page snapshot

```yaml
- heading "Teacher Planner" [level=1]
- button:
    - img
- text: Planning Tools
- link "Year Plan":
    - /url: /planner/year
    - img
    - text: Year Plan
- link "Unit Planner":
    - /url: /subjects
    - img
    - text: Unit Planner
- link "Weekly Planner":
    - /url: /planner/week
    - img
    - text: Weekly Planner
- link "Daily Planner":
    - /url: /planner/day
    - img
    - text: Daily Planner
- link "Outcomes":
    - /url: /outcomes
    - img
    - text: Outcomes
- link "Coverage":
    - /url: /coverage
    - img
    - text: Coverage
- text: Resources
- link "Notes":
    - /url: /notes
    - img
    - text: Notes
- link "Reflections":
    - /url: /reflections
    - img
    - text: Reflections
- link "Parent Messages":
    - /url: /parent-messages
    - img
    - text: Parent Messages
- link "Settings":
    - /url: /settings
    - img
    - text: Settings
- button "Logout":
    - img
    - text: Logout
- text: Unit Planner
- button "Switch language":
    - text: ðŸ‡¨ðŸ‡¦ English
    - img
- text: TP
- heading "Delete Test Subject" [level=1]
- button "Add Milestone"
- list
- region "Notifications alt+T":
    - list:
        - listitem:
            - img
            - text: Milestone deleted
        - listitem:
            - img
            - text: Milestone created
        - listitem:
            - img
            - text: Subject created
```

# Test source

```ts
   64 |     await page.click('button:has-text("Add Subject")');
   65 |     await page.waitForSelector('#subject-name');
   66 |     await page.fill('#subject-name', 'Edit Test Subject');
   67 |     await page.click('button[type="submit"]:has-text("Save")');
   68 |     await page.waitForSelector('#subject-name', { state: 'hidden' });
   69 |
   70 |     // Navigate to the test subject
   71 |     await page.click('a:has-text("Edit Test Subject")');
   72 |     await page.waitForSelector('button:has-text("Add Milestone")');
   73 |
   74 |     // Create a milestone to edit
   75 |     const createResponsePromise = page.waitForResponse(
   76 |       response => response.url().includes('/api/milestones') && response.request().method() === 'POST'
   77 |     );
   78 |
   79 |     await page.click('button:has-text("Add Milestone")');
   80 |     await page.waitForSelector('#milestone-title');
   81 |     await page.fill('#milestone-title', 'Original Milestone');
   82 |     await page.fill('textarea', 'Original description');
   83 |     await page.click('button[type="submit"]:has-text("Save")');
   84 |
   85 |     const response = await createResponsePromise;
   86 |     expect(response.status()).toBe(201);
   87 |     await page.waitForSelector('#milestone-title', { state: 'hidden' });
   88 |     await page.waitForTimeout(1000); // Give React time to re-render
   89 |
   90 |     // Wait for the milestone to appear
   91 |     await expect(page.locator('text=Original Milestone')).toBeVisible({ timeout: 10000 });
   92 |
   93 |     // Edit the milestone
   94 |     const milestoneItem = page.locator('li').filter({ hasText: 'Original Milestone' });
   95 |     await milestoneItem.locator('button:has-text("Edit")').click();
   96 |
   97 |     // Wait for edit dialog to open
   98 |     await page.waitForSelector('#edit-milestone-title');
   99 |
  100 |     // Listen for update API response
  101 |     const updateResponsePromise = page.waitForResponse(
  102 |       response => response.url().includes('/api/milestones/') && response.request().method() === 'PUT'
  103 |     );
  104 |
  105 |     // Clear and update fields
  106 |     await page.fill('#edit-milestone-title', 'Updated Milestone Title');
  107 |     await page.fill('textarea', 'Updated description');
  108 |
  109 |     // Submit the form
  110 |     await page.click('button[type="submit"]:has-text("Save")');
  111 |
  112 |     // Wait for the API response
  113 |     await updateResponsePromise;
  114 |     await page.waitForSelector('#edit-milestone-title', { state: 'hidden' });
  115 |     await page.waitForTimeout(1000); // Give React time to re-render
  116 |
  117 |     // Verify the changes
  118 |     await expect(page.locator('text=Updated Milestone Title')).toBeVisible({ timeout: 10000 });
  119 |     await expect(page.locator('text=Updated description')).toBeVisible({ timeout: 10000 });
  120 |   });
  121 |
  122 |   test('deletes a milestone', async ({ page }) => {
  123 |     // First create a subject
  124 |     await page.goto('/subjects');
  125 |     await page.click('button:has-text("Add Subject")');
  126 |     await page.waitForSelector('#subject-name');
  127 |     await page.fill('#subject-name', 'Delete Test Subject');
  128 |     await page.click('button[type="submit"]:has-text("Save")');
  129 |     await page.waitForSelector('#subject-name', { state: 'hidden' });
  130 |
  131 |     // Navigate to the test subject
  132 |     await page.click('a:has-text("Delete Test Subject")');
  133 |     await page.waitForSelector('button:has-text("Add Milestone")');
  134 |
  135 |     // Create a milestone
  136 |     const createResponsePromise = page.waitForResponse(
  137 |       response => response.url().includes('/api/milestones') && response.request().method() === 'POST'
  138 |     );
  139 |
  140 |     await page.click('button:has-text("Add Milestone")');
  141 |     await page.waitForSelector('#milestone-title');
  142 |     await page.fill('#milestone-title', 'Milestone to Delete');
  143 |     await page.click('button[type="submit"]:has-text("Save")');
  144 |
  145 |     const createResponse = await createResponsePromise;
  146 |     expect(createResponse.status()).toBe(201);
  147 |     await page.waitForSelector('#milestone-title', { state: 'hidden' });
  148 |     await page.waitForTimeout(1000); // Give React time to re-render
  149 |
  150 |     // Wait for the milestone to appear
  151 |     await expect(page.locator('text=Milestone to Delete')).toBeVisible({ timeout: 10000 });
  152 |
  153 |     // Listen for delete API response
  154 |     const deleteResponsePromise = page.waitForResponse(
  155 |       response => response.url().includes('/api/milestones/') && response.request().method() === 'DELETE'
  156 |     );
  157 |
  158 |     // Delete the milestone
  159 |     const milestoneItem = page.locator('li').filter({ hasText: 'Milestone to Delete' });
  160 |     await milestoneItem.locator('button:has-text("Delete")').click();
  161 |
  162 |     // Wait for the API response
  163 |     const deleteResponse = await deleteResponsePromise;
> 164 |     expect(deleteResponse.status()).toBe(200);
      |                                     ^ Error: expect(received).toBe(expected) // Object.is equality
  165 |     await page.waitForTimeout(1000); // Give React time to re-render
  166 |
  167 |     // Verify the milestone is gone
  168 |     await expect(page.locator('text=Milestone to Delete')).not.toBeVisible({ timeout: 10000 });
  169 |   });
  170 |
  171 |   test('adds activities to a milestone', async ({ page }) => {
  172 |     // First create a subject
  173 |     await page.goto('/subjects');
  174 |     await page.click('button:has-text("Add Subject")');
  175 |     await page.waitForSelector('#subject-name');
  176 |     await page.fill('#subject-name', 'Activity Test Subject');
  177 |     await page.click('button[type="submit"]:has-text("Save")');
  178 |     await page.waitForSelector('#subject-name', { state: 'hidden' });
  179 |
  180 |     // Navigate to the test subject
  181 |     await page.click('a:has-text("Activity Test Subject")');
  182 |     await page.waitForSelector('button:has-text("Add Milestone")');
  183 |
  184 |     // Create a milestone
  185 |     const createResponsePromise = page.waitForResponse(
  186 |       response => response.url().includes('/api/milestones') && response.request().method() === 'POST'
  187 |     );
  188 |
  189 |     await page.click('button:has-text("Add Milestone")');
  190 |     await page.waitForSelector('#milestone-title');
  191 |     await page.fill('#milestone-title', 'Milestone with Activities');
  192 |     await page.click('button[type="submit"]:has-text("Save")');
  193 |
  194 |     const createResponse = await createResponsePromise;
  195 |     expect(createResponse.status()).toBe(201);
  196 |     await page.waitForSelector('#milestone-title', { state: 'hidden' });
  197 |     await page.waitForTimeout(1000); // Give React time to re-render
  198 |
  199 |     // Wait for the milestone to appear
  200 |     await expect(page.locator('text=Milestone with Activities')).toBeVisible({ timeout: 10000 });
  201 |
  202 |     // Click on the milestone title to navigate to its detail page
  203 |     const milestoneLink = page.locator('a').filter({ hasText: 'Milestone with Activities' });
  204 |     await milestoneLink.click();
  205 |
  206 |     // Wait for milestone detail page to load
  207 |     await page.waitForSelector('h1:has-text("Milestone with Activities")');
  208 |
  209 |     // Listen for activity creation API response
  210 |     const activityResponsePromise = page.waitForResponse(
  211 |       response => response.url().includes('/api/activities') && response.request().method() === 'POST'
  212 |     );
  213 |
  214 |     // Add a new activity
  215 |     await page.click('button:has-text("Add Activity")');
  216 |
  217 |     // Wait for activity form to appear
  218 |     await page.waitForSelector('input#activity-title');
  219 |
  220 |     await page.fill('input#activity-title', 'Test Activity');
  221 |     await page.fill('textarea', 'Test activity description');
  222 |
  223 |     // Select activity type if select exists
  224 |     const typeSelect = page.locator('select#activity-type');
  225 |     if (await typeSelect.isVisible()) {
  226 |       await typeSelect.selectOption('lesson');
  227 |     }
  228 |
  229 |     // Submit the form
  230 |     await page.click('button[type="submit"]:has-text("Save")');
  231 |
  232 |     // Wait for the API response
  233 |     await activityResponsePromise;
  234 |     await page.waitForSelector('input#activity-title', { state: 'hidden' });
  235 |     await page.waitForTimeout(1000); // Give React time to re-render
  236 |
  237 |     // Verify the activity was added
  238 |     await expect(page.locator('text=Test Activity')).toBeVisible({ timeout: 10000 });
  239 |     // Note: The description might not be visible depending on the UI
  240 |     const descriptionCount = await page.locator('text=Test activity description').count();
  241 |     if (descriptionCount > 0) {
  242 |       await expect(page.locator('text=Test activity description')).toBeVisible({ timeout: 10000 });
  243 |     }
  244 |   });
  245 |
  246 |   test('shows milestone progress', async ({ page }) => {
  247 |     // First create a subject
  248 |     await page.goto('/subjects');
  249 |     await page.click('button:has-text("Add Subject")');
  250 |     await page.waitForSelector('#subject-name');
  251 |     await page.fill('#subject-name', 'Progress Test Subject');
  252 |     await page.click('button[type="submit"]:has-text("Save")');
  253 |     await page.waitForSelector('#subject-name', { state: 'hidden' });
  254 |
  255 |     // Navigate to the test subject
  256 |     await page.click('a:has-text("Progress Test Subject")');
  257 |     await page.waitForSelector('button:has-text("Add Milestone")');
  258 |
  259 |     // Create a milestone
  260 |     const createResponsePromise = page.waitForResponse(
  261 |       response => response.url().includes('/api/milestones') && response.request().method() === 'POST'
  262 |     );
  263 |
  264 |     await page.click('button:has-text("Add Milestone")');
```
